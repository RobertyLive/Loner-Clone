click:()=>{Ps.default.tabs.create({url:`/content/details.html?tab_id=${r.tab_id}&media_hash=${o.hash}`})}}]),this.media_tags.init(o,i.custom_strings.addon);let n=s=>{if(!this.meta?.url.isSome())return;let u=this.meta.url.value.hostname;W({name:"set_default_action",data:{action:s,hostname:u}}),this.action=s,this._updateMediaSelectorVisibility();let l=this._argsFromDOM();this.span_extension.textContent=l.extension,this._updateActionButtons()};Y(this.box_drm,o.has_drm);let a=this._argsFromMetaAndMedia(i.prefered_quality);this.span_directory.textContent=a.subdir,this.span_filename.textContent=a.good_basename,this.span_extension.textContent=a.extension,this._updateActionButtons(),this.action_copy.onclick=()=>this._doCopyLink(),this.action_download.onclick=()=>this._doDownload(),this.action_download_as.onclick=()=>this._doDownloadAs(),this.action_download_audio.onclick=()=>this._doDownloadAudio(),this._setupFilenameEditor()}metaHasChanged(o,r){if(this.meta=o,!this.filename_is_dirty){let i=this._argsFromMetaAndMedia(r);this.span_filename.textContent=i.good_basename}this.span_directory.textContent=this.meta.smartnaming_rule.subdir}_argsFromDOM(){let o=this.action=="download_audio",r=this.action=="download_as",i=ue(this.span_filename.textContent),t=this.media,{subdir:n}=Mr(t,this.meta);if(t.type=="m3u8_playlist"||t.type=="youtube_format"||t.type=="mpd_playlist"){let a=this.media_selector.getPlaylistEntry();return Yt(t,o,r,this.prefered_muxer,i,n,a,this.throttle)}else return Yt(t,o,r,this.prefered_muxer,i,n,void 0,this.throttle)}_argsFromMetaAndMedia(o){let r=this.action=="download_audio",i=this.action=="download_as",t=this.media,{basename:n,subdir:a}=Mr(t,this.meta);if(t.type=="m3u8_playlist"||t.type=="youtube_format"||t.type=="mpd_playlist"){let s=fr(t,o);return Yt(t,r,i,this.prefered_muxer,n,a,s,this.throttle)}else return Yt(t,r,i,this.prefered_muxer,n,a,