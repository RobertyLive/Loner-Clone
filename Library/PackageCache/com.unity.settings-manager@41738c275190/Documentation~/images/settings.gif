.."),this.isStarted&&this.stop();const e=this.worker.deinitialize();return this.worker.off(Sl,this._onONSMonitoringStatusChanged),this._useAxon?this._onsAxonWorker=void 0:this._onsLongPollWorker=void 0,this.onsMonitoringStatus=Al.Unknown,e}start(){var e,t;this._isStarted?this.logDebug("ONS Context is already active! Skipping activation call..."):(this.logInfo("Activating ONS Context..."),this._isStarted=!0,this._documentSupportsVisibility&&(null===(e=this._document)||void 0===e||e.addEventListener("visibilitychange",this._onVisibilityChange)),this._documentSupportsVisibility&&"visible"!==(null===(t=this._document)||void 0===t?void 0:t.visibilityState)||this.worker.start())}stop(){var e;this._isStarted?(this.logInfo("Deactivating ONS Context..."),this._isStarted=!1,this._documentSupportsVisibility&&(null===(e=this._document)||void 0===e||e.removeEventListener("visibilitychange",this._onVisibilityChange)),this._stopTimeout&&(clearTimeout(this._stopTimeout),this._stopTimeout=void 0),this.worker.stop()):this.logDebug("ONS Context is inactive! Skipping deactivation call...")}async watch(e){const t=new Set;if(e.forEach((i=>{var s;const r=this._core.hostAssetContext._assetPool.getLocalItemById(i);if(!r||r.isFolder)return t.add(i),void this.logDebug(`Will unconditionally monitor asset ${i} of type ${(null==r?void 0:r.isFolder)?"folder":"unknown"}.`);const n=null===(s=null==r?void 0:r.ancestorIDs)||void 0===s?void 0:s.at(-1);n?e.has(n)?this.logDebug(`Asset ${i} will be monitored via shallow monitoring of its parent ${n}`):(t.add(i),this.logDebug(`Will monitor asset ${i} because its parent is unknown.`)):(t.add(i),this.logDebug(`Will monitor asset ${i} because it has no parent.`))})),this._assetsIds=t,this.logDebug(`Watching ${this._assetsIds.size} asset(s):`,this._assetsIds),await this.ensureInitialized())return this.worker.watch(this._assetsIds);this.logError("Failed to watch assets due to ONS Context initialization error.")}async _getAndCacheDocument(e){return(await this._core._environment.fetch(e,{headers:{Accept:"application/vnd.syncservice.v2.hal+json"},authHeader:"X-User-Token"})).json()}async _getSyncServiceDiscovery(){var e;const t=await this._getAndCacheDocument(`https://${this._core._environment.endpoints.SYNC_SERVICE_HOST}/api/v1`);if(!this.useAxon&&!(null===(e=null==t?void 0:t._links)||void 0===e?void 0:e[gt.NOTIFICATIONS_LONGPOLL]))throw Ge.create(Ue.UNKNOWN,"Invalid Sync Service Discovery (Missing the required link for Long Poll).");return t}async getSubscriptionConfig(){var e,t;try{const i=await this._getSyncServiceDiscovery();return null!==(t=null===(e=null==i?void 0:i.config)||void 0===e?void 0:e.subscriptions)&&void 0!==t?t:{}}catch(e){return this.logInfo(`Error fetching ONS subscription config from the Sync Service Discovery: ${e}`),{}}}async getLink(e,t={}){return bt((await this._getSyncServiceDiscovery())._links,e,t)}logDebug(e,...t){this._logger.logDebug(e,"Context",...t)}logInfo(e,...t){this._logger.logInfo(e,"Context",...t)}logWarn(e,...t){this._logger.logWarn(e,"Context",...t)}logError(e,...t){this._logger.logError(e,"Context",...t)}}qe([Pt],cu.prototype,"ensureInitialized",null),qe([Pt],cu.prototype,"_deinitialize",null),qe([Pt],cu.prototype,"watch",null),qe([st((e=>e._links&&au.every((t=>e._links[t])))),Ye(0,tt)],cu.prototype,"_getAndCacheDocument",null);class lu extends Nn{matches(e){return!!e.isAvailableOffline&&super.matches(e)}}class du extends Nn{constructor(){super({_isSharedWithYou:!0})}matches(e){return!0===e.isFavorite}}class uu{constructor(e){this._core=e}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i;const s=await this._core._getGQLManager(),{mediaTypes:r}=e.filter,{field:n,direction:o}=e.order,{favorites:a,pageInfo:c}=await s.getFavorites({first:(null===(i=e.loadOptions)||void 0===i?void 0:i.limit)||20,after:t,filter:r?{dc_format:[...r].sort()}:void 0,orderBy:{field:"name"===n?"NAME":"CREATE_DATE",direction:"ascending"===o?"ASCENDING":"DESCENDING"}}),l=this._core._environment.getValue("GQL_LIST_UPDATE_LATENCY"),d=Date.now()-l,u=this._core._getAssetPool().createLoaderUpdateSession(d),h=_c.updateRemoteItems(u,a);let p;return u.commit(),c.hasNextPage&&(p=e=>this._loadPage(e,c.endCursor)),{items:h,loadNextPage:p}}}const hu={name:"NAME",created:"DEVICE_CREATE_DATE",modified:"DEVICE_MODIFY_DATE",shared:"SHARE_DATE"},pu={ascending:"ASCENDING",descending:"DESCENDING"};class _u{constructor(e){this._core=e,this._processIncrementalData=async e=>{if(!e.length)return void console.warn("PLSSWYAdobeAssetLoader: Invalid incremental data format",e);const t=await this._core.getAssetContext(),i=this._core._getAssetPool().createUpdateSession();e.forEach((e=>{const{appMetadata:s,deferredRepoAssetId:r}=e,n=this._core._getAssetPool().getLocalItemById(r);if(!n)return void console.warn(`PLSSWYAdobeAssetLoader: Could not find asset with ID ${r} for incremental update`);const o=this._extractDeferredData(s);o&&t._adobeAssetUpdater.updateLocalItem(i,n,o)})),i.commit()}}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i,s;const r=await this._core._getGQLManager(),{mediaTypes:n}=e.filter,o=this._core._environment.getValue("GQL_LIST_UPDATE_LATENCY"),a=Date.now()-o,{items:c,pageInfo:l}=await r.getSharedWithYou({first:null!==(s=null===(i=e.loadOptions)||void 0===i?void 0:i.limit)&&void 0!==s?s:20,after:t,filter:n?{dc_format:[...n]}:void 0,orderBy:{field:hu[e.order.field],direction:pu[e.order.direction]}},this._processIncrementalData),d=this._core._getAssetPool().createLoaderUpdateSession(a),u=_c.updateRemoteItems(d,c).filter((e=>"directory"!==e._assetClass));let h;return d.commit(),l.hasNextPage&&(h=e=>this._loadPage(e,l.endCursor)),{items:u,loadNextPage:h,mostRecentValidMutation:a}}_extractDeferredData(e){if(e)return{_embedded:{[gt.APP_METADATA]:null==e?void 0:e.valueOf}}}}class mu{constructor(e){this._core=e,this._processIncrementalData=async e=>{if(!e.length)return void console.warn("PLSRecentAdobeAssetLoader: Invalid incremental data format",e);const t=await this._core.getAssetContext(),i=this._core._getAssetPool().createUpdateSession();e.forEach((e=>{const{appMetadata:s,deferredRepoAssetId:r}=e,n=this._core._getAssetPool().getLocalItemById(r);if(!n)return void console.warn(`PLSRecentAdobeAssetLoader: Could not find asset with ID ${r} for incremental update`);const o=this._extractDeferredData(s);o&&t._adobeAssetUpdater.updateLocalItem(i,n,o)})),i.commit()}}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i;const s=await this._core._getGQLManager(),{mediaTypes:r}=e.filter,n=this._core._environment.getValue("GQL_LIST_UPDATE_LATENCY"),o=Date.now()-n,{items:a,pageInfo:c}=await s.recents({first:(null===(i=e.loadOptions)||void 0===i?void 0:i.limit)||20,after:t,filter:r?{dc_format:[...r]}:void 0},this._processIncrementalData),l=this._core._getAssetPool().createLoaderUpdateSession(o),d=_c.updateRemoteItems(l,a);let u;return l.commit(),c.hasNextPage&&(u=e=>this._loadPage(e,c.endCursor)),{items:d,loadNextPage:u,mostRecentValidMutation:o}}_extractDeferredData(e){if(e)return{_embedded:{[gt.APP_METADATA]:null==e?void 0:e.valueOf}}}}var fu,gu;!function(e){e[e.ALL=0]="ALL",e[e.YOURS=1]="YOURS",e[e.SHARED_WITH_YOU=2]="SHARED_WITH_YOU"}(fu||(fu={}));class yu{constructor(e){this.options=e}get hash(){var e,t,i,s;return`isShared=${null!==(t=null===(e=this.options)||void 0===e?void 0:e.isSharedWithYou)&&void 0!==t?t:"all"}:createdBy=${null!==(s=null===(i=this.options)||void 0===i?void 0:i.ownedBy)&&void 0!==s?s:"any"}`}getRelationToFilter(e){var t,i,s,r,n,o,a,c;return void 0!==(null===(t=this.options)||void 0===t?void 0:t.isSharedWithYou)&&void 0!==(null===(i=e.options)||void 0===i?void 0:i.isSharedWithYou)&&this.options.isSharedWithYou!==e.options.isSharedWithYou||(null===(s=this.options)||void 0===s?void 0:s.ownedBy)&&(null===(r=e.options)||void 0===r?void 0:r.ownedBy)&&this.options.ownedBy!==e.options.ownedBy?"disjoint":void 0===(null===(n=this.options)||void 0===n?void 0:n.isSharedWithYou)&&void 0!==(null===(o=e.options)||void 0===o?void 0:o.isSharedWithYou)||void 0===(null===(a=this.options)||void 0===a?void 0:a.ownedBy)&&void 0!==(null===(c=e.options)||void 0===c?void 0:c.ownedBy)?"unknown":"subset"}matches(e){var t,i,s,r,n,o;return!((void 0!==(null===(t=this.options)||void 0===t?void 0:t.isSharedWithYou)||void 0!==(null===(i=this.options)||void 0===i?void 0:i.ownedBy))&&((null===(s=this.options)||void 0===s?void 0:s.isSharedWithYou)&&!e._isSWYAsset_NoLazyLoad||!1===(null===(r=this.options)||void 0===r?void 0:r.isSharedWithYou)&&!1!==e._isSWYAsset_NoLazyLoad||(null===(n=this.options)||void 0===n?void 0:n.ownedBy)&&(null===(o=e._storageAssignee_NoLazyLoad)||void 0===o?void 0:o.id)!==this.options.ownedBy))}}!function(e){e.Size50="50",e.Size100="100",e.Size115="115",e.Size230="230",e.Size138="138",e.Size276="276"}(gu||(gu={}));class vu extends Fs{constructor(e,t){super(e,t),this._countryCode="",this._displayName="",this._email="",this._firstName="",this._lastName="",this._addressBookIdent="",this._images={},this._linkedIdentity="",this._urn=""}get ident(){return this.id}get countryCode(){return this._countryCode}get displayName(){return this._displayName}get email(){return this._email}get firstName(){return this._firstName}get lastName(){return this._lastName}get addressBookIdent(){return this._addressBookIdent}get images(){return this._images}get linkPolicy(){return this._linkPolicy}get linkedIdentity(){return this._linkedIdentity}get urn(){return this._urn}}qe([ut],vu.prototype,"countryCode",null),qe([ut],vu.prototype,"displayName",null),qe([ut],vu.prototype,"email",null),qe([ut],vu.prototype,"firstName",null),qe([ut],vu.prototype,"lastName",null),qe([ut],vu.prototype,"addressBookIdent",null),qe([ut],vu.prototype,"images",null),qe([ut],vu.prototype,"linkPolicy",null),qe([ut],vu.prototype,"linkedIdentity",null),qe([ut],vu.prototype,"urn",null);const Ou=new mn({localItemType:vu,remoteIdProperty:"ident",propertyUpdater:new Sn({_countryCode:"countryCode",_displayName:"displayName",_email:"email",_firstName:"firstName",_addressBookIdent:"addressBookIdent",_images:{format:"object",name:"images"},_lastName:"lastName",_linkPolicy:"linkPolicy",_linkedIdentity:"linkedIdentity",_urn:"urn"})});class bu{constructor(e,t,i,s){this._addressBookUrl=e,this._groupMemberPool=t,this._addressBookInterface=i,this._groupMemberUpdater=s}async loadPage(e,t){const{limit:i=100}=(null==e?void 0:e.loadOptions)||{limit:100};let s;s=t?await this._addressBookInterface.getMembersNextPage(t):await this._addressBookInterface.getMembersFirstPage(this._addressBookUrl,i);const r=this._groupMemberPool.createLoaderMutationSession(),n=this._groupMemberUpdater.updateRemoteItems(r,s._embedded.contacts);return r.commit(),{items:n,loadNextPage:s._links.next?()=>this.loadPage(void 0,s._links.next.href):void 0,total:s.total}}}class Eu extends lr{constructor(e){super(e)}get endpoint(){return`https://${this._core._environment.endpoints.ABS_HOST}`}async getAddressBookURL(e){return(await this._getResponse(`${this.endpoint}/api/urns/resolve/${e}`)).url}async getMembersFirstPage(e,t=100){return this._getResponse(`${e}/members/flat?limit=${t}`)}async getMembersNextPage(e){return this._getResponse(e)}async getAddressBooks(e=100){return this._getResponse(`${this.endpoint}/api/address-books?limit=${e}`)}async getContactInAddressBook(e,t){return this._getResponse(`${this.endpoint}/api/address-books/${e}/contacts?linkedIdentity=${t}`)}}const Iu=["owner","viewer","editor","none"],Tu=["editor","owner"],Su=["self","deep","deep_override"];class Au extends Fs{constructor(){super(...arguments),this._role="viewer",this._type="imsUser",this._isDirect=!1,this._assetID="",this._canDiscover=!1,this._canShare=!1,this._commentPermissions=[]}get assetId(){return this._assetID}get hasProfile(){Jr("Collaborator.hasProfile","Collaborator.hasProfile is deprecated and will be removed on or after 2024-10-01")}get collaboratorID(){return this.id}get imsUserId(){var e;return"imsUser"===this._type?this.id:null===(e=this._additionalData)||void 0===e?void 0:e.linkedIdentity}get email(){var e;return null===(e=this._additionalData)||void 0===e?void 0:e.email}get name(){var e,t;const i=this._additionalData;return null!==(t=null!==(e=null==i?void 0:i.displayName)&&void 0!==e?e:null==i?void 0:i.groupName)&&void 0!==t?t:null==i?void 0:i.organizationName}get role(){return this._role}get type(){return this._type}get commentPermissions(){return this._commentPermissions}get inheritances(){return this._inheritances}get isDirect(){return this._isDirect}get hasContributorRole(){return Tu.includes(this._role)}get hasName(){return!!this.name}get invited(){var e;return null===(e=this._inheritances)||void 0===e?void 0:e.includes("deep")}get isAdmin(){var e;return null===(e=this._inheritances)||void 0===e?void 0:e.includes("deep_override")}get canDiscover(){return this._canDiscover}get canShare(){return this._canShare}get additionalData(){return this._additionalData}get isCurrentUser(){return this._core._environment.getValue("USER_ID")===this.imsUserId}get avatarURL(){return this.getAvatarURL(gu.Size138)}getAvatarURL(e){var t,i,s;return null!==(s=null===(i=null===(t=this._additionalData)||void 0===t?void 0:t.images)||void 0===i?void 0:i[e])&&void 0!==s?s:""}get addressBookGroupUrn(){var e;return(null===(e=this._additionalData)||void 0===e?void 0:e.groupUrn)||""}async getGroupMemberSource(){if("addressBookGroup"!==this.type)throw Ge.create(j.BAD_REQUEST,"groupMemberSource only applies to addressBookGroup Collaborator");if(!this.addressBookGroupUrn)throw Ge.create(j.BAD_REQUEST,"addressBookGroupUrn is required");const e=new Eu(this._core),t=await e.getAddressBookURL(this.addressBookGroupUrn),i=function(e){return new URL(e).pathname.match(/^\/api\/address-books\/[^/]+/)[1]}(t),s=this._core.collaborationContext._getAddressBookContactPool(i),r=new bu(t,s,e,Ou);return new xo(s,[r])}}qe([ut(Mi)],Au.prototype,"email",null),qe([ut(Mi)],Au.prototype,"name",null),qe([ut(Mi)],Au.prototype,"avatarURL",null),qe([ut(Mi)],Au.prototype,"getAvatarURL",null),qe([ut(Mi)],Au.prototype,"addressBookGroupUrn",null),qe([rt],Au.prototype,"getGroupMemberSource",null);const Pu=new mn({localItemType:Au,remoteIdProperty:"id",changeEvent:Mi,propertyUpdater:new Sn({_type:{name:"type",choices:["imsUser","addressBookGroup","addressBookContact","predefinedPrincipal","imsGroup"]},_role:{name:"role",choices:Iu},_inheritances:{name:"inheritances",isArray:!0,choices:Su},_additionalData:{name:"additionalData",format:"object"},_isDirect:{name:"isDirect",format:"boolean"},_avatarURLs:{name:"avatarURLs",format:"object"},_assetID:{name:"assetID",format:"string"},_canDiscover:{name:"canDiscover",format:"boolean"},_canShare:{name:"canShare",format:"boolean"},_commentPermissions:{name:"commentPermissions",isArray:!0}})});class wu{constructor(e,t,i){this._collaboratorPool=e,this._invitationInterface=t,this._urn=i}async loadPage(){const e=await this._invitationInterface.getCollaborators(this._urn),t=this._collaboratorPool.createLoaderUpdateSession(Date.now()),i=new Set(e.directCollaborators.map((({id:e})=>e))),s=e.collaborators.map((t=>{var s,r;const n=i.has(t.id),o=!!n&&null!==(r=null===(s=e.directCollaborators.find((e=>e.id===t.id)))||void 0===s?void 0:s.canDiscover)&&void 0!==r&&r;return Object.assign(Object.assign({},t),{isDirect:n,canDiscover:o})})),r=Pu.updateRemoteItems(t,s);return t.commit(),{items:r}}}const Cu=new mn({localItemType:class extends Fs{constructor(){super(...arguments),this._email="",this._role="viewer",this._canComment=!1,this._canShare=!1,this._acceptanceRequired=!1,this._created=new Date}get invitationID(){return this.id}get email(){return this._email}get role(){return this._role}get canComment(){return this._canComment}get canShare(){return this._canShare}get acceptanceRequired(){return this._acceptanceRequired}get inheritance(){return this._inheritance}get created(){return this._created}},remoteIdProperty:"id",propertyUpdater:new Sn({_email:"email",_role:{name:"role",choices:Iu},_canComment:{name:"canComment",format:"boolean"},_canShare:{name:"canShare",format:"boolean"},_acceptanceRequired:{name:"acceptanceRequired",format:"boolean"},_inheritance:{name:"inheritance",choices:Su},_created:{name:"created",format:"date_as_number"}})});class Ru{constructor(e,t,i){this._invitedCollaboratorPool=e,this._invitationInterface=t,this._urn=i}async loadPage(){const e=await this._invitationInterface.getCollaborators(this._urn),t=this._invitedCollaboratorPool.createLoaderUpdateSession(Date.now()),i=Cu.updateRemoteItems(t,e.invitations);return t.commit(),{items:i}}}const Lu={parse:e=>e,isEqual:(e,t)=>ls(e,t)},Nu={parse:e=>e,isEqual:(e,t)=>ls(e,t)},Du=new mn({localItemType:class extends Fs{constructor(){super(...arguments),this._collaborators=[],this._error=void 0}get getAssetID(){return this.id}get collaborators(){return this._collaborators}get error(){return this._error}},remoteIdProperty:"urn",propertyUpdater:new Sn({_collaborators:{get:function(e,t){const i=new qo(t._core,"collaborator").createUpdateSession();if(200!==e.statusCode)return[];const s=JSON.parse(e.response).collaborators.map((t=>Object.assign(Object.assign({},t),{assetID:e.urn}))),r=Pu.updateRemoteItems(i,s);return i.commit(),r},format:Lu},_error:{get:function(e){if(200===e.statusCode)return;const t=JSON.parse(e.response);return Ge.createWithRepositoryCode(t.statusCode,"",t.error)},format:Nu}})});class Mu{constructor(e,t,i){this._collaboratorsByAssetIDPool=e,this._invitationInterface=t,this._assetIDs=i}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t=0){var i,s;const r=Math.min(null!==(s=null===(i=e.loadOptions)||void 0===i?void 0:i.limit)&&void 0!==s?s:1/0,this._invitationInterface.batchRequestLimit),n=this._assetIDs.slice(t,t+r),o=await this._invitationInterface.getCollaboratorListForUrns(n),a=this._collaboratorsByAssetIDPool.createLoaderUpdateSession(Date.now()),c=Du.updateRemoteItems(a,o.result);let l;return a.commit(),t+c.length<this._assetIDs.length&&(l=e=>this._loadPage(e,t+c.length)),{items:c,loadNextPage:l}}}class xu{constructor(e,t=50,i=50,s=3){this._batchProcessor=e,this._maxItemsPerBatch=t,this._delay=i,this._maxInFlightBatches=s,this._itemQueue=new Set,this._itemPromises=new Map,this._inFlightBatches=new Set,this._processQueue=async()=>{clearTimeout(this._timer),this._timer=void 0;try{this.inFlightCount>=this._maxInFlightBatches&&await Promise.race([...this._inFlightBatches].map((e=>e.promise)))}catch(e){}for(;this.inFlightCount<=this._maxInFlightBatches&&this._itemQueue.size>0;){const e=new Set;for(;this._itemQueue.size>0&&e.size<this._maxItemsPerBatch;){const t=this._itemQueue.values().next().value;this._itemQueue.delete(t),e.add(t)}const t={batch:e,promise:this._batchProcessor(e).catch((()=>{[...e.values()].forEach((e=>this.rejectItemPromise(e)))})).finally((()=>{this._inFlightBatches.delete(t),[...e.values()].forEach((e=>this.resolveItemPromise(e)))}))};this._inFlightBatches.add(t)}this._itemQueue.size>0&&!this._timer&&(this._timer=setTimeout(this._processQueue,this._delay))}}enqueue(e){if(this.isInQueue(e)||this.isInFlight(e))return this._itemPromises.get(e).promise;this._itemQueue.add(e);const t=new Xr;return this._itemPromises.set(e,t),this._timer||(this._timer=setTimeout(this._processQueue,this._delay)),this._itemQueue.size>=this._maxItemsPerBatch&&this._processQueue(),t.promise}dequeue(e){const t=this._itemQueue.has(e);return this._itemQueue.delete(e),t&&(this._itemPromises.get(e).resolve(),this._itemPromises.delete(e)),t}resolveItemPromise(e){var t;null===(t=this._itemPromises.get(e))||void 0===t||t.resolve(),this._itemPromises.delete(e)}rejectItemPromise(e){var t;null===(t=this._itemPromises.get(e))||void 0===t||t.reject(),this._itemPromises.delete(e)}get size(){return this._itemQueue.size}get inFlightCount(){return this._inFlightBatches.size}isInQueue(e){return this._itemQueue.has(e)}isInFlight(e){return!![...this._inFlightBatches].find((t=>t.batch.has(e)))}async _processNow(){if(this._itemQueue.size||this._inFlightBatches.size)do{this._processQueue();try{await Promise.race([...this._inFlightBatches].map((e=>e.promise)))}catch(e){}}while(this._itemQueue.size)}}class ku extends Fs{constructor(e,t){super(e,t),this._displayName="",this._ownerId=""}get ident(){return this.id}get displayName(){return this._displayName}get ownerId(){return this._ownerId}async getContactInAddressBook(e){return this._core.collaborationContext.getContactInAddressBook(this.ident,e)}}qe([ut],ku.prototype,"ident",null),qe([ut],ku.prototype,"displayName",null),qe([ut],ku.prototype,"ownerId",null);const Hu=new mn({localItemType:ku,remoteIdProperty:"ident",propertyUpdater:new Sn({_displayName:"displayName",_ownerId:"ownerId"})});class ju{constructor(e,t,i){this._addressBookPool=e,this._addressBookInterface=t,this._addressBookUpdater=i}async loadPage(e){const{limit:t=100}=(null==e?void 0:e.loadOptions)||{limit:100},i=await this._addressBookInterface.getAddressBooks(t),s=this._addressBookPool.createLoaderMutationSession();return{items:this._addressBookUpdater.updateRemoteItems(s,i._embedded.addressBooks),total:i.total}}}const Uu={name(e,t){var i,s;return Mn(null!==(i=e.name)&&void 0!==i?i:e.id,null!==(s=t.name)&&void 0!==s?s:e.id)}};class Bu extends(Hn(Uu)){}Bu.default=new Bu("ascending","name");const Fu={email(e,t){var i,s;return Mn(null!==(i=e.email)&&void 0!==i?i:e.id,null!==(s=t.email)&&void 0!==s?s:e.id)}};class Vu extends(Hn(Fu)){}Vu.default=new Vu("ascending","email");const Ku={displayName:(e,t)=>Mn(e.displayName,t.displayName)};class $u extends(Hn(Ku)){}$u.default=new $u("ascending","displayName");class Gu{constructor(e){this._core=e,this._collaboratorSourceMap=new Map,this._invitationInterface=new bl(this._core),this._collaboratorsByAssetIDPool=new qo(this._core,"collaboratorsByAssetID"),this._accessConfirmedIDs=new Set,this._addressBookPool=new qo(this._core,"addressBook"),this._addressBookContactPoolMap=new Map,this._handleBatchRequest=async e=>{const t=new Map([...e].map((e=>[e.id,e])));(await this._invitationInterface.getCollaboratorListForUrns([...t.keys()])).result.forEach((e=>{const i=e.urn,s=t.get(i);if(!s)return;if(200!==e.statusCode)return void this._collaboratorRequestQueue.rejectItemPromise(s);const r=this._getCollaboratorSources(i),n=JSON.parse(e.response),o=n.collaborators.map((e=>{const t=n.directCollaborators.find((t=>t.id===e.id));return Object.assign(Object.assign({},e),{assetID:i,isDirect:!!t})})),a=r.collaboratorPool.createUpdateSession(),c=Pu.updateRemoteItems(a,o);a.commit(),s._setCollaboratorData(c)}))},this._collaboratorRequestQueue=new xu(this._handleBatchRequest)}async _getCollaboratorsNow(e){await this._collaboratorRequestQueue.enqueue(e),await this._collaboratorRequestQueue._processNow(),tn.hasManager(e,Mi)?tn.updatedExternally(e,Mi):e.dispatch(Mi)}getCollaboratorsForAssets(e){Jr("getCollaboratorsForAssets","This method is deprecated and will be removed. Use ShareableItem.collaboratorArray instead.");const t=new Mu(this._collaboratorsByAssetIDPool,this._invitationInterface,e);return new xo(this._collaboratorsByAssetIDPool,[t],new vo)}_getCollaboratorSources(e){const t=this._collaboratorSourceMap.get(e);if(t)return t;const i=new qo(this._core,"collaborator"),s=new wu(i,this._invitationInterface,e),r=new xo(i,[s],new vo),n=new qo(this._core,"invitedCollaborator"),o=new Ru(n,this._invitationInterface,e),a={collaboratorPool:i,collaboratorSource:r,invitedCollaboratorPool:n,invitedCollaboratorSource:new xo(n,[o],new vo)};return this._collaboratorSourceMap.set(e,a),a}getCollaborators(e){return Jr("CollaborationContext.getCollaborators","This method is deprecated and will be removed. Use ShareableItem.collaboratorArray instead."),this._getCollaboratorSources(e).collaboratorSource}async removeCollaborator(e,t){return Jr("CollaborationContext.removeCollaborator","This method is deprecated and will be removed on or after 2024-10-01. Use ShareableItem.removeCollaborator instead."),this._removeCollaborator(e,t)}async _removeCollaborator(e,t){var i,s;const r=null===(i=(await this._invitationInterface.modifyCollaborators(e,{collaborators:[{id:t.id,action:"remove"}]})).collaborators)||void 0===i?void 0:i.find((e=>e.id===t.id));if(!r)throw Ge.create(Ue.BAD_REQUEST,"Collaborator patch request unsuccessful");if(200!==r.statusCode)throw Ge.createWithRepositoryCode(r.statusCode,null!==(s=r.errorSubcode)&&void 0!==s?s:"",r.statusText);const{collaboratorPool:n}=this._getCollaboratorSources(e),o=n.createUpdateSession();o.queueDiscardedItem(t),t.isCurrentUser&&this._accessConfirmedIDs.delete(e),o.commit()}async removeInvitedCollaborator(e,t){var i,s;Jr("CollaborationContext.removeInvitedCollaborator","This method is deprecated and will be removed on or after 2025-01-01.");const r=null===(i=(await this._invitationInterface.modifyCollaborators(e,{invitations:[{id:t.id,action:"remove"}]})).invitations)||void 0===i?void 0:i.find((e=>e.id===t.id));if(!r)throw Ge.create(Ue.BAD_REQUEST,"InvitedCollaborator patch request unsuccessful");if(200!==r.statusCode)throw Ge.createWithRepositoryCode(r.statusCode,null!==(s=r.errorSubcode)&&void 0!==s?s:"",r.statusText);const{invitedCollaboratorPool:n}=this._getCollaboratorSources(e),o=n.createUpdateSession();o.queueDiscardedItem(t),o.commit()}getInvitedCollaborators(e){return Jr("CollaborationContext.getInvitedCollaborators","This method is deprecated and will be removed on or after 2025-01-01. Use ShareableItem.collaboratorArray instead."),this._getCollaboratorSources(e).invitedCollaboratorSource}async _removeCurrentUserFromCollaborationList(e){e._isCollaboratorDataLoaded||await this._getCollaboratorsNow(e);const t=e.collaboratorArray.find((e=>e.isCurrentUser));if(!t)throw Ge.create(Ue.BAD_REQUEST,`Current user is not a collaborator on ${e.id}`);if(await this._removeCollaborator(e.id,t),e.collaboratorArray.includes(t)){const i=e.collaboratorArray.filter((e=>e!==t));e._setCollaboratorData(i),tn.hasManager(e,Mi)?tn.updatedExternally(e,Mi):e.dispatch(Mi)}}removeCurrentUserFromCollaborationList(e){Jr("removeCurrentUserFromCollaborationList/getCollaborator","This method does not work correctly and will be removed. Use ShareableItem.removeCurrentUserFromCollaboratorList() insstead.");const t=this.getCollaborator(e);return this._removeCollaborator(e,t)}getCollaborator(e){var t;Jr("removeCurrentUserFromCollaborationList/getCollaborator","This method does not work correctly and will be removed. Use ShareableItem.collaboratorsArray.find(c => c.isCurrentUser()) instead.");const i=this._core._environment.getValue("USER_ID");return null!==(t=this._getCollaboratorSources(e).collaboratorPool.getLocalItemById(i))&&void 0!==t?t:new Au(this._core,i)}async _addCollaborators(e,t,i,s,r,n){const o=Object.assign(Object.assign(Object.assign(Object.assign({recipients:t},s?{notification:s}:{notification:{ans:{}}}),i?{configuration:i}:{}),r?{captcha:r}:{}),n?{inviterLabel:n}:{});return await this._invitationInterface.addCollaborators(e,o)}async _modifyCollaborators(e,t,i,s){const r=Object.assign(Object.assign({collaborators:t},i?{configuration:i}:{}),s?{notification:s}:{});await this._invitationInterface.modifyCollaborators(e,r)}getPendingInvitations(){return this._invitationInterface.getPendingInvitations()}async confirmAccess(e){this._accessConfirmedIDs.has(e)||"guest"===this._core._environment.getValue("SESSION_TYPE")||(await this._invitationInterface.confirmAccess(e),this._accessConfirmedIDs.add(e))}get addressBookSource(){const e=new ju(this._addressBookPool,new Eu(this._core),Hu);return new xo(this._addressBookPool,[e])}getAddressBookOrder(e="ascending",t="displayName"){return new $u(e,t)}_getAddressBookContactPool(e){let t=this._addressBookContactPoolMap.get(e);return t||(t=new qo(this._core,"addressBookContact"),this._addressBookContactPoolMap.set(e,t)),t}async getContactInAddressBook(e,t){const i=this._getAddressBookContactPool(e);let s=i.getLocalItemById(t);if(s)return s;const r=new Eu(this._core),n=await r.getContactInAddressBook(e,t),o=i.createMutationSession();return s=Ou.updateRemoteItem(o,n),o.commit(),s}getCollaboratorOrder(e="ascending",t="name"){return new Bu(e,t)}getInvitedCollaboratorOrder(e="ascending",t="email"){return new Vu(e,t)}async _requestAccess(e,t,i){return await this._invitationInterface.createAccessRequest(e,t,i)}}qe([rt],Gu.prototype,"addressBookSource",null),qe([Nt],Gu.prototype,"getContactInAddressBook",null);var Wu=Object.freeze({__proto__:null,default:Gu});class zu{constructor(e,t,i){this._ffBoardsInterface=i,this._ussLoaderHelper=new Oc(e,t,this)}async loadPage(e){return this._ussLoaderHelper.loadPage(e)}_getListingOptionsFromFilters(e,t){const i=Gn("options",t);return{isSharedWithYou:Gn("isSharedWithYou",i),ownedBy:Gn("ownedBy",i),mediaTypes:$n(e,t)}}async _getUSSResults({start:e,loadOptions:t,order:i,implicitFilter:s,filter:r}){const n=Object.assign({start:e,limit:(null==t?void 0:t.limit)||50,orderDirection:i.direction,orderBy:i.field},this._getListingOptionsFromFilters(s,r));return this._ffBoardsInterface.getAssets(n)}}const qu={start:0,limit:50,orderDirection:"descending",orderBy:"modified"};class Yu extends lr{_getCommonFilters(e){const t=Object.assign(Object.assign({},qu),e);return{hints:{acp_platform_v2:!0},fetch_fields:{includes:[...Vi(),"_embedded"]},limit:t.limit,start_index:t.start,op_none_of:[{[An.VISIBILITY]:["hiddenSelf","hiddenRecursive"]}],sort_orderby:Cn[t.orderBy],sort_order:"ascending"===t.orderDirection?"asc":"desc"}}async getAssets(e){const{ownedBy:t,isSharedWithYou:i,mediaTypes:s}=e,r=ze(e,["ownedBy","isSharedWithYou","mediaTypes"]),n=this._getCommonFilters(r);return t&&(n[An.STORAGE_ASSIGNEE_ID]=t),void 0!==i&&(n[An.SHARED_VIA_INVITE]=i),s&&s.length>0&&(Ll(s),n[An.TYPE]=s),this._core.hostAssetContext._ussInterface.getQueryResponse(n)}}class Qu{constructor(e,t,i){this._core=t,this._swyInterface=i,this._ussLoaderHelper=new Oc(e,t,this)}supportsFilter(e){return void 0!==e}async loadPage(e){return this._libraryContext||(this._libraryContext=await this._core.getLibraryContext()),this._ussLoaderHelper.loadPage(e)}async _getUSSResults({start:e,loadOptions:t,mediaTypes:i,excludeMediaTypes:s,order:r,resource:n}){return this._swyInterface.getSWYAssets({orderBy:jd[r.field],orderDirection:r.direction,start:e,limit:null==t?void 0:t.limit,mediaTypes:i,excludeMediaTypes:s,embedPermissions:!0},n)}}class Ju{constructor(e,t,i){this._recentInterface=i,this._ussLoaderHelper=new Oc(e,t,this)}supportsFilter(e){return void 0!==e}async loadPage(e){return this._ussLoaderHelper.loadPage(e)}async _getUSSResults({start:e,loadOptions:t,mediaTypes:i,excludeMediaTypes:s}){return this._recentInterface.getMRUAssets({start:e,limit:null==t?void 0:t.limit,mediaTypes:i,excludeMediaTypes:s,embedPermissions:!0})}}var Xu;!function(e){e[e.Initializing=0]="Initializing",e[e.Offline=1]="Offline",e[e.NotStarted=2]="NotStarted",e[e.Disabled=3]="Disabled",e[e.Synchronized=4]="Synchronized",e[e.InProgress=5]="InProgress",e[e.ErrorQuotaExceeded=6]="ErrorQuotaExceeded",e[e.ErrorSyncDown=7]="ErrorSyncDown",e[e.ErrorOther=8]="ErrorOther"}(Xu||(Xu={}));class Zu extends nr{constructor(e,t){super(e),this._core=e,this._assetPool=t,this._rapi=new El(this._core),this._invitationInterface=new bl(this._core),this._ussInterface=new Ol(this._core),this._SBMInterface=new Dl(this._core),this._swyInterface=new xl(this._core),this._recentInterface=new Fl(this._core),this._adobeAssetSearchInterface=new Hl(this._core),this._adobeAssetGlobalSearchInterface=new Ul(this._core),this._assetTransferService=new Vl(this._core),this._assetReviewServiceInterface=new Pc(this._core),this._publishedInterface=new pd(this._core),this._discardedInterface=new Td(this._core),this.__ussInterfaceV3=new Pd(this._core),this._globalSearchInterfaceV3=new Cd(this._core,this.__ussInterfaceV3),this._libraryInterface=new fa(this._core),this._acplModelInterface=new ta(this._core),this._ffBoardsInterface=new Yu(this._core),this._commentsById=new Map,this._adobeAssetUpdater=_c,this._ussAdobeAssetUpdater=fc,this._onHomeFolderChange=()=>{this._rapi._clearIndexCache()},this._onOnsAssetChangeEvent=e=>{const t=new Set;e.changedAssets.forEach(((e,i)=>{var s,r;if(null===(s=e.changedResources)||void 0===s?void 0:s.includes("api:annotation")){const t=null===(r=this._commentsById.get(i))||void 0===r?void 0:r.deref();t&&t._onONSNotification(e)}const n=this._assetPool.getLocalItemById(i);if(n&&n.handleOnsChangedResources(e.changedResources),e.parentAssetId&&this._assetPool.getLocalItemById(e.parentAssetId)){const s=this._assetPool.getLocalItemById(e.parentAssetId),r=this._core._getKnowledgeWorkspaceContext(),o=r&&r._isMinimalAsset(s);n||!s._canLoadNewChildrenFromONSNotification||o||this._getAssetById(i,void 0,!0).catch((e=>{if(e.code!==Ue.NOT_FOUND)throw e;this._core._environment.log(`_onOnsChangeAssetEvent asset ${i} not found, likely deleted or unshared.`)})),t.add(s)}})),t.forEach((e=>{e.dispatch(new Ni)}));const i=new Set(e.changedAssets.keys()),s=this._getAssetLinkManager();s&&s.lists.forEach((e=>e._refreshLinksForChangedAssets(i)))},this._onAssetsChanged=e=>{var t;const i=null===(t=null==e?void 0:e.discardedItems)||void 0===t?void 0:t.map((e=>e.id));this._updateONSSubscriptions(i)},this._organizationsResource=new ar(this._core,{onChange:async e=>{this._defaultOrganizationId=null==e?void 0:e.default,this._organizations=null==e?void 0:e.children.map((e=>({id:e["organization:id"],name:e["organization:name"]||""})))}}),this._assetPool.on(Go,this._onAssetsChanged),tn.manageLazyLoading(this,[{event:Hd,fetchData:this._fetchOrganizations,prefetchTimeout:0}]),this._core.on(Ci,((e,t,i)=>{"ONS_OVER_AXON"===i.configurationKeyName&&(this._core._environment.getValue("ENVIRONMENT")===os.Stage?this.onsContext&&(this.onsContext.useAxon=this._core._environment.getValue("ONS_OVER_AXON")):console.warn("Runtime config update for ONS_OVER_AXON is only supported in the Stage environment."))}))}async _getONSContext(){return this._OnsContext||(this._OnsContext=new cu(this._core),this.dispatch(new Rl(this._OnsContext.onsMonitoringStatus)),this._OnsContext.on(ot,this._onOnsAssetChangeEvent),this._OnsContext.on(Il,(e=>{this.dispatch(new wl(e.cachedSubscriptionsUsed))})),this._OnsContext.on(Tl,(e=>{this.dispatch(new Cl(e.expired))})),this._OnsContext.on(Sl,(e=>{this.dispatch(new Rl(e.status))}))),this._OnsContext}get onsMonitoringStatus(){var e,t;return null!==(t=null===(e=this._OnsContext)||void 0===e?void 0:e.onsMonitoringStatus)&&void 0!==t?t:Al.Unknown}get onsContext(){return this._OnsContext}get repoInterface(){return Jr("AssetContext.repoInterface","AssetContext.repoInterface is deprecated and will be removed on or after 2024-10-01. It is for internal SAM.js use only."),this._rapi}get ussInterface(){return Jr("AssetContext.ussInterface","AssetContext.ussInterface is deprecated and will be removed on or after 2024-10-01. It is for internal SAM.js use only."),this._ussInterface}get ussInterfaceV3(){return Jr("AssetContext.ussInterfaceV3","AssetContext.ussInterfaceV3 is deprecated and will be removed on or after 2024-10-01. It is for internal SAM.js use only."),this.__ussInterfaceV3}get sbmInterface(){return Jr("AssetContext.sbmInterface","AssetContext.sbmInterface is deprecated and will be removed on or after 2024-10-01."),this._SBMInterface}get swyInterface(){return Jr("AssetContext.swyInterface","AssetContext.swyInterface is deprecated and will be removed on or after 2024-10-01. It is for internal SAM.js use only."),this._swyInterface}get recentInterface(){return Jr("AssetContext.recentInterface","AssetContext.recentInterface is deprecated and will be removed on or after 2024-10-01. It is for internal SAM.js use only."),this._recentInterface}get invitationInterface(){return Jr("AssetContext.invitationInterface","AssetContext.invitationInterface is deprecated and will be removed on or after 2024-10-01. It is for internal SAM.js use only."),this._invitationInterface}get publishedInterface(){return Jr("AssetContext.publishedInterface","AssetContext.publishedInterface is deprecated and will be removed on or after 2024-10-01. It is for internal SAM.js use only."),this._publishedInterface}get assetPool(){return Jr("AsseContext._assetPool","AssetContext._assetPool is deprecated and will be removed on or after 2024-10-01. ItemPools are for internal SAM.js use only."),this._assetPool}get sharedSource(){const e=new Ld,t=new Qu(this._assetPool,this._core,this._swyInterface),i=new ia(this._assetPool,this._core);return new xo(this._assetPool,[t,i],e)}get PLSSharedSource(){const e=new Ld,t=new _u(this._core),i=new ia(this._assetPool,this._core);return new xo(this._assetPool,[t,i],e)}get recentAssetsSource(){const e=new $l,t=new Kl(this._assetPool,this._core,this._recentInterface,e),i=new ia(this._assetPool,this._core);return e._lastModificationDate=new Date(9999,0,1),new xo(this._assetPool,[t,i],e)}get favoriteAssetsSource(){return new xo(this._assetPool,[new uu(this._core)],new du)}get MRUAssetsSource(){const e=new Wl,t=new ia(this._assetPool,this._core),i=new Ju(this._assetPool,this._core,this._recentInterface);return new xo(this._assetPool,[i,t],e)}get PLSMRUAssetsSource(){const e=new Wl,t=new ia(this._assetPool,this._core),i=new mu(this._core);return new xo(this._assetPool,[i,t],e)}get publishedSource(){const e=new vd,t=new yd(this._assetPool,this._core,this._publishedInterface);return new xo(this._assetPool,[t],e)}get discardedSource(){const e=new Od,t=new Sd(this._assetPool,this._core,this._discardedInterface);return new xo(this._assetPool,[t],e)}get localRecentsSource(){if(this._acplModelInterface.supportsLocalAssets){const e=new ia(this._assetPool,this._core),t=new lu;return new xo(this._assetPool,[e],t)}}async getAssetLinkManager(){if(this._AssetLinkManager)return this._AssetLinkManager;const e=(await Promise.resolve().then((function(){return RA}))).default;return this._AssetLinkManager=new e(this),this._AssetLinkManager}_getAssetLinkManager(){return this._AssetLinkManager}getGlobalSearchAssetsSource(e){const t=new Ad({_query:e,_matchingIDsFromSearch:new Set}),i=new Rd(this._assetPool,t,this._core,this._adobeAssetGlobalSearchInterface);return new xo(this._assetPool,[i],t)}getGlobalSearchAssetsSourceV3(e){const t=new Ad({_query:e,_matchingIDsFromSearch:new Set}),i=new wd(this._assetPool,this._core,this._globalSearchInterfaceV3,t);return new xo(this._assetPool,[i],t)}get ffBoardsSource(){const e=new Fd({mediaTypes:["application/vnd.adobe.hz.aura+dcx"],_isDiscarded:!1}),t=new zu(this._assetPool,this._core,this._ffBoardsInterface);return new xo(this._assetPool,[t],e)}get isOnline(){return Jr("AssetContext.isOnline","AssetContext.isOnline() is not fully implemented for web"),this.networkStatus!==Hc.Offline}get networkStatus(){return Jr("AssetContext.networkStatus","AssetContext.networkStatus is not fully implemented for web"),Hc.OnlineUnknown}async _getAssetById(e,t,i){var s,r,n;const o=null!==(s=this._assetPool.getLocalItemById(e))&&void 0!==s?s:await this._acplModelInterface.getLocalAsset(e);if(o)return this._core._environment.getValue("DISABLE_ONS")||o.needsRepoMetadata?await o._loadWithRetry():o._linksCameFromResolveAPI||this._rapi.getAssetLinks(e).then((e=>{const t=this._assetPool.createUpdateSession();this._adobeAssetUpdater.updateLocalItem(t,o,{_links:e}),o._linksCameFromResolveAPI=!0,t.commit()})),o;const a=new an(this._core),c=new ea(this._core),l=new va(this._core);let d,u,h,p={};if(null===(r=this._core._environment.getValue("FEATURE_FLAGS"))||void 0===r?void 0:r["use-graphql"]){const i=await this._core._getGQLManager(),s=await i.getAssetById(e),{effectivePermission:r,perUserMetadata:o,_embedded:_}=s;u=ze(s,["effectivePermission","perUserMetadata","_embedded"]),t||(t=new Zo(this._core)),await t._setData(u),d=r,await c._setData(d),p=null!==(n=null==_?void 0:_[gt.APP_METADATA])&&void 0!==n?n:{},await a._setData(p),h=o,await l._setData(h)}else{t||(t=new Zo(this._core),await this._rapi.getRepoMetadataById(e,t)),u=t.data;const i=new Yr(this._rapi,e,u._links,u["repo:etag"]);await i.getEffectivePermissions(c),d=c.data,(d&Ki.ReadAppMetadata)===Ki.ReadAppMetadata&&(await i.getAppMetadata(a),p=a.data)}const _=new xd(this._core),m=new Jd(this._core);let f,g={};const y=Va(p),v=Ga({appMetadata:p,repoMetadata:u});if(y)f=await _.getProject(u["repo:assetId"]);else if(v){const t=await m.getStudentAssignment(e,void 0,{[Oa.PREFER_RAPI]:"true"});g=this.repoToStudentAssignmentData(u,Object.assign(Object.assign({},p),t))}const O=Object.assign(Object.assign({},null==t?void 0:t.data),{_embedded:{[gt.APP_METADATA]:p}}),b=await this._core._adobeAssetFactory.getRepoMetadataUpdaters([O]);let E;const I=Ba(u);let T={};I&&(E=await this._core.getGenerationHistoryContext(),T=await E._generationHistoryInterface.getGenerationHistoryAssetById(e));const S=this._assetPool.createMutationSession(),A=this._core._adobeAssetFactory.assetFromRepoMetadata({session:S,repoMetadata:u,updaters:b,permissions:d,appMetadata:p,projectMetadata:f,studentAssignmentMetadata:v?g:void 0,perUserMetadata:h,generationHistoryMetadata:I?T:void 0});return u&&u["storage:assignee"]&&A._storageAssignee_NoLazyLoad.id===u["storage:assignee"].id&&tn.updatedByItemUpdater(A,Fn),S.commit(),i&&A.isLibrary&&await A._waitForLibraryLoad(),A._setResources({repoMetadataResource:t,appMetadataResource:a,effectivePermissionsResource:c,perUserMetadataResource:l}),y?await A._load({repoMetadata:u,appMetadata:p,effectivePermission:d,projectMetadata:f,perUserMetadata:h}):v?await A._load({repoMetadata:g,appMetadata:p,effectivePermission:d,perUserMetadata:h,doFetchStudentAssignmentMetadata:!1}):od(A)?await A._load({repoMetadata:u,appMetadata:p,effectivePermission:d,perUserMetadata:h,requireLibraryDataFetch:i}):await A._load({repoMetadata:u,appMetadata:p,effectivePermission:d,perUserMetadata:h}),A._linksCameFromResolveAPI=!0,A}async getHomeFolder(){if(!this._homeFolder){const e=await this._rapi.getHomeDirectoryMetadata();this._cacheHomeFolder(e)}return this._homeFolder}_cacheHomeFolder(e){const t=this._assetPool.createMutationSession();this._homeFolder=this._adobeAssetUpdater.updateRemoteItem(t,e),t.commit(),this._homeFolder.on(ot,this._onHomeFolderChange)}async getRootFolder(e){var t,i;if(!this._rootFolder)if(null===(t=this._core._environment.getValue("FEATURE_FLAGS"))||void 0===t?void 0:t["use-graphql"]){const t=null===(i=null==e?void 0:e.listingHints)||void 0===i?void 0:i.map((e=>Object.assign(Object.assign({},e),{effectivePermissions:!1}))),s=Object.assign(Object.assign({},e),{listingHints:t,appMetadata:!1,effectivePermissions:!1,perUserMetadata:!1}),r=await this._core._getGQLManager();let n;if(this._homeFolder){const e=Us.join(this._homeFolder.repoPath,Wi);n=(await r.getAssetByPath(e,this._homeFolder.repositoryID,s)).assetData}else{const e=await r.getAssetByPath(Wi,void 0,s);n=e.assetData;const t=e.homeFolderData;this._cacheHomeFolder(t)}const o=this._assetPool.createUpdateSession();this._rootFolder=this._adobeAssetUpdater.updateRemoteItem(o,n),o.commit()}else this._rootFolder=await this._getAssetWithRepoPathImpl(Wi);return this._rootFolder}async getUserRepoID(){return this.getHomeFolder().then((e=>e.repositoryID))}async getAssetWithCloudID(e,t=!1){if(t){const t=await this._core.getCollaborationContext();await t.confirmAccess(e)}return this._getAssetById(e)}async _getAssetRepoDataWithCloudID(e){const t=new Zo(this._core);return await this._rapi.getRepoMetadataById(e,t),t}async getAssetWithRepoPath(e,t){return e===Wi?this.getRootFolder():this._getAssetWithRepoPathImpl(e,t)}async _getRepoDataByPath(e,t){const i=new Zo(this._core),s=await this._rapi.getRepoMetadataByPath(t,e,i);return i._setData(s),i}async _getTopLevelFolder(e,t){var i;const s=await this._getRepoDataByPath(e,t),r=s.data["repo:assetId"];if(!r)throw Ge.create(Ue.NOT_FOUND,`Top-level folder not found at path: ${e}`);const n=await this._core._adobeAssetFactory.getRepoMetadataUpdaters([s.data]);return null!==(i=this._assetPool.getLocalItemById(r))&&void 0!==i?i:(()=>{const e=this._assetPool.createMutationSession(),t=this._core._adobeAssetFactory.assetFromRepoMetadata({session:e,repoMetadata:s.data,updaters:n});return e.commit(),t})()}async _getAssetWithRepoPathImpl(e,t){if(!t){const i=await this.getHomeFolder();t=i.repositoryID;const s=i.repoPath;e=Us.join(s,e)}try{let i;if(Dr(e))return i=await this._getTopLevelFolder(e,t),i;const s=await this._getRepoDataByPath(e,t),r=s.data;return i=await this._getAssetById(r["repo:assetId"],s),i._setResources({repoMetadataResource:s}),i}catch(t){const i=["cloud-content","temp"];for(const s of i){const i=`/${s}`,r=e.indexOf(i)===e.lastIndexOf(i);if(t.code===Ue.NOT_FOUND&&r&&e.endsWith(i))return(await this.getHomeFolder()).createFolder(s)}throw t}}async getAssetWithAssetRefString(e,t=!1){let i;try{i=JSON.parse(e)}catch(e){throw Ge.create(Ue.BAD_REQUEST,"Incorrectly formatted AssetRefString",{underlyingError:e})}if(i.cloud_id)return this.getAssetWithCloudID(i.cloud_id,t);if(i.path)return this.getAssetWithRepoPath(i.path,i.repository_id);throw Ge.create(Ue.BAD_REQUEST,"Invalid AssetRefString")}_createAssetFromMetadata(e){const t=this._assetPool.createUpdateSession(),i=this._adobeAssetUpdater.updateRemoteItem(t,e);return t.commit(),i}async _repositoryNameFromID(e){return await this._rapi.getRepositoryName(e)}async _getStorageAssigneeFromID(e){return await this._rapi.getStorageAssignee(e)}async _getListOfRepositoryIDs(){const e=await this._rapi.getRepositoriesData();if(e)return e.children.map((e=>e._embedded[gt.PRIMARY]["repo:repositoryId"]))}async getXDCEData(e){return this._core._environment.fetch(`https://${this._core._environment.endpoints.XDCE_HOST}/v2/document/${e}`).then((e=>e.json()))}removeAssetsFromAssetsPool(e){this._assetPool.removeLocalItems(e)}async permanentlyDeleteAssets(e){let t;const i=t=>{if(t.discardedItems){const i=t.discardedItems.filter((t=>e.includes(t))).map((e=>e.id));i.length&&this.removeAssetsFromAssetsPool(i)}};this._assetPool.on(Go,i);try{await Fs.runExclusiveTask("delete",e,(async()=>{const i=new Map,s=e.map((e=>{i.set(e.id,e);const t={op:"delete",id:e.id,target:{"repo:assetId":e.id}};return e.repositoryID&&(t.target["repo:repositoryId"]=e.repositoryID),t.recursive=e.isFolder,t}));t=await this._runOperations(s,i,((e,t)=>{t._releaseRenditions(),this._assetPool.getLocalItemById(t.id)&&(this._adobeAssetUpdater.updateLocalItem(e,t,{effectivePermission:Ki.None}),e.queueDiscardedItem(t))}))}))}finally{this._assetPool.off(Go,i)}return t}async getCloudQuotaUsedAndMax(){return this._rapi.getCloudQuotaUsedAndMax()}async transfer(e,t){let i;if(t instanceof Ic){const e=await t.getChild("working_files");if(!e)throw Ge.create(Ue.NOT_FOUND,"unable to find working_files for provided space");i=e.id}else i=t.cloudID;const s={source:{assetId:e.cloudID,repositoryId:e.repositoryID},target:{assetId:i,repositoryId:t.repositoryID}},r=await this._assetTransferService.transfer(s),n=this._assetPool.createUpdateSession();return n.queueDiscardedItem(e),n.commit(),r}async _moveAssets(e,t,i=new Map,s=!0,r){let n={failedResults:[],newModels:[]};return await Fs.runExclusiveTask("move",e,(async()=>{t.repositoryID||await t._load(),void 0===r&&(r=new Map);const s=new Map,o=e.map((e=>{s.set(e.id,e);let n=`${t.repoPath}/${Rr(e,i)}`;n=Ir(this._core,e.id,n,!1,r);const o={op:"move",id:e.id,source:{"repo:assetId":e.id},target:{"repo:path":n,"repo:repositoryId":t.repositoryID}};return e.repositoryID&&(o.source["repo:repositoryId"]=e.repositoryID),o}));n=await this._runOperations(o,s,((e,i,s)=>(i.repositoryID!==t.repositoryID&&i._clearRepositoryName(),i.isFolder&&Cr({assetPool:this._assetPool,asset:i,session:e,operation:{type:"rename",newPath:s["repo:path"]},assetContext:this}),this._adobeAssetUpdater.updateLocalItem(e,i,s),i)))})),s?await Gl(n,t,i,r,this._moveAssets.bind(this)):n}async moveAssets(e,t,i=new Map){return this._moveAssets(e,t,i)}async getMoveCapability(e,t){var i;if(!t.isFolder)return{canMove:!1,reason:hn.NotAFolder};if(!t.hasPermission(Ki.Write))return{canMove:!1,reason:hn.PermissionDeniedDestination};if(e.some((e=>!e.hasPermission(Ki.Move))))return{canMove:!1,reason:hn.PermissionDeniedSource};if(await Promise.all([...e,t].map((e=>tn.fetchIfNeeded(e,Fn)))),e.every((e=>e.storageAssignee.id===t.storageAssignee.id)))return{canMove:!0,warning:un.None,warnings:[]};const s=await this._rapi.getRepoOwnerMap(),r=s.get(t.repositoryID);if(void 0===r)throw Ge.create(Ue.NOT_FOUND,"target's repo owner detail is not available");for(const t of e)""===t.repositoryID&&(Jr("AssetContext.getMoveCapability","getMoveCapability() requires asset._repositoryID to be set."),await t._loadRepoMetadata());if(!(null===(i=this._core._environment.getValue("FEATURE_FLAGS"))||void 0===i?void 0:i["enable-x-bucket-move"]))return{canMove:!1,reason:hn.CrossBucketMoveDisabled};const n=[];if(e.some((e=>{var t,i;const o=s.get(e.repositoryID);return(null===(i=null===(t=this._core._environment.getValue("FEATURE_FLAGS"))||void 0===t?void 0:t["move-capabilities"])||void 0===i?void 0:i["enable-CCI-CCI-move"])&&"user"===(null==o?void 0:o.type)&&"user"===r.type?(n.push(un.OwnerChange),!1):(null==o?void 0:o.id)!==r.id})))return{canMove:!1,reason:hn.DifferentOwner};let o=e.some((e=>e.isFolder||e.isProject||e.isChildOfProject||e._isShared_NoLazyLoad));if(o)return n.push(un.CollaboratorMaybeEditing),{canMove:!0,warning:un.CollaboratorMaybeEditing,warnings:n};let a=!1;if(e.forEach((e=>{e._isCollaboratorDataLoaded||void 0!==e.isShared||(tn.fetchIfNeeded(e,Di),a=!0)})),a){const t=await this._core.getCollaborationContext();if(await t._collaboratorRequestQueue._processNow(),o=e.some((e=>e.isShared&&e.collaboratorArray.some((e=>e.isDirect&&"editor"===e.role)))),o)return n.push(un.CollaboratorMaybeEditing),{canMove:!0,warning:un.CollaboratorMaybeEditing,warnings:n}}return{canMove:!0,warning:n.find((e=>e===un.CollaboratorMaybeEditing))||n[0]||un.None,warnings:n}}async assetsHaveArtifacts(e){const t=Ac(e),i=await this._assetReviewServiceInterface.hasOutputs(t);if(0===i.length)return!1;const s=this._assetPool.createUpdateSession();return this._adobeAssetUpdater.updateRemoteItems(s,i.map((e=>({"repo:assetId":e["repo:assetId"],hasArtifacts:!0})))),s.commit(),!0}async _deleteAssetOutputsFolder(e){return this._assetReviewServiceInterface.discardOutputsForAsset(e.id)}async _copyAssets(e,t,i=new Map,s=!0,r){let n={failedResults:[],newModels:[]};return await Fs.runExclusiveTask("copy",e,(async()=>{t.repositoryID||await t._load(),void 0===r&&(r=new Map);const s=new Map,o=e.map((e=>{s.set(e.id,e);let n=`${t.repoPath}/${Rr(e,i)}`;const o=t.repoPath===e.repoPath.substring(0,e.repoPath.lastIndexOf("/"));n=Ir(this._core,e.id,n,o,r);const a=[{reltype:gt.PRIMARY}];"application/pdf"===e.mediaType&&a.push({reltype:gt.APP_METADATA});const c={op:"copy",id:e.id,source:{"repo:assetId":e.id},target:{"repo:path":n,"repo:repositoryId":t.repositoryID},includeResources:a};return e.repositoryID&&(c.source["repo:repositoryId"]=e.repositoryID),c}));n=await this._runOperations(o,s,((e,t,i)=>{if(!i)throw Ge.create(Ue.UNKNOWN,"Missing metadata from asset bulk operation.");return this._adobeAssetUpdater.updateRemoteItem(e,i)}))})),s?await Gl(n,t,i,r,this._copyAssets.bind(this)):n}async copyAssets(e,t,i=new Map){return await this._copyAssets(e,t,i)}async duplicateAssets(e){const t=e[0].repoPath.substring(0,e[0].repoPath.lastIndexOf("/")),i=await this.getAssetWithRepoPath(t,e[0].repositoryID);return await this._copyAssets(e,i)}async createFolderByPath(e,t,i=!0){const s=await this._rapi.createFolderByPath(e,t.id,i,t.links),r=this._assetPool.createUpdateSession(),n=await this._core._adobeAssetFactory.getRepoMetadataUpdaters([s]),o=this._core._adobeAssetFactory.assetFromRepoMetadata({session:r,repoMetadata:s,updaters:n});return r.commit(),o}async _runOperations(e,t,i){return await this._rapi.runOperationsForContext(e,t,this._assetPool,i||((e,t,i)=>{if(!i)throw Ge.create(Ue.UNKNOWN,"Missing metadata from asset bulk operation.");this._adobeAssetUpdater.updateLocalItem(e,t,i)}),[{match:e=>e.code===Ue.ACCESS_DENIED||e.code===Ue.NOT_FOUND,action:async(e,t)=>(await e._load(),{model:e,error:t})}])}_updateONSSubscriptions(e){const t=new Set,i=this._core._getKnowledgeWorkspaceContext();this._assetPool.forEach((e=>{"/temp"!==e.repoPath&&((null==i?void 0:i._isCuratedCollectionAsset(e))||e.isFile&&(null==i?void 0:i._isMinimalAsset(e))||t.add(e.id))})),null==e||e.forEach((e=>t.delete(e)));const s=this._getAssetLinkManager();s&&s.lists.forEach((e=>e.monitoredAssetIDs.forEach((e=>t.add(e))))),this._commentsById.forEach(((e,i)=>{const s=e.deref();s?t.add(s._assetId):this._commentsById.delete(i)})),this.onsContext&&(t.size>0&&!this._core._environment.getValue("DISABLE_ONS")?(this.onsContext.watch(t),this.onsContext.start()):this.onsContext.stop())}async restoreLibraryElement(e){await this._libraryInterface.restoreLibraryElement(e)}async permanentlyDeleteLibraryElement(e){await this._libraryInterface.permanentlyDeleteLibraryElement(e)}getAssetInterface(e){return Jr("AdobeAsset.getAssetInterface","AdobeAsset.getAssetInterface is deprecated and will be removed on or after 2024-10-01."),new Yr(this._rapi,e["repo:assetId"],e._links,e["repo:etag"])}async getCommentsResource(e){var t;let i=null===(t=this._commentsById.get(e))||void 0===t?void 0:t.deref();return i||(i=new kc(this._core,e),this._commentsById.set(e,new Co(i)),this._updateONSSubscriptions()),i}async waitForListLoad(e){const{waitForListLoad:t}=await Promise.resolve().then((function(){return Do}));return t(e)}async _fetchOrganizations(){const e=new xd(this._core);await e.getOrganizations(this._organizationsResource)}get organizations(){return this._organizations}get defaultOrganizationId(){return this._defaultOrganizationId}getAdobeAssetOrder(e="descending",t="modified"){return new Bn(e,t)}getSWYAdobeAssetOrder(e="descending",t="shared"){return new Bd(e,t)}getUSSAdobeAssetOrder(e="descending",t="modified"){return new gd(e,t)}getAssetVersionOrder(e="descending",t="created"){return new $d(e,t)}getAdobeAssetFilter(e){return new Fd(e)}async getSWYAdobeAssetFilter(){return new Ld}getUSSAdobeAssetFilter(e){return new Vd(e)}getRecentAdobeAssetFilter(){return new $l}getAssetVersionFilter(e){return new Qo(e)}getIsSharedFilter(e=fu.ALL){switch(e){case fu.ALL:return new yu;case fu.SHARED_WITH_YOU:return new yu({isSharedWithYou:!0});case fu.YOURS:return new yu({ownedBy:this._core._environment.getUserId()});default:throw Ge.create(Ue.UNKNOWN,`Unsupported view selection: ${e}`)}}repoToStudentAssignmentData(e,t){const{_links:i}=t,s=ze(t,["_links"]),{_links:r}=e,n=ze(e,["_links"]);return Object.assign(Object.assign(Object.assign({},n),s),{_links:Object.assign(Object.assign({},r),i)})}}qe([Pt],Zu.prototype,"_getONSContext",null),qe([rt],Zu.prototype,"sharedSource",null),qe([rt],Zu.prototype,"PLSSharedSource",null),qe([rt],Zu.prototype,"recentAssetsSource",null),qe([rt],Zu.prototype,"favoriteAssetsSource",null),qe([rt],Zu.prototype,"MRUAssetsSource",null),qe([rt],Zu.prototype,"PLSMRUAssetsSource",null),qe([rt],Zu.prototype,"publishedSource",null),qe([rt],Zu.prototype,"discardedSource",null),qe([rt],Zu.prototype,"localRecentsSource",null),qe([Pt],Zu.prototype,"getAssetLinkManager",null),qe([rt],Zu.prototype,"ffBoardsSource",null),qe([Pt,Ye(0,tt)],Zu.prototype,"_getAssetById",null),qe([Nt,Pt],Zu.prototype,"getHomeFolder",null),qe([Nt,Pt],Zu.prototype,"getRootFolder",null),qe([Nt],Zu.prototype,"getAssetWithCloudID",null),qe([Nt,Pt],Zu.prototype,"getAssetWithRepoPath",null),qe([Pt],Zu.prototype,"_getAssetWithRepoPathImpl",null),qe([Nt],Zu.prototype,"getAssetWithAssetRefString",null),qe([sn(Hd,"_organizations")],Zu.prototype,"organizations",null),qe([sn(Hd,"_defaultOrganizationId")],Zu.prototype,"defaultOrganizationId",null);var eh,th,ih,sh,rh,nh,oh=Object.freeze({__proto__:null,get CloudSyncStatus(){return Xu},default:Zu});!function(e){e.MODIFIED_DATE="modified_date",e.CREATED_DATE="created_date",e.NAME="name"}(eh||(eh={})),function(e){e.Personal="private",e.Public="public",e.Incoming="incoming",e.Discovery="discovery",e.All="all"}(th||(th={})),function(e){e.All="all",e.None="none"}(ih||(ih={})),function(e){e.All="all",e.Only="only"}(sh||(sh={})),function(e){e.None="none",e.Brand="brand",e.TrainingSet="cm_training_set"}(rh||(rh={})),function(e){e.PublishedBrands="publishedBrands",e.AllBrands="allBrands",e.AllEditableBrands="allEditableBrands"}(nh||(nh={}));const ah={name:eh.NAME,created:eh.CREATED_DATE,modified:eh.MODIFIED_DATE},ch={name:(e,t)=>Mn(e.displayName||e.name,t.displayName||t.name),created:(e,t)=>xn(e.created,t.created),modified:(e,t)=>xn(e.modified,t.modified)};class lh extends(Hn(ch)){}function dh(e,t){return void 0!==e._ownership_NoLazyLoad&&(t.has(e._ownership_NoLazyLoad)||t.has(th.All)&&!e._isPublicLink_NoLazyLoad||t.has(th.Incoming)&&!e._isPublicLink_NoLazyLoad&&e._isBookmarked_NoLazyLoad||t.has(th.Discovery)&&"private"!==e._ownership_NoLazyLoad&&!e._isPublicLink_NoLazyLoad&&!e._isCCIProjectLibrary)}function uh(e,t){var i;return void 0!==e._roles_NoLazyLoad&&(t.has(rh.None)&&(!e._roles_NoLazyLoad||0===e._roles_NoLazyLoad.length)||(null===(i=e._roles_NoLazyLoad)||void 0===i?void 0:i.some((e=>t.has(e.type)))))}function hh(e=new Set([th.All]),t=new Set([th.All])){const i=Kn.prototype.intersection.call(e,t);if(i.size===e.size)return"subset";const s=Kn.prototype.symmetricDifference.call(e,t);return s.has(th.Public)?"disjoint":t.has(th.All)?"subset":e.has(th.All)||s.has(th.Discovery)&&s.has(th.Incoming)&&(e.has(th.Discovery)&&t.has(th.Incoming)||t.has(th.Discovery)&&e.has(th.Incoming))||i.size>0?"unknown":"disjoint"}lh.default=new lh("descending","modified");class ph{static EditorBrands(e){return new ph({owner:[th.All],roles:[rh.Brand],publishMetadata:nh.AllBrands,project:e})}constructor(e={}){if(this.filterOptions=e,this._project=e.project,e.roles&&e.roles.length>0&&(this._roles=new Set([...e.roles])),e.reference){if(this._reference=e.reference,e.owner)throw Ge.create(Ue.BAD_REQUEST,"The reference filter cannot be used with the owner filter.");if(!this._project)throw Ge.create(Ue.BAD_REQUEST,"The reference filter must be used with the project filter.")}else if(this._owner=e.owner?new Set([...e.owner]):ph.DEFAULT._owner,this._owner&&this._owner.size>1){if(this._owner.has(th.Public))throw Ge.create(Ue.BAD_REQUEST,"Public libraries cannot be combined with other ownership types.");if(this._owner.has(th.Discovery)&&this._owner.has(th.Incoming))throw Ge.create(Ue.BAD_REQUEST,"Discovery and Incoming are redundant, as Incoming is a subset of Discovery.")}if(e.publishMetadata){if(!this._roles||!this._roles.has(rh.Brand))throw Ge.create(Ue.BAD_REQUEST,"The publish metadata filter can only be used with the brands role.");this._publishMetadata=e.publishMetadata}}get hash(){return this._hash||(this._hash=[this._owner?`owner=${[...this._owner].sort().join(",")}`:void 0,this._roles?`roles=${[...this._roles].sort().join(",")}`:void 0,this._project?`project=${this._project}`:void 0,this._publishMetadata?`publishMetadata=${this._publishMetadata}`:void 0,this._reference?`reference=${this._reference}`:void 0].filter((e=>e)).join(":")),this._hash}matches(e){return!(!e.isLibrary||this._owner&&!dh(e,this._owner)||this._project&&!function(e,t,i){return t===ih.All&&e.isChildOfProject||"none"===t&&!e.isChildOfProject||"other"===t&&e.isChildOfProject&&!e._isBookmarked_NoLazyLoad||i===sh.Only&&e.isReferencedByProject(t)||i===sh.All&&e.isReferencedByProject(t)||t===e.parentProjectID&&i!==sh.Only}(e,this._project,this._reference)||this._roles&&!uh(e,this._roles)||this._publishMetadata&&!function(e,t){return t===nh.AllBrands&&!e.publishedTo||t===nh.PublishedBrands&&e.publishedFrom||t===nh.AllEditableBrands&&!e.publishedFrom}(e,this._publishMetadata))}getRelationToFilter(e){const t=[hh(this._owner,e._owner),(n=this._roles,o=e._roles,n&&o?function(e,t){const i=Kn.prototype.intersection.call(e,t);return i.size===e.size?"subset":i.size>0?"unknown":"disjoint"}(n,o):n||o?"unknown":"subset"),(i=this._project,s=e._project,i?s&&i!==s&&(r=i,Object.values(ih).includes(r)||s!==ih.All)?"disjoint":"subset":!i&&s?"unknown":"subset"),(l=this._publishMetadata,d=e._publishMetadata,d&&l!==d?l===nh.PublishedBrands&&d===nh.AllEditableBrands||l===nh.AllEditableBrands&&d===nh.PublishedBrands?"disjoint":d===nh.AllBrands&&l===nh.PublishedBrands?"subset":"unknown":"subset"),(a=this._reference,c=e._reference,a===c||c===sh.All?"subset":a===sh.All?"unknown":"disjoint")];var i,s,r,n,o,a,c,l,d;return t.includes("disjoint")?"disjoint":t.includes("unknown")?"unknown":"subset"}}var _h;ph.AllLibraries=new ph({owner:[th.Incoming,th.Personal]}),ph.CollaboratorBrands=new ph({owner:[th.All],roles:[rh.Brand],publishMetadata:nh.PublishedBrands}),ph.DEFAULT=ph.AllLibraries,function(e){e.MODIFY_DATE="modifyDate",e.CREATE_DATE="createDate",e.NAME="name"}(_h||(_h={}));const mh={name:(e,t)=>Mn(e.name,t.name),modified:(e,t)=>xn(e.modified,t.modified)};class fh extends(Hn(mh)){}var gh,yh,vh,Oh,bh,Eh,Ih,Th,Sh,Ah,Ph,wh,Ch,Rh,Lh;fh.default=new fh("descending","modified"),function(e){e.GC="GC"}(gh||(gh={})),function(e){e.STUDENT="STUDENT",e.TEACHER="TEACHER"}(yh||(yh={})),function(e){e.BLOCKED="BLOCKED",e.INVITED="INVITED",e.JOINED="JOINED",e.NOT_ENROLLED="NOT_ENROLLED",e.REMOVED="REMOVED"}(vh||(vh={})),function(e){e.CLEVER="clever",e.CLASS_LINK="classlink"}(Oh||(Oh={})),function(e){e.ACTIVE="ACTIVE",e.ARCHIVED="ARCHIVED"}(bh||(bh={})),function(e){e.TRUE="TRUE",e.RESTRICTED="RESTRICTED",e.UNRESTRICTED="UNRESTRICTED",e.NONE="NONE"}(Eh||(Eh={})),function(e){e.noSubject="",e.allsubjects="allsubjects",e.careersTechnicalEducation="careersTechnicalEducation",e.computerScience="computerScience",e.english="english",e.math="math",e.otherLanguages="otherLanguages",e.others="others",e.science="science",e.socialStudies="socialStudies",e.visualPerformingArts="visualPerformingArts"}(Ih||(Ih={})),function(e){e.STUDENT="STUDENT",e.TEACHER="TEACHER"}(Th||(Th={})),function(e){e.REMOVE_STUDENT_SUCCESS="REMOVE_STUDENT_SUCCESS",e.BLOCK_STUDENT_SUCCESS="BLOCK_STUDENT_SUCCESS",e.UNBLOCK_STUDENT_SUCCESS="UNBLOCK_STUDENT_SUCCESS",e.DELETE_DOMAIN_MAPPING_ACCEPTED="DELETE_DOMAIN_MAPPING_ACCEPTED"}(Sh||(Sh={})),function(e){e.OWNER="OWNER",e.ACTIVE="ACTIVE",e.INACTIVE="INACTIVE",e.INVITED="INVITED",e.IN_REVIEW="IN_REVIEW",e.DECLINED="DECLINED",e.NOT_A_MEMBER="NOT_A_MEMBER"}(Ah||(Ah={})),function(e){e.ALLOWED="ALLOWED",e.NOT_ALLOWED="NOT_ALLOWED"}(Ph||(Ph={})),function(e){e.ACCOUNT_NOT_FOUND="ACCOUNT_NOT_FOUND",e.STUDENT_IN_CLASSROOM="STUDENT_IN_CLASSROOM",e.TEACHER_IN_CLASSROOM="TEACHER_IN_CLASSROOM"}(wh||(wh={})),function(e){e.STUDENT="student",e.TEACHER="teacher",e.NONE="none"}(Ch||(Ch={})),function(e){e.ACTIVE="ACTIVE",e.DECLINED="DECLINED",e.INACTIVE="INACTIVE",e.INVITED="INVITED",e.IN_REVIEW="IN_REVIEW",e.NOT_A_MEMBER="NOT_A_MEMBER",e.OWNER="OWNER"}(Rh||(Rh={})),function(e){e.CLASSLINK="CLASSLINK",e.CLEVER="CLEVER",e.EMAIL="EMAIL",e.GOOGLE_CLASSROOM="GOOGLE_CLASSROOM",e.NONE="NONE"}(Lh||(Lh={}));const Nh={name:(e,t)=>Mn(e.name,t.name),created(e,t){let i;return i=e.created||t.created?e.created?t.created?xn(e.created.getTime(),t.created.getTime()):-1:1:0,0===i?Mn(e.name,t.name):i}};class Dh extends(Hn(Nh)){}Dh.default=new Dh("ascending","name");class Mh extends Fs{constructor(){super(...arguments),this._classroomId="",this._displayName="",this._email="",this._firstName="",this._inviteSource=Lh.NONE,this._lastName="",this._membershipStatus=Rh.NOT_A_MEMBER,this._role=Ch.NONE,this._userId=""}get classroomId(){return this._classroomId}get displayName(){return this._displayName}get email(){return this._email}get firstName(){return this._firstName}get inviteSource(){return this._inviteSource}get lastName(){return this._lastName}get membershipStatus(){return this._membershipStatus}get role(){return this._role}get userId(){return this._userId}}qe([ut],Mh.prototype,"classroomId",null),qe([ut],Mh.prototype,"displayName",null),qe([ut],Mh.prototype,"email",null),qe([ut],Mh.prototype,"firstName",null),qe([ut],Mh.prototype,"inviteSource",null),qe([ut],Mh.prototype,"lastName",null),qe([ut],Mh.prototype,"membershipStatus",null),qe([ut],Mh.prototype,"role",null),qe([ut],Mh.prototype,"userId",null);const xh=new mn({localItemType:Mh,remoteIdProperty:"computedKey",propertyUpdater:new Sn({_classroomId:{name:"classroomId",format:"string"},_displayName:{name:"displayName",format:"string"},_email:{name:"email",format:"string"},_firstName:{name:"firstName",format:"string"},_inviteSource:{name:"inviteSource",format:"string",choices:Object.values(Lh)},_lastName:{name:"lastName",format:"string"},_membershipStatus:{name:"membershipStatus",format:"string",choices:Object.values(Rh)},_role:{name:"role",format:"string",choices:Object.values(Ch)},_userId:{name:"userId",format:"string"}})}),kh={name:(e,t)=>Mn(e.displayName,t.displayName)};class Hh extends(Hn(kh)){}Hh.default=new Hh("ascending","name");class jh{constructor(e){this.classroomId=e.classroomId||"",this.role=e.role||Ch.NONE}matches(e){return this.classroomId===e.classroomId&&(this.role&&this.role!==Ch.NONE?e.role===this.role:e.role===Ch.STUDENT||e.role===Ch.TEACHER)}getRelationToFilter(e){return e.classroomId!==this.classroomId||this.role!==e.role&&this.role!==Ch.NONE&&e.role!==Ch.NONE?"disjoint":this.role===e.role||e.role===Ch.NONE?"subset":"unknown"}get hash(){return`id=${this.classroomId}-${this.role}`}}const Uh={[gt.ASSIGNMENTS_COLLECTION]:["classroomId"],[gt.ASSIGNMENTS_CREATE]:["classroomId"],[gt.ASSIGNMENTS_PRIMARY]:["assignmentId"]};var Bh;!function(e){e.DRAFT="DRAFT",e.ASSIGNED="ASSIGNED"}(Bh||(Bh={}));const Fh={canClassroomReadSubmissions:"assignment:canClassroomReadSubmissions",instructions:"assignment:instructions",dueDate:"assignment:dueDate",externalTemplateIds:"assignment:externalTemplateIds",templateIds:"assignment:templateIds",name:"repo:name",tasks:"assignment:tasks",status:"assignment:status",referenceIds:"assignment:referenceIds",externalTutorials:"assignment:externalTemplateIds"};var Vh;!function(e){e.ANY="ANY",e.NONE="NONE",e.SELF="SELF"}(Vh||(Vh={}));const Kh={[Bh.DRAFT]:0,[Bh.ASSIGNED]:1},$h=(e,t)=>Mn(e.name||"",t.name||""),Gh={name:(e,t)=>$h(e,t),dueDate(e,t){let i;return i=e.dueDate||t.dueDate?e.dueDate?t.dueDate?xn(e.dueDate.getTime(),t.dueDate.getTime()):-1:1:0,0===i?$h(e,t):i},status(e,t){const i=xn(Kh[e.status],Kh[t.status]);return 0===i?$h(e,t):i}};class Wh extends(Hn(Gh)){}Wh.default=new Wh("ascending","name");class zh{constructor(e={}){if(this.classroomId=e.classroomId||"",this.campaignId=e.campaignId||"",this.campaignId&&this.classroomId)throw Ge.create(Ue.UNSUPPORTED,"Cannot filter by both campaignId and classroomId");if(!this.campaignId&&!this.classroomId)throw Ge.create(Ue.UNSUPPORTED,"Must filter by either campaignId or classroomId");this.submissions=e.submissions}matches(e){return!(!e.isAssignment||this.classroomId&&e.classroomId!==this.classroomId||this.campaignId&&e.campaignId!==this.campaignId||e.isDiscarded)}getRelationToFilter(e){return this.classroomId&&this.classroomId===e.classroomId||this.campaignId&&this.campaignId===e.campaignId?"subset":"disjoint"}get hash(){return`classroomId=${this.classroomId}&campaignId=${this.campaignId}`}}class qh{constructor(e={}){this.owner=qd.Any;const{assignmentId:t,assignmentCode:i,currentUserId:s,loadDocuments:r,status:n}=e;this.assignmentId=t,this.assignmentCode=i,this.loadDocuments=void 0===r||r,this.status=n&&n.length>0?n:zd,this.currentUserId=s}matches(e){return!(this.currentUserId&&e.student.id!==this.currentUserId||!this.status.includes(e.status))}getRelationToFilter(e){const t=lo(this.status,e.status);return"disjoint"===t?"disjoint":"unknown"===t||this.loadDocuments&&!e.loadDocuments||!this.currentUserId&&e.currentUserId?"unknown":"subset"}get hash(){const e=this.assignmentId||this.assignmentCode;return`${e?`assignmentId=${e}&`:""}status=${this.status.join()}&loadDocuments=${this.loadDocuments}${this.currentUserId?`&currentUserId=${this.currentUserId}`:""}`}}const Yh={[Wd.SUBMITTED]:0,[Wd.IN_PROGRESS]:1,[Wd.RETURNED]:2,[Wd.NOT_STARTED]:3},Qh=(e,t)=>xn(e.student.displayName||"",t.student.displayName||""),Jh={studentDisplayName:(e,t)=>Qh(e,t),submissionDate(e,t){let i;return i=e.submissionDate||t.submissionDate?e.submissionDate?t.submissionDate?xn(e.submissionDate.getTime(),t.submissionDate.getTime()):-1:1:0,0===i?Qh(e,t):i},status(e,t){const i=xn(Yh[e.status],Yh[t.status]);return 0===i?Qh(e,t):i}};class Xh extends(Hn(Jh)){}Xh.default=new Xh("ascending","studentDisplayName");class Zh extends an{constructor(e,t){super(e,t),this._core=e,this._parent=t}async _loadData(){await super._loadData();const e=this._core._getAssetPool().createMutationSession();tp.updateLocalItem(e,this._parent,this.data),e.commit()}}class ep extends dc{constructor(e,t,i){super(e,t,i),this._core=e,this._studentAssignmentId="",this._parentAssignmentId="",this._parentClassroomId="",this._sourceAssets=[],this._sourceTasks=[],this._sourceTutorials=[],this._studentAssignmentFileAppMetadata=new Zh(e,this),this._needsRepoMetadata=!0}get adobeAsset(){return this}get isChildOfStudentAssignment(){return!0}get studentAssignmentId(){return this._studentAssignmentId}get parentStudentAssignmentId(){return this._studentAssignmentId||super.parentStudentAssignmentId||""}get parentAssignmentID(){return this._parentAssignmentId||super.parentAssignmentID||""}get isChildOfAssignment(){return!0}get isChildOfClassroom(){return!0}get parentClassroomId(){return this._parentClassroomId||super.parentClassroomId}get isChildOfAssignmentMaterials(){return!1}get sourceAsset(){return this._sourceAsset}get sourceAssets(){return this._sourceAssets}get sourceTasks(){return this._sourceTasks}get sourceTutorials(){return this._sourceTutorials}get appMetadata(){return this._studentAssignmentFileAppMetadata}async update({sourceAsset:e,sourceAssets:t,sourceTasks:i,sourceTutorials:s}){if(!(e||t||i||s))throw Error("Incorrect parameters: sourceAsset, sourceTasks, or sourceTutorials parameter required");return await this._core.classroomContext.updateStudentAssignmentFile(this,{sourceAsset:e,sourceAssets:t,sourceTasks:i,sourceTutorials:s}),this}}qe([ut],ep.prototype,"isChildOfStudentAssignment",null),qe([ut],ep.prototype,"studentAssignmentId",null),qe([ut],ep.prototype,"parentStudentAssignmentId",null),qe([ut],ep.prototype,"parentAssignmentID",null),qe([ut],ep.prototype,"isChildOfAssignment",null),qe([ut],ep.prototype,"isChildOfClassroom",null),qe([ut],ep.prototype,"parentClassroomId",null),qe([ut],ep.prototype,"isChildOfAssignmentMaterials",null),qe([ut],ep.prototype,"sourceAsset",null),qe([ut],ep.prototype,"sourceAssets",null),qe([ut],ep.prototype,"sourceTasks",null),qe([ut],ep.prototype,"sourceTutorials",null),qe([ut],ep.prototype,"appMetadata",null);const tp=new mn({localItemType:ep,remoteIdProperty:"repo:assetId",propertyUpdater:new Sn({_repositoryID:"repo:repositoryId",_name:"repo:name",_path:"repo:path",_type:"dc:format",_assetClass:{name:"repo:assetClass",choices:ln},_created:{name:"repo:createDate",format:"date"},_modified:{name:"repo:modifyDate",format:"date"},_createdBy:"repo:createdBy",_modifiedBy:"repo:modifiedBy",__links:{name:"_links",format:"object"},_parentAssignmentId:{name:"computedAssignmentId",format:"string"},_parentClassroomId:{name:"computedClassroomAssetId",format:"string"},_studentAssignmentId:{name:"computedStudentAssignmentId",format:"string"},_sourceAsset:{name:"assignment:sourceAsset",format:"object"},_sourceAssets:{isArray:!0,name:"assignment:sourceAssets",format:"string"},_sourceTasks:{isArray:!0,name:"assignment:sourceTasks",format:"string"},_sourceTutorials:{isArray:!0,name:"assignment:sourceTutorials",format:"object"}})}),ip={modified:(e,t)=>xn(e.modified,t.modified),name:(e,t)=>xn(e.name,t.name),created:(e,t)=>xn(e.created,t.created)};class sp extends(Hn(ip)){}sp.default=new sp("descending","modified");class rp extends Fd{matches(e){return e.isChildOfStudentAssignment}}class np{constructor(e,t){var i;this.studentAssignmentId=e,this.loadDocuments=null===(i=null==t?void 0:t.loadDocuments)||void 0===i||i}matches(e){return!0===e.isChildOfStudentAssignment&&e.studentAssignmentId===this.studentAssignmentId&&!e.isFolder&&e.mediaType!==kr&&!function(e){const t="application/vnd.adobe.gneisswebpage.theme.document+dcx"===e.mediaType,i=e.name.endsWith(".webpagetheme");return t||i}(e)}getRelationToFilter(e){return this.loadDocuments!==e.loadDocuments?"disjoint":this.studentAssignmentId===e.studentAssignmentId?"subset":"disjoint"}get hash(){return`studentAssignmentId=${this.studentAssignmentId}&loadDocuments=${this.loadDocuments}`}}function op(e){return Object.keys(e).filter((e=>isNaN(Number(e))))}var ap,cp,lp;!function(e){e.OWNER="OWNER",e.POSTER="POSTER",e.VIEWER="VIEWER",e.UNKNOWN="UNKNOWN"}(ap||(ap={})),function(e){e.Text="text",e.AssetLink="assetLink"}(cp||(cp={})),function(e){e.CLASSROOM="classroom"}(lp||(lp={}));const dp={[gt.BOARDS_COLLECTION]:["baseAssetId","useBaseAssetDirectory"],[gt.BOARDS_CREATE]:["baseAssetId"],[gt.BOARDS_PRIMARY]:["boardId"]};var up;!function(e){e.TEXT="application/vnd.adobe.post.text+dcx",e.ASSET_LINK="application/vnd.adobe.post.assetlink+dcx"}(up||(up={}));const hp=function(e,t,i){const s=op(e).map((t=>e[t])),r=op(t).map((e=>t[e]));if(i.length!==s.length||i.length!==r.length)throw Ge.create(Ue.INTERNAL_ERROR,`Enum-to-enum map must have exactly ${s.length} entries, got ${i.length}`);const n=new Map,o=new Map;for(const[e,t]of i){if(!s.includes(e))throw Ge.create(Ue.INTERNAL_ERROR,`Value ${e} not in enum A`);if(!r.includes(t))throw Ge.create(Ue.INTERNAL_ERROR,`Value ${t} not in enum B`);if(n.has(e))throw Ge.create(Ue.INTERNAL_ERROR,`Duplicate mapping for A value ${e}`);if(o.has(t))throw Ge.create(Ue.INTERNAL_ERROR,`Duplicate mapping for B value ${t}`);n.set(e,t),o.set(t,e)}return{toB(e){const t=n.get(e);if(void 0===t)throw Ge.create(Ue.INTERNAL_ERROR,`No B-value mapped for A value ${e}`);return t},toA(e){const t=o.get(e);if(void 0===t)throw Ge.create(Ue.INTERNAL_ERROR,`No A-value mapped for B value ${e}`);return t}}}(cp,up,[[cp.Text,up.TEXT],[cp.AssetLink,up.ASSET_LINK]]);class pp{constructor(e,t){this._core=e,this._board=t}async loadPage(e){return await this._loadPage(e)}async _loadPage(e){const t=await this._core.getBoardContext(),i=(await t.getBoardById(this._board.id))._postPool.toArray();return{items:i,total:i.length,loadNextPage:void 0}}}class _p{constructor(e){this.data=e,this._userId=void 0,this._displayName=void 0,this._email=void 0,this._firstName=void 0,this._lastName=void 0,this._images=void 0,this._userId=e.userId,this._displayName=e.displayName,this._email=e.email,this._firstName=e.firstName,this._lastName=e.lastName,this._images=e.images}get userId(){return this._userId}get displayName(){return this._displayName}get email(){return this._email}get firstName(){return this._firstName}get lastName(){return this._lastName}get avatarImageURLs(){return this._images}get avatarUrl(){var e;return null===(e=this.avatarImageURLs)||void 0===e?void 0:e[gu.Size138]}}class mp extends Fs{constructor(){super(...arguments),this._description=void 0,this._boardId="",this._owner=void 0}get boardId(){return this._boardId}get type(){return hp.toA(this._type)}get name(){return this._name}get created(){return this._created}get modified(){return this._modified}get description(){return this._description}get owner(){return this._owner}get isDeletable(){return this._isOwner()||this._isBoardOwner()}get isEditable(){return this.isDeletable}_isOwner(){if(this._owner)return this._owner.userId===this._core._environment.getUserId()}_isBoardOwner(){var e;return(null===(e=this._core._getAssetPool().getLocalItemById(this._boardId))||void 0===e?void 0:e.role)===ap.OWNER}}qe([ut],mp.prototype,"boardId",null),qe([ut],mp.prototype,"type",null),qe([ut],mp.prototype,"name",null),qe([ut],mp.prototype,"created",null),qe([ut],mp.prototype,"modified",null),qe([ut],mp.prototype,"description",null),qe([ut],mp.prototype,"owner",null),qe([ut],mp.prototype,"isDeletable",null),qe([ut],mp.prototype,"isEditable",null);const fp=e=>new Sn(Object.assign({_boardId:{name:"computedBoardId",format:"string"},_name:{name:"name",format:"string"},_type:{name:"type",format:"string",choices:Object.values(up)},_description:{name:"board#postDescription",format:"string"},_modified:{name:"modified",format:"date"},_created:{name:"created",format:"date"},_owner:{name:"postedBy",format:"object",set:(e,t)=>{const i=t,s=new _p(e);i._owner=s}}},e));class gp extends mp{get link(){return{mediaType:this._remoteLink["dc:format"],assetId:this._remoteLink["repo:assetId"],publicUrl:this._remoteLink["board#postPublicUrl"]}}}qe([ut],gp.prototype,"link",null);const yp=new mn({localItemType:gp,remoteIdProperty:"id",propertyUpdater:fp({_remoteLink:{name:"link",format:"object"}})}),vp=new mn({localItemType:class extends mp{get text(){return this._text}},remoteIdProperty:"id",propertyUpdater:fp({_text:{name:"board#postText",format:"string"}})});class Op extends dc{constructor(e,t,i){super(e,t,i),this._core=e,this._memberRole=ap.UNKNOWN,this._hasLoadedPostsProp=!1,this._postPool=new qo(this._core,"post"),this._posts=[],this._core.getBoardContext().then((e=>{this._boardContext=e})),this._needsRepoMetadata=!0}_ensureBoardContext(){if(!this._boardContext)throw Ge.create(Ue.INTERNAL_ERROR,"Board context not initialized");return this._boardContext}get _hasLoadedPosts(){return this._hasLoadedPostsProp}set _hasLoadedPosts(e){this._hasLoadedPostsProp=e}get posts(){const e=new pp(this._core,this);return new xo(this._postPool,[e])}get description(){return this._description}get displayName(){return this._name.replace(Op.boardNameSuffix,"")}get _idOfBaseAsset(){return this._baseAssetId}get role(){return this._memberRole}get publishedBoardInfo(){return this._publishedBoardInfo}get isPublishedToAnotherBoard(){return!!this._publishedBoardInfo}get sourceBoardInfo(){return this._sourceBoardInfo}get isPublishedFromAnotherBoard(){return!!this._sourceBoardInfo}async addPost(e){return this._ensureBoardContext().addPost(Object.assign({boardId:this.id},e))}async removePost(e){await this._ensureBoardContext().removePost({boardId:this.id,postId:e})}async updatePost(e){await this._ensureBoardContext().updatePost(Object.assign({boardId:this.id},e))}async update(e){return this._ensureBoardContext().updateBoard(Object.assign({boardId:this.id},e))}async discard(){return this._ensureBoardContext().discardBoard(this.id)}async restore(){}get links(){return Object.assign({},this.__links)}async publish(e={}){return this._ensureBoardContext().publishBoard(Object.assign({boardId:this.id},e))}async unpublish(){return this._ensureBoardContext().unpublishBoard(this.id)}get canAddPost(){return this._memberRole===ap.OWNER||this._memberRole===ap.POSTER}get canUnpublish(){return this._memberRole===ap.OWNER&&this.isPublishedToAnotherBoard}get canPublish(){return this._memberRole===ap.OWNER}async getPostById(e){return this._ensureBoardContext().getPostByBoardAndPostId({boardId:this.id,postId:e})}handleOnsChangedResources(e){super.handleOnsChangedResources(e),(null==e?void 0:e.includes("api:metadata/repository"))||this._boardContext._fetchBoardById(this.id)}_loadWithRetry(){return this._load()}async _load({repoMetadata:e,appMetadata:t,effectivePermission:i}={}){this._boardContext||(this._boardContext=await this._core.getBoardContext());const s=super._load({repoMetadata:e,appMetadata:t,effectivePermission:i});await Promise.allSettled([s,this._boardContext._fetchBoardById(this.id,s)])}}Op.boardNameSuffix=".ccboard",qe([rt],Op.prototype,"posts",null),qe([ut],Op.prototype,"description",null),qe([ut],Op.prototype,"displayName",null),qe([ut],Op.prototype,"_idOfBaseAsset",null),qe([ut],Op.prototype,"role",null),qe([ut],Op.prototype,"publishedBoardInfo",null),qe([ut],Op.prototype,"isPublishedToAnotherBoard",null),qe([ut],Op.prototype,"sourceBoardInfo",null),qe([ut],Op.prototype,"isPublishedFromAnotherBoard",null),qe([ut],Op.prototype,"links",null),qe([At],Op.prototype,"_loadWithRetry",null);const bp=new mn({localItemType:Op,remoteIdProperty:"repo:assetId",propertyUpdater:new Sn({_id:{name:"repo:assetId",format:"string"},_assetClass:{name:"repo:assetClass",choices:ln},_description:{name:"dc:description",format:"string"},_name:{name:"repo:name",format:"string"},_created:{name:"repo:createDate",format:"date"},_repositoryID:{name:"repo:repositoryId",format:"string"},__links:{name:"_links",format:"object"},_createdBy:{name:"repo:createdBy",format:"string"},_modifiedBy:{name:"repo:modifiedBy",format:"string"},_modified:{name:"repo:modifyDate",format:"date"},_assetState:{name:"repo:state",choices:dn},_type:{name:"dc:format",format:"string"},_path:{name:"repo:path",format:"string"},_remotePosts:{isArray:!0,name:"posts",format:"object",set:async(e,t)=>{const i=t;i._posts.length=0;const s=i._postPool.createMutationSession(),r=i._postPool.toArray().filter((t=>!e.some((e=>e.id===t.id))));r.forEach((e=>s.queueDiscardedItem(e))),i._postPool.removeLocalItems(r.map((e=>e.id)));const n=[];e.forEach((e=>{const t=Object.assign(Object.assign({},e),{computedBoardId:i.id});e.type===up.TEXT?n.push(vp.updateRemoteItem(s,t)):e.type===up.ASSET_LINK&&n.push(yp.updateRemoteItem(s,t))})),s.commit(),i._posts.push(...n)}},_baseAssetId:{name:"board:context[baseAssetId]",format:"string"},_memberRole:{name:"memberRole",choices:Object.values(ap)},_permissions:{get:function(e){var t;if(null===(t=e._embedded)||void 0===t?void 0:t[gt.AC_EFFECTIVE])return Gi(e._embedded[gt.AC_EFFECTIVE]);switch(e.memberRole){case ap.OWNER:return Z.Write|Z.Read|Z.Delete;case ap.POSTER:case ap.VIEWER:return Z.Read;case ap.UNKNOWN:return Z.None;default:return fn}},format:"number"},_publishedBoardInfo:{name:"board:publishedBoard",format:"object",set:(e,t)=>{t._publishedBoardInfo={boardId:e["repo:assetId"],showPosterName:e["board:showPosterName"]||!1}}},_sourceBoardInfo:{name:"board:sourceBoard",format:"object",set:(e,t)=>{t._sourceBoardInfo={boardId:e["repo:assetId"],publishedVersion:e["repo:version"]}}}})}),Ep={noop:()=>0};class Ip extends(Hn(Ep)){}Ip.default=new Ip("ascending","noop");const Tp=(e,t)=>Mn(e.displayName||"",t.displayName||""),Sp=(e,t,i)=>{let s;return s=e[i]||t[i]?e[i]?t[i]?xn(e[i].getTime(),t[i].getTime()):-1:1:0,0===s?Tp(e,t):s},Ap={name:(e,t)=>Tp(e,t),created:(e,t)=>Sp(e,t,"created"),modified:(e,t)=>Sp(e,t,"modified")};class Pp extends(Hn(Ap)){}Pp.default=new Pp("ascending","name");class wp{constructor(e={}){this.baseAssetId=e.baseAssetId||"",this.shouldGetDirectlyInBaseAsset=e.shouldGetDirectlyInBaseAsset||!1}matches(e){return!!e.isBoard&&e._idOfBaseAsset===this.baseAssetId&&!e.isDiscarded}getRelationToFilter(e){return this.baseAssetId!==e.baseAssetId?"disjoint":"subset"}get hash(){return`baseAssetId=${this.baseAssetId}&shouldGetDirectlyInBaseAsset=${this.shouldGetDirectlyInBaseAsset}`}}class Cp extends Fs{constructor(){super(...arguments),this._repositoryID=""}get repositoryID(){return this._repositoryID}async createTeam(e){return await this._core.spaceContext.createTeam(this,e)}}qe([ut],Cp.prototype,"repositoryID",null);const Rp=new mn({localItemType:Cp,remoteIdProperty:"repositoryId",propertyUpdater:new Sn({_repositoryID:"repositoryId"})}),Lp={created:(e,t)=>xn(e.created,t.created),name:(e,t)=>xn(e.name,t.name)};class Np extends(Hn(Lp)){}Np.default=new Np("descending","created");class Dp extends gd{}Dp.default=new Dp("descending","lastAccessed");class Mp extends gd{}Mp.default=new Mp("descending","modified");const xp={name:"repo:name",created:"repo:createDate",lastAccessed:wn},kp={name:(e,t)=>Mn(e.name,t.name),created:(e,t)=>xn(e.created,t.created),lastAccessed:(e,t)=>xn(e.lastAccessed,t.lastAccessed)};class Hp extends(Hn(kp)){}Hp.default=new Hp("ascending","name"),Hp.createdDesc=new Hp("descending","created"),Hp.lastAccessed=new Hp("descending","lastAccessed");const jp={name:ss.NAME,created:ss.CREATE_DATE,modified:ss.MODIFY_DATE},Up={name:(e,t)=>Mn(e.name,t.name),created:(e,t)=>xn(e.created,t.created),modified:(e,t)=>xn(e.modified,t.modified)};class Bp extends(Hn(Up)){}Bp.default=new Bp("descending","modified");const Fp={created:(e,t)=>xn(e.created,t.created)};class Vp extends(Hn(Fp)){}Vp.default=new Vp("descending","created");const Kp={name:ns.NAME,created:ns.CREATE_DATE,modified:ns.MODIFY_DATE},$p={name:(e,t)=>Mn(e.name,t.name),created:(e,t)=>xn(e.created,t.created),modified:(e,t)=>xn(e.modified,t.modified)};class Gp extends(Hn($p)){}Gp.default=new Gp("descending","modified");const Wp={id:(e,t)=>Mn(e.id,t.id)};class zp extends(Hn(Wp)){}zp.default=new zp("ascending","id");const qp={name:"name",created:"createDate"},Yp={name:(e,t)=>Mn(e.name,t.name),created:(e,t)=>xn(e.created,t.created)};class Qp extends(Hn(Yp)){}Qp.default=new Qp("ascending","name");const Jp={name:"name",created:"createdDate"},Xp={name:(e,t)=>Mn(e.name,t.name),created:(e,t)=>xn(e.created,t.created)};class Zp extends(Hn(Xp)){}Zp.default=new Zp("ascending","name");const e_={noop:(e,t)=>0};class t_ extends(Hn(e_)){}t_.default=new t_("ascending","noop");const i_=e=>/\S/.test(e);var s_;!function(e){e[e.DISJOINTED=0]="DISJOINTED",e[e.SUPERSET=1]="SUPERSET",e[e.SUBSET=2]="SUBSET",e[e.UNKNOWN=3]="UNKNOWN",e[e.IDENTICAL=4]="IDENTICAL"}(s_||(s_={}));const r_=[q.Yours,q.SWY];class n_{constructor(e={view:q.All}){this._view=q.All,this._directorySubtypes=[es.CC_PROJECTS];const{_isDiscarded:t,view:i,repositoryID:s,organizationID:r,nameContains:n,isDiscarded:o,directorySubtypes:a}=e;this._isDiscarded=!(!t&&!o),void 0!==i&&(this._view=i),this._repositoryID=s,this._organizationID=r,this._nameContains=n,this._directorySubtypes=null!=a?a:this._directorySubtypes}get hash(){var e;return`discarded=${this._isDiscarded}view=${this._view}repositoryId=${this._repositoryID}orgID=${this._organizationID||""}nameContains=${this._nameContains}directorySubtype=${null===(e=this._directorySubtypes)||void 0===e?void 0:e.sort().join("")}`}get view(){return this._view}get repositoryID(){return this._repositoryID}get nameContains(){return this._nameContains}get isDiscarded(){return this._isDiscarded}_getRelationToNameContains(e="",t=""){if(e===t)return s_.IDENTICAL;if(!e&&t)return s_.UNKNOWN;const i=e.toLowerCase().split(" ").filter(i_).sort(),s=t.toLowerCase().split(" ").filter(i_).sort();if(0===i.length&&0===s.length)return s_.IDENTICAL;if(i.length===s.length&&i.every(((e,t)=>e===s[t])))return s_.IDENTICAL;let r=0,n=0;return i.forEach((e=>{const t=s.find((t=>{const i=t.startsWith(e),s=e.startsWith(t);return i||s}));t&&(e.length<=t.length&&n++,e.length>t.length&&r++)})),i.length===r?s_.SUBSET:i.length===n?s_.SUPERSET:0===r&&0===n?s_.DISJOINTED:s_.UNKNOWN}_searchTarget(e,t){const i=e.toLowerCase().split(/\s+/),s=t.toLowerCase().split(/\s+/);return 0!==i.length&&0!==s.length&&i.every((e=>s.find((t=>t.startsWith(e)))))}get organizationID(){return this._organizationID}get directorySubtypes(){return this._directorySubtypes}matches(e){var t;if(this._view===q.Recent&&!e._isRecent)return!1;if(this.view!==q.Recent&&e._isRecent&&!e._allowInLists)return!1;if(!e.isProject)return!1;if(e.isDiscarded!==this._isDiscarded)return!1;if(this._repositoryID&&this._repositoryID!==e.repositoryID)return!1;if(this._organizationID&&this._organizationID!==e.repositoryOwner.id)return!1;if((null===(t=this._directorySubtypes)||void 0===t?void 0:t.length)&&!this._directorySubtypes.includes(e.directorySubtype))return!1;const i=this._nameContains;return!(i&&!this._searchTarget(i,e.name)||r_.includes(this._view)&&this._view!==e.view)}getRelationToFilter(e){if(this._repositoryID&&e.repositoryID&&this._repositoryID!==e.repositoryID)return"disjoint";if(this._isDiscarded!==e._isDiscarded)return"disjoint";if(this._view!==e.view&&r_.includes(this._view)&&r_.includes(e.view))return"disjoint";let t;if((this.nameContains||e.nameContains)&&(t=this._getRelationToNameContains(this.nameContains,e.nameContains),t===s_.DISJOINTED))return"disjoint";if(this._organizationID&&e.organizationID&&this._organizationID!==e.organizationID)return"disjoint";const i=lo(this._directorySubtypes,e._directorySubtypes);if("disjoint"===i)return"disjoint";if(t&&t===s_.SUPERSET||t===s_.UNKNOWN)return"unknown";if(!this._organizationID&&e.organizationID)return"unknown";if([q.All,q.Admin,void 0].includes(this._view)&&r_.includes(e.view))return"unknown";if(r_.includes(this.view)&&e.view===q.All)return"unknown";if(this.view===q.Admin&&e.view===q.All)return"unknown";if(this._view===q.Recent){switch(e.view){case q.Recent:case q.All:case q.Admin:case q.Yours:case q.SWY:case q.Organization:}return"unknown"}return e.view===q.Recent||"unknown"===i?"unknown":"subset"}}n_.YourProjects=new n_({view:q.Yours}),n_.AllProjects=new n_({view:q.All}),n_.SWYProjects=new n_({view:q.SWY}),n_.AdminProjects=new n_({view:q.Admin});class o_{constructor(e){this._listingOptions={},e&&(this._listingOptions=e)}get listingOptions(){return this._listingOptions}get hash(){const e=this._listingOptions;return[void 0!==e.publishedState?`publishedState:${e.publishedState}`:void 0,e.createDateMin?`createDateMin:${e.createDateMin.getTime()}`:void 0,e.createDateMax?`createDateMax:${e.createDateMax.getTime()}`:void 0,e.modifyDateMin?`modifyDateMin:${e.modifyDateMin.getTime()}`:void 0,e.modifyDateMax?`modifyDateMax:${e.modifyDateMax.getTime()}`:void 0,e.createdBy?`createdBy:${e.createdBy}`:void 0,e.trainingSetId?`trainingSetId:${e.trainingSetId}`:void 0,e.baseModelName?`baseModelName:${e.baseModelName}`:void 0,e.baseModelVersion?`baseModelVersion:${e.baseModelVersion}`:void 0,e.category?`category:${e.category}`:void 0,void 0!==e.inferenceReady?`inferenceReady:${e.inferenceReady}`:void 0,e.trainingJobId?`trainingJobId:${e.trainingJobId}`:void 0,e.trainingState?`trainingState:${e.trainingState}`:void 0,e.trainingSetVersion?`trainingSetVersion:${e.trainingSetVersion}`:void 0].filter((e=>void 0!==e)).join(":")}matches(e){return!(void 0!==this._listingOptions.publishedState&&e.publishedState!==this._listingOptions.publishedState||void 0!==this._listingOptions.createdBy&&e.createdBy!==this._listingOptions.createdBy||void 0!==this._listingOptions.createDateMin&&e.created<this._listingOptions.createDateMin||void 0!==this._listingOptions.createDateMax&&e.created>this._listingOptions.createDateMax||void 0!==this._listingOptions.modifyDateMin&&e.modified<this._listingOptions.modifyDateMin||void 0!==this._listingOptions.modifyDateMax&&e.modified>this._listingOptions.modifyDateMax||void 0!==this._listingOptions.trainingSetId&&e.trainingSetInfo.id!==this._listingOptions.trainingSetId||void 0!==this._listingOptions.baseModelName&&e.baseModelName!==this._listingOptions.baseModelName||void 0!==this._listingOptions.baseModelVersion&&e.baseModelVersion!==this._listingOptions.baseModelVersion||void 0!==this._listingOptions.category&&e.category!==this._listingOptions.category||void 0!==this._listingOptions.inferenceReady&&e.inferenceReady!==this._listingOptions.inferenceReady||void 0!==this._listingOptions.trainingJobId&&e.trainingInfo.jobId!==this._listingOptions.trainingJobId||void 0!==this._listingOptions.trainingState&&e.trainingInfo.trainingState!==this._listingOptions.trainingState||void 0!==this._listingOptions.trainingSetVersion&&e.trainingSetInfo.version!==this._listingOptions.trainingSetVersion)}getRelationToFilter(e){const t=co(this._listingOptions.createDateMin,this._listingOptions.createDateMax,e._listingOptions.createDateMin,e._listingOptions.createDateMax),i=co(this._listingOptions.modifyDateMin,this._listingOptions.modifyDateMax,e._listingOptions.modifyDateMin,e._listingOptions.modifyDateMax),s=[...["publishedState","createdBy","trainingSetId","baseModelName","baseModelVersion","category","inferenceReady","trainingJobId","trainingState","trainingSetVersion"].map((t=>this.getRelationForParam(e,t))),t,i];return s.some((e=>"disjoint"===e))?"disjoint":s.some((e=>"unknown"===e))?"unknown":"subset"}getRelationForParam(e,t){return this._listingOptions[t]===e._listingOptions[t]?"subset":e._listingOptions[t]?this._listingOptions[t]?"disjoint":"unknown":"subset"}getRelationPublishedState(e){return this.getRelationForParam(e,"publishedState")}getRelationCreatedBy(e){return this.getRelationForParam(e,"createdBy")}getRelationTrainingSetId(e){return this.getRelationForParam(e,"trainingSetId")}getRelationBaseModelName(e){return this.getRelationForParam(e,"baseModelName")}getRelationBaseModelVersion(e){return this.getRelationForParam(e,"baseModelVersion")}getRelationCategory(e){return this.getRelationForParam(e,"category")}getRelationInferenceReady(e){return this.getRelationForParam(e,"inferenceReady")}getRelationTrainingJobId(e){return this.getRelationForParam(e,"trainingJobId")}getRelationTrainingState(e){return this.getRelationForParam(e,"trainingState")}getRelationTrainingSetVersion(e){return this.getRelationForParam(e,"trainingSetVersion")}}class a_{constructor(e){this._generationGroupId=null==e?void 0:e.generationGroupId,this._historyAssetType=null==e?void 0:e.historyAssetType}get generationGroupId(){return this._generationGroupId}get historyAssetType(){return this._historyAssetType}get hash(){return[this._generationGroupId?`generationGroupId:${this._generationGroupId}`:void 0,this._historyAssetType?`historyAssetType:${this._historyAssetType}`:void 0].filter((e=>e)).join(":")}matches(e){if(this._generationGroupId)return la(e)===this._generationGroupId;if(this._historyAssetType){if(this._historyAssetType===ye.IMAGE)return e.mediaType===ra;if(this._historyAssetType===ye.VIDEO)return e.mediaType===na}return!0}getRelationToFilter(e){const{_generationGroupId:t,_historyAssetType:i}=e,{_generationGroupId:s,_historyAssetType:r}=this;return t&&s&&t!==s||i&&r&&i!==r?"disjoint":!s&&t||!r&&i?"unknown":"subset"}}class c_{constructor(e){this._listingOptions={},e&&(this._listingOptions=e)}get listingOptions(){return this._listingOptions}get hash(){return[this._listingOptions.publishedState?`publishedState:${this._listingOptions.publishedState}`:void 0,this._listingOptions.createDateMin?`createDateMin:${this._listingOptions.createDateMin.getTime()}`:void 0,this._listingOptions.createDateMax?`createDateMax:${this._listingOptions.createDateMax.getTime()}`:void 0,this._listingOptions.modifyDateMin?`modifyDateMin:${this._listingOptions.modifyDateMin.getTime()}`:void 0,this._listingOptions.modifyDateMax?`modifyDateMax:${this._listingOptions.modifyDateMax.getTime()}`:void 0,this._listingOptions.createdBy?`createdBy:${this._listingOptions.createdBy}`:void 0].filter((e=>e)).join(":")}matches(e){return!(this._listingOptions.publishedState&&e.publishedState!==this._listingOptions.publishedState&&this._listingOptions.publishedState!==rs.ALL||this._listingOptions.createdBy&&e.createdBy!==this._listingOptions.createdBy||this._listingOptions.createDateMin&&e.created<this._listingOptions.createDateMin||this._listingOptions.createDateMax&&e.created>this._listingOptions.createDateMax||this._listingOptions.modifyDateMin&&e.modified<this._listingOptions.modifyDateMin||this._listingOptions.modifyDateMax&&e.modified>this._listingOptions.modifyDateMax)}getRelationToFilter(e){const t=this.getRelationPublishedState(e),i=this.getRelationCreatedBy(e),s=co(this._listingOptions.createDateMin,this._listingOptions.createDateMax,e._listingOptions.createDateMin,e._listingOptions.createDateMax),r=co(this._listingOptions.modifyDateMin,this._listingOptions.modifyDateMax,e._listingOptions.modifyDateMin,e._listingOptions.modifyDateMax);return[t,i,s,r].some((e=>"disjoint"===e))?"disjoint":[t,i,s,r].some((e=>"unknown"===e))?"unknown":"subset"}getRelationPublishedState(e){return this._listingOptions.publishedState===e._listingOptions.publishedState||e._listingOptions.publishedState===rs.ALL||void 0===e._listingOptions.publishedState?"subset":this._listingOptions.publishedState===rs.ALL||void 0===this._listingOptions.publishedState?"unknown":"disjoint"}getRelationCreatedBy(e){return this._listingOptions.createdBy===e._listingOptions.createdBy?"subset":e._listingOptions.createdBy?this._listingOptions.createdBy?"disjoint":"unknown":"subset"}}class l_{constructor(e){this._bookmarked=!1,this._bookmarked=Boolean(null==e?void 0:e.bookmarked),this._teamID=null==e?void 0:e.teamID,this._teamRole=null==e?void 0:e.teamRole,this._state=null==e?void 0:e.state,this._teamRole=null==e?void 0:e.teamRole}static ActiveSpacesFromTeam(e){return new l_({state:"active",teamID:e})}get bookmarked(){return this._bookmarked}get teamID(){return this._teamID}get teamRole(){return this._teamRole}get state(){return this._state}get hash(){var e,t;return String(this.bookmarked)+":"+(this.teamID||"all-teams")+":"+(null!==(e=this._teamRole)&&void 0!==e?e:"all-roles")+":"+(null!==(t=this._state)&&void 0!==t?t:"any-state")}matches(e){if(this._bookmarked&&!e.isBookmarked)return!1;const t=this._teamID;if(t&&e.teamID!==t)return!1;const i=this._teamRole;if(i&&e.teamRole!==i)return!1;const s=this._state;return!s||s===e.state}getRelationToFilter(e){const t=e;return this._teamRole!==t._teamRole?this._teamRole&&t._teamRole?"disjoint":"unknown":this.teamID&&t.teamID&&this.teamID!==t.teamID?"disjoint":!this.teamID&&t.teamID||!this.bookmarked&&e.bookmarked?"unknown":this._state!==e._state?this._state&&e._state?"disjoint":"unknown":"subset"}}var d_;l_.ActiveSpaces=new l_({state:"active"}),l_.ArchivedSpaces=new l_({state:"archived"}),l_.ActiveBookmarkedSpaces=new l_({state:"active",bookmarked:!0}),l_.ActiveSpacesFromOtherTeams=new l_({state:"active",teamRole:"NONE"}),function(e){e[e.DISJOINTED=0]="DISJOINTED",e[e.SUPERSET=1]="SUPERSET",e[e.SUBSET=2]="SUBSET",e[e.UNKNOWN=3]="UNKNOWN",e[e.IDENTICAL=4]="IDENTICAL"}(d_||(d_={}));class u_{constructor(e){this._nameContains=null==e?void 0:e.nameContains,this._state=null==e?void 0:e.state}static TeamsContainingName(e){return new u_({nameContains:e})}get nameContains(){return this._nameContains}get state(){return this._state}get hash(){var e,t;return(null!==(e=this._nameContains)&&void 0!==e?e:"any-name")+":"+(null!==(t=this._state)&&void 0!==t?t:"any-state")}_getRelationToNameContains(e,t){if(e===t)return d_.IDENTICAL;const i=e.toLowerCase().split(" ").filter(i_).sort(),s=t.toLowerCase().split(" ").filter(i_).sort();if(0===i.length&&0===s.length)return d_.IDENTICAL;if(0===i.length||0===s.length)return d_.DISJOINTED;if(i.length===s.length&&i.every(((e,t)=>e===s[t])))return d_.IDENTICAL;let r=0,n=0;return i.forEach((e=>{const t=s.find((t=>{const i=t.startsWith(e),s=e.startsWith(t);return i||s}));t&&(e.length<=t.length&&n++,e.length>t.length&&r++)})),i.length===r?d_.SUBSET:i.length===n?d_.SUPERSET:0===r&&0===n?d_.DISJOINTED:d_.UNKNOWN}_searchTarget(e,t){const i=e.toLowerCase().split(" ").filter(i_),s=t.toLowerCase().split(" ").filter(i_);return 0!==i.length&&0!==s.length&&i.every((e=>s.find((t=>t.startsWith(e)))))}matches(e){const t=this._state;if(t&&t!==e.state)return!1;const i=this._nameContains;return!(i&&!this._searchTarget(i,e.name))}getRelationToFilter(e){let t;return this.nameContains&&e.nameContains&&(t=this._getRelationToNameContains(this.nameContains,e.nameContains),t===d_.DISJOINTED)||this.state&&e.state&&this.state!==e.state?"disjoint":!this.state&&e.state||!this.nameContains&&e.nameContains||t&&t===d_.SUPERSET||t===d_.UNKNOWN?"unknown":"subset"}}u_.ActiveTeams=new u_({state:"active"}),u_.DiscardedTeams=new u_({state:"discarded"});class h_ extends rn{constructor(){super(...arguments),this._created=new Date,this._createdBy="",this._name="",this._repositoryID="",this._repositoryName="",this._state="active",this._role="none"}get teamID(){return this.id}get created(){return this._created}get createdBy(){return this._createdBy}get name(){return this._name}get description(){return this._description}get repositoryID(){return this._repositoryID}get repositoryName(){return this._repositoryName}get repositoryOwnerID(){return this._repositoryOwnerID}get repositoryOwnerEmail(){return this._repositoryOwnerEmail}get repositoryOwnerType(){return this._repositoryOwnerType}get collaboratorRole(){return Jr("collaboratorRoleDeprecated","The property collaboratorRole has been depecrated in favor of role."),"owner"===this._role?"editor":this._role}get role(){return this._role}get state(){return this._state}get _links(){return this.__links}async archive(){await this._core.spaceContext.archiveTeam(this)}async createSpace(e){return await this._core.spaceContext.createSpace(this,e)}async permanentlyDelete(){await this._core.spaceContext.permanentlyDeleteTeam(this)}async rename(e){await this._core.spaceContext.renameTeam(this,e)}async restore(){await this._core.spaceContext.restoreTeam(this)}async update(e){await this._core.spaceContext.updateTeam(this,e)}async ensureDescription(){await this._core.spaceContext.loadTeamProperties(this)}}qe([ut],h_.prototype,"created",null),qe([ut],h_.prototype,"createdBy",null),qe([ut],h_.prototype,"name",null),qe([ut],h_.prototype,"description",null),qe([ut],h_.prototype,"repositoryID",null),qe([ut],h_.prototype,"repositoryName",null),qe([ut],h_.prototype,"repositoryOwnerID",null),qe([ut],h_.prototype,"repositoryOwnerEmail",null),qe([ut],h_.prototype,"repositoryOwnerType",null),qe([ut],h_.prototype,"collaboratorRole",null),qe([ut],h_.prototype,"role",null),qe([ut],h_.prototype,"state",null),qe([ut],h_.prototype,"_links",null);const p_=new mn({localItemType:h_,remoteIdProperty:"id",propertyUpdater:new Sn({_created:{name:"createDate",format:"date"},_createdBy:"createdBy",_description:"description",_name:"name",_repositoryID:"repositoryId",_repositoryName:"repositoryName",_repositoryOwnerID:"repositoryOwner.id",_repositoryOwnerEmail:"repositoryOwner.email",_repositoryOwnerType:{name:"repositoryOwner.type",choices:["org","user"]},_role:{name:"role",choices:Iu},_state:{name:"state",choices:["active","discarded"]},__links:{name:"_links",format:"object"}})}),__={displayName:(e,t)=>Mn(e.displayName,t.displayName)};class m_ extends(Hn(__)){}m_.default=new m_("ascending","displayName");const f_=new mn({localItemType:class extends Fs{constructor(){super(...arguments),this._isDefault=!1,this._type="",this._angle=0,this._stops=[],this._name="",this._languageCode="",this._gradientID="",this._textAlpha=1,this._textMode="RGB",this._textColorValue={r:0,g:0,b:0},this._textType="process"}get isDefault(){return this._isDefault}get type(){return this._type}get angle(){return this._angle}get stops(){return this._stops}get name(){return this._name}get languageCode(){return this._languageCode}get gradientID(){return this._gradientID}get textAlpha(){return this._textAlpha}get textMode(){return this._textMode}get textColorValue(){return this._textColorValue}get textType(){return this._textType}},remoteIdProperty:"computedID",propertyUpdater:new Sn({_isDefault:{name:"project:gradientData.isDefault",format:"boolean"},_type:{name:"project:gradientData.type",format:"string"},_angle:{name:"project:gradientData.angle",format:"string"},_name:{name:"project:gradientName",format:"string"},_stops:{name:"project:gradientData.stops",format:"object"},_languageCode:{name:"project:gradientData.languageCode",format:"string"},_gradientID:"project:gradientId",_textAlpha:{name:"project:gradientTextColor.alpha",format:"number"},_textMode:{name:"project:gradientTextColor.mode",format:"string"},_textColorValue:{name:"project:gradientTextColor.value",format:"object"},_textType:{name:"project:gradientTextColor.type",format:"string"}})}),g_="frameioAuthorizationChange",y_=new class extends nt{constructor(){super(g_)}},v_="frameioReviewLinksChange",O_=new class extends nt{constructor(){super(v_)}},b_="https://api.frame.io",E_={ME:`${b_}/v2/me`,ACCOUNT:`${b_}/v2/accounts/{accountId}`,ACCOUNTS:`${b_}/v2/accounts?join=collaborator`,TEAMS:`${b_}/v2/accounts/{accountId}/teams?include=user_role&role=member`,TEAM:`${b_}/v2/teams/{teamId}?include=account`,PROJECT:`${b_}/v2/projects/{projectId}?include=string`,PROJECTS:`${b_}/v2/teams/{teamId}/projects?filter[archived]`,SHAREDPROJECTS:`${b_}/v2/projects/shared?filter[account_id]={accountId}`,REVIEWS:`${b_}/v2/projects/{projectId}/review_links`,REVIEW:`${b_}/v2/review_links/{reviewLinkId}`,ITEMCREATE:`${b_}/v2/review_links/{reviewLinkId}/assets`,ASSETS:`${b_}/v2/assets/{assetId}/children?include=cover_asset`,ASSET:`${b_}/v2/assets/{assetId}?type=folder&include=cover_asset`,CREATEASSET:`${b_}/v2/assets/{parentId}/children`,VERSION:`${b_}/v2/assets/{assetId}/version`,CREATECOMMENT:`${b_}/v2/assets/{assetId}/comments`,GETCOMMENT:`${b_}/v2/comments/{commentId}?include=string`,GETCOMMENTS:`${b_}/v2/assets/{assetId}/comments?include=string`,IMPRESSIONS:`${b_}/v2/comments/{commentId}/impressions?include=string`,COMMENT:`${b_}/v2/comments/{commentId}`,REPLY:`${b_}/v2/comments/{commentId}/replies`,GETREPLIES:`${b_}/v2/comments/{commentId}/replies?include=replies`,LIKE:`${b_}/v2/comments/{commentId}/like`,COMPLETE:`${b_}/v2/comments/{commentId}/complete`,FOLDERTREE:`${b_}/v2/projects/{projectId}/folder_tree`,ANCESTORS:`${b_}/v2/assets/{assetId}/ancestors`,ADOBE_SUSI_USER:`${b_}/v2/auth/adobe/method`,ADOBE_SUSI:`${b_}/v2/auth/adobe/callback`};function I_(e,t){return _t(e).fill(t)}var T_;!function(e){e[e.authLoggedOut=0]="authLoggedOut",e[e.authLoggedIn=1]="authLoggedIn",e[e.authExpired=2]="authExpired"}(T_||(T_={}));class S_ extends lr{constructor(e){super(e._core),this._frameioContext=e;const{PRODUCT_ID:t}=this._core._environment.getValue("HOST_PRODUCT_DATA"),i="adobe+"+t;this._frameioClientId=i.toLowerCase()}get nativeContext(){const e="undefined"!=typeof window&&window.acplModel;if(!this._nativeContext&&e){const t=e.Workflows;if(t.createShareForReviewWorkflow){const i=t.createShareForReviewWorkflow(e.applicationAssetContext);if(this._nativeContext=i.getFrameioAssetContext(),this._nativeContext){const e=this;this._nativeContext.addEventListener(v_,(t=>{e._frameioContext._handleReviewLinksChangeEvent(t)})),this._nativeContext.addEventListener(g_,(async()=>{const t=e.nativeContext.authenticationInfo();t.frameioToken?(await e._cacheCredentials(JSON.stringify(t)),e._frameioContext._updateCurrentUserId(t.frameioUserId)):(await e._core._environment.cache.deleteItem(e._cachedCredentialsId()),e._frameioContext._updateCurrentUserId(void 0)),e._frameioContext.dispatch(y_)}))}}else Jr("FrameioInterface.nativeContext","Share for Review workflows are not enabled for this application")}return this._nativeContext||Jr("FrameioInterface.nativeContext","native Frameio context does not exist, web/browser mode is utilized for testing only"),this._nativeContext}get _authenticationId(){return this.adobeId}_cachedCredentialsId(){return"FRAMEIO_CREDENTIALS_"+this._authenticationId}_getRefreshTokenExpiration(e){const t=parseInt(e);return t?t+1296e3:0}async _getCachedCredentials(){const e=this._cachedCredentialsId(),t=await this._core._environment.cache.getItem(e);return t!==Ii?t:""}async _cacheCredentials(e){return this._core._environment.cache.setItem(this._cachedCredentialsId(),e,12096e5)}get adobeId(){return this._core._environment.getValue("USER_ID")}get ccUserId(){return this._core._environment.getValue("USER_EMAIL")||""}get imsToken(){return this._core._environment.getValue("ACCESS_TOKEN")}get xFrameioClient(){return this._frameioClientId}get productKey(){const{PRODUCT_ID:e}=this._core._environment.getValue("HOST_PRODUCT_DATA");return e.includes("Photoshop")?"PHXS":e.includes("Illustrator")?"ILST":e.includes("InDesign")?"IDSN":e.includes("SAMJSDemoApp")?"dev":e.includes("/")?e.slice(0,e.indexOf("/")):"dev"}async checkForCachedCredentials(){const e=await this._getCachedCredentials();if(""!==e){const t=this.nativeContext,i=JSON.parse(e),s=this._getRefreshTokenExpiration(i.frameioLastRefresh);if(s&&s-Math.floor(Date.now()/1e3)<=0)return T_.authExpired;if(i.xFrameioClient=this.xFrameioClient,t&&await t.authenticateUser(i)!==i.token){const e=t.authenticationInfo();return await this._cacheCredentials(JSON.stringify(e)),T_.authLoggedIn}}return T_.authLoggedOut}async isAuthenticated(){return await this.authenticationStatus()===T_.authLoggedIn}async authenticationStatus(){var e,t,i;const s=this.nativeContext;if(s){let e=s.authenticationStatus(this._authenticationId);return e===T_.authLoggedOut&&(e=await this.checkForCachedCredentials()),e}if(null===(e=this._authenticationInfo)||void 0===e?void 0:e.frameioLastRefresh){const e=359,s=new Date,r=new Date(0);return r.setUTCSeconds(parseInt(null===(t=this._authenticationInfo)||void 0===t?void 0:t.frameioLastRefresh)),Math.abs(s.valueOf()-r.valueOf())/36e5>=e?T_.authExpired:(null===(i=this._authenticationInfo)||void 0===i?void 0:i.frameioToken)?T_.authLoggedIn:T_.authLoggedOut}return T_.authLoggedOut}async getToken(){var e;const t=this.nativeContext;return t?await t.getToken():(null===(e=this._authenticationInfo)||void 0===e?void 0:e.frameioToken)||""}async refreshToken(){var e;const t=this.nativeContext;if(t){const e=await t.getToken(!0),i=t.authenticationInfo();return e===i.frameioToken&&await this._cacheCredentials(JSON.stringify(i)),e}return(null===(e=this._authenticationInfo)||void 0===e?void 0:e.frameioToken)||""}async authenticate(e){const t=this.nativeContext;if(t){const i=this.adobeId,s=this.ccUserId,r=this.productKey,n=this.xFrameioClient;if(!t.isUserAuthenticated(this._authenticationId)){const o={adobeId:i,ccUserId:s,productKey:r,xFrameioClient:n};void 0!==e&&(o.frameioToken=e.frameioToken,o.frameioRefreshToken=(null==e?void 0:e.frameioRefreshToken)||void 0,o.frameioTokenExpires=(null==e?void 0:e.frameioTokenExpires)||void 0,o.frameioUserId=(null==e?void 0:e.frameioUserId)||void 0,o.frameioLastRefresh=(null==e?void 0:e.frameioLastRefresh)||void 0);const a=await t.authenticateUser(o);if(""!==a){const e=t.authenticationInfo();await this._cacheCredentials(JSON.stringify(e))}return a}}else this._authenticationInfo=e||void 0;return await this.getToken()}async deauthenticate(){this._authenticationInfo=void 0,await this._core._environment.cache.deleteItem(this._cachedCredentialsId());const e=this.nativeContext;e&&await e.deauthenticateUser(this._authenticationId)}async openFile(e){const t=this.nativeContext;if(t)return await t.openFile(e);throw Ge.create(Ue.UNSUPPORTED,"Method is not supported in browser _environment.")}dispatchReviewLinksChangeEvent(e){const t=this.nativeContext;if(!t)throw Ge.create(Ue.UNSUPPORTED,"Method is not supported in browser _environment.");t.dispatchReviewLinksChangeEvent(e)}async getAdobeSusiInfo(){const e=await this._adobeSusiUserRequest();return{userExists:e.exists,susiAvailable:"adobe"===e.method,restriction:e.restriction||void 0}}async authenticateAdobeSusi(){return await this._adobeSusiRequest()}async _adobeSusiUserRequest(){return(await this._doPost(E_.ADOBE_SUSI_USER,{"Content-Type":"application/json"},JSON.stringify({access_token:this.imsToken}),[200])).json()}async _adobeSusiRequest(){const e=await this._doPost(E_.ADOBE_SUSI,{"Content-Type":"application/json"},JSON.stringify({access_token:this.imsToken}),[200]),t=e.headers,i=await e.json(),s=t.get("authorization"),r=t.get("x-refresh-token"),n=t.get("x-expires");return{frameioToken:s?s.replace("Bearer ",""):"",frameioRefreshToken:r||void 0,frameioTokenExpires:n||void 0,frameioUserId:i.id||void 0,frameioLastRefresh:Date.now().toString(),useAdobeSusi:!0}}async _getFetchOptionOverrides(e,t){const i=await this.getToken();return{href:e,options:Object.assign(Object.assign({},t),{headers:Object.assign(Object.assign({},t.headers),{authorization:`Bearer ${i}`,"x-frameio-client":this.xFrameioClient}),noOtherHeaders:!0})}}async _getMultiPageResponse(e){let t=[];const i=async e=>{const s=await this._doGet(e),r=await s.json(),n=(e=>{const t=e&&e.headers&&e.headers.get("Link"),i=t&&er.parse(t),s=i&&i.has("rel","next")&&i.get("rel","next"),r=s&&s[0]&&s[0].uri;return r&&r.replace("http:","https:")})(s);return t=t.concat(r),n?i(n):t};return i(e)}async getCurrentUser(){return this._getResponse(E_.ME)}async getAccount(e){return this._getResponse(I_(E_.ACCOUNT,{accountId:e}))}async getAccounts(){return this._getMultiPageResponse(E_.ACCOUNTS)}async getTeams(e){return this._getMultiPageResponse(I_(E_.TEAMS,{accountId:e}))}async getTeam(e){return this._getResponse(I_(E_.TEAM,{teamId:e}))}async getProject(e){return this._getResponse(I_(E_.PROJECT,{projectId:e}))}async getProjects(e){return this._getMultiPageResponse(I_(E_.PROJECTS,{teamId:e}))}async getSharedProjects(e){return this._getMultiPageResponse(I_(E_.SHAREDPROJECTS,{accountId:e}))}async getReviewLinks(e){return this._getMultiPageResponse(I_(E_.REVIEWS,{projectId:e}))}async getReviewLink(e){return this._getResponse(I_(E_.REVIEW,{reviewLinkId:e}))}async createReviewLink(e,t){return(await this._doPost(I_(E_.REVIEWS,{projectId:e}),{"Content-Type":"application/json"},JSON.stringify({name:t}),[200])).json()}async createFolder(e,t){return(await this._doPost(I_(E_.CREATEASSET,{parentId:e}),{"Content-Type":"application/json"},JSON.stringify({name:t,type:"folder"}),[200])).json()}async createFile(e,t,i,s="application/pdf"){return(await this._doPost(I_(E_.CREATEASSET,{parentId:e}),{"Content-Type":"application/json"},JSON.stringify({name:t,type:"file",filetype:s,filesize:i}),[200])).json()}async uploadFile(e,t,i="application/pdf"){const s={method:"PUT",headers:{"Content-Type":i,"x-amz-acl":"private"},body:t};await fetch(e,s)}async reviewLinkAddAsset(e,t){return(await this._doPost(I_(E_.ITEMCREATE,{reviewLinkId:e}),{"Content-Type":"application/json"},JSON.stringify({asset_ids:[t]}),[200])).json()}async getChildren(e){return this._getMultiPageResponse(I_(E_.ASSETS,{assetId:e}))}async getAsset(e){return this._getResponse(I_(E_.ASSET,{assetId:e}))}async addVersionToAsset(e,t){return(await this._doPost(I_(E_.VERSION,{assetId:e}),{"Content-Type":"application/json"},JSON.stringify({next_asset_id:t}),[200])).json()}async createComment(e,t){return(await this._doPost(I_(E_.CREATECOMMENT,{assetId:e}),{"Content-Type":"application/json"},JSON.stringify({text:t}),[200])).json()}async getComment(e){return this._getResponse(I_(E_.GETCOMMENT,{commentId:e}))}async getComments(e){return this._getMultiPageResponse(I_(E_.GETCOMMENTS,{assetId:e}))}async getImpressions(e){return this._getMultiPageResponse(I_(E_.IMPRESSIONS,{commentId:e}))}async updateComment(e,t){return(await this._doPut(I_(E_.COMMENT,{commentId:e}),{"Content-Type":"application/json"},JSON.stringify({text:t}),[200])).json()}async deleteComment(e){return(await this._doDelete(I_(E_.COMMENT,{commentId:e}))).json()}async createReply(e,t){return(await this._doPost(I_(E_.REPLY,{commentId:e}),{"Content-Type":"application/json"},JSON.stringify({text:t}),[200])).json()}async getReplies(e){return this._getMultiPageResponse(I_(E_.GETREPLIES,{commentId:e}))}async createLike(e){return(await this._doPost(I_(E_.LIKE,{commentId:e}),{},void 0,[200])).json()}async deleteLike(e){return(await this._doDelete(I_(E_.LIKE,{commentId:e}))).json()}async completeComment(e){return(await this._doPost(I_(E_.COMPLETE,{commentId:e}),{},void 0,[200])).json()}async uncompleteComment(e){return(await this._doDelete(I_(E_.COMPLETE,{commentId:e}))).json()}async getFolderTree(e){return this._getResponse(I_(E_.FOLDERTREE,{projectId:e}))}async getAncestors(e){return this._getMultiPageResponse(I_(E_.ANCESTORS,{assetId:e}))}}class A_ extends Fs{get context(){return this._core.frameioContext}}const P_=new mn({localItemType:class extends A_{constructor(){super(...arguments),this._accountId="",this._email="",this._name="",this._profileImage="",this._userDefaultColor=""}get accountId(){return this._accountId}get email(){return this._email}get name(){return this._name}get profileImage(){return this._profileImage}get userDefaultColor(){return this._userDefaultColor}async getAccount(){return this._account||(this._account=await this.context.getAccount(this.accountId)),this._account}},remoteIdProperty:"id",propertyUpdater:new Sn({_accountId:"account_id",_email:"email",_name:"name",_profileImage:"profile_image",_userDefaultColor:"user_default_color"})});class w_ extends A_{constructor(){super(...arguments),this._name="",this._projectId="",this._teamId=""}get insertedAt(){return this._insertedAt}get name(){return this._name}get parentId(){return this._parentId}async getParent(){const e=this.context,t=this.parentId;if(t)return e.getAsset(t)}get projectId(){return this._projectId}get teamId(){return this._teamId}get updatedAt(){return this._updatedAt}async getAncestors(){return this.context.getAncestors(this.id)}}const C_=new mn({localItemType:class extends A_{get anonymousUserId(){return this._anonymousUserId||""}get comment(){return this._comment}get commentId(){return this._commentId||""}get deletedAt(){return this._deletedAt}get insertedAt(){return this._insertedAt}get updatedAt(){return this._updatedAt}get userId(){return this._userId||""}},remoteIdProperty:"id",propertyUpdater:new Sn({_anonymousUserId:"anonymous_user_id",_comment:{set:(e,t)=>{const i=t,s=i.context._objectPool.createUpdateSession();i._comment=R_.updateRemoteItem(s,e),s.commit()},name:"comment",format:"object"},_commentId:"comment_id",_deletedAt:{name:"deleted_at",format:"date"},_insertedAt:{name:"inserted_at",format:"date"},_updatedAt:{name:"updated_at",format:"date"},_userId:"user_id"})}),R_=new mn({localItemType:class extends A_{constructor(){super(...arguments),this._completed=!1,this._hasReplies=!1,this._likeCount=0,this._private=!1,this._readCount=0,this._timestamp=0,this._timestampMicroseconds=0}get assetId(){return this._assetId||""}get completed(){return this._completed}get completedAt(){return this._completedAt}get completerId(){return this._completerId||""}get deletedAt(){return this._deletedAt}get hasReplies(){return this._hasReplies}get insertedAt(){return this._insertedAt}get likeCount(){return this._likeCount}get owner(){return this._owner}get ownerId(){return this._ownerId||""}get page(){return this._page||""}get parentId(){return this._parentId||""}get private(){return this._private}get readCount(){return this._readCount}get reviewLinkId(){return this._reviewLinkId||""}get targetAssetId(){return this._targetAssetId||""}get text(){return this._text||""}get textEditedAt(){return this._textEditedAt}get timestamp(){return this._timestamp}get timestampMicroseconds(){return this._timestampMicroseconds}get updatedAt(){return this._updatedAt}async updateComment(e){const t=this.context,i=await t._frameioInterface.updateComment(this.id,e.text),s=t._objectPool.createUpdateSession(),r=R_.updateRemoteItem(s,i);return s.commit(),r}async deleteComment(){const e=this.context,t=await e._frameioInterface.deleteComment(this.id),i=e._objectPool.createUpdateSession(),s=R_.updateRemoteItem(i,t);return i.commit(),s}async createLike(){const e=this.context,t=await e._frameioInterface.createLike(this.id),i=e._objectPool.createUpdateSession(),s=C_.updateRemoteItem(i,t);return i.commit(),s}async deleteLike(){const e=this.context,t=await e._frameioInterface.deleteLike(this.id),i=e._objectPool.createUpdateSession(),s=C_.updateRemoteItem(i,t);return i.commit(),s}async createReply(e){const t=this.context,i=await t._frameioInterface.createReply(this.id,e.text),s=t._objectPool.createUpdateSession(),r=R_.updateRemoteItem(s,i);return s.commit(),r}async getReplies(){const e=this.context,t=await e._frameioInterface.getReplies(this.id),i=e._objectPool.createUpdateSession(),s=R_.updateRemoteItems(i,t);return i.commit(),s}async completeComment(){const e=this.context,t=await e._frameioInterface.completeComment(this.id),i=e._objectPool.createUpdateSession(),s=R_.updateRemoteItem(i,t);return i.commit(),s}async uncompleteComment(){const e=this.context,t=await e._frameioInterface.uncompleteComment(this.id),i=e._objectPool.createUpdateSession(),s=R_.updateRemoteItem(i,t);return i.commit(),s}},remoteIdProperty:"id",propertyUpdater:new Sn({_assetId:"asset_id",_completed:{name:"completed",format:"boolean"},_completedAt:{name:"completed_at",format:"date"},_completerId:"completer_id",_deletedAt:{name:"deleted_at",format:"date"},_hasReplies:{name:"has_replies",format:"boolean"},_insertedAt:{name:"inserted_at",format:"date"},_likeCount:{name:"like_count",format:"number"},_owner:{set:(e,t)=>{const i=t,s=i.context._objectPool.createUpdateSession();i._owner=P_.updateRemoteItem(s,e),s.commit()},name:"owner",format:"object"},_ownerId:"owner_id",_page:"page",_parentId:"parent_id",_private:{name:"private",format:"boolean"},_readCount:{name:"read_count",format:"number"},_reviewLinkId:"review_link_id",_targetAssetId:"target_asset_id",_text:"text",_textEditedAt:{name:"text_edited_at",format:"date"},_timestamp:{name:"timestamp",format:"number"},_timestampMicroseconds:{name:"timestamp_microseconds",format:"number"},_updatedAt:{name:"updated_at",format:"date"}})}),L_=new mn({localItemType:class extends w_{async createComment(e){const t=this.context,i=await t._frameioInterface.createComment(this.id,e.text),s=t._objectPool.createUpdateSession(),r=R_.updateRemoteItem(s,i);return s.commit(),this._comments=void 0,r}async getComments(){let e=this._comments;if(!e){const t=this.context,i=await t._frameioInterface.getComments(this.id),s=t._objectPool.createUpdateSession();e=R_.updateRemoteItems(s,i),s.commit(),this._comments=e}return e}},remoteIdProperty:"id",propertyUpdater:new Sn({_commentCount:"comment_count",_insertedAt:{name:"inserted_at",format:"date"},_name:"name",_parentId:"parent_id",_projectId:"project_id",_teamId:"team_id",_updatedAt:{name:"updated_at",format:"date"}})}),N_=new mn({localItemType:class extends w_{async getChildren(){if(!this._children){const e=this.context,t=await e._frameioInterface.getChildren(this.id),i=e._objectPool.createUpdateSession();this._children=t.map((e=>B_(i,e))),i.commit()}return this._children}async _uploadFile(e,t){const i=this.context,s=t.size(),r=e.length,n=Math.ceil(s/r);let o=0;const a=async s=>{const c=o++;return s=await t.read(c*n,s),i._frameioInterface.uploadFile(e[c],s).then((()=>o<r?a(s):Promise.resolve()))},c=Math.min(r,8),l=[];for(let e=0;e<c;e++)l.push(a(new ArrayBuffer(n)));await Promise.all(l)}async createFile(e,t){const i=this.context,s=await i._frameioInterface.openFile(t),r=s.size(),n=await i._frameioInterface.createFile(this.id,e,r),o=i._objectPool.createUpdateSession(),a=L_.updateRemoteItem(o,n);return o.commit(),await this._uploadFile(n.upload_urls,s),s.close(),a}async createFolder(e){const t=this.context,i=await t._frameioInterface.createFolder(this.id,e),s=t._objectPool.createUpdateSession(),r=N_.updateRemoteItem(s,i);return s.commit(),r}},remoteIdProperty:"id",propertyUpdater:new Sn({_insertedAt:{name:"inserted_at",format:"date"},_name:"name",_parentId:"parent_id",_projectId:"project_id",_teamId:"team_id",_updatedAt:{name:"updated_at",format:"date"}})}),D_=new mn({localItemType:class extends A_{constructor(){super(...arguments),this._email="",this._name=""}get email(){return this._email}get name(){return this._name}async getProjects(){let e=this._projects;if(!e){const t=this.context,i=await this._core.frameioContext._frameioInterface.getProjects(this.id),s=t._objectPool.createUpdateSession();e=H_.updateRemoteItems(s,i),s.commit(),this._projects=e}return e}},remoteIdProperty:"id",propertyUpdater:new Sn({_email:"owner.email",_name:"name"})});class M_ extends w_{constructor(){super(...arguments),this._coverAssetId="",this._versions=0}get coverAssetId(){return this._coverAssetId}async getCoverAsset(){return this._coverAsset||(this._coverAsset=await this.context.getAsset(this.coverAssetId)),this._coverAsset}get versions(){return this._versions}set coverAsset(e){this._coverAsset=e}async getChildren(){if(!this._children){const e=this.context,t=await e._frameioInterface.getChildren(this.id),i=e._objectPool.createUpdateSession();this._children=t.map((e=>B_(i,e))),i.commit()}return this._children}}const x_=new mn({localItemType:M_,remoteIdProperty:"id",propertyUpdater:new Sn({_coverAsset:{name:"cover_asset",format:"object",set:(e,t)=>{const i=t,s=i.context._objectPool.createUpdateSession(),r=B_(s,e);s.commit(),i.coverAsset=r}},_coverAssetId:"cover_asset_id",_insertedAt:{name:"inserted_at",format:"date"},_name:"name",_parentId:"parent_id",_projectId:"project_id",_teamId:"team_id",_updatedAt:{name:"updated_at",format:"date"},_versions:{name:"versions",format:"number"}})}),k_=new mn({localItemType:class extends A_{constructor(){super(...arguments),this._name="",this._shortUrl="",this._ownerId="",this._projectId="",this._active=!1,this._inviteOnly=!1}get name(){return this._name}get shortUrl(){return this._shortUrl}get ownerId(){return this._ownerId}get projectId(){return this._projectId}get active(){return this._active}get inviteOnly(){return this._inviteOnly}get itemId(){return this._itemId}async getArtifactCount(){const e=await this.getItem();return e instanceof M_?e.versions:1}async getArtifact(){const e=await this.getItem();return e instanceof M_?await e.getCoverAsset():e}async getItem(){if(!this._item){if(!this._itemId)return Promise.reject(Ge.create(Ue.BAD_REQUEST,`FrameioReviewLink.getItem() could not find item ${this._itemId}`));this._item=await this.context.getAsset(this._itemId)}return this._item}_dispatchReviewLinksChangeEvent(e){const t=this.context,i={source:e,reviewLink:{id:this.id,name:this._name,short_url:this._shortUrl,owner_id:this._ownerId,project_id:this._projectId,is_active:!!this._active,access_control:{invite_only:!!this._inviteOnly},"frameio:artifactId":this._itemId,"repo:etag":this._etag}};t._frameioInterface.dispatchReviewLinksChangeEvent(JSON.stringify(i))}async updateReviewLink(e,t,i){const s=await t.createFile(this.name,i);if(this._itemId){const t=this.context,i=await t._frameioInterface.addVersionToAsset(this._itemId,s.id),r=t._objectPool.createUpdateSession(),n=x_.updateRemoteItem(r,i);if(r.commit(),this._itemId!==n.id){const i=await t._reviewServiceInterface.updateReviewLink(Object.assign(Object.assign({},e),{projectId:this.projectId,reviewLinkId:this.id,artifactId:n.id,etag:this._etag}));this._etag=i["repo:etag"],this._item=n,this._itemId=n.id}}else{const t=this.context,i=await t._frameioInterface.reviewLinkAddAsset(this.id,s.id),r=t._objectPool.createUpdateSession();k_.updateRemoteItem(r,i),r.commit();const n=await t._reviewServiceInterface.createReviewLink(Object.assign(Object.assign({},e),{projectId:this.projectId,reviewLinkId:this.id,artifactId:s.id}));this._etag=n["repo:etag"],this._item=s,this._itemId=s.id}this._dispatchReviewLinksChangeEvent(e)}},remoteIdProperty:"id",propertyUpdater:new Sn({_name:"name",_shortUrl:"short_url",_ownerId:"owner_id",_projectId:"project_id",_active:{name:"is_active",format:"boolean"},_inviteOnly:{name:"access_control.invite_only",format:"boolean"},_itemId:"frameio:artifactId",_etag:"repo:etag"})}),H_=new mn({localItemType:class extends A_{constructor(){super(...arguments),this._rootAssetId="",this._name="",this._ownerId="",this._teamId=""}get name(){return this._name}get ownerId(){return this._ownerId}get rootAssetId(){return this._rootAssetId}get teamId(){return this._teamId}async getTeam(){return this._team||(this._team=await this.context.getTeam(this.rootAssetId)),this._team}async getRootFolder(){return this._rootFolder||(this._rootFolder=await this.context.getAsset(this.rootAssetId)),this._rootFolder}async getReviewLinks(){let e=this._reviews;if(!e){const t=this.context,i=await t._frameioInterface.getReviewLinks(this.id),s=t._objectPool.createUpdateSession();e=k_.updateRemoteItems(s,i),s.commit(),this._reviews=e}return e}createFolder(e,t){const i=this.context,s=t;s.project_id=this.id,s.team_id=this.teamId;const r=i._objectPool.createUpdateSession(),n=N_.updateRemoteItem(r,s);return r.commit(),n._children=e[s.id].map((t=>this.createFolder(e,t))),n}async getFolderTree(){const e=await this._core.frameioContext._frameioInterface.getFolderTree(this.id);return this._rootFolder=this.createFolder(e.data,e.data.root[0]),this._rootFolder}async createReviewLink(e){const t=this.context,i=await t._frameioInterface.createReviewLink(this.id,e),s=t._objectPool.createUpdateSession(),r=k_.updateRemoteItem(s,i);return s.commit(),this._reviews&&this._reviews.push(r),r}},remoteIdProperty:"id",propertyUpdater:new Sn({_name:"name",_ownerId:"owner_id",_rootAssetId:"root_asset_id",_rootFolder:{name:"root_asset",format:"object",set:(e,t)=>{const i=t,s=i.context._objectPool.createUpdateSession(),r=N_.updateRemoteItem(s,e);s.commit(),i._rootFolder=r}},_team:{set:(e,t)=>{const i=t,s=i.context._objectPool.createUpdateSession();i._team=D_.updateRemoteItem(s,e),s.commit()},name:"team",format:"object"},_teamId:"team_id"})}),j_=new mn({localItemType:class extends A_{constructor(){super(...arguments),this._displayName="",this._ownerId="",this._version=0}get ownerId(){return this._ownerId}get owner(){return this._owner}get displayName(){return this._displayName}get version(){return this._version}async getTeams(){let e=this._teams;if(!e){const t=this.context,i=await t._frameioInterface.getTeams(this.id),s=t._objectPool.createUpdateSession();e=D_.updateRemoteItems(s,i),s.commit(),this._teams=e}return e}async getSharedProjects(){let e=this._sharedProjects;if(!e){const t=this.context,i=await t._frameioInterface.getSharedProjects(this.id),s=t._objectPool.createUpdateSession();e=H_.updateRemoteItems(s,i),s.commit(),this._sharedProjects=e}return e}async getSharedTeams(){const e=await this.getSharedProjects(),t=new Set,i=[];for(const s of e){const e=s.teamId;if(!t.has(e)){const r=await s.getTeam();t.add(e),i.push(r)}}return i}async getProjectTree(){const e=await this.getTeams(),t=[];return e.forEach((e=>{t.push(e.getProjects())})),await Promise.all(t),e}},remoteIdProperty:"id",propertyUpdater:new Sn({_displayName:"display_name",_owner:{set:(e,t)=>{const i=t,s=i.context._objectPool.createUpdateSession();i._owner=P_.updateRemoteItem(s,e),s.commit()},name:"owner",format:"object"},_ownerId:"owner_id",_version:{name:"version",format:"number"}})});class U_ extends ws{constructor(e){super(),this._core=e,this._objectPool=new qo(this._core,"frameio"),this._frameioInterface=new S_(this),this._reviewServiceInterface=new Pc(this._core),this._reviewLinksForDocument=new Map}_updateCurrentUserId(e){e&&this._currentUserId===e||(this._currentUserId=e,this._currentUser=void 0,this._accounts=void 0,this._reviewLinksForDocument.clear())}_mapKeyForSourceDocument(e){return e.documentId?e.documentId:e.assetId}_retainUntilTimeout(e,t=12e4){const i=e.deref();setTimeout((function(){return i}),t)}_handleReviewLinksChangeEvent(e){const t=JSON.parse(e),i=t.reviewLink,s=this._mapKeyForSourceDocument(t.source),r=this._objectPool.createUpdateSession(),n=k_.updateRemoteItem(r,i);r.commit();const o=new WeakRef([{reviewLink:n}]);this._reviewLinksForDocument.set(s,o),this._retainUntilTimeout(o),this.dispatch(O_)}async isAuthenticated(){return await this._frameioInterface.isAuthenticated()}async authenticationStatus(){return await this._frameioInterface.authenticationStatus()}async getToken(){return this._frameioInterface.getToken()}async refreshToken(){return this._frameioInterface.refreshToken()}async authenticate(e){return await this._frameioInterface.authenticate(e)}async deauthenticate(){return await this._frameioInterface.deauthenticate()}async getCurrentUser(){let e=this._currentUser;if(!e){const t=await this._frameioInterface.getCurrentUser(),i=this._objectPool.createUpdateSession();e=P_.updateRemoteItem(i,t),i.commit(),this._currentUser=e}return e}async getAccounts(){let e=this._accounts;if(!e){const t=await this._frameioInterface.getAccounts(),i=this._objectPool.createUpdateSession();e=j_.updateRemoteItems(i,t),i.commit(),this._accounts=e}return e}_getLocalAncestors(e){const t=new Array;for(;;){const i=this._objectPool.getLocalItemById(e);if(void 0===i)return;if(t.unshift(i),!i.parentId)break;e=i.parentId}return t}async getAncestors(e){let t=this._getLocalAncestors(e);if(!t){const i=await this._frameioInterface.getAncestors(e),s=this._objectPool.createUpdateSession();t=i.map((e=>B_(s,e))),s.commit()}return t}async getReviewLinksForDocument(e,t=!0){const i=this._mapKeyForSourceDocument(e),s=this._reviewLinksForDocument.get(i);let r=s?s.deref():void 0;if(!t&&r)return this._retainUntilTimeout(s),r;r=[];const n=await this._reviewServiceInterface.getReviewLinks(e);n.sort(((e,t)=>t["repo:createdDate"]-e["repo:createdDate"]));for(let e=0;e<n.length;e++){const t=n[e],i=t["frameio:projectId"],s=t["frameio:reviewLinkId"],o=t["frameio:artifactId"],a=t["repo:etag"];let c;try{const e=await this._frameioInterface.getReviewLink(s),t=this._objectPool.createUpdateSession();c=k_.updateRemoteItem(t,e),t.commit()}catch(e){}try{if(!c){const e=await this.getProject(i);c=(await e.getReviewLinks()).find((({id:e})=>e===s))}if(c){c._itemId=o,c._etag=a,await c.getItem(),r.push({reviewLink:c});break}{const e=Ge.create(Ue.NOT_FOUND,`frameio:reviewLinkId = ${s} not found in projectId = ${i}`);r.push({error:e})}}catch(e){const t=e;r.push({error:t})}}const o=new WeakRef(r);return this._reviewLinksForDocument.set(i,o),this._retainUntilTimeout(o),r}async getAccount(e){let t=(await this.getAccounts()).find((t=>t.id===e));if(!t){const i=await this._frameioInterface.getAccount(e),s=this._objectPool.createUpdateSession();t=j_.updateRemoteItem(s,i),s.commit()}return t}async getAsset(e){let t=this._objectPool.getLocalItemById(e);if(!t){const i=await this._frameioInterface.getAsset(e),s=this._objectPool.createUpdateSession();t=B_(s,i),s.commit()}return t}async getTeam(e){let t=this._objectPool.getLocalItemById(e);if(!t){const i=await this._frameioInterface.getTeam(e),s=this._objectPool.createUpdateSession();t=D_.updateRemoteItem(s,i),s.commit()}return t}async getProject(e){let t=this._objectPool.getLocalItemById(e);if(!t){const i=await this._frameioInterface.getProject(e),s=this._objectPool.createUpdateSession();t=H_.updateRemoteItem(s,i),s.commit()}return t}async getComment(e){let t=this._objectPool.getLocalItemById(e);if(!t){const i=await this._frameioInterface.getComment(e),s=this._objectPool.createUpdateSession();t=R_.updateRemoteItem(s,i),s.commit()}return t}async getAdobeSusiInfo(){return await this._frameioInterface.getAdobeSusiInfo()}}function B_(e,t){if("file"===t.type){const i=e;return L_.updateRemoteItem(i,t)}if("folder"===t.type){const i=e;return N_.updateRemoteItem(i,t)}if("version_stack"===t.type){const i=e;return x_.updateRemoteItem(i,t)}throw Ge.create(Ue.UNSUPPORTED,`Invalid Frameio asset type ${t.type}`)}qe([Nt],U_.prototype,"getAsset",null);var F_,V_,K_,$_,G_,W_=Object.freeze({__proto__:null,default:U_,frameioAssetUpdater:B_});!function(e){e.USER="https://ns.adobe.com/adobeaemcloud/aem/user",e.GROUP="https://ns.adobe.com/adobeaemcloud/aem/group"}(F_||(F_={})),function(e){e.ACK="ack",e.READ="read",e.WRITE="write",e.DELETE="delete"}(V_||(V_={})),function(e){e.GRANT="grant",e.DENY="deny"}(K_||(K_={})),function(e){e.SELF="self",e.DEEP="deep",e.DEEP_OVERRIDE="deep_override"}($_||($_={})),function(e){e.PRINCIPAL_TYPE_IMS_USER="https://ns.adobe.com/adobecloudplatform/ims/user",e.PRINCIPAL_TYPE_IMS_GROUP="https://ns.adobe.com/adobecloudplatform/ims/group"}(G_||(G_={}));var z_=function(e,t){return z_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},z_(e,t)};function q_(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}z_(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var Y_=function(){return Y_=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Y_.apply(this,arguments)};function Q_(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(i[s[r]]=e[s[r]])}return i}function J_(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))}function X_(e,t){var i,s,r,n,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,s=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){o.label=n[1];break}if(6===n[0]&&o.label<r[1]){o.label=r[1],r=n;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(n);break}r[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}function Z_(e,t,i){if(i||2===arguments.length)for(var s,r=0,n=t.length;r<n;r++)!s&&r in t||(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}var em=function(e,t){return em=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},em(e,t)},tm="Invariant Violation",im=Object.setPrototypeOf,sm=void 0===im?function(e,t){return e.__proto__=t,e}:im,rm=function(e){function t(i){void 0===i&&(i=tm);var s=e.call(this,"number"==typeof i?tm+": "+i+" (see https://github.com/apollographql/invariant-packages)":i)||this;return s.framesToPop=1,s.name=tm,sm(s,t.prototype),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}em(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(t,e),t}(Error);function nm(e,t){if(!e)throw new rm(t)}var om,am=["debug","log","warn","error","silent"],cm=am.indexOf("log");function lm(e){return function(){if(am.indexOf(e)>=cm)return(console[e]||console.log).apply(console,arguments)}}(om=nm||(nm={})).debug=lm("debug"),om.log=lm("log"),om.warn=lm("warn"),om.error=lm("error");var dm="3.11.8";function um(e){try{return e()}catch(e){}}var hm=um((function(){return globalThis}))||um((function(){return window}))||um((function(){return self}))||um((function(){return global}))||um((function(){return um.constructor("return this")()})),pm=new Map;function _m(e){var t=pm.get(e)||1;return pm.set(e,t+1),"".concat(e,":").concat(t,":").concat(Math.random().toString(36).slice(2))}function mm(e,t){void 0===t&&(t=0);var i=_m("stringifyForDisplay");return JSON.stringify(e,(function(e,t){return void 0===t?i:t}),t).split(JSON.stringify(i)).join("<undefined>")}function fm(e){return function(t){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];if("number"==typeof t){var r=t;(t=bm(r))||(t=Em(r,i),i=[])}e.apply(void 0,[t].concat(i))}}var gm=Object.assign((function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];e||nm(e,bm(t,i)||Em(t,i))}),{debug:fm(nm.debug),log:fm(nm.log),warn:fm(nm.warn),error:fm(nm.error)});function ym(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return new rm(bm(e,t)||Em(e,t))}var vm=Symbol.for("ApolloErrorMessageHandler_"+dm);function Om(e){if("string"==typeof e)return e;try{return mm(e,2).slice(0,1e3)}catch(e){return"<non-serializable>"}}function bm(e,t){if(void 0===t&&(t=[]),e)return hm[vm]&&hm[vm](e,t.map(Om))}function Em(e,t){if(void 0===t&&(t=[]),e)return"An error occurred! For more details, see the full error text at https://go.apollo.dev/c/err#".concat(encodeURIComponent(JSON.stringify({version:dm,message:e,args:t.map(Om)})))}function Im(e,t){if(!Boolean(e))throw new Error(t)}function Tm(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}const Sm=/\r\n|[\n\r]/g;function Am(e,t){let i=0,s=1;for(const r of e.body.matchAll(Sm)){if("number"==typeof r.index||Tm(!1),r.index>=t)break;i=r.index+r[0].length,s+=1}return{line:s,column:t+1-i}}function Pm(e,t){const i=e.locationOffset.column-1,s="".padStart(i)+e.body,r=t.line-1,n=e.locationOffset.line-1,o=t.line+n,a=1===t.line?i:0,c=t.column+a,l=`${e.name}:${o}:${c}\n`,d=s.split(/\r\n|[\n\r]/g),u=d[r];if(u.length>120){const e=Math.floor(c/80),t=c%80,i=[];for(let e=0;e<u.length;e+=80)i.push(u.slice(e,e+80));return l+wm([[`${o} |`,i[0]],...i.slice(1,e+1).map((e=>["|",e])),["|","^".padStart(t)],["|",i[e+1]]])}return l+wm([[o-1+" |",d[r-1]],[`${o} |`,u],["|","^".padStart(c)],[`${o+1} |`,d[r+1]]])}function wm(e){const t=e.filter((([e,t])=>void 0!==t)),i=Math.max(...t.map((([e])=>e.length)));return t.map((([e,t])=>e.padStart(i)+(t?" "+t:""))).join("\n")}class Cm extends Error{constructor(e,...t){var i,s,r;const{nodes:n,source:o,positions:a,path:c,originalError:l,extensions:d}=function(e){const t=e[0];return null==t||"kind"in t||"length"in t?{nodes:t,source:e[1],positions:e[2],path:e[3],originalError:e[4],extensions:e[5]}:t}(t);super(e),this.name="GraphQLError",this.path=null!=c?c:void 0,this.originalError=null!=l?l:void 0,this.nodes=Rm(Array.isArray(n)?n:n?[n]:void 0);const u=Rm(null===(i=this.nodes)||void 0===i?void 0:i.map((e=>e.loc)).filter((e=>null!=e)));this.source=null!=o?o:null==u||null===(s=u[0])||void 0===s?void 0:s.source,this.positions=null!=a?a:null==u?void 0:u.map((e=>e.start)),this.locations=a&&o?a.map((e=>Am(o,e))):null==u?void 0:u.map((e=>Am(e.source,e.start)));const h="object"==typeof(p=null==l?void 0:l.extensions)&&null!==p?null==l?void 0:l.extensions:void 0;var p;this.extensions=null!==(r=null!=d?d:h)&&void 0!==r?r:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),null!=l&&l.stack?Object.defineProperty(this,"stack",{value:l.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,Cm):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let e=this.message;if(this.nodes)for(const i of this.nodes)i.loc&&(e+="\n\n"+Pm((t=i.loc).source,Am(t.source,t.start)));else if(this.source&&this.locations)for(const t of this.locations)e+="\n\n"+Pm(this.source,t);var t;return e}toJSON(){const e={message:this.message};return null!=this.locations&&(e.locations=this.locations),null!=this.path&&(e.path=this.path),null!=this.extensions&&Object.keys(this.extensions).length>0&&(e.extensions=this.extensions),e}}function Rm(e){return void 0===e||0===e.length?void 0:e}function Lm(e,t,i){return new Cm(`Syntax Error: ${i}`,{source:e,positions:[t]})}class Nm{constructor(e,t,i){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=i}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}}class Dm{constructor(e,t,i,s,r,n){this.kind=e,this.start=t,this.end=i,this.line=s,this.column=r,this.value=n,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const Mm={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},xm=new Set(Object.keys(Mm));function km(e){const t=null==e?void 0:e.kind;return"string"==typeof t&&xm.has(t)}var Hm,jm,Um,Bm;function Fm(e){return 9===e||32===e}function Vm(e){return e>=48&&e<=57}function Km(e){return e>=97&&e<=122||e>=65&&e<=90}function $m(e){return Km(e)||95===e}function Gm(e){var t;let i=Number.MAX_SAFE_INTEGER,s=null,r=-1;for(let t=0;t<e.length;++t){var n;const o=e[t],a=Wm(o);a!==o.length&&(s=null!==(n=s)&&void 0!==n?n:t,r=t,0!==t&&a<i&&(i=a))}return e.map(((e,t)=>0===t?e:e.slice(i))).slice(null!==(t=s)&&void 0!==t?t:0,r+1)}function Wm(e){let t=0;for(;t<e.length&&Fm(e.charCodeAt(t));)++t;return t}!function(e){e.QUERY="query",e.MUTATION="mutation",e.SUBSCRIPTION="subscription"}(Hm||(Hm={})),function(e){e.QUERY="QUERY",e.MUTATION="MUTATION",e.SUBSCRIPTION="SUBSCRIPTION",e.FIELD="FIELD",e.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",e.FRAGMENT_SPREAD="FRAGMENT_SPREAD",e.INLINE_FRAGMENT="INLINE_FRAGMENT",e.VARIABLE_DEFINITION="VARIABLE_DEFINITION",e.SCHEMA="SCHEMA",e.SCALAR="SCALAR",e.OBJECT="OBJECT",e.FIELD_DEFINITION="FIELD_DEFINITION",e.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",e.INTERFACE="INTERFACE",e.UNION="UNION",e.ENUM="ENUM",e.ENUM_VALUE="ENUM_VALUE",e.INPUT_OBJECT="INPUT_OBJECT",e.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"}(jm||(jm={})),function(e){e.NAME="Name",e.DOCUMENT="Document",e.OPERATION_DEFINITION="OperationDefinition",e.VARIABLE_DEFINITION="VariableDefinition",e.SELECTION_SET="SelectionSet",e.FIELD="Field",e.ARGUMENT="Argument",e.FRAGMENT_SPREAD="FragmentSpread",e.INLINE_FRAGMENT="InlineFragment",e.FRAGMENT_DEFINITION="FragmentDefinition",e.VARIABLE="Variable",e.INT="IntValue",e.FLOAT="FloatValue",e.STRING="StringValue",e.BOOLEAN="BooleanValue",e.NULL="NullValue",e.ENUM="EnumValue",e.LIST="ListValue",e.OBJECT="ObjectValue",e.OBJECT_FIELD="ObjectField",e.DIRECTIVE="Directive",e.NAMED_TYPE="NamedType",e.LIST_TYPE="ListType",e.NON_NULL_TYPE="NonNullType",e.SCHEMA_DEFINITION="SchemaDefinition",e.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",e.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",e.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",e.FIELD_DEFINITION="FieldDefinition",e.INPUT_VALUE_DEFINITION="InputValueDefinition",e.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",e.UNION_TYPE_DEFINITION="UnionTypeDefinition",e.ENUM_TYPE_DEFINITION="EnumTypeDefinition",e.ENUM_VALUE_DEFINITION="EnumValueDefinition",e.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",e.DIRECTIVE_DEFINITION="DirectiveDefinition",e.SCHEMA_EXTENSION="SchemaExtension",e.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",e.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",e.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",e.UNION_TYPE_EXTENSION="UnionTypeExtension",e.ENUM_TYPE_EXTENSION="EnumTypeExtension",e.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"}(Um||(Um={})),function(e){e.SOF="<SOF>",e.EOF="<EOF>",e.BANG="!",e.DOLLAR="$",e.AMP="&",e.PAREN_L="(",e.PAREN_R=")",e.SPREAD="...",e.COLON=":",e.EQUALS="=",e.AT="@",e.BRACKET_L="[",e.BRACKET_R="]",e.BRACE_L="{",e.PIPE="|",e.BRACE_R="}",e.NAME="Name",e.INT="Int",e.FLOAT="Float",e.STRING="String",e.BLOCK_STRING="BlockString",e.COMMENT="Comment"}(Bm||(Bm={}));class zm{constructor(e){const t=new Dm(Bm.SOF,0,0,0,0);this.source=e,this.lastToken=t,this.token=t,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){return this.lastToken=this.token,this.token=this.lookahead()}lookahead(){let e=this.token;if(e.kind!==Bm.EOF)do{if(e.next)e=e.next;else{const t=ef(this,e.end);e.next=t,t.prev=e,e=t}}while(e.kind===Bm.COMMENT);return e}}function qm(e){return e>=0&&e<=55295||e>=57344&&e<=1114111}function Ym(e,t){return Qm(e.charCodeAt(t))&&Jm(e.charCodeAt(t+1))}function Qm(e){return e>=55296&&e<=56319}function Jm(e){return e>=56320&&e<=57343}function Xm(e,t){const i=e.source.body.codePointAt(t);if(void 0===i)return Bm.EOF;if(i>=32&&i<=126){const e=String.fromCodePoint(i);return'"'===e?"'\"'":`"${e}"`}return"U+"+i.toString(16).toUpperCase().padStart(4,"0")}function Zm(e,t,i,s,r){const n=e.line,o=1+i-e.lineStart;return new Dm(t,i,s,n,o,r)}function ef(e,t){const i=e.source.body,s=i.length;let r=t;for(;r<s;){const t=i.charCodeAt(r);switch(t){case 65279:case 9:case 32:case 44:++r;continue;case 10:++r,++e.line,e.lineStart=r;continue;case 13:10===i.charCodeAt(r+1)?r+=2:++r,++e.line,e.lineStart=r;continue;case 35:return tf(e,r);case 33:return Zm(e,Bm.BANG,r,r+1);case 36:return Zm(e,Bm.DOLLAR,r,r+1);case 38:return Zm(e,Bm.AMP,r,r+1);case 40:return Zm(e,Bm.PAREN_L,r,r+1);case 41:return Zm(e,Bm.PAREN_R,r,r+1);case 46:if(46===i.charCodeAt(r+1)&&46===i.charCodeAt(r+2))return Zm(e,Bm.SPREAD,r,r+3);break;case 58:return Zm(e,Bm.COLON,r,r+1);case 61:return Zm(e,Bm.EQUALS,r,r+1);case 64:return Zm(e,Bm.AT,r,r+1);case 91:return Zm(e,Bm.BRACKET_L,r,r+1);case 93:return Zm(e,Bm.BRACKET_R,r,r+1);case 123:return Zm(e,Bm.BRACE_L,r,r+1);case 124:return Zm(e,Bm.PIPE,r,r+1);case 125:return Zm(e,Bm.BRACE_R,r,r+1);case 34:return 34===i.charCodeAt(r+1)&&34===i.charCodeAt(r+2)?uf(e,r):nf(e,r)}if(Vm(t)||45===t)return sf(e,r,t);if($m(t))return hf(e,r);throw Lm(e.source,r,39===t?"Unexpected single quote character ('), did you mean to use a double quote (\")?":qm(t)||Ym(i,r)?`Unexpected character: ${Xm(e,r)}.`:`Invalid character: ${Xm(e,r)}.`)}return Zm(e,Bm.EOF,s,s)}function tf(e,t){const i=e.source.body,s=i.length;let r=t+1;for(;r<s;){const e=i.charCodeAt(r);if(10===e||13===e)break;if(qm(e))++r;else{if(!Ym(i,r))break;r+=2}}return Zm(e,Bm.COMMENT,t,r,i.slice(t+1,r))}function sf(e,t,i){const s=e.source.body;let r=t,n=i,o=!1;if(45===n&&(n=s.charCodeAt(++r)),48===n){if(n=s.charCodeAt(++r),Vm(n))throw Lm(e.source,r,`Invalid number, unexpected digit after 0: ${Xm(e,r)}.`)}else r=rf(e,r,n),n=s.charCodeAt(r);if(46===n&&(o=!0,n=s.charCodeAt(++r),r=rf(e,r,n),n=s.charCodeAt(r)),69!==n&&101!==n||(o=!0,n=s.charCodeAt(++r),43!==n&&45!==n||(n=s.charCodeAt(++r)),r=rf(e,r,n),n=s.charCodeAt(r)),46===n||$m(n))throw Lm(e.source,r,`Invalid number, expected digit but got: ${Xm(e,r)}.`);return Zm(e,o?Bm.FLOAT:Bm.INT,t,r,s.slice(t,r))}function rf(e,t,i){if(!Vm(i))throw Lm(e.source,t,`Invalid number, expected digit but got: ${Xm(e,t)}.`);const s=e.source.body;let r=t+1;for(;Vm(s.charCodeAt(r));)++r;return r}function nf(e,t){const i=e.source.body,s=i.length;let r=t+1,n=r,o="";for(;r<s;){const s=i.charCodeAt(r);if(34===s)return o+=i.slice(n,r),Zm(e,Bm.STRING,t,r+1,o);if(92!==s){if(10===s||13===s)break;if(qm(s))++r;else{if(!Ym(i,r))throw Lm(e.source,r,`Invalid character within String: ${Xm(e,r)}.`);r+=2}}else{o+=i.slice(n,r);const t=117===i.charCodeAt(r+1)?123===i.charCodeAt(r+2)?of(e,r):af(e,r):df(e,r);o+=t.value,r+=t.size,n=r}}throw Lm(e.source,r,"Unterminated string.")}function of(e,t){const i=e.source.body;let s=0,r=3;for(;r<12;){const e=i.charCodeAt(t+r++);if(125===e){if(r<5||!qm(s))break;return{value:String.fromCodePoint(s),size:r}}if(s=s<<4|lf(e),s<0)break}throw Lm(e.source,t,`Invalid Unicode escape sequence: "${i.slice(t,t+r)}".`)}function af(e,t){const i=e.source.body,s=cf(i,t+2);if(qm(s))return{value:String.fromCodePoint(s),size:6};if(Qm(s)&&92===i.charCodeAt(t+6)&&117===i.charCodeAt(t+7)){const e=cf(i,t+8);if(Jm(e))return{value:String.fromCodePoint(s,e),size:12}}throw Lm(e.source,t,`Invalid Unicode escape sequence: "${i.slice(t,t+6)}".`)}function cf(e,t){return lf(e.charCodeAt(t))<<12|lf(e.charCodeAt(t+1))<<8|lf(e.charCodeAt(t+2))<<4|lf(e.charCodeAt(t+3))}function lf(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function df(e,t){const i=e.source.body;switch(i.charCodeAt(t+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:"\n",size:2};case 114:return{value:"\r",size:2};case 116:return{value:"\t",size:2}}throw Lm(e.source,t,`Invalid character escape sequence: "${i.slice(t,t+2)}".`)}function uf(e,t){const i=e.source.body,s=i.length;let r=e.lineStart,n=t+3,o=n,a="";const c=[];for(;n<s;){const s=i.charCodeAt(n);if(34===s&&34===i.charCodeAt(n+1)&&34===i.charCodeAt(n+2)){a+=i.slice(o,n),c.push(a);const s=Zm(e,Bm.BLOCK_STRING,t,n+3,Gm(c).join("\n"));return e.line+=c.length-1,e.lineStart=r,s}if(92!==s||34!==i.charCodeAt(n+1)||34!==i.charCodeAt(n+2)||34!==i.charCodeAt(n+3))if(10!==s&&13!==s)if(qm(s))++n;else{if(!Ym(i,n))throw Lm(e.source,n,`Invalid character within String: ${Xm(e,n)}.`);n+=2}else a+=i.slice(o,n),c.push(a),13===s&&10===i.charCodeAt(n+1)?n+=2:++n,a="",o=n,r=n;else a+=i.slice(o,n),o=n+1,n+=4}throw Lm(e.source,n,"Unterminated string.")}function hf(e,t){const i=e.source.body,s=i.length;let r=t+1;for(;r<s&&(Km(n=i.charCodeAt(r))||Vm(n)||95===n);)++r;var n;return Zm(e,Bm.NAME,t,r,i.slice(t,r))}const pf=10,_f=2;function mf(e){return ff(e,[])}function ff(e,t){switch(typeof e){case"string":return JSON.stringify(e);case"function":return e.name?`[function ${e.name}]`:"[function]";case"object":return function(e,t){if(null===e)return"null";if(t.includes(e))return"[Circular]";const i=[...t,e];if(function(e){return"function"==typeof e.toJSON}(e)){const t=e.toJSON();if(t!==e)return"string"==typeof t?t:ff(t,i)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>_f)return"[Array]";const i=Math.min(pf,e.length),s=e.length-i,r=[];for(let s=0;s<i;++s)r.push(ff(e[s],t));return 1===s?r.push("... 1 more item"):s>1&&r.push(`... ${s} more items`),"["+r.join(", ")+"]"}(e,i);return function(e,t){const i=Object.entries(e);if(0===i.length)return"{}";if(t.length>_f)return"["+function(e){const t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){const t=e.constructor.name;if("string"==typeof t&&""!==t)return t}return t}(e)+"]";const s=i.map((([e,i])=>e+": "+ff(i,t)));return"{ "+s.join(", ")+" }"}(e,i)}(e,t);default:return String(e)}}const gf=globalThis.process?function(e,t){return e instanceof t}:function(e,t){if(e instanceof t)return!0;if("object"==typeof e&&null!==e){var i;const s=t.prototype[Symbol.toStringTag];if(s===(Symbol.toStringTag in e?e[Symbol.toStringTag]:null===(i=e.constructor)||void 0===i?void 0:i.name)){const t=mf(e);throw new Error(`Cannot use ${s} "${t}" from another module or realm.\n\nEnsure that there is only one instance of "graphql" in the node_modules\ndirectory. If different versions of "graphql" are the dependencies of other\nrelied on modules, use "resolutions" to ensure only one version is installed.\n\nhttps://yarnpkg.com/en/docs/selective-version-resolutions\n\nDuplicate "graphql" modules cannot be used at the same time since different\nversions may have different capabilities and behavior. The data from one\nversion used in the function from another could produce confusing and\nspurious results.`)}}return!1};class yf{constructor(e,t="GraphQL request",i={line:1,column:1}){"string"==typeof e||Im(!1,`Body must be a string. Received: ${mf(e)}.`),this.body=e,this.name=t,this.locationOffset=i,this.locationOffset.line>0||Im(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||Im(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}class vf{constructor(e,t={}){const i=function(e){return gf(e,yf)}(e)?e:new yf(e);this._lexer=new zm(i),this._options=t,this._tokenCounter=0}parseName(){const e=this.expectToken(Bm.NAME);return this.node(e,{kind:Um.NAME,value:e.value})}parseDocument(){return this.node(this._lexer.token,{kind:Um.DOCUMENT,definitions:this.many(Bm.SOF,this.parseDefinition,Bm.EOF)})}parseDefinition(){if(this.peek(Bm.BRACE_L))return this.parseOperationDefinition();const e=this.peekDescription(),t=e?this._lexer.lookahead():this._lexer.token;if(t.kind===Bm.NAME){switch(t.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(e)throw Lm(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(t.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(t)}parseOperationDefinition(){const e=this._lexer.token;if(this.peek(Bm.BRACE_L))return this.node(e,{kind:Um.OPERATION_DEFINITION,operation:Hm.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const t=this.parseOperationType();let i;return this.peek(Bm.NAME)&&(i=this.parseName()),this.node(e,{kind:Um.OPERATION_DEFINITION,operation:t,name:i,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const e=this.expectToken(Bm.NAME);switch(e.value){case"query":return Hm.QUERY;case"mutation":return Hm.MUTATION;case"subscription":return Hm.SUBSCRIPTION}throw this.unexpected(e)}parseVariableDefinitions(){return this.optionalMany(Bm.PAREN_L,this.parseVariableDefinition,Bm.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:Um.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(Bm.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(Bm.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const e=this._lexer.token;return this.expectToken(Bm.DOLLAR),this.node(e,{kind:Um.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:Um.SELECTION_SET,selections:this.many(Bm.BRACE_L,this.parseSelection,Bm.BRACE_R)})}parseSelection(){return this.peek(Bm.SPREAD)?this.parseFragment():this.parseField()}parseField(){const e=this._lexer.token,t=this.parseName();let i,s;return this.expectOptionalToken(Bm.COLON)?(i=t,s=this.parseName()):s=t,this.node(e,{kind:Um.FIELD,alias:i,name:s,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(Bm.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(e){const t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(Bm.PAREN_L,t,Bm.PAREN_R)}parseArgument(e=!1){const t=this._lexer.token,i=this.parseName();return this.expectToken(Bm.COLON),this.node(t,{kind:Um.ARGUMENT,name:i,value:this.parseValueLiteral(e)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const e=this._lexer.token;this.expectToken(Bm.SPREAD);const t=this.expectOptionalKeyword("on");return!t&&this.peek(Bm.NAME)?this.node(e,{kind:Um.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(e,{kind:Um.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const e=this._lexer.token;return this.expectKeyword("fragment"),!0===this._options.allowLegacyFragmentVariables?this.node(e,{kind:Um.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(e,{kind:Um.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()}parseValueLiteral(e){const t=this._lexer.token;switch(t.kind){case Bm.BRACKET_L:return this.parseList(e);case Bm.BRACE_L:return this.parseObject(e);case Bm.INT:return this.advanceLexer(),this.node(t,{kind:Um.INT,value:t.value});case Bm.FLOAT:return this.advanceLexer(),this.node(t,{kind:Um.FLOAT,value:t.value});case Bm.STRING:case Bm.BLOCK_STRING:return this.parseStringLiteral();case Bm.NAME:switch(this.advanceLexer(),t.value){case"true":return this.node(t,{kind:Um.BOOLEAN,value:!0});case"false":return this.node(t,{kind:Um.BOOLEAN,value:!1});case"null":return this.node(t,{kind:Um.NULL});default:return this.node(t,{kind:Um.ENUM,value:t.value})}case Bm.DOLLAR:if(e){if(this.expectToken(Bm.DOLLAR),this._lexer.token.kind===Bm.NAME){const e=this._lexer.token.value;throw Lm(this._lexer.source,t.start,`Unexpected variable "$${e}" in constant value.`)}throw this.unexpected(t)}return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const e=this._lexer.token;return this.advanceLexer(),this.node(e,{kind:Um.STRING,value:e.value,block:e.kind===Bm.BLOCK_STRING})}parseList(e){return this.node(this._lexer.token,{kind:Um.LIST,values:this.any(Bm.BRACKET_L,(()=>this.parseValueLiteral(e)),Bm.BRACKET_R)})}parseObject(e){return this.node(this._lexer.token,{kind:Um.OBJECT,fields:this.any(Bm.BRACE_L,(()=>this.parseObjectField(e)),Bm.BRACE_R)})}parseObjectField(e){const t=this._lexer.token,i=this.parseName();return this.expectToken(Bm.COLON),this.node(t,{kind:Um.OBJECT_FIELD,name:i,value:this.parseValueLiteral(e)})}parseDirectives(e){const t=[];for(;this.peek(Bm.AT);)t.push(this.parseDirective(e));return t}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(e){const t=this._lexer.token;return this.expectToken(Bm.AT),this.node(t,{kind:Um.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e)})}parseTypeReference(){const e=this._lexer.token;let t;if(this.expectOptionalToken(Bm.BRACKET_L)){const i=this.parseTypeReference();this.expectToken(Bm.BRACKET_R),t=this.node(e,{kind:Um.LIST_TYPE,type:i})}else t=this.parseNamedType();return this.expectOptionalToken(Bm.BANG)?this.node(e,{kind:Um.NON_NULL_TYPE,type:t}):t}parseNamedType(){return this.node(this._lexer.token,{kind:Um.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(Bm.STRING)||this.peek(Bm.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");const i=this.parseConstDirectives(),s=this.many(Bm.BRACE_L,this.parseOperationTypeDefinition,Bm.BRACE_R);return this.node(e,{kind:Um.SCHEMA_DEFINITION,description:t,directives:i,operationTypes:s})}parseOperationTypeDefinition(){const e=this._lexer.token,t=this.parseOperationType();this.expectToken(Bm.COLON);const i=this.parseNamedType();return this.node(e,{kind:Um.OPERATION_TYPE_DEFINITION,operation:t,type:i})}parseScalarTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");const i=this.parseName(),s=this.parseConstDirectives();return this.node(e,{kind:Um.SCALAR_TYPE_DEFINITION,description:t,name:i,directives:s})}parseObjectTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");const i=this.parseName(),s=this.parseImplementsInterfaces(),r=this.parseConstDirectives(),n=this.parseFieldsDefinition();return this.node(e,{kind:Um.OBJECT_TYPE_DEFINITION,description:t,name:i,interfaces:s,directives:r,fields:n})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(Bm.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(Bm.BRACE_L,this.parseFieldDefinition,Bm.BRACE_R)}parseFieldDefinition(){const e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),s=this.parseArgumentDefs();this.expectToken(Bm.COLON);const r=this.parseTypeReference(),n=this.parseConstDirectives();return this.node(e,{kind:Um.FIELD_DEFINITION,description:t,name:i,arguments:s,type:r,directives:n})}parseArgumentDefs(){return this.optionalMany(Bm.PAREN_L,this.parseInputValueDef,Bm.PAREN_R)}parseInputValueDef(){const e=this._lexer.token,t=this.parseDescription(),i=this.parseName();this.expectToken(Bm.COLON);const s=this.parseTypeReference();let r;this.expectOptionalToken(Bm.EQUALS)&&(r=this.parseConstValueLiteral());const n=this.parseConstDirectives();return this.node(e,{kind:Um.INPUT_VALUE_DEFINITION,description:t,name:i,type:s,defaultValue:r,directives:n})}parseInterfaceTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");const i=this.parseName(),s=this.parseImplementsInterfaces(),r=this.parseConstDirectives(),n=this.parseFieldsDefinition();return this.node(e,{kind:Um.INTERFACE_TYPE_DEFINITION,description:t,name:i,interfaces:s,directives:r,fields:n})}parseUnionTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");const i=this.parseName(),s=this.parseConstDirectives(),r=this.parseUnionMemberTypes();return this.node(e,{kind:Um.UNION_TYPE_DEFINITION,description:t,name:i,directives:s,types:r})}parseUnionMemberTypes(){return this.expectOptionalToken(Bm.EQUALS)?this.delimitedMany(Bm.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");const i=this.parseName(),s=this.parseConstDirectives(),r=this.parseEnumValuesDefinition();return this.node(e,{kind:Um.ENUM_TYPE_DEFINITION,description:t,name:i,directives:s,values:r})}parseEnumValuesDefinition(){return this.optionalMany(Bm.BRACE_L,this.parseEnumValueDefinition,Bm.BRACE_R)}parseEnumValueDefinition(){const e=this._lexer.token,t=this.parseDescription(),i=this.parseEnumValueName(),s=this.parseConstDirectives();return this.node(e,{kind:Um.ENUM_VALUE_DEFINITION,description:t,name:i,directives:s})}parseEnumValueName(){if("true"===this._lexer.token.value||"false"===this._lexer.token.value||"null"===this._lexer.token.value)throw Lm(this._lexer.source,this._lexer.token.start,`${Of(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");const i=this.parseName(),s=this.parseConstDirectives(),r=this.parseInputFieldsDefinition();return this.node(e,{kind:Um.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:i,directives:s,fields:r})}parseInputFieldsDefinition(){return this.optionalMany(Bm.BRACE_L,this.parseInputValueDef,Bm.BRACE_R)}parseTypeSystemExtension(){const e=this._lexer.lookahead();if(e.kind===Bm.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)}parseSchemaExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const t=this.parseConstDirectives(),i=this.optionalMany(Bm.BRACE_L,this.parseOperationTypeDefinition,Bm.BRACE_R);if(0===t.length&&0===i.length)throw this.unexpected();return this.node(e,{kind:Um.SCHEMA_EXTENSION,directives:t,operationTypes:i})}parseScalarTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const t=this.parseName(),i=this.parseConstDirectives();if(0===i.length)throw this.unexpected();return this.node(e,{kind:Um.SCALAR_TYPE_EXTENSION,name:t,directives:i})}parseObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const t=this.parseName(),i=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),r=this.parseFieldsDefinition();if(0===i.length&&0===s.length&&0===r.length)throw this.unexpected();return this.node(e,{kind:Um.OBJECT_TYPE_EXTENSION,name:t,interfaces:i,directives:s,fields:r})}parseInterfaceTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const t=this.parseName(),i=this.parseImplementsInterfaces(),s=this.parseConstDirectives(),r=this.parseFieldsDefinition();if(0===i.length&&0===s.length&&0===r.length)throw this.unexpected();return this.node(e,{kind:Um.INTERFACE_TYPE_EXTENSION,name:t,interfaces:i,directives:s,fields:r})}parseUnionTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const t=this.parseName(),i=this.parseConstDirectives(),s=this.parseUnionMemberTypes();if(0===i.length&&0===s.length)throw this.unexpected();return this.node(e,{kind:Um.UNION_TYPE_EXTENSION,name:t,directives:i,types:s})}parseEnumTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const t=this.parseName(),i=this.parseConstDirectives(),s=this.parseEnumValuesDefinition();if(0===i.length&&0===s.length)throw this.unexpected();return this.node(e,{kind:Um.ENUM_TYPE_EXTENSION,name:t,directives:i,values:s})}parseInputObjectTypeExtension(){const e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const t=this.parseName(),i=this.parseConstDirectives(),s=this.parseInputFieldsDefinition();if(0===i.length&&0===s.length)throw this.unexpected();return this.node(e,{kind:Um.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:i,fields:s})}parseDirectiveDefinition(){const e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(Bm.AT);const i=this.parseName(),s=this.parseArgumentDefs(),r=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const n=this.parseDirectiveLocations();return this.node(e,{kind:Um.DIRECTIVE_DEFINITION,description:t,name:i,arguments:s,repeatable:r,locations:n})}parseDirectiveLocations(){return this.delimitedMany(Bm.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const e=this._lexer.token,t=this.parseName();if(Object.prototype.hasOwnProperty.call(jm,t.value))return t;throw this.unexpected(e)}node(e,t){return!0!==this._options.noLocation&&(t.loc=new Nm(e,this._lexer.lastToken,this._lexer.source)),t}peek(e){return this._lexer.token.kind===e}expectToken(e){const t=this._lexer.token;if(t.kind===e)return this.advanceLexer(),t;throw Lm(this._lexer.source,t.start,`Expected ${bf(e)}, found ${Of(t)}.`)}expectOptionalToken(e){return this._lexer.token.kind===e&&(this.advanceLexer(),!0)}expectKeyword(e){const t=this._lexer.token;if(t.kind!==Bm.NAME||t.value!==e)throw Lm(this._lexer.source,t.start,`Expected "${e}", found ${Of(t)}.`);this.advanceLexer()}expectOptionalKeyword(e){const t=this._lexer.token;return t.kind===Bm.NAME&&t.value===e&&(this.advanceLexer(),!0)}unexpected(e){const t=null!=e?e:this._lexer.token;return Lm(this._lexer.source,t.start,`Unexpected ${Of(t)}.`)}any(e,t,i){this.expectToken(e);const s=[];for(;!this.expectOptionalToken(i);)s.push(t.call(this));return s}optionalMany(e,t,i){if(this.expectOptionalToken(e)){const e=[];do{e.push(t.call(this))}while(!this.expectOptionalToken(i));return e}return[]}many(e,t,i){this.expectToken(e);const s=[];do{s.push(t.call(this))}while(!this.expectOptionalToken(i));return s}delimitedMany(e,t){this.expectOptionalToken(e);const i=[];do{i.push(t.call(this))}while(this.expectOptionalToken(e));return i}advanceLexer(){const{maxTokens:e}=this._options,t=this._lexer.advance();if(void 0!==e&&t.kind!==Bm.EOF&&(++this._tokenCounter,this._tokenCounter>e))throw Lm(this._lexer.source,t.start,`Document contains more that ${e} tokens. Parsing aborted.`)}}function Of(e){const t=e.value;return bf(e.kind)+(null!=t?` "${t}"`:"")}function bf(e){return function(e){return e===Bm.BANG||e===Bm.DOLLAR||e===Bm.AMP||e===Bm.PAREN_L||e===Bm.PAREN_R||e===Bm.SPREAD||e===Bm.COLON||e===Bm.EQUALS||e===Bm.AT||e===Bm.BRACKET_L||e===Bm.BRACKET_R||e===Bm.BRACE_L||e===Bm.PIPE||e===Bm.BRACE_R}(e)?`"${e}"`:e}const Ef=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function If(e){return Tf[e.charCodeAt(0)]}const Tf=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"],Sf=Object.freeze({});function Af(e,t,i=Mm){const s=new Map;for(const e of Object.values(Um))s.set(e,Pf(t,e));let r,n,o,a=Array.isArray(e),c=[e],l=-1,d=[],u=e;const h=[],p=[];do{l++;const e=l===c.length,g=e&&0!==d.length;if(e){if(n=0===p.length?void 0:h[h.length-1],u=o,o=p.pop(),g)if(a){u=u.slice();let e=0;for(const[t,i]of d){const s=t-e;null===i?(u.splice(s,1),e++):u[s]=i}}else{u=Object.defineProperties({},Object.getOwnPropertyDescriptors(u));for(const[e,t]of d)u[e]=t}l=r.index,c=r.keys,d=r.edits,a=r.inArray,r=r.prev}else if(o){if(n=a?l:c[l],u=o[n],null==u)continue;h.push(n)}let y;if(!Array.isArray(u)){var _,m;km(u)||Im(!1,`Invalid AST Node: ${mf(u)}.`);const i=e?null===(_=s.get(u.kind))||void 0===_?void 0:_.leave:null===(m=s.get(u.kind))||void 0===m?void 0:m.enter;if(y=null==i?void 0:i.call(t,u,n,o,h,p),y===Sf)break;if(!1===y){if(!e){h.pop();continue}}else if(void 0!==y&&(d.push([n,y]),!e)){if(!km(y)){h.pop();continue}u=y}}var f;void 0===y&&g&&d.push([n,u]),e?h.pop():(r={inArray:a,index:l,keys:c,edits:d,prev:r},a=Array.isArray(u),c=a?u:null!==(f=i[u.kind])&&void 0!==f?f:[],l=-1,d=[],o&&p.push(o),o=u)}while(void 0!==r);return 0!==d.length?d[d.length-1][1]:e}function Pf(e,t){const i=e[t];return"object"==typeof i?i:"function"==typeof i?{enter:i,leave:void 0}:{enter:e.enter,leave:e.leave}}const wf={Name:{leave:e=>e.value},Variable:{leave:e=>"$"+e.name},Document:{leave:e=>Cf(e.definitions,"\n\n")},OperationDefinition:{leave(e){const t=Lf("(",Cf(e.variableDefinitions,", "),")"),i=Cf([e.operation,Cf([e.name,t]),Cf(e.directives," ")]," ");return("query"===i?"":i+" ")+e.selectionSet}},VariableDefinition:{leave:({variable:e,type:t,defaultValue:i,directives:s})=>e+": "+t+Lf(" = ",i)+Lf(" ",Cf(s," "))},SelectionSet:{leave:({selections:e})=>Rf(e)},Field:{leave({alias:e,name:t,arguments:i,directives:s,selectionSet:r}){const n=Lf("",e,": ")+t;let o=n+Lf("(",Cf(i,", "),")");return o.length>80&&(o=n+Lf("(\n",Nf(Cf(i,"\n")),"\n)")),Cf([o,Cf(s," "),r]," ")}},Argument:{leave:({name:e,value:t})=>e+": "+t},FragmentSpread:{leave:({name:e,directives:t})=>"..."+e+Lf(" ",Cf(t," "))},InlineFragment:{leave:({typeCondition:e,directives:t,selectionSet:i})=>Cf(["...",Lf("on ",e),Cf(t," "),i]," ")},FragmentDefinition:{leave:({name:e,typeCondition:t,variableDefinitions:i,directives:s,selectionSet:r})=>`fragment ${e}${Lf("(",Cf(i,", "),")")} on ${t} ${Lf("",Cf(s," ")," ")}`+r},IntValue:{leave:({value:e})=>e},FloatValue:{leave:({value:e})=>e},StringValue:{leave:({value:e,block:t})=>t?function(e,t){const i=e.replace(/"""/g,'\\"""'),s=i.split(/\r\n|[\n\r]/g),r=1===s.length,n=s.length>1&&s.slice(1).every((e=>0===e.length||Fm(e.charCodeAt(0)))),o=i.endsWith('\\"""'),a=e.endsWith('"')&&!o,c=e.endsWith("\\"),l=a||c,d=!r||e.length>70||l||n||o;let u="";const h=r&&Fm(e.charCodeAt(0));return(d&&!h||n)&&(u+="\n"),u+=i,(d||l)&&(u+="\n"),'"""'+u+'"""'}(e):`"${e.replace(Ef,If)}"`},BooleanValue:{leave:({value:e})=>e?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:e})=>e},ListValue:{leave:({values:e})=>"["+Cf(e,", ")+"]"},ObjectValue:{leave:({fields:e})=>"{"+Cf(e,", ")+"}"},ObjectField:{leave:({name:e,value:t})=>e+": "+t},Directive:{leave:({name:e,arguments:t})=>"@"+e+Lf("(",Cf(t,", "),")")},NamedType:{leave:({name:e})=>e},ListType:{leave:({type:e})=>"["+e+"]"},NonNullType:{leave:({type:e})=>e+"!"},SchemaDefinition:{leave:({description:e,directives:t,operationTypes:i})=>Lf("",e,"\n")+Cf(["schema",Cf(t," "),Rf(i)]," ")},OperationTypeDefinition:{leave:({operation:e,type:t})=>e+": "+t},ScalarTypeDefinition:{leave:({description:e,name:t,directives:i})=>Lf("",e,"\n")+Cf(["scalar",t,Cf(i," ")]," ")},ObjectTypeDefinition:{leave:({description:e,name:t,interfaces:i,directives:s,fields:r})=>Lf("",e,"\n")+Cf(["type",t,Lf("implements ",Cf(i," & ")),Cf(s," "),Rf(r)]," ")},FieldDefinition:{leave:({description:e,name:t,arguments:i,type:s,directives:r})=>Lf("",e,"\n")+t+(Df(i)?Lf("(\n",Nf(Cf(i,"\n")),"\n)"):Lf("(",Cf(i,", "),")"))+": "+s+Lf(" ",Cf(r," "))},InputValueDefinition:{leave:({description:e,name:t,type:i,defaultValue:s,directives:r})=>Lf("",e,"\n")+Cf([t+": "+i,Lf("= ",s),Cf(r," ")]," ")},InterfaceTypeDefinition:{leave:({description:e,name:t,interfaces:i,directives:s,fields:r})=>Lf("",e,"\n")+Cf(["interface",t,Lf("implements ",Cf(i," & ")),Cf(s," "),Rf(r)]," ")},UnionTypeDefinition:{leave:({description:e,name:t,directives:i,types:s})=>Lf("",e,"\n")+Cf(["union",t,Cf(i," "),Lf("= ",Cf(s," | "))]," ")},EnumTypeDefinition:{leave:({description:e,name:t,directives:i,values:s})=>Lf("",e,"\n")+Cf(["enum",t,Cf(i," "),Rf(s)]," ")},EnumValueDefinition:{leave:({description:e,name:t,directives:i})=>Lf("",e,"\n")+Cf([t,Cf(i," ")]," ")},InputObjectTypeDefinition:{leave:({description:e,name:t,directives:i,fields:s})=>Lf("",e,"\n")+Cf(["input",t,Cf(i," "),Rf(s)]," ")},DirectiveDefinition:{leave:({description:e,name:t,arguments:i,repeatable:s,locations:r})=>Lf("",e,"\n")+"directive @"+t+(Df(i)?Lf("(\n",Nf(Cf(i,"\n")),"\n)"):Lf("(",Cf(i,", "),")"))+(s?" repeatable":"")+" on "+Cf(r," | ")},SchemaExtension:{leave:({directives:e,operationTypes:t})=>Cf(["extend schema",Cf(e," "),Rf(t)]," ")},ScalarTypeExtension:{leave:({name:e,directives:t})=>Cf(["extend scalar",e,Cf(t," ")]," ")},ObjectTypeExtension:{leave:({name:e,interfaces:t,directives:i,fields:s})=>Cf(["extend type",e,Lf("implements ",Cf(t," & ")),Cf(i," "),Rf(s)]," ")},InterfaceTypeExtension:{leave:({name:e,interfaces:t,directives:i,fields:s})=>Cf(["extend interface",e,Lf("implements ",Cf(t," & ")),Cf(i," "),Rf(s)]," ")},UnionTypeExtension:{leave:({name:e,directives:t,types:i})=>Cf(["extend union",e,Cf(t," "),Lf("= ",Cf(i," | "))]," ")},EnumTypeExtension:{leave:({name:e,directives:t,values:i})=>Cf(["extend enum",e,Cf(t," "),Rf(i)]," ")},InputObjectTypeExtension:{leave:({name:e,directives:t,fields:i})=>Cf(["extend input",e,Cf(t," "),Rf(i)]," ")}};function Cf(e,t=""){var i;return null!==(i=null==e?void 0:e.filter((e=>e)).join(t))&&void 0!==i?i:""}function Rf(e){return Lf("{\n",Nf(Cf(e,"\n")),"\n}")}function Lf(e,t,i=""){return null!=t&&""!==t?e+t+i:""}function Nf(e){return Lf("  ",e.replace(/\n/g,"\n  "))}function Df(e){var t;return null!==(t=null==e?void 0:e.some((e=>e.includes("\n"))))&&void 0!==t&&t}function Mf(e){return e.kind===Um.FIELD||e.kind===Um.FRAGMENT_SPREAD||e.kind===Um.INLINE_FRAGMENT}function xf(e,t){var i=e.directives;return!i||!i.length||function(e){var t=[];return e&&e.length&&e.forEach((function(e){if(function(e){var t=e.name.value;return"skip"===t||"include"===t}(e)){var i=e.arguments,s=e.name.value;gm(i&&1===i.length,71,s);var r=i[0];gm(r.name&&"if"===r.name.value,72,s);var n=r.value;gm(n&&("Variable"===n.kind||"BooleanValue"===n.kind),73,s),t.push({directive:e,ifArgument:r})}})),t}(i).every((function(e){var i=e.directive,s=e.ifArgument,r=!1;return"Variable"===s.value.kind?(r=t&&t[s.value.name.value],gm(void 0!==r,70,i.name.value)):r=s.value.value,"skip"===i.name.value?!r:r}))}function kf(e,t,i){var s=new Set(e),r=s.size;return Af(t,{Directive:function(e){if(s.delete(e.name.value)&&(!i||!s.size))return Sf}}),i?!s.size:s.size<r}function Hf(e){return e&&kf(["client","export"],e,!0)}const jf=()=>Object.create(null),{forEach:Uf,slice:Bf}=Array.prototype,{hasOwnProperty:Ff}=Object.prototype;class Vf{constructor(e=!0,t=jf){this.weakness=e,this.makeData=t}lookup(){return this.lookupArray(arguments)}lookupArray(e){let t=this;return Uf.call(e,(e=>t=t.getChildTrie(e))),Ff.call(t,"data")?t.data:t.data=this.makeData(Bf.call(e))}peek(){return this.peekArray(arguments)}peekArray(e){let t=this;for(let i=0,s=e.length;t&&i<s;++i){const s=t.mapFor(e[i],!1);t=s&&s.get(e[i])}return t&&t.data}remove(){return this.removeArray(arguments)}removeArray(e){let t;if(e.length){const i=e[0],s=this.mapFor(i,!1),r=s&&s.get(i);r&&(t=r.removeArray(Bf.call(e,1)),r.data||r.weak||r.strong&&r.strong.size||s.delete(i))}else t=this.data,delete this.data;return t}getChildTrie(e){const t=this.mapFor(e,!0);let i=t.get(e);return i||t.set(e,i=new Vf(this.weakness,this.makeData)),i}mapFor(e,t){return this.weakness&&function(e){switch(typeof e){case"object":if(null===e)break;case"function":return!0}return!1}(e)?this.weak||(t?this.weak=new WeakMap:void 0):this.strong||(t?this.strong=new Map:void 0)}}var Kf="ReactNative"==um((function(){return navigator.product})),$f="function"==typeof WeakMap&&!(Kf&&!global.HermesInternal),Gf="function"==typeof WeakSet,Wf="function"==typeof Symbol&&"function"==typeof Symbol.for,zf=Wf&&Symbol.asyncIterator;function qf(e){return null!==e&&"object"==typeof e}function Yf(e,t){var i=t,s=[];return e.definitions.forEach((function(e){if("OperationDefinition"===e.kind)throw ym(74,e.operation,e.name?" named '".concat(e.name.value,"'"):"");"FragmentDefinition"===e.kind&&s.push(e)})),void 0===i&&(gm(1===s.length,75,s.length),i=s[0].name.value),Y_(Y_({},e),{definitions:Z_([{kind:"OperationDefinition",operation:"query",selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:i}}]}}],e.definitions,!0)})}function Qf(e){void 0===e&&(e=[]);var t={};return e.forEach((function(e){t[e.name.value]=e})),t}function Jf(e,t){switch(e.kind){case"InlineFragment":return e;case"FragmentSpread":var i=e.name.value;if("function"==typeof t)return t(i);var s=t&&t[i];return gm(s,76,i),s||null;default:return null}}function Xf(){}um((function(){return window.document.createElement})),um((function(){return navigator.userAgent.indexOf("jsdom")>=0}));class Zf{constructor(e=1/0,t=Xf){this.max=e,this.dispose=t,this.map=new Map,this.newest=null,this.oldest=null}has(e){return this.map.has(e)}get(e){const t=this.getNode(e);return t&&t.value}get size(){return this.map.size}getNode(e){const t=this.map.get(e);if(t&&t!==this.newest){const{older:e,newer:i}=t;i&&(i.older=e),e&&(e.newer=i),t.older=this.newest,t.older.newer=t,t.newer=null,this.newest=t,t===this.oldest&&(this.oldest=i)}return t}set(e,t){let i=this.getNode(e);return i?i.value=t:(i={key:e,value:t,newer:null,older:this.newest},this.newest&&(this.newest.newer=i),this.newest=i,this.oldest=this.oldest||i,this.map.set(e,i),i.value)}clean(){for(;this.oldest&&this.map.size>this.max;)this.delete(this.oldest.key)}delete(e){const t=this.map.get(e);return!!t&&(t===this.newest&&(this.newest=t.older),t===this.oldest&&(this.oldest=t.newer),t.newer&&(t.newer.older=t.older),t.older&&(t.older.newer=t.newer),this.map.delete(e),this.dispose(t.value,e),!0)}}function eg(){}const tg=eg,ig="undefined"!=typeof WeakRef?WeakRef:function(e){return{deref:()=>e}},sg="undefined"!=typeof WeakMap?WeakMap:Map,rg="undefined"!=typeof FinalizationRegistry?FinalizationRegistry:function(){return{register:eg,unregister:eg}};class ng{constructor(e=1/0,t=tg){this.max=e,this.dispose=t,this.map=new sg,this.newest=null,this.oldest=null,this.unfinalizedNodes=new Set,this.finalizationScheduled=!1,this.size=0,this.finalize=()=>{const e=this.unfinalizedNodes.values();for(let t=0;t<10024;t++){const t=e.next().value;if(!t)break;this.unfinalizedNodes.delete(t);const i=t.key;delete t.key,t.keyRef=new ig(i),this.registry.register(i,t,t)}this.unfinalizedNodes.size>0?queueMicrotask(this.finalize):this.finalizationScheduled=!1},this.registry=new rg(this.deleteNode.bind(this))}has(e){return this.map.has(e)}get(e){const t=this.getNode(e);return t&&t.value}getNode(e){const t=this.map.get(e);if(t&&t!==this.newest){const{older:e,newer:i}=t;i&&(i.older=e),e&&(e.newer=i),t.older=this.newest,t.older.newer=t,t.newer=null,this.newest=t,t===this.oldest&&(this.oldest=i)}return t}set(e,t){let i=this.getNode(e);return i?i.value=t:(i={key:e,value:t,newer:null,older:this.newest},this.newest&&(this.newest.newer=i),this.newest=i,this.oldest=this.oldest||i,this.scheduleFinalization(i),this.map.set(e,i),this.size++,i.value)}clean(){for(;this.oldest&&this.size>this.max;)this.deleteNode(this.oldest)}deleteNode(e){e===this.newest&&(this.newest=e.older),e===this.oldest&&(this.oldest=e.newer),e.newer&&(e.newer.older=e.older),e.older&&(e.older.newer=e.newer),this.size--;const t=e.key||e.keyRef&&e.keyRef.deref();this.dispose(e.value,t),e.keyRef?this.registry.unregister(e):this.unfinalizedNodes.delete(e),t&&this.map.delete(t)}delete(e){const t=this.map.get(e);return!!t&&(this.deleteNode(t),!0)}scheduleFinalization(e){this.unfinalizedNodes.add(e),this.finalizationScheduled||(this.finalizationScheduled=!0,queueMicrotask(this.finalize))}}var og=new WeakSet;function ag(e){e.size<=(e.max||-1)||og.has(e)||(og.add(e),setTimeout((function(){e.clean(),og.delete(e)}),100))}var cg=function(e,t){var i=new ng(e,t);return i.set=function(e,t){var i=ng.prototype.set.call(this,e,t);return ag(this),i},i},lg=function(e,t){var i=new Zf(e,t);return i.set=function(e,t){var i=Zf.prototype.set.call(this,e,t);return ag(this),i},i},dg=Symbol.for("apollo.cacheSize"),ug=Y_({},hm[dg]),hg={};function pg(e,t){hg[e]=t}var _g=!1!==globalThis.__DEV__?function(){var e,t,i,s,r;if(!1===globalThis.__DEV__)throw new Error("only supported in development mode");return{limits:Object.fromEntries(Object.entries({parser:1e3,canonicalStringify:1e3,print:2e3,"documentTransform.cache":2e3,"queryManager.getDocumentInfo":2e3,"PersistedQueryLink.persistedQueryHashes":2e3,"fragmentRegistry.transform":2e3,"fragmentRegistry.lookup":1e3,"fragmentRegistry.findFragmentSpreads":4e3,"cache.fragmentQueryDocuments":1e3,"removeTypenameFromVariables.getVariableDefinitions":2e3,"inMemoryCache.maybeBroadcastWatch":5e3,"inMemoryCache.executeSelectionSet":5e4,"inMemoryCache.executeSubSelectedArray":1e4}).map((function(e){var t=e[0],i=e[1];return[t,ug[t]||i]}))),sizes:Y_({print:null===(e=hg.print)||void 0===e?void 0:e.call(hg),parser:null===(t=hg.parser)||void 0===t?void 0:t.call(hg),canonicalStringify:null===(i=hg.canonicalStringify)||void 0===i?void 0:i.call(hg),links:Eg(this.link),queryManager:{getDocumentInfo:this.queryManager.transformCache.size,documentTransforms:Og(this.queryManager.documentTransform)}},null===(r=(s=this.cache).getMemoryInternals)||void 0===r?void 0:r.call(s))}}:void 0,mg=!1!==globalThis.__DEV__?function(){var e=this.config.fragments;return Y_(Y_({},gg.apply(this)),{addTypenameDocumentTransform:Og(this.addTypenameTransform),inMemoryCache:{executeSelectionSet:yg(this.storeReader.executeSelectionSet),executeSubSelectedArray:yg(this.storeReader.executeSubSelectedArray),maybeBroadcastWatch:yg(this.maybeBroadcastWatch)},fragmentRegistry:{findFragmentSpreads:yg(null==e?void 0:e.findFragmentSpreads),lookup:yg(null==e?void 0:e.lookup),transform:yg(null==e?void 0:e.transform)}})}:void 0,fg=!1!==globalThis.__DEV__?gg:void 0;function gg(){return{cache:{fragmentQueryDocuments:yg(this.getFragmentDoc)}}}function yg(e){return function(e){return!!e&&"dirtyKey"in e}(e)?e.size:void 0}function vg(e){return null!=e}function Og(e){return bg(e).map((function(e){return{cache:e}}))}function bg(e){return e?Z_(Z_([yg(null==e?void 0:e.performWork)],bg(null==e?void 0:e.left),!0),bg(null==e?void 0:e.right),!0).filter(vg):[]}function Eg(e){var t;return e?Z_(Z_([null===(t=null==e?void 0:e.getMemoryInternals)||void 0===t?void 0:t.call(e)],Eg(null==e?void 0:e.left),!0),Eg(null==e?void 0:e.right),!0).filter(vg):[]}var Ig,Tg=Object.assign((function(e){return JSON.stringify(e,Sg)}),{reset:function(){Ig=new lg(ug.canonicalStringify||1e3)}});function Sg(e,t){if(t&&"object"==typeof t){var i=Object.getPrototypeOf(t);if(i===Object.prototype||null===i){var s=Object.keys(t);if(s.every(Ag))return t;var r=JSON.stringify(s),n=Ig.get(r);if(!n){s.sort();var o=JSON.stringify(s);n=Ig.get(o)||s,Ig.set(r,n),Ig.set(o,n)}var a=Object.create(i);return n.forEach((function(e){a[e]=t[e]})),a}}return t}function Ag(e,t,i){return 0===t||i[t-1]<=e}function Pg(e){return{__ref:String(e)}}function wg(e){return Boolean(e&&"object"==typeof e&&"string"==typeof e.__ref)}function Cg(e,t,i,s){if(function(e){return"IntValue"===e.kind}(i)||function(e){return"FloatValue"===e.kind}(i))e[t.value]=Number(i.value);else if(function(e){return"BooleanValue"===e.kind}(i)||function(e){return"StringValue"===e.kind}(i))e[t.value]=i.value;else if(function(e){return"ObjectValue"===e.kind}(i)){var r={};i.fields.map((function(e){return Cg(r,e.name,e.value,s)})),e[t.value]=r}else if(function(e){return"Variable"===e.kind}(i)){var n=(s||{})[i.name.value];e[t.value]=n}else if(function(e){return"ListValue"===e.kind}(i))e[t.value]=i.values.map((function(e){var i={};return Cg(i,t,e,s),i[t.value]}));else if(function(e){return"EnumValue"===e.kind}(i))e[t.value]=i.value;else{if(!function(e){return"NullValue"===e.kind}(i))throw ym(85,t.value,i.kind);e[t.value]=null}}!1!==globalThis.__DEV__&&pg("canonicalStringify",(function(){return Ig.size})),Tg.reset();var Rg=["connection","include","skip","client","rest","export","nonreactive"],Lg=Tg,Ng=Object.assign((function(e,t,i){if(t&&i&&i.connection&&i.connection.key){if(i.connection.filter&&i.connection.filter.length>0){var s=i.connection.filter?i.connection.filter:[];s.sort();var r={};return s.forEach((function(e){r[e]=t[e]})),"".concat(i.connection.key,"(").concat(Lg(r),")")}return i.connection.key}var n=e;if(t){var o=Lg(t);n+="(".concat(o,")")}return i&&Object.keys(i).forEach((function(e){-1===Rg.indexOf(e)&&(i[e]&&Object.keys(i[e]).length?n+="@".concat(e,"(").concat(Lg(i[e]),")"):n+="@".concat(e))})),n}),{setStringify:function(e){var t=Lg;return Lg=e,t}});function Dg(e,t){if(e.arguments&&e.arguments.length){var i={};return e.arguments.forEach((function(e){var s=e.name,r=e.value;return Cg(i,s,r,t)})),i}return null}function Mg(e){return e.alias?e.alias.value:e.name.value}function xg(e,t,i){for(var s,r=0,n=t.selections;r<n.length;r++)if(kg(c=n[r])){if("__typename"===c.name.value)return e[Mg(c)]}else s?s.push(c):s=[c];if("string"==typeof e.__typename)return e.__typename;if(s)for(var o=0,a=s;o<a.length;o++){var c,l=xg(e,Jf(c=a[o],i).selectionSet,i);if("string"==typeof l)return l}}function kg(e){return"Field"===e.kind}function Hg(e){gm(e&&"Document"===e.kind,77);var t=e.definitions.filter((function(e){return"FragmentDefinition"!==e.kind})).map((function(e){if("OperationDefinition"!==e.kind)throw ym(78,e.kind);return e}));return gm(t.length<=1,79,t.length),e}function jg(e){return Hg(e),e.definitions.filter((function(e){return"OperationDefinition"===e.kind}))[0]}function Ug(e){return e.definitions.filter((function(e){return"OperationDefinition"===e.kind&&!!e.name})).map((function(e){return e.name.value}))[0]||null}function Bg(e){return e.definitions.filter((function(e){return"FragmentDefinition"===e.kind}))}function Fg(e){var t=jg(e);return gm(t&&"query"===t.operation,80),t}function Vg(e){var t;Hg(e);for(var i=0,s=e.definitions;i<s.length;i++){var r=s[i];if("OperationDefinition"===r.kind){var n=r.operation;if("query"===n||"mutation"===n||"subscription"===n)return r}"FragmentDefinition"!==r.kind||t||(t=r)}if(t)return t;throw ym(84)}function Kg(e){var t=Object.create(null),i=e&&e.variableDefinitions;return i&&i.length&&i.forEach((function(e){e.defaultValue&&Cg(t,e.variable.name,e.defaultValue)})),t}const $g=()=>Object.create(null),{forEach:Gg,slice:Wg}=Array.prototype,{hasOwnProperty:zg}=Object.prototype;class qg{constructor(e=!0,t=$g){this.weakness=e,this.makeData=t}lookup(...e){return this.lookupArray(e)}lookupArray(e){let t=this;return Gg.call(e,(e=>t=t.getChildTrie(e))),zg.call(t,"data")?t.data:t.data=this.makeData(Wg.call(e))}peek(...e){return this.peekArray(e)}peekArray(e){let t=this;for(let i=0,s=e.length;t&&i<s;++i){const s=this.weakness&&Yg(e[i])?t.weak:t.strong;t=s&&s.get(e[i])}return t&&t.data}getChildTrie(e){const t=this.weakness&&Yg(e)?this.weak||(this.weak=new WeakMap):this.strong||(this.strong=new Map);let i=t.get(e);return i||t.set(e,i=new qg(this.weakness,this.makeData)),i}}function Yg(e){switch(typeof e){case"object":if(null===e)break;case"function":return!0}return!1}let Qg=null;const Jg={};let Xg=1;function Zg(e){try{return e()}catch(e){}}const ey="@wry/context:Slot",ty=Zg((()=>globalThis))||Zg((()=>global))||Object.create(null),iy=ty[ey]||Array[ey]||function(e){try{Object.defineProperty(ty,ey,{value:e,enumerable:!1,writable:!1,configurable:!0})}finally{return e}}(class{constructor(){this.id=["slot",Xg++,Date.now(),Math.random().toString(36).slice(2)].join(":")}hasValue(){for(let e=Qg;e;e=e.parent)if(this.id in e.slots){const t=e.slots[this.id];if(t===Jg)break;return e!==Qg&&(Qg.slots[this.id]=t),!0}return Qg&&(Qg.slots[this.id]=Jg),!1}getValue(){if(this.hasValue())return Qg.slots[this.id]}withValue(e,t,i,s){const r={__proto__:null,[this.id]:e},n=Qg;Qg={parent:n,slots:r};try{return t.apply(s,i)}finally{Qg=n}}static bind(e){const t=Qg;return function(){const i=Qg;try{return Qg=t,e.apply(this,arguments)}finally{Qg=i}}}static noContext(e,t,i){if(!Qg)return e.apply(i,t);{const s=Qg;try{return Qg=null,e.apply(i,t)}finally{Qg=s}}}}),sy=new iy,{hasOwnProperty:ry}=Object.prototype,ny=Array.from||function(e){const t=[];return e.forEach((e=>t.push(e))),t};function oy(e){const{unsubscribe:t}=e;"function"==typeof t&&(e.unsubscribe=void 0,t())}const ay=[],cy=100;function ly(e,t){if(!e)throw new Error(t||"assertion failure")}function dy(e,t){const i=e.length;return i>0&&i===t.length&&e[i-1]===t[i-1]}function uy(e){switch(e.length){case 0:throw new Error("unknown value");case 1:return e[0];case 2:throw e[1]}}function hy(e){return e.slice(0)}class py{constructor(e){this.fn=e,this.parents=new Set,this.childValues=new Map,this.dirtyChildren=null,this.dirty=!0,this.recomputing=!1,this.value=[],this.deps=null,++py.count}peek(){if(1===this.value.length&&!fy(this))return _y(this),this.value[0]}recompute(e){return ly(!this.recomputing,"already recomputing"),_y(this),fy(this)?function(e,t){return Iy(e),sy.withValue(e,my,[e,t]),function(e,t){if("function"==typeof e.subscribe)try{oy(e),e.unsubscribe=e.subscribe.apply(null,t)}catch(t){return e.setDirty(),!1}return!0}(e,t)&&function(e){e.dirty=!1,fy(e)||yy(e)}(e),uy(e.value)}(this,e):uy(this.value)}setDirty(){this.dirty||(this.dirty=!0,gy(this),oy(this))}dispose(){this.setDirty(),Iy(this),vy(this,((e,t)=>{e.setDirty(),Ty(e,this)}))}forget(){this.dispose()}dependOn(e){e.add(this),this.deps||(this.deps=ay.pop()||new Set),this.deps.add(e)}forgetDeps(){this.deps&&(ny(this.deps).forEach((e=>e.delete(this))),this.deps.clear(),ay.push(this.deps),this.deps=null)}}function _y(e){const t=sy.getValue();if(t)return e.parents.add(t),t.childValues.has(e)||t.childValues.set(e,[]),fy(e)?Oy(t,e):by(t,e),t}function my(e,t){e.recomputing=!0;const{normalizeResult:i}=e;let s;i&&1===e.value.length&&(s=hy(e.value)),e.value.length=0;try{if(e.value[0]=e.fn.apply(null,t),i&&s&&!dy(s,e.value))try{e.value[0]=i(e.value[0],s[0])}catch(e){}}catch(t){e.value[1]=t}e.recomputing=!1}function fy(e){return e.dirty||!(!e.dirtyChildren||!e.dirtyChildren.size)}function gy(e){vy(e,Oy)}function yy(e){vy(e,by)}function vy(e,t){const i=e.parents.size;if(i){const s=ny(e.parents);for(let r=0;r<i;++r)t(s[r],e)}}function Oy(e,t){ly(e.childValues.has(t)),ly(fy(t));const i=!fy(e);if(e.dirtyChildren){if(e.dirtyChildren.has(t))return}else e.dirtyChildren=ay.pop()||new Set;e.dirtyChildren.add(t),i&&gy(e)}function by(e,t){ly(e.childValues.has(t)),ly(!fy(t));const i=e.childValues.get(t);0===i.length?e.childValues.set(t,hy(t.value)):dy(i,t.value)||e.setDirty(),Ey(e,t),fy(e)||yy(e)}function Ey(e,t){const i=e.dirtyChildren;i&&(i.delete(t),0===i.size&&(ay.length<cy&&ay.push(i),e.dirtyChildren=null))}function Iy(e){e.childValues.size>0&&e.childValues.forEach(((t,i)=>{Ty(e,i)})),e.forgetDeps(),ly(null===e.dirtyChildren)}function Ty(e,t){t.parents.delete(e),e.childValues.delete(t),Ey(e,t)}py.count=0;const Sy={setDirty:!0,dispose:!0,forget:!0};function Ay(e){const t=new Map,i=e&&e.subscribe;function s(e){const s=sy.getValue();if(s){let r=t.get(e);r||t.set(e,r=new Set),s.dependOn(r),"function"==typeof i&&(oy(r),r.unsubscribe=i(e))}}return s.dirty=function(e,i){const s=t.get(e);if(s){const r=i&&ry.call(Sy,i)?i:"setDirty";ny(s).forEach((e=>e[r]())),t.delete(e),oy(s)}},s}let Py;function wy(...e){return(Py||(Py=new qg("function"==typeof WeakMap))).lookupArray(e)}const Cy=new Set;function Ry(e,{max:t=Math.pow(2,16),keyArgs:i,makeCacheKey:s=wy,normalizeResult:r,subscribe:n,cache:o=Zf}=Object.create(null)){const a="function"==typeof o?new o(t,(e=>e.dispose())):o,c=function(){const t=s.apply(null,i?i.apply(null,arguments):arguments);if(void 0===t)return e.apply(null,arguments);let o=a.get(t);o||(a.set(t,o=new py(e)),o.normalizeResult=r,o.subscribe=n,o.forget=()=>a.delete(t));const c=o.recompute(Array.prototype.slice.call(arguments));return a.set(t,o),Cy.add(a),sy.hasValue()||(Cy.forEach((e=>e.clean())),Cy.clear()),c};function l(e){const t=e&&a.get(e);t&&t.setDirty()}function d(e){const t=e&&a.get(e);if(t)return t.peek()}function u(e){return!!e&&a.delete(e)}return Object.defineProperty(c,"size",{get:()=>a.size,configurable:!1,enumerable:!1}),Object.freeze(c.options={max:t,keyArgs:i,makeCacheKey:s,normalizeResult:r,subscribe:n,cache:a}),c.dirtyKey=l,c.dirty=function(){l(s.apply(null,arguments))},c.peekKey=d,c.peek=function(){return d(s.apply(null,arguments))},c.forgetKey=u,c.forget=function(){return u(s.apply(null,arguments))},c.makeCacheKey=s,c.getKey=i?function(){return s.apply(null,i.apply(null,arguments))}:s,Object.freeze(c)}function Ly(e){return e}var Ny,Dy=function(){function e(e,t){void 0===t&&(t=Object.create(null)),this.resultCache=Gf?new WeakSet:new Set,this.transform=e,t.getCacheKey&&(this.getCacheKey=t.getCacheKey),this.cached=!1!==t.cache,this.resetCache()}return e.prototype.getCacheKey=function(e){return[e]},e.identity=function(){return new e(Ly,{cache:!1})},e.split=function(t,i,s){return void 0===s&&(s=e.identity()),Object.assign(new e((function(e){return(t(e)?i:s).transformDocument(e)}),{cache:!1}),{left:i,right:s})},e.prototype.resetCache=function(){var t=this;if(this.cached){var i=new Vf($f);this.performWork=Ry(e.prototype.performWork.bind(this),{makeCacheKey:function(e){var s=t.getCacheKey(e);if(s)return gm(Array.isArray(s),69),i.lookupArray(s)},max:ug["documentTransform.cache"],cache:ng})}},e.prototype.performWork=function(e){return Hg(e),this.transform(e)},e.prototype.transformDocument=function(e){if(this.resultCache.has(e))return e;var t=this.performWork(e);return this.resultCache.add(t),t},e.prototype.concat=function(t){var i=this;return Object.assign(new e((function(e){return t.transformDocument(i.transformDocument(e))}),{cache:!1}),{left:this,right:t})},e}(),My=Object.assign((function(e){var t=Ny.get(e);return t||(t=function(e){return Af(e,wf)}(e),Ny.set(e,t)),t}),{reset:function(){Ny=new cg(ug.print||2e3)}});My.reset(),!1!==globalThis.__DEV__&&pg("print",(function(){return Ny?Ny.size:0}));var xy=Array.isArray;function ky(e){return Array.isArray(e)&&e.length>0}var Hy={kind:Um.FIELD,name:{kind:Um.NAME,value:"__typename"}};function jy(e,t){return!e||e.selectionSet.selections.every((function(e){return e.kind===Um.FRAGMENT_SPREAD&&jy(t[e.name.value],t)}))}function Uy(e){return jy(jg(e)||function(e){gm("Document"===e.kind,81),gm(e.definitions.length<=1,82);var t=e.definitions[0];return gm("FragmentDefinition"===t.kind,83),t}(e),Qf(Bg(e)))?null:e}function By(e){var t=new Map;return function(i){void 0===i&&(i=e);var s=t.get(i);return s||t.set(i,s={variables:new Set,fragmentSpreads:new Set}),s}}function Fy(e,t){Hg(t);for(var i=By(""),s=By(""),r=function(e){for(var t=0,r=void 0;t<e.length&&(r=e[t]);++t)if(!xy(r)){if(r.kind===Um.OPERATION_DEFINITION)return i(r.name&&r.name.value);if(r.kind===Um.FRAGMENT_DEFINITION)return s(r.name.value)}return!1!==globalThis.__DEV__&&gm.error(86),null},n=0,o=t.definitions.length-1;o>=0;--o)t.definitions[o].kind===Um.OPERATION_DEFINITION&&++n;var a,c,l,d=(a=e,c=new Map,l=new Map,a.forEach((function(e){e&&(e.name?c.set(e.name,e):e.test&&l.set(e.test,e))})),function(e){var t=c.get(e.name.value);return!t&&l.size&&l.forEach((function(i,s){s(e)&&(t=i)})),t}),u=function(e){return ky(e)&&e.map(d).some((function(e){return e&&e.remove}))},h=new Map,p=!1,_={enter:function(e){if(u(e.directives))return p=!0,null}},m=Af(t,{Field:_,InlineFragment:_,VariableDefinition:{enter:function(){return!1}},Variable:{enter:function(e,t,i,s,n){var o=r(n);o&&o.variables.add(e.name.value)}},FragmentSpread:{enter:function(e,t,i,s,n){if(u(e.directives))return p=!0,null;var o=r(n);o&&o.fragmentSpreads.add(e.name.value)}},FragmentDefinition:{enter:function(e,t,i,s){h.set(JSON.stringify(s),e)},leave:function(e,t,i,r){return e===h.get(JSON.stringify(r))?e:n>0&&e.selectionSet.selections.every((function(e){return e.kind===Um.FIELD&&"__typename"===e.name.value}))?(s(e.name.value).removed=!0,p=!0,null):void 0}},Directive:{leave:function(e){if(d(e))return p=!0,null}}});if(!p)return t;var f=function(e){return e.transitiveVars||(e.transitiveVars=new Set(e.variables),e.removed||e.fragmentSpreads.forEach((function(t){f(s(t)).transitiveVars.forEach((function(t){e.transitiveVars.add(t)}))}))),e},g=new Set;m.definitions.forEach((function(e){e.kind===Um.OPERATION_DEFINITION?f(i(e.name&&e.name.value)).fragmentSpreads.forEach((function(e){g.add(e)})):e.kind!==Um.FRAGMENT_DEFINITION||0!==n||s(e.name.value).removed||g.add(e.name.value)})),g.forEach((function(e){f(s(e)).fragmentSpreads.forEach((function(e){g.add(e)}))}));var y={enter:function(e){if(t=e.name.value,!g.has(t)||s(t).removed)return null;var t}};return Uy(Af(m,{FragmentSpread:y,FragmentDefinition:y,OperationDefinition:{leave:function(e){if(e.variableDefinitions){var t=f(i(e.name&&e.name.value)).transitiveVars;if(t.size<e.variableDefinitions.length)return Y_(Y_({},e),{variableDefinitions:e.variableDefinitions.filter((function(e){return t.has(e.variable.name.value)}))})}}}}))}var Vy=Object.assign((function(e){return Af(e,{SelectionSet:{enter:function(e,t,i){if(!i||i.kind!==Um.OPERATION_DEFINITION){var s=e.selections;if(s&&!s.some((function(e){return kg(e)&&("__typename"===e.name.value||0===e.name.value.lastIndexOf("__",0))}))){var r=i;if(!(kg(r)&&r.directives&&r.directives.some((function(e){return"export"===e.name.value}))))return Y_(Y_({},e),{selections:Z_(Z_([],s,!0),[Hy],!1)})}}}}})}),{added:function(e){return e===Hy}});function Ky(e){return"query"===Vg(e).operation?e:Af(e,{OperationDefinition:{enter:function(e){return Y_(Y_({},e),{operation:"query"})}}})}function $y(e){return Hg(e),Fy([{test:function(e){return"client"===e.name.value},remove:!0}],e)}var Gy=Object.prototype.hasOwnProperty;function Wy(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zy(e)}function zy(e){var t=e[0]||{},i=e.length;if(i>1)for(var s=new Yy,r=1;r<i;++r)t=s.merge(t,e[r]);return t}var qy=function(e,t,i){return this.merge(e[i],t[i])},Yy=function(){function e(e){void 0===e&&(e=qy),this.reconciler=e,this.isObject=qf,this.pastCopies=new Set}return e.prototype.merge=function(e,t){for(var i=this,s=[],r=2;r<arguments.length;r++)s[r-2]=arguments[r];return qf(t)&&qf(e)?(Object.keys(t).forEach((function(r){if(Gy.call(e,r)){var n=e[r];if(t[r]!==n){var o=i.reconciler.apply(i,Z_([e,t,r],s,!1));o!==n&&((e=i.shallowCopyForMerge(e))[r]=o)}}else(e=i.shallowCopyForMerge(e))[r]=t[r]})),e):t},e.prototype.shallowCopyForMerge=function(e){return qf(e)&&(this.pastCopies.has(e)||(e=Array.isArray(e)?e.slice(0):Y_({__proto__:Object.getPrototypeOf(e)},e),this.pastCopies.add(e))),e},e}();function Qy(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function Jy(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function Xy(e,t,i){return t&&Jy(e.prototype,t),i&&Jy(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var Zy=function(){return"function"==typeof Symbol},ev=function(e){return Zy()&&Boolean(Symbol[e])},tv=function(e){return ev(e)?Symbol[e]:"@@"+e};Zy()&&!ev("observable")&&(Symbol.observable=Symbol("observable"));var iv=tv("iterator"),sv=tv("observable"),rv=tv("species");function nv(e,t){var i=e[t];if(null!=i){if("function"!=typeof i)throw new TypeError(i+" is not a function");return i}}function ov(e){var t=e.constructor;return void 0!==t&&null===(t=t[rv])&&(t=void 0),void 0!==t?t:fv}function av(e){return e instanceof fv}function cv(e){cv.log?cv.log(e):setTimeout((function(){throw e}))}function lv(e){Promise.resolve().then((function(){try{e()}catch(e){cv(e)}}))}function dv(e){var t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{var i=nv(t,"unsubscribe");i&&i.call(t)}}catch(e){cv(e)}}function uv(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function hv(e,t,i){e._state="running";var s=e._observer;try{var r=nv(s,t);switch(t){case"next":r&&r.call(s,i);break;case"error":if(uv(e),!r)throw i;r.call(s,i);break;case"complete":uv(e),r&&r.call(s)}}catch(e){cv(e)}"closed"===e._state?dv(e):"running"===e._state&&(e._state="ready")}function pv(e,t,i){if("closed"!==e._state){if("buffering"!==e._state)return"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:i}],void lv((function(){return function(e){var t=e._queue;if(t){e._queue=void 0,e._state="ready";for(var i=0;i<t.length&&(hv(e,t[i].type,t[i].value),"closed"!==e._state);++i);}}(e)}))):void hv(e,t,i);e._queue.push({type:t,value:i})}}var _v=function(){function e(e,t){this._cleanup=void 0,this._observer=e,this._queue=void 0,this._state="initializing";var i=new mv(this);try{this._cleanup=t.call(void 0,i)}catch(e){i.error(e)}"initializing"===this._state&&(this._state="ready")}return e.prototype.unsubscribe=function(){"closed"!==this._state&&(uv(this),dv(this))},Xy(e,[{key:"closed",get:function(){return"closed"===this._state}}]),e}(),mv=function(){function e(e){this._subscription=e}var t=e.prototype;return t.next=function(e){pv(this._subscription,"next",e)},t.error=function(e){pv(this._subscription,"error",e)},t.complete=function(){pv(this._subscription,"complete")},Xy(e,[{key:"closed",get:function(){return"closed"===this._subscription._state}}]),e}(),fv=function(){function e(t){if(!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}var t=e.prototype;return t.subscribe=function(e){return"object"==typeof e&&null!==e||(e={next:e,error:arguments[1],complete:arguments[2]}),new _v(e,this._subscriber)},t.forEach=function(e){var t=this;return new Promise((function(i,s){if("function"==typeof e)var r=t.subscribe({next:function(t){try{e(t,n)}catch(e){s(e),r.unsubscribe()}},error:s,complete:i});else s(new TypeError(e+" is not a function"));function n(){r.unsubscribe(),i()}}))},t.map=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(ov(this))((function(i){return t.subscribe({next:function(t){try{t=e(t)}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))},t.filter=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(ov(this))((function(i){return t.subscribe({next:function(t){try{if(!e(t))return}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))},t.reduce=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=ov(this),s=arguments.length>1,r=!1,n=arguments[1];return new i((function(i){return t.subscribe({next:function(t){var o=!r;if(r=!0,!o||s)try{n=e(n,t)}catch(e){return i.error(e)}else n=t},error:function(e){i.error(e)},complete:function(){if(!r&&!s)return i.error(new TypeError("Cannot reduce an empty sequence"));i.next(n),i.complete()}})}))},t.concat=function(){for(var e=this,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];var r=ov(this);return new r((function(t){var s,n=0;return function e(o){s=o.subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){n===i.length?(s=void 0,t.complete()):e(r.from(i[n++]))}})}(e),function(){s&&(s.unsubscribe(),s=void 0)}}))},t.flatMap=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=ov(this);return new i((function(s){var r=[],n=t.subscribe({next:function(t){if(e)try{t=e(t)}catch(e){return s.error(e)}var n=i.from(t).subscribe({next:function(e){s.next(e)},error:function(e){s.error(e)},complete:function(){var e=r.indexOf(n);e>=0&&r.splice(e,1),o()}});r.push(n)},error:function(e){s.error(e)},complete:function(){o()}});function o(){n.closed&&0===r.length&&s.complete()}return function(){r.forEach((function(e){return e.unsubscribe()})),n.unsubscribe()}}))},t[sv]=function(){return this},e.from=function(t){var i="function"==typeof this?this:e;if(null==t)throw new TypeError(t+" is not an object");var s=nv(t,sv);if(s){var r=s.call(t);if(Object(r)!==r)throw new TypeError(r+" is not an object");return av(r)&&r.constructor===i?r:new i((function(e){return r.subscribe(e)}))}if(ev("iterator")&&(s=nv(t,iv)))return new i((function(e){lv((function(){if(!e.closed){for(var i,r=function(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return Qy(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Qy(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(s.call(t));!(i=r()).done;){var n=i.value;if(e.next(n),e.closed)return}e.complete()}}))}));if(Array.isArray(t))return new i((function(e){lv((function(){if(!e.closed){for(var i=0;i<t.length;++i)if(e.next(t[i]),e.closed)return;e.complete()}}))}));throw new TypeError(t+" is not observable")},e.of=function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return new("function"==typeof this?this:e)((function(e){lv((function(){if(!e.closed){for(var t=0;t<i.length;++t)if(e.next(i[t]),e.closed)return;e.complete()}}))}))},Xy(e,null,[{key:rv,get:function(){return this}}]),e}();Zy()&&Object.defineProperty(fv,Symbol("extensions"),{value:{symbol:sv,hostReportError:cv},configurable:!0}),function(e){var t,i=("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()).Symbol;if("function"==typeof i)if(i.observable)t=i.observable;else{t="function"==typeof i.for?i.for("https://github.com/benlesh/symbol-observable"):i("https://github.com/benlesh/symbol-observable");try{i.observable=t}catch(e){}}else t="@@observable"}();var gv=fv.prototype,yv="@@observable";gv[yv]||(gv[yv]=function(){return this});var vv=Object.prototype.toString;function Ov(e){return bv(e)}function bv(e,t){switch(vv.call(e)){case"[object Array]":if((t=t||new Map).has(e))return t.get(e);var i=e.slice(0);return t.set(e,i),i.forEach((function(e,s){i[s]=bv(e,t)})),i;case"[object Object]":if((t=t||new Map).has(e))return t.get(e);var s=Object.create(Object.getPrototypeOf(e));return t.set(e,s),Object.keys(e).forEach((function(i){s[i]=bv(e[i],t)})),s;default:return e}}function Ev(e){return!1!==globalThis.__DEV__&&(t=e,(i=new Set([t])).forEach((function(e){qf(e)&&function(e){if(!1!==globalThis.__DEV__&&!Object.isFrozen(e))try{Object.freeze(e)}catch(e){if(e instanceof TypeError)return null;throw e}return e}(e)===e&&Object.getOwnPropertyNames(e).forEach((function(t){qf(e[t])&&i.add(e[t])}))}))),e;var t,i}function Iv(e,t,i){var s=[];e.forEach((function(e){return e[t]&&s.push(e)})),s.forEach((function(e){return e[t](i)}))}function Tv(e,t,i){return new fv((function(s){var r={then:function(e){return new Promise((function(t){return t(e())}))}};function n(e,t){return function(i){if(e){var n=function(){return s.closed?0:e(i)};r=r.then(n,n).then((function(e){return s.next(e)}),(function(e){return s.error(e)}))}else s[t](i)}}var o={next:n(t,"next"),error:n(i,"error"),complete:function(){r.then((function(){return s.complete()}))}},a=e.subscribe(o);return function(){return a.unsubscribe()}}))}function Sv(e){function t(t){Object.defineProperty(e,t,{value:fv})}return Wf&&Symbol.species&&t(Symbol.species),t("@@species"),e}function Av(e){return e&&"function"==typeof e.then}var Pv=function(e){function t(t){var i=e.call(this,(function(e){return i.addObserver(e),function(){return i.removeObserver(e)}}))||this;return i.observers=new Set,i.promise=new Promise((function(e,t){i.resolve=e,i.reject=t})),i.handlers={next:function(e){null!==i.sub&&(i.latest=["next",e],i.notify("next",e),Iv(i.observers,"next",e))},error:function(e){var t=i.sub;null!==t&&(t&&setTimeout((function(){return t.unsubscribe()})),i.sub=null,i.latest=["error",e],i.reject(e),i.notify("error",e),Iv(i.observers,"error",e))},complete:function(){var e=i,t=e.sub,s=e.sources;if(null!==t){var r=(void 0===s?[]:s).shift();r?Av(r)?r.then((function(e){return i.sub=e.subscribe(i.handlers)}),i.handlers.error):i.sub=r.subscribe(i.handlers):(t&&setTimeout((function(){return t.unsubscribe()})),i.sub=null,i.latest&&"next"===i.latest[0]?i.resolve(i.latest[1]):i.resolve(),i.notify("complete"),Iv(i.observers,"complete"))}}},i.nextResultListeners=new Set,i.cancel=function(e){i.reject(e),i.sources=[],i.handlers.error(e)},i.promise.catch((function(e){})),"function"==typeof t&&(t=[new fv(t)]),Av(t)?t.then((function(e){return i.start(e)}),i.handlers.error):i.start(t),i}return q_(t,e),t.prototype.start=function(e){void 0===this.sub&&(this.sources=Array.from(e),this.handlers.complete())},t.prototype.deliverLastMessage=function(e){if(this.latest){var t=this.latest[0],i=e[t];i&&i.call(e,this.latest[1]),null===this.sub&&"next"===t&&e.complete&&e.complete()}},t.prototype.addObserver=function(e){this.observers.has(e)||(this.deliverLastMessage(e),this.observers.add(e))},t.prototype.removeObserver=function(e){this.observers.delete(e)&&this.observers.size<1&&this.handlers.complete()},t.prototype.notify=function(e,t){var i=this.nextResultListeners;i.size&&(this.nextResultListeners=new Set,i.forEach((function(i){return i(e,t)})))},t.prototype.beforeNext=function(e){var t=!1;this.nextResultListeners.add((function(i,s){t||(t=!0,e(i,s))}))},t}(fv);function wv(e){return"incremental"in e}function Cv(e){return qf(e)&&"payload"in e}function Rv(e,t){var i=e,s=new Yy;return wv(t)&&ky(t.incremental)&&t.incremental.forEach((function(e){for(var t=e.data,r=e.path,n=r.length-1;n>=0;--n){var o=r[n],a=isNaN(+o)?{}:[];a[o]=t,t=a}i=s.merge(i,t)})),i}function Lv(e){return ky(Nv(e))}function Nv(e){var t=ky(e.errors)?e.errors.slice(0):[];return wv(e)&&ky(e.incremental)&&e.incremental.forEach((function(e){e.errors&&t.push.apply(t,e.errors)})),t}function Dv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Object.create(null);return e.forEach((function(e){e&&Object.keys(e).forEach((function(t){var s=e[t];void 0!==s&&(i[t]=s)}))})),i}function Mv(e,t){return Dv(e,t,t.variables&&{variables:Dv(Y_(Y_({},e&&e.variables),t.variables))})}function xv(e){return new fv((function(t){t.error(e)}))}Sv(Pv);var kv=function(e,t,i){var s=new Error(i);throw s.name="ServerError",s.response=e,s.statusCode=e.status,s.result=t,s};function Hv(e,t){return t?t(e):fv.of()}function jv(e){return"function"==typeof e?new Bv(e):e}function Uv(e){return e.request.length<=1}var Bv=function(){function e(e){e&&(this.request=e)}return e.empty=function(){return new e((function(){return fv.of()}))},e.from=function(t){return 0===t.length?e.empty():t.map(jv).reduce((function(e,t){return e.concat(t)}))},e.split=function(t,i,s){var r,n=jv(i),o=jv(s||new e(Hv));return r=Uv(n)&&Uv(o)?new e((function(e){return t(e)?n.request(e)||fv.of():o.request(e)||fv.of()})):new e((function(e,i){return t(e)?n.request(e,i)||fv.of():o.request(e,i)||fv.of()})),Object.assign(r,{left:n,right:o})},e.execute=function(e,t){return e.request(function(e,t){var i=Y_({},e);return Object.defineProperty(t,"setContext",{enumerable:!1,value:function(e){i=Y_(Y_({},i),"function"==typeof e?e(i):e)}}),Object.defineProperty(t,"getContext",{enumerable:!1,value:function(){return Y_({},i)}}),t}(t.context,function(e){var t={variables:e.variables||{},extensions:e.extensions||{},operationName:e.operationName,query:e.query};return t.operationName||(t.operationName="string"!=typeof t.query?Ug(t.query)||void 0:""),t}(function(e){for(var t=["query","operationName","variables","extensions","context"],i=0,s=Object.keys(e);i<s.length;i++){var r=s[i];if(t.indexOf(r)<0)throw ym(44,r)}return e}(t))))||fv.of()},e.concat=function(t,i){var s=jv(t);if(Uv(s))return!1!==globalThis.__DEV__&&gm.warn(36,s),s;var r,n=jv(i);return r=Uv(n)?new e((function(e){return s.request(e,(function(e){return n.request(e)||fv.of()}))||fv.of()})):new e((function(e,t){return s.request(e,(function(e){return n.request(e,t)||fv.of()}))||fv.of()})),Object.assign(r,{left:s,right:n})},e.prototype.split=function(t,i,s){return this.concat(e.split(t,i,s||new e(Hv)))},e.prototype.concat=function(t){return e.concat(this,t)},e.prototype.request=function(e,t){throw ym(37)},e.prototype.onError=function(e,t){if(t&&t.error)return t.error(e),!1;throw e},e.prototype.setOnError=function(e){return this.onError=e,this},e}(),Fv=Bv.from,Vv=Bv.execute;function Kv(e){var t={next:function(){return e.read()}};return zf&&(t[Symbol.asyncIterator]=function(){return this}),t}function $v(e){var t,i,s,r,n=e;if(e.body&&(n=e.body),r=n,zf&&r[Symbol.asyncIterator])return function(e){var t,i=e[Symbol.asyncIterator]();return(t={next:function(){return i.next()}})[Symbol.asyncIterator]=function(){return this},t}(n);if(function(e){return!!e.getReader}(n))return Kv(n.getReader());if(function(e){return!!e.stream}(n))return Kv(n.stream().getReader());if(function(e){return!!e.arrayBuffer}(n))return t=n.arrayBuffer(),i=!1,s={next:function(){return i?Promise.resolve({value:void 0,done:!0}):(i=!0,new Promise((function(e,i){t.then((function(t){e({value:t,done:!1})})).catch(i)})))}},zf&&(s[Symbol.asyncIterator]=function(){return this}),s;if(function(e){return!!e.pipe}(n))return function(e){var t=null,i=null,s=!1,r=[],n=[];function o(e){if(!i){if(n.length){var t=n.shift();if(Array.isArray(t)&&t[0])return t[0]({value:e,done:!1})}r.push(e)}}function a(e){i=e,n.slice().forEach((function(t){t[1](e)})),!t||t()}function c(){s=!0,n.slice().forEach((function(e){e[0]({value:void 0,done:!0})})),!t||t()}t=function(){t=null,e.removeListener("data",o),e.removeListener("error",a),e.removeListener("end",c),e.removeListener("finish",c),e.removeListener("close",c)},e.on("data",o),e.on("error",a),e.on("end",c),e.on("finish",c),e.on("close",c);var l={next:function(){return new Promise((function(e,t){return i?t(i):r.length?e({value:r.shift(),done:!1}):s?e({value:void 0,done:!0}):void n.push([e,t])}))}};return zf&&(l[Symbol.asyncIterator]=function(){return this}),l}(n);throw new Error("Unknown body type for responseIterator. Please pass a streamable response.")}var Gv=Symbol();function Wv(e){return e.hasOwnProperty("graphQLErrors")}var zv=function(e){function t(i){var s,r,n=i.graphQLErrors,o=i.protocolErrors,a=i.clientErrors,c=i.networkError,l=i.errorMessage,d=i.extraInfo,u=e.call(this,l)||this;return u.name="ApolloError",u.graphQLErrors=n||[],u.protocolErrors=o||[],u.clientErrors=a||[],u.networkError=c||null,u.message=l||(r=Z_(Z_(Z_([],(s=u).graphQLErrors,!0),s.clientErrors,!0),s.protocolErrors,!0),s.networkError&&r.push(s.networkError),r.map((function(e){return qf(e)&&e.message||"Error message not found."})).join("\n")),u.extraInfo=d,u.cause=Z_(Z_(Z_([c],n||[],!0),o||[],!0),a||[],!0).find((function(e){return!!e}))||null,u.__proto__=t.prototype,u}return q_(t,e),t}(Error),qv=Object.prototype.hasOwnProperty;function Yv(e){var t={};return e.split("\n").forEach((function(e){var i=e.indexOf(":");if(i>-1){var s=e.slice(0,i).trim().toLowerCase(),r=e.slice(i+1).trim();t[s]=r}})),t}function Qv(e,t){e.status>=300&&kv(e,function(){try{return JSON.parse(t)}catch(e){return t}}(),"Response not successful: Received status code ".concat(e.status));try{return JSON.parse(t)}catch(s){var i=s;throw i.name="ServerParseError",i.response=e,i.statusCode=e.status,i.bodyText=t,i}}var Jv=function(e,t){var i;try{i=JSON.stringify(e)}catch(e){var s=ym(40,t,e.message);throw s.parseError=e,s}return i},Xv={http:{includeQuery:!0,includeExtensions:!1,preserveHeaderCase:!1},headers:{accept:"*/*","content-type":"application/json"},options:{method:"POST"}},Zv=function(e,t){return t(e)};function eO(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var r={},n={};i.forEach((function(e){r=Y_(Y_(Y_({},r),e.options),{headers:Y_(Y_({},r.headers),e.headers)}),e.credentials&&(r.credentials=e.credentials),n=Y_(Y_({},n),e.http)})),r.headers&&(r.headers=function(e,t){if(!t){var i={};return Object.keys(Object(e)).forEach((function(t){i[t.toLowerCase()]=e[t]})),i}var s={};Object.keys(Object(e)).forEach((function(t){s[t.toLowerCase()]={originalName:t,value:e[t]}}));var r={};return Object.keys(s).forEach((function(e){r[s[e].originalName]=s[e].value})),r}(r.headers,n.preserveHeaderCase));var o=e.operationName,a=e.extensions,c=e.variables,l=e.query,d={operationName:o,variables:c};return n.includeExtensions&&(d.extensions=a),n.includeQuery&&(d.query=t(l,My)),{options:r,body:d}}var tO=um((function(){return fetch})),iO=function(e){function t(t){void 0===t&&(t={});var i=e.call(this,function(e){void 0===e&&(e={});var t=e.uri,i=void 0===t?"/graphql":t,s=e.fetch,r=e.print,n=void 0===r?Zv:r,o=e.includeExtensions,a=e.preserveHeaderCase,c=e.useGETForQueries,l=e.includeUnusedVariables,d=void 0!==l&&l,u=Q_(e,["uri","fetch","print","includeExtensions","preserveHeaderCase","useGETForQueries","includeUnusedVariables"]);!1!==globalThis.__DEV__&&function(e){if(!e&&"undefined"==typeof fetch)throw ym(38)}(s||tO);var h={http:{includeExtensions:o,preserveHeaderCase:a},options:u.fetchOptions,credentials:u.credentials,headers:u.headers};return new Bv((function(e){var t=function(e,t){return e.getContext().uri||("function"==typeof t?t(e):t||"/graphql")}(e,i),r=e.getContext(),o={};if(r.clientAwareness){var a=r.clientAwareness,l=a.name,u=a.version;l&&(o["apollographql-client-name"]=l),u&&(o["apollographql-client-version"]=u)}var p=Y_(Y_({},o),r.headers),_={http:r.http,options:r.fetchOptions,credentials:r.credentials,headers:p};if(kf(["client"],e.query)){var m=$y(e.query);if(!m)return xv(new Error("HttpLink: Trying to send a client-only query to the server. To send to the server, ensure a non-client field is added to the query or set the `transformOptions.removeClientFields` option to `true`."));e.query=m}var f,g=eO(e,n,Xv,h,_),y=g.options,v=g.body;v.variables&&!d&&(v.variables=function(e,t){var i=Y_({},e),s=new Set(Object.keys(e));return Af(t,{Variable:function(e,t,i){i&&"VariableDefinition"!==i.kind&&s.delete(e.name.value)}}),s.forEach((function(e){delete i[e]})),i}(v.variables,e.query)),y.signal||"undefined"==typeof AbortController||(f=new AbortController,y.signal=f.signal);var O,b="OperationDefinition"===(O=Vg(e.query)).kind&&"subscription"===O.operation,E=kf(["defer"],e.query);if(c&&!e.query.definitions.some((function(e){return"OperationDefinition"===e.kind&&"mutation"===e.operation}))&&(y.method="GET"),E||b){y.headers=y.headers||{};var I="multipart/mixed;";b&&E&&!1!==globalThis.__DEV__&&gm.warn(39),b?I+="boundary=graphql;subscriptionSpec=1.0,application/json":E&&(I+="deferSpec=20220824,application/json"),y.headers.accept=I}if("GET"===y.method){var T=function(e,t){var i=[],s=function(e,t){i.push("".concat(e,"=").concat(encodeURIComponent(t)))};if("query"in t&&s("query",t.query),t.operationName&&s("operationName",t.operationName),t.variables){var r=void 0;try{r=Jv(t.variables,"Variables map")}catch(e){return{parseError:e}}s("variables",r)}if(t.extensions){var n=void 0;try{n=Jv(t.extensions,"Extensions map")}catch(e){return{parseError:e}}s("extensions",n)}var o="",a=e,c=e.indexOf("#");-1!==c&&(o=e.substr(c),a=e.substr(0,c));var l=-1===a.indexOf("?")?"?":"&";return{newURI:a+l+i.join("&")+o}}(t,v),S=T.newURI,A=T.parseError;if(A)return xv(A);t=S}else try{y.body=Jv(v,"Payload")}catch(A){return xv(A)}return new fv((function(i){var r=s||um((function(){return fetch}))||tO,n=i.next.bind(i);return r(t,y).then((function(t){var i;e.setContext({response:t});var s,r=null===(i=t.headers)||void 0===i?void 0:i.get("content-type");return null!==r&&/^multipart\/mixed/i.test(r)?function(e,t){return J_(this,void 0,void 0,(function(){var i,s,r,n,o,a,c,l,d,u,h,p,_,m,f,g,y,v,O,b,E,I,T,S;return X_(this,(function(A){switch(A.label){case 0:if(void 0===TextDecoder)throw new Error("TextDecoder must be defined in the environment: please import a polyfill.");i=new TextDecoder("utf-8"),s=null===(S=e.headers)||void 0===S?void 0:S.get("content-type"),r="boundary=",n=(null==s?void 0:s.includes(r))?null==s?void 0:s.substring((null==s?void 0:s.indexOf(r))+9).replace(/['"]/g,"").replace(/\;(.*)/gm,"").trim():"-",o="\r\n--".concat(n),a="",c=$v(e),l=!0,A.label=1;case 1:return l?[4,c.next()]:[3,3];case 2:for(d=A.sent(),u=d.value,h=d.done,p="string"==typeof u?u:i.decode(u),_=a.length-o.length+1,l=!h,m=(a+=p).indexOf(o,_);m>-1;){if(f=void 0,I=[a.slice(0,m),a.slice(m+o.length)],a=I[1],g=(f=I[0]).indexOf("\r\n\r\n"),y=Yv(f.slice(0,g)),(v=y["content-type"])&&-1===v.toLowerCase().indexOf("application/json"))throw new Error("Unsupported patch content type: application/json is required.");if(O=f.slice(g))if(b=Qv(e,O),Object.keys(b).length>1||"data"in b||"incremental"in b||"errors"in b||"payload"in b)if(Cv(b)){if(E={},"payload"in b){if(1===Object.keys(b).length&&null===b.payload)return[2];E=Y_({},b.payload)}"errors"in b&&(E=Y_(Y_({},E),{extensions:Y_(Y_({},"extensions"in E?E.extensions:null),(T={},T[Gv]=b.errors,T))})),t(E)}else t(b);else if(1===Object.keys(b).length&&"hasNext"in b&&!b.hasNext)return[2];m=a.indexOf(o)}return[3,1];case 3:return[2]}}))}))}(t,n):(s=e,function(e){return e.text().then((function(t){return Qv(e,t)})).then((function(t){return Array.isArray(t)||qv.call(t,"data")||qv.call(t,"errors")||kv(e,t,"Server response was missing for query '".concat(Array.isArray(s)?s.map((function(e){return e.operationName})):s.operationName,"'.")),t}))})(t).then(n)})).then((function(){f=void 0,i.complete()})).catch((function(e){f=void 0,function(e,t){e.result&&e.result.errors&&e.result.data&&t.next(e.result),t.error(e)}(e,i)})),function(){f&&f.abort()}}))}))}(t).request)||this;return i.options=t,i}return q_(t,e),t}(Bv);const{toString:sO,hasOwnProperty:rO}=Object.prototype,nO=Function.prototype.toString,oO=new Map;function aO(e,t){try{return cO(e,t)}finally{oO.clear()}}function cO(e,t){if(e===t)return!0;const i=sO.call(e);if(i!==sO.call(t))return!1;switch(i){case"[object Array]":if(e.length!==t.length)return!1;case"[object Object]":{if(hO(e,t))return!0;const i=lO(e),s=lO(t),r=i.length;if(r!==s.length)return!1;for(let e=0;e<r;++e)if(!rO.call(t,i[e]))return!1;for(let s=0;s<r;++s){const r=i[s];if(!cO(e[r],t[r]))return!1}return!0}case"[object Error]":return e.name===t.name&&e.message===t.message;case"[object Number]":if(e!=e)return t!=t;case"[object Boolean]":case"[object Date]":return+e==+t;case"[object RegExp]":case"[object String]":return e==`${t}`;case"[object Map]":case"[object Set]":{if(e.size!==t.size)return!1;if(hO(e,t))return!0;const s=e.entries(),r="[object Map]"===i;for(;;){const e=s.next();if(e.done)break;const[i,n]=e.value;if(!t.has(i))return!1;if(r&&!cO(n,t.get(i)))return!1}return!0}case"[object Uint16Array]":case"[object Uint8Array]":case"[object Uint32Array]":case"[object Int32Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object ArrayBuffer]":e=new Uint8Array(e),t=new Uint8Array(t);case"[object DataView]":{let i=e.byteLength;if(i===t.byteLength)for(;i--&&e[i]===t[i];);return-1===i}case"[object AsyncFunction]":case"[object GeneratorFunction]":case"[object AsyncGeneratorFunction]":case"[object Function]":{const i=nO.call(e);return i===nO.call(t)&&!function(e,t){const i=e.length-t.length;return i>=0&&e.indexOf(t,i)===i}(i,uO)}}return!1}function lO(e){return Object.keys(e).filter(dO,e)}function dO(e){return void 0!==this[e]}const uO="{ [native code] }";function hO(e,t){let i=oO.get(e);if(i){if(i.has(t))return!0}else oO.set(e,i=new Set);return i.add(t),!1}function pO(e,t,i,s){var r=t.data,n=Q_(t,["data"]),o=i.data;return aO(n,Q_(i,["data"]))&&_O(Vg(e).selectionSet,r,o,{fragmentMap:Qf(Bg(e)),variables:s})}function _O(e,t,i,s){if(t===i)return!0;var r=new Set;return e.selections.every((function(e){if(r.has(e))return!0;if(r.add(e),!xf(e,s.variables))return!0;if(mO(e))return!0;if(kg(e)){var n=Mg(e),o=t&&t[n],a=i&&i[n],c=e.selectionSet;if(!c)return aO(o,a);var l=Array.isArray(o),d=Array.isArray(a);if(l!==d)return!1;if(l&&d){var u=o.length;if(a.length!==u)return!1;for(var h=0;h<u;++h)if(!_O(c,o[h],a[h],s))return!1;return!0}return _O(c,o,a,s)}var p=Jf(e,s.fragmentMap);return p?!!mO(p)||_O(p.selectionSet,t,i,s):void 0}))}function mO(e){return!!e.directives&&e.directives.some(fO)}function fO(e){return"nonreactive"===e.name.value}var gO=function(){function e(){this.assumeImmutableResults=!1,this.getFragmentDoc=Ry(Yf,{max:ug["cache.fragmentQueryDocuments"]||1e3,cache:ng})}return e.prototype.batch=function(e){var t,i=this,s="string"==typeof e.optimistic?e.optimistic:!1===e.optimistic?null:void 0;return this.performTransaction((function(){return t=e.update(i)}),s),t},e.prototype.recordOptimisticTransaction=function(e,t){this.performTransaction(e,t)},e.prototype.transformDocument=function(e){return e},e.prototype.transformForLink=function(e){return e},e.prototype.identify=function(e){},e.prototype.gc=function(){return[]},e.prototype.modify=function(e){return!1},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read(Y_(Y_({},e),{rootId:e.id||"ROOT_QUERY",optimistic:t}))},e.prototype.watchFragment=function(e){var t,i=this,s=e.fragment,r=e.fragmentName,n=e.from,o=e.optimistic,a=void 0===o||o,c=Q_(e,["fragment","fragmentName","from","optimistic"]),l=this.getFragmentDoc(s,r),d=Y_(Y_({},c),{returnPartialData:!0,id:void 0===n||"string"==typeof n?n:this.identify(n),query:l,optimistic:a});return new fv((function(e){return i.watch(Y_(Y_({},d),{immediate:!0,callback:function(i){if(!t||!pO(l,{data:null==t?void 0:t.result},{data:i.result})){var s={data:i.result,complete:!!i.complete};i.missing&&(s.missing=zy(i.missing.map((function(e){return e.missing})))),t=i,e.next(s)}}}))}))},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read(Y_(Y_({},e),{query:this.getFragmentDoc(e.fragment,e.fragmentName),rootId:e.id,optimistic:t}))},e.prototype.writeQuery=function(e){var t=e.id,i=e.data,s=Q_(e,["id","data"]);return this.write(Object.assign(s,{dataId:t||"ROOT_QUERY",result:i}))},e.prototype.writeFragment=function(e){var t=e.id,i=e.data,s=e.fragment,r=e.fragmentName,n=Q_(e,["id","data","fragment","fragmentName"]);return this.write(Object.assign(n,{query:this.getFragmentDoc(s,r),dataId:t,result:i}))},e.prototype.updateQuery=function(e,t){return this.batch({update:function(i){var s=i.readQuery(e),r=t(s);return null==r?s:(i.writeQuery(Y_(Y_({},e),{data:r})),r)}})},e.prototype.updateFragment=function(e,t){return this.batch({update:function(i){var s=i.readFragment(e),r=t(s);return null==r?s:(i.writeFragment(Y_(Y_({},e),{data:r})),r)}})},e}();!1!==globalThis.__DEV__&&(gO.prototype.getMemoryInternals=fg);var yO=function(e){function t(i,s,r,n){var o,a=e.call(this,i)||this;if(a.message=i,a.path=s,a.query=r,a.variables=n,Array.isArray(a.path)){a.missing=a.message;for(var c=a.path.length-1;c>=0;--c)a.missing=((o={})[a.path[c]]=a.missing,o)}else a.missing=a.path;return a.__proto__=t.prototype,a}return q_(t,e),t}(Error),vO=Object.prototype.hasOwnProperty;function OO(e){return null==e}function bO(e,t){var i=e.__typename,s=e.id,r=e._id;if("string"==typeof i&&(t&&(t.keyObject=OO(s)?OO(r)?void 0:{_id:r}:{id:s}),OO(s)&&!OO(r)&&(s=r),!OO(s)))return"".concat(i,":").concat("number"==typeof s||"string"==typeof s?s:JSON.stringify(s))}var EO={dataIdFromObject:bO,addTypename:!0,resultCaching:!0,canonizeResults:!1};function IO(e){var t=e.canonizeResults;return void 0===t?EO.canonizeResults:t}var TO=/^[_a-z][_0-9a-z]*/i;function SO(e){var t=e.match(TO);return t?t[0]:e}function AO(e,t,i){return!!qf(t)&&(xy(t)?t.every((function(t){return AO(e,t,i)})):e.selections.every((function(e){if(kg(e)&&xf(e,i)){var s=Mg(e);return vO.call(t,s)&&(!e.selectionSet||AO(e.selectionSet,t[s],i))}return!0})))}function PO(e){return qf(e)&&!wg(e)&&!xy(e)}function wO(e,t){var i=Qf(Bg(e));return{fragmentMap:i,lookupFragment:function(e){var s=i[e];return!s&&t&&(s=t.lookup(e)),s||null}}}var CO=Object.create(null),RO=function(){return CO},LO=Object.create(null),NO=function(){function e(e,t){var i=this;this.policies=e,this.group=t,this.data=Object.create(null),this.rootIds=Object.create(null),this.refs=Object.create(null),this.getFieldValue=function(e,t){return Ev(wg(e)?i.get(e.__ref,t):e&&e[t])},this.canRead=function(e){return wg(e)?i.has(e.__ref):"object"==typeof e},this.toReference=function(e,t){if("string"==typeof e)return Pg(e);if(wg(e))return e;var s=i.policies.identify(e)[0];if(s){var r=Pg(s);return t&&i.merge(s,e),r}}}return e.prototype.toObject=function(){return Y_({},this.data)},e.prototype.has=function(e){return void 0!==this.lookup(e,!0)},e.prototype.get=function(e,t){if(this.group.depend(e,t),vO.call(this.data,e)){var i=this.data[e];if(i&&vO.call(i,t))return i[t]}return"__typename"===t&&vO.call(this.policies.rootTypenamesById,e)?this.policies.rootTypenamesById[e]:this instanceof kO?this.parent.get(e,t):void 0},e.prototype.lookup=function(e,t){return t&&this.group.depend(e,"__exists"),vO.call(this.data,e)?this.data[e]:this instanceof kO?this.parent.lookup(e,t):this.policies.rootTypenamesById[e]?Object.create(null):void 0},e.prototype.merge=function(e,t){var i,s=this;wg(e)&&(e=e.__ref),wg(t)&&(t=t.__ref);var r="string"==typeof e?this.lookup(i=e):e,n="string"==typeof t?this.lookup(i=t):t;if(n){gm("string"==typeof i,1);var o=new Yy(jO).merge(r,n);if(this.data[i]=o,o!==r&&(delete this.refs[i],this.group.caching)){var a=Object.create(null);r||(a.__exists=1),Object.keys(n).forEach((function(e){if(!r||r[e]!==o[e]){a[e]=1;var t=SO(e);t===e||s.policies.hasKeyArgs(o.__typename,t)||(a[t]=1),void 0!==o[e]||s instanceof kO||delete o[e]}})),!a.__typename||r&&r.__typename||this.policies.rootTypenamesById[i]!==o.__typename||delete a.__typename,Object.keys(a).forEach((function(e){return s.group.dirty(i,e)}))}}},e.prototype.modify=function(e,t){var i=this,s=this.lookup(e);if(s){var r=Object.create(null),n=!1,o=!0,a={DELETE:CO,INVALIDATE:LO,isReference:wg,toReference:this.toReference,canRead:this.canRead,readField:function(t,s){return i.policies.readField("string"==typeof t?{fieldName:t,from:s||Pg(e)}:t,{store:i})}};if(Object.keys(s).forEach((function(c){var l=SO(c),d=s[c];if(void 0!==d){var u="function"==typeof t?t:t[c]||t[l];if(u){var h=u===RO?CO:u(Ev(d),Y_(Y_({},a),{fieldName:l,storeFieldName:c,storage:i.getStorage(e,c)}));if(h===LO)i.group.dirty(e,c);else if(h===CO&&(h=void 0),h!==d&&(r[c]=h,n=!0,d=h,!1!==globalThis.__DEV__)){var p=function(e){if(void 0===i.lookup(e.__ref))return!1!==globalThis.__DEV__&&gm.warn(2,e),!0};if(wg(h))p(h);else if(Array.isArray(h))for(var _=!1,m=void 0,f=0,g=h;f<g.length;f++){var y=g[f];if(wg(y)){if(_=!0,p(y))break}else"object"==typeof y&&y&&i.policies.identify(y)[0]&&(m=y);if(_&&void 0!==m){!1!==globalThis.__DEV__&&gm.warn(3,m);break}}}}void 0!==d&&(o=!1)}})),n)return this.merge(e,r),o&&(this instanceof kO?this.data[e]=void 0:delete this.data[e],this.group.dirty(e,"__exists")),!0}return!1},e.prototype.delete=function(e,t,i){var s,r=this.lookup(e);if(r){var n=this.getFieldValue(r,"__typename"),o=t&&i?this.policies.getStoreFieldName({typename:n,fieldName:t,args:i}):t;return this.modify(e,o?((s={})[o]=RO,s):RO)}return!1},e.prototype.evict=function(e,t){var i=!1;return e.id&&(vO.call(this.data,e.id)&&(i=this.delete(e.id,e.fieldName,e.args)),this instanceof kO&&this!==t&&(i=this.parent.evict(e,t)||i),(e.fieldName||i)&&this.group.dirty(e.id,e.fieldName||"__exists")),i},e.prototype.clear=function(){this.replace(null)},e.prototype.extract=function(){var e=this,t=this.toObject(),i=[];return this.getRootIdSet().forEach((function(t){vO.call(e.policies.rootTypenamesById,t)||i.push(t)})),i.length&&(t.__META={extraRootIds:i.sort()}),t},e.prototype.replace=function(e){var t=this;if(Object.keys(this.data).forEach((function(i){e&&vO.call(e,i)||t.delete(i)})),e){var i=e.__META,s=Q_(e,["__META"]);Object.keys(s).forEach((function(e){t.merge(e,s[e])})),i&&i.extraRootIds.forEach(this.retain,this)}},e.prototype.retain=function(e){return this.rootIds[e]=(this.rootIds[e]||0)+1},e.prototype.release=function(e){if(this.rootIds[e]>0){var t=--this.rootIds[e];return t||delete this.rootIds[e],t}return 0},e.prototype.getRootIdSet=function(e){return void 0===e&&(e=new Set),Object.keys(this.rootIds).forEach(e.add,e),this instanceof kO?this.parent.getRootIdSet(e):Object.keys(this.policies.rootTypenamesById).forEach(e.add,e),e},e.prototype.gc=function(){var e=this,t=this.getRootIdSet(),i=this.toObject();t.forEach((function(s){vO.call(i,s)&&(Object.keys(e.findChildRefIds(s)).forEach(t.add,t),delete i[s])}));var s=Object.keys(i);if(s.length){for(var r=this;r instanceof kO;)r=r.parent;s.forEach((function(e){return r.delete(e)}))}return s},e.prototype.findChildRefIds=function(e){if(!vO.call(this.refs,e)){var t=this.refs[e]=Object.create(null),i=this.data[e];if(!i)return t;var s=new Set([i]);s.forEach((function(e){wg(e)&&(t[e.__ref]=!0),qf(e)&&Object.keys(e).forEach((function(t){var i=e[t];qf(i)&&s.add(i)}))}))}return this.refs[e]},e.prototype.makeCacheKey=function(){return this.group.keyMaker.lookupArray(arguments)},e}(),DO=function(){function e(e,t){void 0===t&&(t=null),this.caching=e,this.parent=t,this.d=null,this.resetCaching()}return e.prototype.resetCaching=function(){this.d=this.caching?Ay():null,this.keyMaker=new Vf($f)},e.prototype.depend=function(e,t){if(this.d){this.d(MO(e,t));var i=SO(t);i!==t&&this.d(MO(e,i)),this.parent&&this.parent.depend(e,t)}},e.prototype.dirty=function(e,t){this.d&&this.d.dirty(MO(e,t),"__exists"===t?"forget":"setDirty")},e}();function MO(e,t){return t+"#"+e}function xO(e,t){UO(e)&&e.group.depend(t,"__exists")}!function(e){var t=function(e){function t(t){var i=t.policies,s=t.resultCaching,r=void 0===s||s,n=t.seed,o=e.call(this,i,new DO(r))||this;return o.stump=new HO(o),o.storageTrie=new Vf($f),n&&o.replace(n),o}return q_(t,e),t.prototype.addLayer=function(e,t){return this.stump.addLayer(e,t)},t.prototype.removeLayer=function(){return this},t.prototype.getStorage=function(){return this.storageTrie.lookupArray(arguments)},t}(e);e.Root=t}(NO||(NO={}));var kO=function(e){function t(t,i,s,r){var n=e.call(this,i.policies,r)||this;return n.id=t,n.parent=i,n.replay=s,n.group=r,s(n),n}return q_(t,e),t.prototype.addLayer=function(e,i){return new t(e,this,i,this.group)},t.prototype.removeLayer=function(e){var t=this,i=this.parent.removeLayer(e);return e===this.id?(this.group.caching&&Object.keys(this.data).forEach((function(e){var s=t.data[e],r=i.lookup(e);r?s?s!==r&&Object.keys(s).forEach((function(i){aO(s[i],r[i])||t.group.dirty(e,i)})):(t.group.dirty(e,"__exists"),Object.keys(r).forEach((function(i){t.group.dirty(e,i)}))):t.delete(e)})),i):i===this.parent?this:i.addLayer(this.id,this.replay)},t.prototype.toObject=function(){return Y_(Y_({},this.parent.toObject()),this.data)},t.prototype.findChildRefIds=function(t){var i=this.parent.findChildRefIds(t);return vO.call(this.data,t)?Y_(Y_({},i),e.prototype.findChildRefIds.call(this,t)):i},t.prototype.getStorage=function(){for(var e=this.parent;e.parent;)e=e.parent;return e.getStorage.apply(e,arguments)},t}(NO),HO=function(e){function t(t){return e.call(this,"EntityStore.Stump",t,(function(){}),new DO(t.group.caching,t.group))||this}return q_(t,e),t.prototype.removeLayer=function(){return this},t.prototype.merge=function(e,t){return this.parent.merge(e,t)},t}(kO);function jO(e,t,i){var s=e[i],r=t[i];return aO(s,r)?s:r}function UO(e){return!!(e instanceof NO&&e.group.caching)}var BO=function(){function e(){this.known=new(Gf?WeakSet:Set),this.pool=new Vf($f),this.passes=new WeakMap,this.keysByJSON=new Map,this.empty=this.admit({})}return e.prototype.isKnown=function(e){return qf(e)&&this.known.has(e)},e.prototype.pass=function(e){if(qf(e)){var t=function(e){return qf(e)?xy(e)?e.slice(0):Y_({__proto__:Object.getPrototypeOf(e)},e):e}(e);return this.passes.set(t,e),t}return e},e.prototype.admit=function(e){var t=this;if(qf(e)){var i=this.passes.get(e);if(i)return i;switch(Object.getPrototypeOf(e)){case Array.prototype:if(this.known.has(e))return e;var s=e.map(this.admit,this);return(a=this.pool.lookupArray(s)).array||(this.known.add(a.array=s),!1!==globalThis.__DEV__&&Object.freeze(s)),a.array;case null:case Object.prototype:if(this.known.has(e))return e;var r=Object.getPrototypeOf(e),n=[r],o=this.sortedKeys(e);n.push(o.json);var a,c=n.length;if(o.sorted.forEach((function(i){n.push(t.admit(e[i]))})),!(a=this.pool.lookupArray(n)).object){var l=a.object=Object.create(r);this.known.add(l),o.sorted.forEach((function(e,t){l[e]=n[c+t]})),!1!==globalThis.__DEV__&&Object.freeze(l)}return a.object}}return e},e.prototype.sortedKeys=function(e){var t=Object.keys(e),i=this.pool.lookupArray(t);if(!i.keys){t.sort();var s=JSON.stringify(t);(i.keys=this.keysByJSON.get(s))||this.keysByJSON.set(s,i.keys={sorted:t,json:s})}return i.keys},e}();function FO(e){return[e.selectionSet,e.objectOrReference,e.context,e.context.canonizeResults]}var VO=function(){function e(e){var t=this;this.knownResults=new($f?WeakMap:Map),this.config=Dv(e,{addTypename:!1!==e.addTypename,canonizeResults:IO(e)}),this.canon=e.canon||new BO,this.executeSelectionSet=Ry((function(e){var i,s=e.context.canonizeResults,r=FO(e);r[3]=!s;var n=(i=t.executeSelectionSet).peek.apply(i,r);return n?s?Y_(Y_({},n),{result:t.canon.admit(n.result)}):n:(xO(e.context.store,e.enclosingRef.__ref),t.execSelectionSetImpl(e))}),{max:this.config.resultCacheMaxSize||ug["inMemoryCache.executeSelectionSet"]||5e4,keyArgs:FO,makeCacheKey:function(e,t,i,s){if(UO(i.store))return i.store.makeCacheKey(e,wg(t)?t.__ref:t,i.varString,s)}}),this.executeSubSelectedArray=Ry((function(e){return xO(e.context.store,e.enclosingRef.__ref),t.execSubSelectedArrayImpl(e)}),{max:this.config.resultCacheMaxSize||ug["inMemoryCache.executeSubSelectedArray"]||1e4,makeCacheKey:function(e){var t=e.field,i=e.array,s=e.context;if(UO(s.store))return s.store.makeCacheKey(t,i,s.varString)}})}return e.prototype.resetCanon=function(){this.canon=new BO},e.prototype.diffQueryAgainstStore=function(e){var t=e.store,i=e.query,s=e.rootId,r=void 0===s?"ROOT_QUERY":s,n=e.variables,o=e.returnPartialData,a=void 0===o||o,c=e.canonizeResults,l=void 0===c?this.config.canonizeResults:c,d=this.config.cache.policies;n=Y_(Y_({},Kg(Fg(i))),n);var u,h=Pg(r),p=this.executeSelectionSet({selectionSet:Vg(i).selectionSet,objectOrReference:h,enclosingRef:h,context:Y_({store:t,query:i,policies:d,variables:n,varString:Tg(n),canonizeResults:l},wO(i,this.config.fragments))});if(p.missing&&(u=[new yO(KO(p.missing),p.missing,i,n)],!a))throw u[0];return{result:p.result,complete:!u,missing:u}},e.prototype.isFresh=function(e,t,i,s){if(UO(s.store)&&this.knownResults.get(e)===i){var r=this.executeSelectionSet.peek(i,t,s,this.canon.isKnown(e));if(r&&e===r.result)return!0}return!1},e.prototype.execSelectionSetImpl=function(e){var t=this,i=e.selectionSet,s=e.objectOrReference,r=e.enclosingRef,n=e.context;if(wg(s)&&!n.policies.rootTypenamesById[s.__ref]&&!n.store.has(s.__ref))return{result:this.canon.empty,missing:"Dangling reference to missing ".concat(s.__ref," object")};var o,a=n.variables,c=n.policies,l=n.store.getFieldValue(s,"__typename"),d=[],u=new Yy;function h(e,t){var i;return e.missing&&(o=u.merge(o,((i={})[t]=e.missing,i))),e.result}this.config.addTypename&&"string"==typeof l&&!c.rootIdsByTypename[l]&&d.push({__typename:l});var p=new Set(i.selections);p.forEach((function(e){var i,_;if(xf(e,a))if(kg(e)){var m=c.readField({fieldName:e.name.value,field:e,variables:n.variables,from:s},n),f=Mg(e);void 0===m?Vy.added(e)||(o=u.merge(o,((i={})[f]="Can't find field '".concat(e.name.value,"' on ").concat(wg(s)?s.__ref+" object":"object "+JSON.stringify(s,null,2)),i))):xy(m)?m.length>0&&(m=h(t.executeSubSelectedArray({field:e,array:m,enclosingRef:r,context:n}),f)):e.selectionSet?null!=m&&(m=h(t.executeSelectionSet({selectionSet:e.selectionSet,objectOrReference:m,enclosingRef:wg(m)?m:r,context:n}),f)):n.canonizeResults&&(m=t.canon.pass(m)),void 0!==m&&d.push(((_={})[f]=m,_))}else{var g=Jf(e,n.lookupFragment);if(!g&&e.kind===Um.FRAGMENT_SPREAD)throw ym(9,e.name.value);g&&c.fragmentMatches(g,l)&&g.selectionSet.selections.forEach(p.add,p)}}));var _={result:zy(d),missing:o},m=n.canonizeResults?this.canon.admit(_):Ev(_);return m.result&&this.knownResults.set(m.result,i),m},e.prototype.execSubSelectedArrayImpl=function(e){var t,i=this,s=e.field,r=e.array,n=e.enclosingRef,o=e.context,a=new Yy;function c(e,i){var s;return e.missing&&(t=a.merge(t,((s={})[i]=e.missing,s))),e.result}return s.selectionSet&&(r=r.filter(o.store.canRead)),r=r.map((function(e,t){return null===e?null:xy(e)?c(i.executeSubSelectedArray({field:s,array:e,enclosingRef:n,context:o}),t):s.selectionSet?c(i.executeSelectionSet({selectionSet:s.selectionSet,objectOrReference:e,enclosingRef:wg(e)?e:n,context:o}),t):(!1!==globalThis.__DEV__&&function(e,t,i){if(!t.selectionSet){var s=new Set([i]);s.forEach((function(i){qf(i)&&(gm(!wg(i),10,function(e,t){return wg(t)?e.get(t.__ref,"__typename"):t&&t.__typename}(e,i),t.name.value),Object.values(i).forEach(s.add,s))}))}}(o.store,s,e),e)})),{result:o.canonizeResults?this.canon.admit(r):r,missing:t}},e}();function KO(e){try{JSON.stringify(e,(function(e,t){if("string"==typeof t)throw t;return t}))}catch(e){return e}}var $O=new iy,GO=new WeakMap;function WO(e){var t=GO.get(e);return t||GO.set(e,t={vars:new Set,dep:Ay()}),t}function zO(e){WO(e).vars.forEach((function(t){return t.forgetCache(e)}))}function qO(e){var t=new Set,i=new Set,s=function(n){if(arguments.length>0){if(e!==n){e=n,t.forEach((function(e){WO(e).dep.dirty(s),function(e){e.broadcastWatches&&e.broadcastWatches()}(e)}));var o=Array.from(i);i.clear(),o.forEach((function(t){return t(e)}))}}else{var a=$O.getValue();a&&(r(a),WO(a).dep(s))}return e};s.onNextChange=function(e){return i.add(e),function(){i.delete(e)}};var r=s.attachCache=function(e){return t.add(e),WO(e).vars.add(s),s};return s.forgetCache=function(e){return t.delete(e)},s}var YO=Object.create(null);function QO(e){var t=JSON.stringify(e);return YO[t]||(YO[t]=Object.create(null))}function JO(e){var t=QO(e);return t.keyFieldsFn||(t.keyFieldsFn=function(t,i){var s=function(e,t){return i.readField(t,e)},r=i.keyObject=ZO(e,(function(e){var r=ib(i.storeObject,e,s);return void 0===r&&t!==i.storeObject&&vO.call(t,e[0])&&(r=ib(t,e,tb)),gm(void 0!==r,4,e.join("."),t),r}));return"".concat(i.typename,":").concat(JSON.stringify(r))})}function XO(e){var t=QO(e);return t.keyArgsFn||(t.keyArgsFn=function(t,i){var s=i.field,r=i.variables,n=i.fieldName,o=ZO(e,(function(e){var i=e[0],n=i.charAt(0);if("@"!==n)if("$"!==n){if(t)return ib(t,e)}else{var o=i.slice(1);if(r&&vO.call(r,o)){var a=e.slice(0);return a[0]=o,ib(r,a)}}else if(s&&ky(s.directives)){var c=i.slice(1),l=s.directives.find((function(e){return e.name.value===c})),d=l&&Dg(l,r);return d&&ib(d,e.slice(1))}})),a=JSON.stringify(o);return(t||"{}"!==a)&&(n+=":"+a),n})}function ZO(e,t){var i=new Yy;return eb(e).reduce((function(e,s){var r,n=t(s);if(void 0!==n){for(var o=s.length-1;o>=0;--o)(r={})[s[o]]=n,n=r;e=i.merge(e,n)}return e}),Object.create(null))}function eb(e){var t=QO(e);if(!t.paths){var i=t.paths=[],s=[];e.forEach((function(t,r){xy(t)?(eb(t).forEach((function(e){return i.push(s.concat(e))})),s.length=0):(s.push(t),xy(e[r+1])||(i.push(s.slice(0)),s.length=0))}))}return t.paths}function tb(e,t){return e[t]}function ib(e,t,i){return i=i||tb,sb(t.reduce((function e(t,s){return xy(t)?t.map((function(t){return e(t,s)})):t&&i(t,s)}),e))}function sb(e){return qf(e)?xy(e)?e.map(sb):ZO(Object.keys(e).sort(),(function(t){return ib(e,t)})):e}function rb(e){return void 0!==e.args?e.args:e.field?Dg(e.field,e.variables):null}var nb=function(){},ob=function(e,t){return t.fieldName},ab=function(e,t,i){return(0,i.mergeObjects)(e,t)},cb=function(e,t){return t},lb=function(){function e(e){this.config=e,this.typePolicies=Object.create(null),this.toBeAdded=Object.create(null),this.supertypeMap=new Map,this.fuzzySubtypes=new Map,this.rootIdsByTypename=Object.create(null),this.rootTypenamesById=Object.create(null),this.usingPossibleTypes=!1,this.config=Y_({dataIdFromObject:bO},e),this.cache=this.config.cache,this.setRootTypename("Query"),this.setRootTypename("Mutation"),this.setRootTypename("Subscription"),e.possibleTypes&&this.addPossibleTypes(e.possibleTypes),e.typePolicies&&this.addTypePolicies(e.typePolicies)}return e.prototype.identify=function(e,t){var i,s=this,r=t&&(t.typename||(null===(i=t.storeObject)||void 0===i?void 0:i.__typename))||e.__typename;if(r===this.rootTypenamesById.ROOT_QUERY)return["ROOT_QUERY"];for(var n,o=t&&t.storeObject||e,a=Y_(Y_({},t),{typename:r,storeObject:o,readField:t&&t.readField||function(){var e=ub(arguments,o);return s.readField(e,{store:s.cache.data,variables:e.variables})}}),c=r&&this.getTypePolicy(r),l=c&&c.keyFn||this.config.dataIdFromObject;l;){var d=l(Y_(Y_({},e),o),a);if(!xy(d)){n=d;break}l=JO(d)}return n=n?String(n):void 0,a.keyObject?[n,a.keyObject]:[n]},e.prototype.addTypePolicies=function(e){var t=this;Object.keys(e).forEach((function(i){var s=e[i],r=s.queryType,n=s.mutationType,o=s.subscriptionType,a=Q_(s,["queryType","mutationType","subscriptionType"]);r&&t.setRootTypename("Query",i),n&&t.setRootTypename("Mutation",i),o&&t.setRootTypename("Subscription",i),vO.call(t.toBeAdded,i)?t.toBeAdded[i].push(a):t.toBeAdded[i]=[a]}))},e.prototype.updateTypePolicy=function(e,t){var i=this,s=this.getTypePolicy(e),r=t.keyFields,n=t.fields;function o(e,t){e.merge="function"==typeof t?t:!0===t?ab:!1===t?cb:e.merge}o(s,t.merge),s.keyFn=!1===r?nb:xy(r)?JO(r):"function"==typeof r?r:s.keyFn,n&&Object.keys(n).forEach((function(t){var s=i.getFieldPolicy(e,t,!0),r=n[t];if("function"==typeof r)s.read=r;else{var a=r.keyArgs,c=r.read,l=r.merge;s.keyFn=!1===a?ob:xy(a)?XO(a):"function"==typeof a?a:s.keyFn,"function"==typeof c&&(s.read=c),o(s,l)}s.read&&s.merge&&(s.keyFn=s.keyFn||ob)}))},e.prototype.setRootTypename=function(e,t){void 0===t&&(t=e);var i="ROOT_"+e.toUpperCase(),s=this.rootTypenamesById[i];t!==s&&(gm(!s||s===e,5,e),s&&delete this.rootIdsByTypename[s],this.rootIdsByTypename[t]=i,this.rootTypenamesById[i]=t)},e.prototype.addPossibleTypes=function(e){var t=this;this.usingPossibleTypes=!0,Object.keys(e).forEach((function(i){t.getSupertypeSet(i,!0),e[i].forEach((function(e){t.getSupertypeSet(e,!0).add(i);var s=e.match(TO);s&&s[0]===e||t.fuzzySubtypes.set(e,new RegExp(e))}))}))},e.prototype.getTypePolicy=function(e){var t=this;if(!vO.call(this.typePolicies,e)){var i=this.typePolicies[e]=Object.create(null);i.fields=Object.create(null);var s=this.supertypeMap.get(e);!s&&this.fuzzySubtypes.size&&(s=this.getSupertypeSet(e,!0),this.fuzzySubtypes.forEach((function(i,r){if(i.test(e)){var n=t.supertypeMap.get(r);n&&n.forEach((function(e){return s.add(e)}))}}))),s&&s.size&&s.forEach((function(e){var s=t.getTypePolicy(e),r=s.fields,n=Q_(s,["fields"]);Object.assign(i,n),Object.assign(i.fields,r)}))}var r=this.toBeAdded[e];return r&&r.length&&r.splice(0).forEach((function(i){t.updateTypePolicy(e,i)})),this.typePolicies[e]},e.prototype.getFieldPolicy=function(e,t,i){if(e){var s=this.getTypePolicy(e).fields;return s[t]||i&&(s[t]=Object.create(null))}},e.prototype.getSupertypeSet=function(e,t){var i=this.supertypeMap.get(e);return!i&&t&&this.supertypeMap.set(e,i=new Set),i},e.prototype.fragmentMatches=function(e,t,i,s){var r=this;if(!e.typeCondition)return!0;if(!t)return!1;var n=e.typeCondition.name.value;if(t===n)return!0;if(this.usingPossibleTypes&&this.supertypeMap.has(n))for(var o=this.getSupertypeSet(t,!0),a=[o],c=function(e){var t=r.getSupertypeSet(e,!1);t&&t.size&&a.indexOf(t)<0&&a.push(t)},l=!(!i||!this.fuzzySubtypes.size),d=!1,u=0;u<a.length;++u){var h=a[u];if(h.has(n))return o.has(n)||(d&&!1!==globalThis.__DEV__&&gm.warn(6,t,n),o.add(n)),!0;h.forEach(c),l&&u===a.length-1&&AO(e.selectionSet,i,s)&&(l=!1,d=!0,this.fuzzySubtypes.forEach((function(e,i){var s=t.match(e);s&&s[0]===t&&c(i)})))}return!1},e.prototype.hasKeyArgs=function(e,t){var i=this.getFieldPolicy(e,t,!1);return!(!i||!i.keyFn)},e.prototype.getStoreFieldName=function(e){var t,i=e.typename,s=e.fieldName,r=this.getFieldPolicy(i,s,!1),n=r&&r.keyFn;if(n&&i)for(var o={typename:i,fieldName:s,field:e.field||null,variables:e.variables},a=rb(e);n;){var c=n(a,o);if(!xy(c)){t=c||s;break}n=XO(c)}return void 0===t&&(t=e.field?function(e,t){var i=null;e.directives&&(i={},e.directives.forEach((function(e){i[e.name.value]={},e.arguments&&e.arguments.forEach((function(s){var r=s.name,n=s.value;return Cg(i[e.name.value],r,n,t)}))})));var s=null;return e.arguments&&e.arguments.length&&(s={},e.arguments.forEach((function(e){var i=e.name,r=e.value;return Cg(s,i,r,t)}))),Ng(e.name.value,s,i)}(e.field,e.variables):Ng(s,rb(e))),!1===t?s:s===SO(t)?t:s+":"+t},e.prototype.readField=function(e,t){var i=e.from;if(i&&(e.field||e.fieldName)){if(void 0===e.typename){var s=t.store.getFieldValue(i,"__typename");s&&(e.typename=s)}var r=this.getStoreFieldName(e),n=SO(r),o=t.store.getFieldValue(i,r),a=this.getFieldPolicy(e.typename,n,!1),c=a&&a.read;if(c){var l=db(this,i,e,t,t.store.getStorage(wg(i)?i.__ref:i,r));return $O.withValue(this.cache,c,[o,l])}return o}},e.prototype.getReadFunction=function(e,t){var i=this.getFieldPolicy(e,t,!1);return i&&i.read},e.prototype.getMergeFunction=function(e,t,i){var s=this.getFieldPolicy(e,t,!1),r=s&&s.merge;return!r&&i&&(r=(s=this.getTypePolicy(i))&&s.merge),r},e.prototype.runMergeFunction=function(e,t,i,s,r){var n=i.field,o=i.typename,a=i.merge;return a===ab?hb(s.store)(e,t):a===cb?t:(s.overwrite&&(e=void 0),a(e,t,db(this,void 0,{typename:o,fieldName:n.name.value,field:n,variables:s.variables},s,r||Object.create(null))))},e}();function db(e,t,i,s,r){var n=e.getStoreFieldName(i),o=SO(n),a=i.variables||s.variables,c=s.store,l=c.toReference,d=c.canRead;return{args:rb(i),field:i.field||null,fieldName:o,storeFieldName:n,variables:a,isReference:wg,toReference:l,storage:r,cache:e.cache,canRead:d,readField:function(){return e.readField(ub(arguments,t,a),s)},mergeObjects:hb(s.store)}}function ub(e,t,i){var s,r=e[0],n=e[1],o=e.length;return"string"==typeof r?s={fieldName:r,from:o>1?n:t}:(s=Y_({},r),vO.call(s,"from")||(s.from=t)),!1!==globalThis.__DEV__&&void 0===s.from&&!1!==globalThis.__DEV__&&gm.warn(7,mm(Array.from(e))),void 0===s.variables&&(s.variables=i),s}function hb(e){return function(t,i){if(xy(t)||xy(i))throw ym(8);if(qf(t)&&qf(i)){var s=e.getFieldValue(t,"__typename"),r=e.getFieldValue(i,"__typename");if(s&&r&&s!==r)return i;if(wg(t)&&PO(i))return e.merge(t.__ref,i),t;if(PO(t)&&wg(i))return e.merge(t,i.__ref),i;if(PO(t)&&PO(i))return Y_(Y_({},t),i)}return i}}function pb(e,t,i){var s="".concat(t).concat(i),r=e.flavors.get(s);return r||e.flavors.set(s,r=e.clientOnly===t&&e.deferred===i?e:Y_(Y_({},e),{clientOnly:t,deferred:i})),r}var _b=function(){function e(e,t,i){this.cache=e,this.reader=t,this.fragments=i}return e.prototype.writeToStore=function(e,t){var i=this,s=t.query,r=t.result,n=t.dataId,o=t.variables,a=t.overwrite,c=jg(s),l=new Yy;o=Y_(Y_({},Kg(c)),o);var d=Y_(Y_({store:e,written:Object.create(null),merge:function(e,t){return l.merge(e,t)},variables:o,varString:Tg(o)},wO(s,this.fragments)),{overwrite:!!a,incomingById:new Map,clientOnly:!1,deferred:!1,flavors:new Map}),u=this.processSelectionSet({result:r||Object.create(null),dataId:n,selectionSet:c.selectionSet,mergeTree:{map:new Map},context:d});if(!wg(u))throw ym(11,r);return d.incomingById.forEach((function(t,s){var r=t.storeObject,n=t.mergeTree,o=t.fieldNodeSet,a=Pg(s);if(n&&n.map.size){var c=i.applyMerges(n,a,r,d);if(wg(c))return;r=c}if(!1!==globalThis.__DEV__&&!d.overwrite){var l=Object.create(null);o.forEach((function(e){e.selectionSet&&(l[e.name.value]=!0)})),Object.keys(r).forEach((function(e){(function(e){return!0===l[SO(e)]})(e)&&!function(e){var t=n&&n.map.get(e);return Boolean(t&&t.info&&t.info.merge)}(e)&&function(e,t,i,s){var r=function(e){var t=s.getFieldValue(e,i);return"object"==typeof t&&t},n=r(e);if(n){var o=r(t);if(o&&!wg(n)&&!aO(n,o)&&!Object.keys(n).every((function(e){return void 0!==s.getFieldValue(o,e)}))){var a=s.getFieldValue(e,"__typename")||s.getFieldValue(t,"__typename"),c=SO(i),l="".concat(a,".").concat(c);if(!bb.has(l)){bb.add(l);var d=[];xy(n)||xy(o)||[n,o].forEach((function(e){var t=s.getFieldValue(e,"__typename");"string"!=typeof t||d.includes(t)||d.push(t)})),!1!==globalThis.__DEV__&&gm.warn(14,c,a,d.length?"either ensure all objects of type "+d.join(" and ")+" have an ID or a custom merge function, or ":"",l,Y_({},n),Y_({},o))}}}}(a,r,e,d.store)}))}e.merge(s,r)})),e.retain(u.__ref),u},e.prototype.processSelectionSet=function(e){var t=this,i=e.dataId,s=e.result,r=e.selectionSet,n=e.context,o=e.mergeTree,a=this.cache.policies,c=Object.create(null),l=i&&a.rootTypenamesById[i]||xg(s,r,n.fragmentMap)||i&&n.store.get(i,"__typename");"string"==typeof l&&(c.__typename=l);var d=function(){var e=ub(arguments,c,n.variables);if(wg(e.from)){var t=n.incomingById.get(e.from.__ref);if(t){var i=a.readField(Y_(Y_({},e),{from:t.storeObject}),n);if(void 0!==i)return i}}return a.readField(e,n)},u=new Set;this.flattenFields(r,s,n,l).forEach((function(e,i){var r,n=Mg(i),h=s[n];if(u.add(i),void 0!==h){var p=a.getStoreFieldName({typename:l,fieldName:i.name.value,field:i,variables:e.variables}),_=fb(o,p),m=t.processFieldValue(h,i,i.selectionSet?pb(e,!1,!1):e,_),f=void 0;i.selectionSet&&(wg(m)||PO(m))&&(f=d("__typename",m));var g=a.getMergeFunction(l,i.name.value,f);g?_.info={field:i,typename:l,merge:g}:vb(o,p),c=e.merge(c,((r={})[p]=m,r))}else!1===globalThis.__DEV__||e.clientOnly||e.deferred||Vy.added(i)||a.getReadFunction(l,i.name.value)||!1!==globalThis.__DEV__&&gm.error(12,Mg(i),s)}));try{var h=a.identify(s,{typename:l,selectionSet:r,fragmentMap:n.fragmentMap,storeObject:c,readField:d}),p=h[0],_=h[1];i=i||p,_&&(c=n.merge(c,_))}catch(e){if(!i)throw e}if("string"==typeof i){var m=Pg(i),f=n.written[i]||(n.written[i]=[]);if(f.indexOf(r)>=0)return m;if(f.push(r),this.reader&&this.reader.isFresh(s,m,r,n))return m;var g=n.incomingById.get(i);return g?(g.storeObject=n.merge(g.storeObject,c),g.mergeTree=gb(g.mergeTree,o),u.forEach((function(e){return g.fieldNodeSet.add(e)}))):n.incomingById.set(i,{storeObject:c,mergeTree:yb(o)?void 0:o,fieldNodeSet:u}),m}return c},e.prototype.processFieldValue=function(e,t,i,s){var r=this;return t.selectionSet&&null!==e?xy(e)?e.map((function(e,n){var o=r.processFieldValue(e,t,i,fb(s,n));return vb(s,n),o})):this.processSelectionSet({result:e,selectionSet:t.selectionSet,context:i,mergeTree:s}):!1!==globalThis.__DEV__?Ov(e):e},e.prototype.flattenFields=function(e,t,i,s){void 0===s&&(s=xg(t,e,i.fragmentMap));var r=new Map,n=this.cache.policies,o=new Vf(!1);return function e(a,c){var l=o.lookup(a,c.clientOnly,c.deferred);l.visited||(l.visited=!0,a.selections.forEach((function(o){if(xf(o,i.variables)){var a=c.clientOnly,l=c.deferred;if(a&&l||!ky(o.directives)||o.directives.forEach((function(e){var t=e.name.value;if("client"===t&&(a=!0),"defer"===t){var s=Dg(e,i.variables);s&&!1===s.if||(l=!0)}})),kg(o)){var d=r.get(o);d&&(a=a&&d.clientOnly,l=l&&d.deferred),r.set(o,pb(i,a,l))}else{var u=Jf(o,i.lookupFragment);if(!u&&o.kind===Um.FRAGMENT_SPREAD)throw ym(13,o.name.value);u&&n.fragmentMatches(u,s,t,i.variables)&&e(u.selectionSet,pb(i,a,l))}}})))}(e,i),r},e.prototype.applyMerges=function(e,t,i,s,r){var n,o=this;if(e.map.size&&!wg(i)){var a,c=xy(i)||!wg(t)&&!PO(t)?void 0:t,l=i;c&&!r&&(r=[wg(c)?c.__ref:c]);var d=function(e,t){return xy(e)?"number"==typeof t?e[t]:void 0:s.store.getFieldValue(e,String(t))};e.map.forEach((function(e,t){var i=d(c,t),n=d(l,t);if(void 0!==n){r&&r.push(t);var u=o.applyMerges(e,i,n,s,r);u!==n&&(a=a||new Map).set(t,u),r&&gm(r.pop()===t)}})),a&&(i=xy(l)?l.slice(0):Y_({},l),a.forEach((function(e,t){i[t]=e})))}return e.info?this.cache.policies.runMergeFunction(t,i,e.info,s,r&&(n=s.store).getStorage.apply(n,r)):i},e}(),mb=[];function fb(e,t){var i=e.map;return i.has(t)||i.set(t,mb.pop()||{map:new Map}),i.get(t)}function gb(e,t){if(e===t||!t||yb(t))return e;if(!e||yb(e))return t;var i=e.info&&t.info?Y_(Y_({},e.info),t.info):e.info||t.info,s=e.map.size&&t.map.size,r={info:i,map:s?new Map:e.map.size?e.map:t.map};if(s){var n=new Set(t.map.keys());e.map.forEach((function(e,i){r.map.set(i,gb(e,t.map.get(i))),n.delete(i)})),n.forEach((function(i){r.map.set(i,gb(t.map.get(i),e.map.get(i)))}))}return r}function yb(e){return!e||!(e.info||e.map.size)}function vb(e,t){var i=e.map,s=i.get(t);s&&yb(s)&&(mb.push(s),i.delete(t))}var Ob,bb=new Set,Eb=function(e){function t(t){void 0===t&&(t={});var i=e.call(this)||this;return i.watches=new Set,i.addTypenameTransform=new Dy(Vy),i.assumeImmutableResults=!0,i.makeVar=qO,i.txCount=0,i.config=function(e){return Dv(EO,e)}(t),i.addTypename=!!i.config.addTypename,i.policies=new lb({cache:i,dataIdFromObject:i.config.dataIdFromObject,possibleTypes:i.config.possibleTypes,typePolicies:i.config.typePolicies}),i.init(),i}return q_(t,e),t.prototype.init=function(){var e=this.data=new NO.Root({policies:this.policies,resultCaching:this.config.resultCaching});this.optimisticData=e.stump,this.resetResultCache()},t.prototype.resetResultCache=function(e){var t=this,i=this.storeReader,s=this.config.fragments;this.storeWriter=new _b(this,this.storeReader=new VO({cache:this,addTypename:this.addTypename,resultCacheMaxSize:this.config.resultCacheMaxSize,canonizeResults:IO(this.config),canon:e?void 0:i&&i.canon,fragments:s}),s),this.maybeBroadcastWatch=Ry((function(e,i){return t.broadcastWatch(e,i)}),{max:this.config.resultCacheMaxSize||ug["inMemoryCache.maybeBroadcastWatch"]||5e3,makeCacheKey:function(e){var i=e.optimistic?t.optimisticData:t.data;if(UO(i)){var s=e.optimistic,r=e.id,n=e.variables;return i.makeCacheKey(e.query,e.callback,Tg({optimistic:s,id:r,variables:n}))}}}),new Set([this.data.group,this.optimisticData.group]).forEach((function(e){return e.resetCaching()}))},t.prototype.restore=function(e){return this.init(),e&&this.data.replace(e),this},t.prototype.extract=function(e){return void 0===e&&(e=!1),(e?this.optimisticData:this.data).extract()},t.prototype.read=function(e){var t=e.returnPartialData,i=void 0!==t&&t;try{return this.storeReader.diffQueryAgainstStore(Y_(Y_({},e),{store:e.optimistic?this.optimisticData:this.data,config:this.config,returnPartialData:i})).result||null}catch(e){if(e instanceof yO)return null;throw e}},t.prototype.write=function(e){try{return++this.txCount,this.storeWriter.writeToStore(this.data,e)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.modify=function(e){if(vO.call(e,"id")&&!e.id)return!1;var t=e.optimistic?this.optimisticData:this.data;try{return++this.txCount,t.modify(e.id||"ROOT_QUERY",e.fields)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.diff=function(e){return this.storeReader.diffQueryAgainstStore(Y_(Y_({},e),{store:e.optimistic?this.optimisticData:this.data,rootId:e.id||"ROOT_QUERY",config:this.config}))},t.prototype.watch=function(e){var t=this;return this.watches.size||function(e){WO(e).vars.forEach((function(t){return t.attachCache(e)}))}(this),this.watches.add(e),e.immediate&&this.maybeBroadcastWatch(e),function(){t.watches.delete(e)&&!t.watches.size&&zO(t),t.maybeBroadcastWatch.forget(e)}},t.prototype.gc=function(e){var t;Tg.reset(),My.reset(),this.addTypenameTransform.resetCache(),null===(t=this.config.fragments)||void 0===t||t.resetCaches();var i=this.optimisticData.gc();return e&&!this.txCount&&(e.resetResultCache?this.resetResultCache(e.resetResultIdentities):e.resetResultIdentities&&this.storeReader.resetCanon()),i},t.prototype.retain=function(e,t){return(t?this.optimisticData:this.data).retain(e)},t.prototype.release=function(e,t){return(t?this.optimisticData:this.data).release(e)},t.prototype.identify=function(e){if(wg(e))return e.__ref;try{return this.policies.identify(e)[0]}catch(e){!1!==globalThis.__DEV__&&gm.warn(e)}},t.prototype.evict=function(e){if(!e.id){if(vO.call(e,"id"))return!1;e=Y_(Y_({},e),{id:"ROOT_QUERY"})}try{return++this.txCount,this.optimisticData.evict(e,this.data)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.reset=function(e){var t=this;return this.init(),Tg.reset(),e&&e.discardWatches?(this.watches.forEach((function(e){return t.maybeBroadcastWatch.forget(e)})),this.watches.clear(),zO(this)):this.broadcastWatches(),Promise.resolve()},t.prototype.removeOptimistic=function(e){var t=this.optimisticData.removeLayer(e);t!==this.optimisticData&&(this.optimisticData=t,this.broadcastWatches())},t.prototype.batch=function(e){var t,i=this,s=e.update,r=e.optimistic,n=void 0===r||r,o=e.removeOptimistic,a=e.onWatchUpdated,c=function(e){var r=i,n=r.data,o=r.optimisticData;++i.txCount,e&&(i.data=i.optimisticData=e);try{return t=s(i)}finally{--i.txCount,i.data=n,i.optimisticData=o}},l=new Set;return a&&!this.txCount&&this.broadcastWatches(Y_(Y_({},e),{onWatchUpdated:function(e){return l.add(e),!1}})),"string"==typeof n?this.optimisticData=this.optimisticData.addLayer(n,c):!1===n?c(this.data):c(),"string"==typeof o&&(this.optimisticData=this.optimisticData.removeLayer(o)),a&&l.size?(this.broadcastWatches(Y_(Y_({},e),{onWatchUpdated:function(e,t){var i=a.call(this,e,t);return!1!==i&&l.delete(e),i}})),l.size&&l.forEach((function(e){return i.maybeBroadcastWatch.dirty(e)}))):this.broadcastWatches(e),t},t.prototype.performTransaction=function(e,t){return this.batch({update:e,optimistic:t||null!==t})},t.prototype.transformDocument=function(e){return this.addTypenameToDocument(this.addFragmentsToDocument(e))},t.prototype.broadcastWatches=function(e){var t=this;this.txCount||this.watches.forEach((function(i){return t.maybeBroadcastWatch(i,e)}))},t.prototype.addFragmentsToDocument=function(e){var t=this.config.fragments;return t?t.transform(e):e},t.prototype.addTypenameToDocument=function(e){return this.addTypename?this.addTypenameTransform.transformDocument(e):e},t.prototype.broadcastWatch=function(e,t){var i=e.lastDiff,s=this.diff(e);t&&(e.optimistic&&"string"==typeof t.optimistic&&(s.fromOptimisticTransaction=!0),t.onWatchUpdated&&!1===t.onWatchUpdated.call(this,e,s,i))||i&&aO(i.result,s.result)||e.callback(e.lastDiff=s,i)},t}(gO);function Ib(e){return!!e&&e<7}!1!==globalThis.__DEV__&&(Eb.prototype.getMemoryInternals=mg),function(e){e[e.loading=1]="loading",e[e.setVariables=2]="setVariables",e[e.fetchMore=3]="fetchMore",e[e.refetch=4]="refetch",e[e.poll=6]="poll",e[e.ready=7]="ready",e[e.error=8]="error"}(Ob||(Ob={}));var Tb=Object.assign,Sb=Object.hasOwnProperty,Ab=function(e){function t(t){var i=t.queryManager,s=t.queryInfo,r=t.options,n=e.call(this,(function(e){try{var t=e._subscription._observer;t&&!t.error&&(t.error=wb)}catch(e){}var i=!n.observers.size;n.observers.add(e);var s=n.last;return s&&s.error?e.error&&e.error(s.error):s&&s.result&&e.next&&e.next(s.result),i&&n.reobserve().catch((function(){})),function(){n.observers.delete(e)&&!n.observers.size&&n.tearDownQuery()}}))||this;n.observers=new Set,n.subscriptions=new Set,n.queryInfo=s,n.queryManager=i,n.waitForOwnResult=Rb(r.fetchPolicy),n.isTornDown=!1,n.subscribeToMore=n.subscribeToMore.bind(n);var o=i.defaultOptions.watchQuery,a=(void 0===o?{}:o).fetchPolicy,c=void 0===a?"cache-first":a,l=r.fetchPolicy,d=void 0===l?c:l,u=r.initialFetchPolicy,h=void 0===u?"standby"===d?c:d:u;n.options=Y_(Y_({},r),{initialFetchPolicy:h,fetchPolicy:d}),n.queryId=s.queryId||i.generateQueryId();var p=jg(n.query);return n.queryName=p&&p.name&&p.name.value,n}return q_(t,e),Object.defineProperty(t.prototype,"query",{get:function(){return this.lastQuery||this.options.query},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"variables",{get:function(){return this.options.variables},enumerable:!1,configurable:!0}),t.prototype.result=function(){var e=this;return new Promise((function(t,i){var s={next:function(i){t(i),e.observers.delete(s),e.observers.size||e.queryManager.removeQuery(e.queryId),setTimeout((function(){r.unsubscribe()}),0)},error:i},r=e.subscribe(s)}))},t.prototype.resetDiff=function(){this.queryInfo.resetDiff()},t.prototype.getCurrentResult=function(e){void 0===e&&(e=!0);var t=this.getLastResult(!0),i=this.queryInfo.networkStatus||t&&t.networkStatus||Ob.ready,s=Y_(Y_({},t),{loading:Ib(i),networkStatus:i}),r=this.options.fetchPolicy,n=void 0===r?"cache-first":r;if(Rb(n)||this.queryManager.getDocumentInfo(this.query).hasForcedResolvers);else if(this.waitForOwnResult)this.queryInfo.updateWatch();else{var o=this.queryInfo.getDiff();(o.complete||this.options.returnPartialData)&&(s.data=o.result),aO(s.data,{})&&(s.data=void 0),o.complete?(delete s.partial,!o.complete||s.networkStatus!==Ob.loading||"cache-first"!==n&&"cache-only"!==n||(s.networkStatus=Ob.ready,s.loading=!1)):s.partial=!0,!1===globalThis.__DEV__||o.complete||this.options.partialRefetch||s.loading||s.data||s.error||Cb(o.missing)}return e&&this.updateLastResult(s),s},t.prototype.isDifferentFromLastResult=function(e,t){return!this.last||(this.queryManager.getDocumentInfo(this.query).hasNonreactiveDirective?!pO(this.query,this.last.result,e,this.variables):!aO(this.last.result,e))||t&&!aO(this.last.variables,t)},t.prototype.getLast=function(e,t){var i=this.last;if(i&&i[e]&&(!t||aO(i.variables,this.variables)))return i[e]},t.prototype.getLastResult=function(e){return this.getLast("result",e)},t.prototype.getLastError=function(e){return this.getLast("error",e)},t.prototype.resetLastResults=function(){delete this.last,this.isTornDown=!1},t.prototype.resetQueryStoreErrors=function(){this.queryManager.resetErrors(this.queryId)},t.prototype.refetch=function(e){var t,i={pollInterval:0},s=this.options.fetchPolicy;if(i.fetchPolicy="cache-and-network"===s?s:"no-cache"===s?"no-cache":"network-only",!1!==globalThis.__DEV__&&e&&Sb.call(e,"variables")){var r=Fg(this.query),n=r.variableDefinitions;n&&n.some((function(e){return"variables"===e.variable.name.value}))||!1!==globalThis.__DEV__&&gm.warn(20,e,(null===(t=r.name)||void 0===t?void 0:t.value)||r)}return e&&!aO(this.options.variables,e)&&(i.variables=this.options.variables=Y_(Y_({},this.options.variables),e)),this.queryInfo.resetLastWrite(),this.reobserve(i,Ob.refetch)},t.prototype.fetchMore=function(e){var t=this,i=Y_(Y_({},e.query?e:Y_(Y_(Y_(Y_({},this.options),{query:this.options.query}),e),{variables:Y_(Y_({},this.options.variables),e.variables)})),{fetchPolicy:"no-cache"});i.query=this.transformDocument(i.query);var s=this.queryManager.generateQueryId();this.lastQuery=e.query?this.transformDocument(this.options.query):i.query;var r=this.queryInfo,n=r.networkStatus;r.networkStatus=Ob.fetchMore,i.notifyOnNetworkStatusChange&&this.observe();var o=new Set,a=null==e?void 0:e.updateQuery,c="no-cache"!==this.options.fetchPolicy;return c||gm(a,21),this.queryManager.fetchQuery(s,i,Ob.fetchMore).then((function(l){if(t.queryManager.removeQuery(s),r.networkStatus===Ob.fetchMore&&(r.networkStatus=n),c)t.queryManager.cache.batch({update:function(s){var r=e.updateQuery;r?s.updateQuery({query:t.query,variables:t.variables,returnPartialData:!0,optimistic:!1},(function(e){return r(e,{fetchMoreResult:l.data,variables:i.variables})})):s.writeQuery({query:i.query,variables:i.variables,data:l.data})},onWatchUpdated:function(e){o.add(e.query)}});else{var d=t.getLast("result"),u=a(d.data,{fetchMoreResult:l.data,variables:i.variables});t.reportResult(Y_(Y_({},d),{data:u}),t.variables)}return l})).finally((function(){c&&!o.has(t.query)&&Pb(t)}))},t.prototype.subscribeToMore=function(e){var t=this,i=this.queryManager.startGraphQLSubscription({query:e.document,variables:e.variables,context:e.context}).subscribe({next:function(i){var s=e.updateQuery;s&&t.updateQuery((function(e,t){var r=t.variables;return s(e,{subscriptionData:i,variables:r})}))},error:function(t){e.onError?e.onError(t):!1!==globalThis.__DEV__&&gm.error(22,t)}});return this.subscriptions.add(i),function(){t.subscriptions.delete(i)&&i.unsubscribe()}},t.prototype.setOptions=function(e){return this.reobserve(e)},t.prototype.silentSetOptions=function(e){var t=Dv(this.options,e||{});Tb(this.options,t)},t.prototype.setVariables=function(e){return aO(this.variables,e)?this.observers.size?this.result():Promise.resolve():(this.options.variables=e,this.observers.size?this.reobserve({fetchPolicy:this.options.initialFetchPolicy,variables:e},Ob.setVariables):Promise.resolve())},t.prototype.updateQuery=function(e){var t=this.queryManager,i=e(t.cache.diff({query:this.options.query,variables:this.variables,returnPartialData:!0,optimistic:!1}).result,{variables:this.variables});i&&(t.cache.writeQuery({query:this.options.query,data:i,variables:this.variables}),t.broadcastQueries())},t.prototype.startPolling=function(e){this.options.pollInterval=e,this.updatePolling()},t.prototype.stopPolling=function(){this.options.pollInterval=0,this.updatePolling()},t.prototype.applyNextFetchPolicy=function(e,t){if(t.nextFetchPolicy){var i=t.fetchPolicy,s=void 0===i?"cache-first":i,r=t.initialFetchPolicy,n=void 0===r?s:r;"standby"===s||("function"==typeof t.nextFetchPolicy?t.fetchPolicy=t.nextFetchPolicy(s,{reason:e,options:t,observable:this,initialFetchPolicy:n}):t.fetchPolicy="variables-changed"===e?n:t.nextFetchPolicy)}return t.fetchPolicy},t.prototype.fetch=function(e,t,i){return this.queryManager.setObservableQuery(this),this.queryManager.fetchConcastWithInfo(this.queryId,e,t,i)},t.prototype.updatePolling=function(){var e=this;if(!this.queryManager.ssrMode){var t=this.pollingInfo,i=this.options.pollInterval;if(i&&this.hasObservers()){if(!t||t.interval!==i){gm(i,23),(t||(this.pollingInfo={})).interval=i;var s=function(){var t,i;e.pollingInfo&&(Ib(e.queryInfo.networkStatus)||(null===(i=(t=e.options).skipPollAttempt)||void 0===i?void 0:i.call(t))?r():e.reobserve({fetchPolicy:"no-cache"===e.options.initialFetchPolicy?"no-cache":"network-only"},Ob.poll).then(r,r))},r=function(){var t=e.pollingInfo;t&&(clearTimeout(t.timeout),t.timeout=setTimeout(s,t.interval))};r()}}else t&&(clearTimeout(t.timeout),delete this.pollingInfo)}},t.prototype.updateLastResult=function(e,t){void 0===t&&(t=this.variables);var i=this.getLastError();return i&&this.last&&!aO(t,this.last.variables)&&(i=void 0),this.last=Y_({result:this.queryManager.assumeImmutableResults?e:Ov(e),variables:t},i?{error:i}:null)},t.prototype.reobserveAsConcast=function(e,t){var i=this;this.isTornDown=!1;var s=t===Ob.refetch||t===Ob.fetchMore||t===Ob.poll,r=this.options.variables,n=this.options.fetchPolicy,o=Dv(this.options,e||{}),a=s?o:Tb(this.options,o),c=this.transformDocument(a.query);this.lastQuery=c,s||(this.updatePolling(),!e||!e.variables||aO(e.variables,r)||"standby"===a.fetchPolicy||a.fetchPolicy!==n&&"function"!=typeof a.nextFetchPolicy||(this.applyNextFetchPolicy("variables-changed",a),void 0===t&&(t=Ob.setVariables))),this.waitForOwnResult&&(this.waitForOwnResult=Rb(a.fetchPolicy));var l=function(){i.concast===h&&(i.waitForOwnResult=!1)},d=a.variables&&Y_({},a.variables),u=this.fetch(a,t,c),h=u.concast,p=u.fromLink,_={next:function(e){aO(i.variables,d)&&(l(),i.reportResult(e,d))},error:function(e){aO(i.variables,d)&&(Wv(e)||(e=new zv({networkError:e})),l(),i.reportError(e,d))}};return s||!p&&this.concast||(this.concast&&this.observer&&this.concast.removeObserver(this.observer),this.concast=h,this.observer=_),h.addObserver(_),h},t.prototype.reobserve=function(e,t){return this.reobserveAsConcast(e,t).promise},t.prototype.resubscribeAfterError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this.last;this.resetLastResults();var s=this.subscribe.apply(this,e);return this.last=i,s},t.prototype.observe=function(){this.reportResult(this.getCurrentResult(!1),this.variables)},t.prototype.reportResult=function(e,t){var i=this.getLastError(),s=this.isDifferentFromLastResult(e,t);(i||!e.partial||this.options.returnPartialData)&&this.updateLastResult(e,t),(i||s)&&Iv(this.observers,"next",e)},t.prototype.reportError=function(e,t){var i=Y_(Y_({},this.getLastResult()),{error:e,errors:e.graphQLErrors,networkStatus:Ob.error,loading:!1});this.updateLastResult(i,t),Iv(this.observers,"error",this.last.error=e)},t.prototype.hasObservers=function(){return this.observers.size>0},t.prototype.tearDownQuery=function(){this.isTornDown||(this.concast&&this.observer&&(this.concast.removeObserver(this.observer),delete this.concast,delete this.observer),this.stopPolling(),this.subscriptions.forEach((function(e){return e.unsubscribe()})),this.subscriptions.clear(),this.queryManager.stopQuery(this.queryId),this.observers.clear(),this.isTornDown=!0)},t.prototype.transformDocument=function(e){return this.queryManager.transform(e)},t}(fv);function Pb(e){var t=e.options,i=t.fetchPolicy,s=t.nextFetchPolicy;return"cache-and-network"===i||"network-only"===i?e.reobserve({fetchPolicy:"cache-first",nextFetchPolicy:function(e,t){return this.nextFetchPolicy=s,"function"==typeof this.nextFetchPolicy?this.nextFetchPolicy(e,t):i}}):e.reobserve()}function wb(e){!1!==globalThis.__DEV__&&gm.error(24,e.message,e.stack)}function Cb(e){!1!==globalThis.__DEV__&&e&&!1!==globalThis.__DEV__&&gm.debug(25,e)}function Rb(e){return"network-only"===e||"no-cache"===e||"standby"===e}Sv(Ab);var Lb=new($f?WeakMap:Map);function Nb(e,t){var i=e[t];"function"==typeof i&&(e[t]=function(){return Lb.set(e,(Lb.get(e)+1)%1e15),i.apply(this,arguments)})}function Db(e){e.notifyTimeout&&(clearTimeout(e.notifyTimeout),e.notifyTimeout=void 0)}var Mb=function(){function e(e,t){void 0===t&&(t=e.generateQueryId()),this.queryId=t,this.listeners=new Set,this.document=null,this.lastRequestId=1,this.stopped=!1,this.dirty=!1,this.observableQuery=null;var i=this.cache=e.cache;Lb.has(i)||(Lb.set(i,0),Nb(i,"evict"),Nb(i,"modify"),Nb(i,"reset"))}return e.prototype.init=function(e){var t=e.networkStatus||Ob.loading;return this.variables&&this.networkStatus!==Ob.loading&&!aO(this.variables,e.variables)&&(t=Ob.setVariables),aO(e.variables,this.variables)||(this.lastDiff=void 0),Object.assign(this,{document:e.document,variables:e.variables,networkError:null,graphQLErrors:this.graphQLErrors||[],networkStatus:t}),e.observableQuery&&this.setObservableQuery(e.observableQuery),e.lastRequestId&&(this.lastRequestId=e.lastRequestId),this},e.prototype.reset=function(){Db(this),this.dirty=!1},e.prototype.resetDiff=function(){this.lastDiff=void 0},e.prototype.getDiff=function(){var e=this.getDiffOptions();if(this.lastDiff&&aO(e,this.lastDiff.options))return this.lastDiff.diff;this.updateWatch(this.variables);var t=this.observableQuery;if(t&&"no-cache"===t.options.fetchPolicy)return{complete:!1};var i=this.cache.diff(e);return this.updateLastDiff(i,e),i},e.prototype.updateLastDiff=function(e,t){this.lastDiff=e?{diff:e,options:t||this.getDiffOptions()}:void 0},e.prototype.getDiffOptions=function(e){var t;return void 0===e&&(e=this.variables),{query:this.document,variables:e,returnPartialData:!0,optimistic:!0,canonizeResults:null===(t=this.observableQuery)||void 0===t?void 0:t.options.canonizeResults}},e.prototype.setDiff=function(e){var t,i=this,s=this.lastDiff&&this.lastDiff.diff;e&&!e.complete&&(null===(t=this.observableQuery)||void 0===t?void 0:t.getLastError())||(this.updateLastDiff(e),this.dirty||aO(s&&s.result,e&&e.result)||(this.dirty=!0,this.notifyTimeout||(this.notifyTimeout=setTimeout((function(){return i.notify()}),0))))},e.prototype.setObservableQuery=function(e){var t=this;e!==this.observableQuery&&(this.oqListener&&this.listeners.delete(this.oqListener),this.observableQuery=e,e?(e.queryInfo=this,this.listeners.add(this.oqListener=function(){t.getDiff().fromOptimisticTransaction?e.observe():Pb(e)})):delete this.oqListener)},e.prototype.notify=function(){var e=this;Db(this),this.shouldNotify()&&this.listeners.forEach((function(t){return t(e)})),this.dirty=!1},e.prototype.shouldNotify=function(){if(!this.dirty||!this.listeners.size)return!1;if(Ib(this.networkStatus)&&this.observableQuery){var e=this.observableQuery.options.fetchPolicy;if("cache-only"!==e&&"cache-and-network"!==e)return!1}return!0},e.prototype.stop=function(){if(!this.stopped){this.stopped=!0,this.reset(),this.cancel(),this.cancel=e.prototype.cancel;var t=this.observableQuery;t&&t.stopPolling()}},e.prototype.cancel=function(){},e.prototype.updateWatch=function(e){var t=this;void 0===e&&(e=this.variables);var i=this.observableQuery;if(!i||"no-cache"!==i.options.fetchPolicy){var s=Y_(Y_({},this.getDiffOptions(e)),{watcher:this,callback:function(e){return t.setDiff(e)}});this.lastWatch&&aO(s,this.lastWatch)||(this.cancel(),this.cancel=this.cache.watch(this.lastWatch=s))}},e.prototype.resetLastWrite=function(){this.lastWrite=void 0},e.prototype.shouldWrite=function(e,t){var i=this.lastWrite;return!(i&&i.dmCount===Lb.get(this.cache)&&aO(t,i.variables)&&aO(e.data,i.result.data))},e.prototype.markResult=function(e,t,i,s){var r=this,n=new Yy,o=ky(e.errors)?e.errors.slice(0):[];if(this.reset(),"incremental"in e&&ky(e.incremental)){var a=Rv(this.getDiff().result,e);e.data=a}else if("hasNext"in e&&e.hasNext){var c=this.getDiff();e.data=n.merge(c.result,e.data)}this.graphQLErrors=o,"no-cache"===i.fetchPolicy?this.updateLastDiff({result:e.data,complete:!0},this.getDiffOptions(i.variables)):0!==s&&(xb(e,i.errorPolicy)?this.cache.performTransaction((function(n){if(r.shouldWrite(e,i.variables))n.writeQuery({query:t,data:e.data,variables:i.variables,overwrite:1===s}),r.lastWrite={result:e,variables:i.variables,dmCount:Lb.get(r.cache)};else if(r.lastDiff&&r.lastDiff.diff.complete)return void(e.data=r.lastDiff.diff.result);var o=r.getDiffOptions(i.variables),a=n.diff(o);!r.stopped&&aO(r.variables,i.variables)&&r.updateWatch(i.variables),r.updateLastDiff(a,o),a.complete&&(e.data=a.result)})):this.lastWrite=void 0)},e.prototype.markReady=function(){return this.networkError=null,this.networkStatus=Ob.ready},e.prototype.markError=function(e){return this.networkStatus=Ob.error,this.lastWrite=void 0,this.reset(),e.graphQLErrors&&(this.graphQLErrors=e.graphQLErrors),e.networkError&&(this.networkError=e.networkError),e},e}();function xb(e,t){void 0===t&&(t="none");var i="ignore"===t||"all"===t,s=!Lv(e);return!s&&i&&e.data&&(s=!0),s}var kb=Object.prototype.hasOwnProperty,Hb=Object.create(null),jb=function(){function e(e){var t=this;this.clientAwareness={},this.queries=new Map,this.fetchCancelFns=new Map,this.transformCache=new cg(ug["queryManager.getDocumentInfo"]||2e3),this.queryIdCounter=1,this.requestIdCounter=1,this.mutationIdCounter=1,this.inFlightLinkObservables=new Vf(!1);var i=new Dy((function(e){return t.cache.transformDocument(e)}),{cache:!1});this.cache=e.cache,this.link=e.link,this.defaultOptions=e.defaultOptions,this.queryDeduplication=e.queryDeduplication,this.clientAwareness=e.clientAwareness,this.localState=e.localState,this.ssrMode=e.ssrMode,this.assumeImmutableResults=e.assumeImmutableResults;var s=e.documentTransform;this.documentTransform=s?i.concat(s).concat(i):i,this.defaultContext=e.defaultContext||Object.create(null),(this.onBroadcast=e.onBroadcast)&&(this.mutationStore=Object.create(null))}return e.prototype.stop=function(){var e=this;this.queries.forEach((function(t,i){e.stopQueryNoBroadcast(i)})),this.cancelPendingFetches(ym(26))},e.prototype.cancelPendingFetches=function(e){this.fetchCancelFns.forEach((function(t){return t(e)})),this.fetchCancelFns.clear()},e.prototype.mutate=function(e){return J_(this,arguments,void 0,(function(e){var t,i,s,r,n,o,a,c=e.mutation,l=e.variables,d=e.optimisticResponse,u=e.updateQueries,h=e.refetchQueries,p=void 0===h?[]:h,_=e.awaitRefetchQueries,m=void 0!==_&&_,f=e.update,g=e.onQueryUpdated,y=e.fetchPolicy,v=void 0===y?(null===(o=this.defaultOptions.mutate)||void 0===o?void 0:o.fetchPolicy)||"network-only":y,O=e.errorPolicy,b=void 0===O?(null===(a=this.defaultOptions.mutate)||void 0===a?void 0:a.errorPolicy)||"none":O,E=e.keepRootFields,I=e.context;return X_(this,(function(e){switch(e.label){case 0:return gm(c,27),gm("network-only"===v||"no-cache"===v,28),t=this.generateMutationId(),c=this.cache.transformForLink(this.transform(c)),i=this.getDocumentInfo(c).hasClientExports,l=this.getVariables(c,l),i?[4,this.localState.addExportedVariables(c,l,I)]:[3,2];case 1:l=e.sent(),e.label=2;case 2:return s=this.mutationStore&&(this.mutationStore[t]={mutation:c,variables:l,loading:!0,error:null}),r=d&&this.markMutationOptimistic(d,{mutationId:t,document:c,variables:l,fetchPolicy:v,errorPolicy:b,context:I,updateQueries:u,update:f,keepRootFields:E}),this.broadcastQueries(),n=this,[2,new Promise((function(e,i){return Tv(n.getObservableFromLink(c,Y_(Y_({},I),{optimisticResponse:r?d:void 0}),l,{},!1),(function(e){if(Lv(e)&&"none"===b)throw new zv({graphQLErrors:Nv(e)});s&&(s.loading=!1,s.error=null);var i=Y_({},e);return"function"==typeof p&&(p=p(i)),"ignore"===b&&Lv(i)&&delete i.errors,n.markMutationResult({mutationId:t,result:i,document:c,variables:l,fetchPolicy:v,errorPolicy:b,context:I,update:f,updateQueries:u,awaitRefetchQueries:m,refetchQueries:p,removeOptimistic:r?t:void 0,onQueryUpdated:g,keepRootFields:E})})).subscribe({next:function(t){n.broadcastQueries(),"hasNext"in t&&!1!==t.hasNext||e(t)},error:function(e){s&&(s.loading=!1,s.error=e),r&&n.cache.removeOptimistic(t),n.broadcastQueries(),i(e instanceof zv?e:new zv({networkError:e}))}})}))]}}))}))},e.prototype.markMutationResult=function(e,t){var i=this;void 0===t&&(t=this.cache);var s=e.result,r=[],n="no-cache"===e.fetchPolicy;if(!n&&xb(s,e.errorPolicy)){if(wv(s)||r.push({result:s.data,dataId:"ROOT_MUTATION",query:e.document,variables:e.variables}),wv(s)&&ky(s.incremental)){var o=t.diff({id:"ROOT_MUTATION",query:this.getDocumentInfo(e.document).asQuery,variables:e.variables,optimistic:!1,returnPartialData:!0}),a=void 0;o.result&&(a=Rv(o.result,s)),void 0!==a&&(s.data=a,r.push({result:a,dataId:"ROOT_MUTATION",query:e.document,variables:e.variables}))}var c=e.updateQueries;c&&this.queries.forEach((function(e,n){var o=e.observableQuery,a=o&&o.queryName;if(a&&kb.call(c,a)){var l=c[a],d=i.queries.get(n),u=d.document,h=d.variables,p=t.diff({query:u,variables:h,returnPartialData:!0,optimistic:!1}),_=p.result;if(p.complete&&_){var m=l(_,{mutationResult:s,queryName:u&&Ug(u)||void 0,queryVariables:h});m&&r.push({result:m,dataId:"ROOT_QUERY",query:u,variables:h})}}}))}if(r.length>0||(e.refetchQueries||"").length>0||e.update||e.onQueryUpdated||e.removeOptimistic){var l=[];if(this.refetchQueries({updateCache:function(t){n||r.forEach((function(e){return t.write(e)}));var o,a=e.update,c=!(wv(o=s)||function(e){return"hasNext"in e&&"data"in e}(o))||wv(s)&&!s.hasNext;if(a){if(!n){var l=t.diff({id:"ROOT_MUTATION",query:i.getDocumentInfo(e.document).asQuery,variables:e.variables,optimistic:!1,returnPartialData:!0});l.complete&&("incremental"in(s=Y_(Y_({},s),{data:l.result}))&&delete s.incremental,"hasNext"in s&&delete s.hasNext)}c&&a(t,s,{context:e.context,variables:e.variables})}n||e.keepRootFields||!c||t.modify({id:"ROOT_MUTATION",fields:function(e,t){var i=t.fieldName,s=t.DELETE;return"__typename"===i?e:s}})},include:e.refetchQueries,optimistic:!1,removeOptimistic:e.removeOptimistic,onQueryUpdated:e.onQueryUpdated||null}).forEach((function(e){return l.push(e)})),e.awaitRefetchQueries||e.onQueryUpdated)return Promise.all(l).then((function(){return s}))}return Promise.resolve(s)},e.prototype.markMutationOptimistic=function(e,t){var i=this,s="function"==typeof e?e(t.variables,{IGNORE:Hb}):e;return s!==Hb&&(this.cache.recordOptimisticTransaction((function(e){try{i.markMutationResult(Y_(Y_({},t),{result:{data:s}}),e)}catch(e){!1!==globalThis.__DEV__&&gm.error(e)}}),t.mutationId),!0)},e.prototype.fetchQuery=function(e,t,i){return this.fetchConcastWithInfo(e,t,i).concast.promise},e.prototype.getQueryStore=function(){var e=Object.create(null);return this.queries.forEach((function(t,i){e[i]={variables:t.variables,networkStatus:t.networkStatus,networkError:t.networkError,graphQLErrors:t.graphQLErrors}})),e},e.prototype.resetErrors=function(e){var t=this.queries.get(e);t&&(t.networkError=void 0,t.graphQLErrors=[])},e.prototype.transform=function(e){return this.documentTransform.transformDocument(e)},e.prototype.getDocumentInfo=function(e){var t=this.transformCache;if(!t.has(e)){var i={hasClientExports:Hf(e),hasForcedResolvers:this.localState.shouldForceResolvers(e),hasNonreactiveDirective:kf(["nonreactive"],e),clientQuery:this.localState.clientQuery(e),serverQuery:Fy([{name:"client",remove:!0},{name:"connection"},{name:"nonreactive"}],e),defaultVars:Kg(jg(e)),asQuery:Y_(Y_({},e),{definitions:e.definitions.map((function(e){return"OperationDefinition"===e.kind&&"query"!==e.operation?Y_(Y_({},e),{operation:"query"}):e}))})};t.set(e,i)}return t.get(e)},e.prototype.getVariables=function(e,t){return Y_(Y_({},this.getDocumentInfo(e).defaultVars),t)},e.prototype.watchQuery=function(e){var t=this.transform(e.query);void 0===(e=Y_(Y_({},e),{variables:this.getVariables(t,e.variables)})).notifyOnNetworkStatusChange&&(e.notifyOnNetworkStatusChange=!1);var i=new Mb(this),s=new Ab({queryManager:this,queryInfo:i,options:e});return s.lastQuery=t,this.queries.set(s.queryId,i),i.init({document:t,observableQuery:s,variables:s.variables}),s},e.prototype.query=function(e,t){var i=this;return void 0===t&&(t=this.generateQueryId()),gm(e.query,29),gm("Document"===e.query.kind,30),gm(!e.returnPartialData,31),gm(!e.pollInterval,32),this.fetchQuery(t,Y_(Y_({},e),{query:this.transform(e.query)})).finally((function(){return i.stopQuery(t)}))},e.prototype.generateQueryId=function(){return String(this.queryIdCounter++)},e.prototype.generateRequestId=function(){return this.requestIdCounter++},e.prototype.generateMutationId=function(){return String(this.mutationIdCounter++)},e.prototype.stopQueryInStore=function(e){this.stopQueryInStoreNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryInStoreNoBroadcast=function(e){var t=this.queries.get(e);t&&t.stop()},e.prototype.clearStore=function(e){return void 0===e&&(e={discardWatches:!0}),this.cancelPendingFetches(ym(33)),this.queries.forEach((function(e){e.observableQuery?e.networkStatus=Ob.loading:e.stop()})),this.mutationStore&&(this.mutationStore=Object.create(null)),this.cache.reset(e)},e.prototype.getObservableQueries=function(e){var t=this;void 0===e&&(e="active");var i=new Map,s=new Map,r=new Set;return Array.isArray(e)&&e.forEach((function(e){var i;"string"==typeof e?s.set(e,!1):qf(i=e)&&"Document"===i.kind&&Array.isArray(i.definitions)?s.set(t.transform(e),!1):qf(e)&&e.query&&r.add(e)})),this.queries.forEach((function(t,r){var n=t.observableQuery,o=t.document;if(n){if("all"===e)return void i.set(r,n);var a=n.queryName;if("standby"===n.options.fetchPolicy||"active"===e&&!n.hasObservers())return;("active"===e||a&&s.has(a)||o&&s.has(o))&&(i.set(r,n),a&&s.set(a,!0),o&&s.set(o,!0))}})),r.size&&r.forEach((function(e){var s=_m("legacyOneTimeQuery"),r=t.getQuery(s).init({document:e.query,variables:e.variables}),n=new Ab({queryManager:t,queryInfo:r,options:Y_(Y_({},e),{fetchPolicy:"network-only"})});gm(n.queryId===s),r.setObservableQuery(n),i.set(s,n)})),!1!==globalThis.__DEV__&&s.size&&s.forEach((function(e,t){e||!1!==globalThis.__DEV__&&gm.warn("string"==typeof t?34:35,t)})),i},e.prototype.reFetchObservableQueries=function(e){var t=this;void 0===e&&(e=!1);var i=[];return this.getObservableQueries(e?"all":"active").forEach((function(s,r){var n=s.options.fetchPolicy;s.resetLastResults(),(e||"standby"!==n&&"cache-only"!==n)&&i.push(s.refetch()),t.getQuery(r).setDiff(null)})),this.broadcastQueries(),Promise.all(i)},e.prototype.setObservableQuery=function(e){this.getQuery(e.queryId).setObservableQuery(e)},e.prototype.startGraphQLSubscription=function(e){var t=this,i=e.query,s=e.fetchPolicy,r=e.errorPolicy,n=void 0===r?"none":r,o=e.variables,a=e.context,c=void 0===a?{}:a,l=e.extensions,d=void 0===l?{}:l;i=this.transform(i),o=this.getVariables(i,o);var u=function(e){return t.getObservableFromLink(i,c,e,d).map((function(r){"no-cache"!==s&&(xb(r,n)&&t.cache.write({query:i,result:r.data,dataId:"ROOT_SUBSCRIPTION",variables:e}),t.broadcastQueries());var o=Lv(r),a=function(e){return!!e.extensions&&Array.isArray(e.extensions[Gv])}(r);if(o||a){var c={};if(o&&(c.graphQLErrors=r.errors),a&&(c.protocolErrors=r.extensions[Gv]),"none"===n||a)throw new zv(c)}return"ignore"===n&&delete r.errors,r}))};if(this.getDocumentInfo(i).hasClientExports){var h=this.localState.addExportedVariables(i,o,c).then(u);return new fv((function(e){var t=null;return h.then((function(i){return t=i.subscribe(e)}),e.error),function(){return t&&t.unsubscribe()}}))}return u(o)},e.prototype.stopQuery=function(e){this.stopQueryNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryNoBroadcast=function(e){this.stopQueryInStoreNoBroadcast(e),this.removeQuery(e)},e.prototype.removeQuery=function(e){this.fetchCancelFns.delete(e),this.queries.has(e)&&(this.getQuery(e).stop(),this.queries.delete(e))},e.prototype.broadcastQueries=function(){this.onBroadcast&&this.onBroadcast(),this.queries.forEach((function(e){return e.notify()}))},e.prototype.getLocalState=function(){return this.localState},e.prototype.getObservableFromLink=function(e,t,i,s,r){var n,o,a=this;void 0===r&&(r=null!==(n=null==t?void 0:t.queryDeduplication)&&void 0!==n?n:this.queryDeduplication);var c=this.getDocumentInfo(e),l=c.serverQuery,d=c.clientQuery;if(l){var u=this.inFlightLinkObservables,h=this.link,p={query:l,variables:i,operationName:Ug(l)||void 0,context:this.prepareContext(Y_(Y_({},t),{forceFetch:!r})),extensions:s};if(t=p.context,r){var _=My(l),m=Tg(i),f=u.lookup(_,m);if(!(o=f.observable)){var g=new Pv([Vv(h,p)]);o=f.observable=g,g.beforeNext((function(){u.remove(_,m)}))}}else o=new Pv([Vv(h,p)])}else o=new Pv([fv.of({data:{}})]),t=this.prepareContext(t);return d&&(o=Tv(o,(function(e){return a.localState.runResolvers({document:d,remoteResult:e,context:t,variables:i})}))),o},e.prototype.getResultsFromLink=function(e,t,i){var s=e.lastRequestId=this.generateRequestId(),r=this.cache.transformForLink(i.query);return Tv(this.getObservableFromLink(r,i.context,i.variables),(function(n){var o=Nv(n),a=o.length>0,c=i.errorPolicy;if(s>=e.lastRequestId){if(a&&"none"===c)throw e.markError(new zv({graphQLErrors:o}));e.markResult(n,r,i,t),e.markReady()}var l={data:n.data,loading:!1,networkStatus:Ob.ready};return a&&"none"===c&&(l.data=void 0),a&&"ignore"!==c&&(l.errors=o,l.networkStatus=Ob.error),l}),(function(t){var i=Wv(t)?t:new zv({networkError:t});throw s>=e.lastRequestId&&e.markError(i),i}))},e.prototype.fetchConcastWithInfo=function(e,t,i,s){var r=this;void 0===i&&(i=Ob.loading),void 0===s&&(s=t.query);var n,o,a=this.getVariables(s,t.variables),c=this.getQuery(e),l=this.defaultOptions.watchQuery,d=t.fetchPolicy,u=void 0===d?l&&l.fetchPolicy||"cache-first":d,h=t.errorPolicy,p=void 0===h?l&&l.errorPolicy||"none":h,_=t.returnPartialData,m=void 0!==_&&_,f=t.notifyOnNetworkStatusChange,g=void 0!==f&&f,y=t.context,v=void 0===y?{}:y,O=Object.assign({},t,{query:s,variables:a,fetchPolicy:u,errorPolicy:p,returnPartialData:m,notifyOnNetworkStatusChange:g,context:v}),b=function(e){O.variables=e;var s=r.fetchQueryByPolicy(c,O,i);return"standby"!==O.fetchPolicy&&s.sources.length>0&&c.observableQuery&&c.observableQuery.applyNextFetchPolicy("after-fetch",t),s},E=function(){return r.fetchCancelFns.delete(e)};if(this.fetchCancelFns.set(e,(function(e){E(),setTimeout((function(){return n.cancel(e)}))})),this.getDocumentInfo(O.query).hasClientExports)n=new Pv(this.localState.addExportedVariables(O.query,O.variables,O.context).then(b).then((function(e){return e.sources}))),o=!0;else{var I=b(O.variables);o=I.fromLink,n=new Pv(I.sources)}return n.promise.then(E,E),{concast:n,fromLink:o}},e.prototype.refetchQueries=function(e){var t=this,i=e.updateCache,s=e.include,r=e.optimistic,n=void 0!==r&&r,o=e.removeOptimistic,a=void 0===o?n?_m("refetchQueries"):void 0:o,c=e.onQueryUpdated,l=new Map;s&&this.getObservableQueries(s).forEach((function(e,i){l.set(i,{oq:e,lastDiff:t.getQuery(i).getDiff()})}));var d=new Map;return i&&this.cache.batch({update:i,optimistic:n&&a||!1,removeOptimistic:a,onWatchUpdated:function(e,t,i){var s=e.watcher instanceof Mb&&e.watcher.observableQuery;if(s){if(c){l.delete(s.queryId);var r=c(s,t,i);return!0===r&&(r=s.refetch()),!1!==r&&d.set(s,r),r}null!==c&&l.set(s.queryId,{oq:s,lastDiff:i,diff:t})}}}),l.size&&l.forEach((function(e,i){var s,r=e.oq,n=e.lastDiff,o=e.diff;if(c){if(!o){var a=r.queryInfo;a.reset(),o=a.getDiff()}s=c(r,o,n)}c&&!0!==s||(s=r.refetch()),!1!==s&&d.set(r,s),i.indexOf("legacyOneTimeQuery")>=0&&t.stopQueryNoBroadcast(i)})),a&&this.cache.removeOptimistic(a),d},e.prototype.fetchQueryByPolicy=function(e,t,i){var s=this,r=t.query,n=t.variables,o=t.fetchPolicy,a=t.refetchWritePolicy,c=t.errorPolicy,l=t.returnPartialData,d=t.context,u=t.notifyOnNetworkStatusChange,h=e.networkStatus;e.init({document:r,variables:n,networkStatus:i});var p=function(){return e.getDiff()},_=function(t,i){void 0===i&&(i=e.networkStatus||Ob.loading);var o=t.result;!1===globalThis.__DEV__||l||aO(o,{})||Cb(t.missing);var a=function(e){return fv.of(Y_({data:e,loading:Ib(i),networkStatus:i},t.complete?null:{partial:!0}))};return o&&s.getDocumentInfo(r).hasForcedResolvers?s.localState.runResolvers({document:r,remoteResult:{data:o},context:d,variables:n,onlyRunForcedResolvers:!0}).then((function(e){return a(e.data||void 0)})):"none"===c&&i===Ob.refetch&&Array.isArray(t.missing)?a(void 0):a(o)},m="no-cache"===o?0:i===Ob.refetch&&"merge"!==a?1:2,f=function(){return s.getResultsFromLink(e,m,{query:r,variables:n,context:d,fetchPolicy:o,errorPolicy:c})},g=u&&"number"==typeof h&&h!==i&&Ib(i);switch(o){default:case"cache-first":return(y=p()).complete?{fromLink:!1,sources:[_(y,e.markReady())]}:l||g?{fromLink:!0,sources:[_(y),f()]}:{fromLink:!0,sources:[f()]};case"cache-and-network":var y;return(y=p()).complete||l||g?{fromLink:!0,sources:[_(y),f()]}:{fromLink:!0,sources:[f()]};case"cache-only":return{fromLink:!1,sources:[_(p(),e.markReady())]};case"network-only":return g?{fromLink:!0,sources:[_(p()),f()]}:{fromLink:!0,sources:[f()]};case"no-cache":return g?{fromLink:!0,sources:[_(e.getDiff()),f()]}:{fromLink:!0,sources:[f()]};case"standby":return{fromLink:!1,sources:[]}}},e.prototype.getQuery=function(e){return e&&!this.queries.has(e)&&this.queries.set(e,new Mb(this,e)),this.queries.get(e)},e.prototype.prepareContext=function(e){void 0===e&&(e={});var t=this.localState.prepareContext(e);return Y_(Y_(Y_({},this.defaultContext),t),{clientAwareness:this.clientAwareness})},e}(),Ub=function(){function e(e){var t=e.cache,i=e.client,s=e.resolvers,r=e.fragmentMatcher;this.selectionsToResolveCache=new WeakMap,this.cache=t,i&&(this.client=i),s&&this.addResolvers(s),r&&this.setFragmentMatcher(r)}return e.prototype.addResolvers=function(e){var t=this;this.resolvers=this.resolvers||{},Array.isArray(e)?e.forEach((function(e){t.resolvers=Wy(t.resolvers,e)})):this.resolvers=Wy(this.resolvers,e)},e.prototype.setResolvers=function(e){this.resolvers={},this.addResolvers(e)},e.prototype.getResolvers=function(){return this.resolvers||{}},e.prototype.runResolvers=function(e){return J_(this,arguments,void 0,(function(e){var t=e.document,i=e.remoteResult,s=e.context,r=e.variables,n=e.onlyRunForcedResolvers,o=void 0!==n&&n;return X_(this,(function(e){return t?[2,this.resolveDocument(t,i.data,s,r,this.fragmentMatcher,o).then((function(e){return Y_(Y_({},i),{data:e.result})}))]:[2,i]}))}))},e.prototype.setFragmentMatcher=function(e){this.fragmentMatcher=e},e.prototype.getFragmentMatcher=function(){return this.fragmentMatcher},e.prototype.clientQuery=function(e){return kf(["client"],e)&&this.resolvers?e:null},e.prototype.serverQuery=function(e){return $y(e)},e.prototype.prepareContext=function(e){var t=this.cache;return Y_(Y_({},e),{cache:t,getCacheKey:function(e){return t.identify(e)}})},e.prototype.addExportedVariables=function(e){return J_(this,arguments,void 0,(function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),X_(this,(function(s){return e?[2,this.resolveDocument(e,this.buildRootValueFromCache(e,t)||{},this.prepareContext(i),t).then((function(e){return Y_(Y_({},t),e.exportedVariables)}))]:[2,Y_({},t)]}))}))},e.prototype.shouldForceResolvers=function(e){var t=!1;return Af(e,{Directive:{enter:function(e){if("client"===e.name.value&&e.arguments&&(t=e.arguments.some((function(e){return"always"===e.name.value&&"BooleanValue"===e.value.kind&&!0===e.value.value}))))return Sf}}}),t},e.prototype.buildRootValueFromCache=function(e,t){return this.cache.diff({query:Ky(e),variables:t,returnPartialData:!0,optimistic:!1}).result},e.prototype.resolveDocument=function(e,t){return J_(this,arguments,void 0,(function(e,t,i,s,r,n){var o,a,c,l,d,u,h,p,_,m;return void 0===i&&(i={}),void 0===s&&(s={}),void 0===r&&(r=function(){return!0}),void 0===n&&(n=!1),X_(this,(function(f){return o=Vg(e),a=Bg(e),c=Qf(a),l=this.collectSelectionsToResolve(o,c),d=o.operation,u=d?d.charAt(0).toUpperCase()+d.slice(1):"Query",p=(h=this).cache,_=h.client,m={fragmentMap:c,context:Y_(Y_({},i),{cache:p,client:_}),variables:s,fragmentMatcher:r,defaultOperationType:u,exportedVariables:{},selectionsToResolve:l,onlyRunForcedResolvers:n},[2,this.resolveSelectionSet(o.selectionSet,!1,t,m).then((function(e){return{result:e,exportedVariables:m.exportedVariables}}))]}))}))},e.prototype.resolveSelectionSet=function(e,t,i,s){return J_(this,void 0,void 0,(function(){var r,n,o,a,c,l=this;return X_(this,(function(d){return r=s.fragmentMap,n=s.context,o=s.variables,a=[i],c=function(e){return J_(l,void 0,void 0,(function(){var c,l;return X_(this,(function(d){return(t||s.selectionsToResolve.has(e))&&xf(e,o)?kg(e)?[2,this.resolveField(e,t,i,s).then((function(t){var i;void 0!==t&&a.push(((i={})[Mg(e)]=t,i))}))]:(function(e){return"InlineFragment"===e.kind}(e)?c=e:(c=r[e.name.value],gm(c,18,e.name.value)),c&&c.typeCondition&&(l=c.typeCondition.name.value,s.fragmentMatcher(i,l,n))?[2,this.resolveSelectionSet(c.selectionSet,t,i,s).then((function(e){a.push(e)}))]:[2]):[2]}))}))},[2,Promise.all(e.selections.map(c)).then((function(){return zy(a)}))]}))}))},e.prototype.resolveField=function(e,t,i,s){return J_(this,void 0,void 0,(function(){var r,n,o,a,c,l,d,u,h,p=this;return X_(this,(function(_){return i?(r=s.variables,n=e.name.value,o=Mg(e),a=n!==o,c=i[o]||i[n],l=Promise.resolve(c),s.onlyRunForcedResolvers&&!this.shouldForceResolvers(e)||(d=i.__typename||s.defaultOperationType,(u=this.resolvers&&this.resolvers[d])&&(h=u[a?n:o])&&(l=Promise.resolve($O.withValue(this.cache,h,[i,Dg(e,r),s.context,{field:e,fragmentMap:s.fragmentMap}])))),[2,l.then((function(i){var r,n;if(void 0===i&&(i=c),e.directives&&e.directives.forEach((function(e){"export"===e.name.value&&e.arguments&&e.arguments.forEach((function(e){"as"===e.name.value&&"StringValue"===e.value.kind&&(s.exportedVariables[e.value.value]=i)}))})),!e.selectionSet)return i;if(null==i)return i;var o=null!==(n=null===(r=e.directives)||void 0===r?void 0:r.some((function(e){return"client"===e.name.value})))&&void 0!==n&&n;return Array.isArray(i)?p.resolveSubSelectedArray(e,t||o,i,s):e.selectionSet?p.resolveSelectionSet(e.selectionSet,t||o,i,s):void 0}))]):[2,null]}))}))},e.prototype.resolveSubSelectedArray=function(e,t,i,s){var r=this;return Promise.all(i.map((function(i){return null===i?null:Array.isArray(i)?r.resolveSubSelectedArray(e,t,i,s):e.selectionSet?r.resolveSelectionSet(e.selectionSet,t,i,s):void 0})))},e.prototype.collectSelectionsToResolve=function(e,t){var i=function(e){return!Array.isArray(e)},s=this.selectionsToResolveCache;return function e(r){if(!s.has(r)){var n=new Set;s.set(r,n),Af(r,{Directive:function(e,t,s,r,o){"client"===e.name.value&&o.forEach((function(e){i(e)&&Mf(e)&&n.add(e)}))},FragmentSpread:function(s,r,o,a,c){var l=t[s.name.value];gm(l,19,s.name.value);var d=e(l);d.size>0&&(c.forEach((function(e){i(e)&&Mf(e)&&n.add(e)})),n.add(s),d.forEach((function(e){n.add(e)})))}})}return s.get(r)}(e)},e}(),Bb=!1,Fb=function(){function e(e){var t=this;if(this.resetStoreCallbacks=[],this.clearStoreCallbacks=[],!e.cache)throw ym(15);var i=e.uri,s=e.credentials,r=e.headers,n=e.cache,o=e.documentTransform,a=e.ssrMode,c=void 0!==a&&a,l=e.ssrForceFetchDelay,d=void 0===l?0:l,u=e.connectToDevTools,h=e.queryDeduplication,p=void 0===h||h,_=e.defaultOptions,m=e.defaultContext,f=e.assumeImmutableResults,g=void 0===f?n.assumeImmutableResults:f,y=e.resolvers,v=e.typeDefs,O=e.fragmentMatcher,b=e.name,E=e.version,I=e.devtools,T=e.link;T||(T=i?new iO({uri:i,credentials:s,headers:r}):Bv.empty()),this.link=T,this.cache=n,this.disableNetworkFetches=c||d>0,this.queryDeduplication=p,this.defaultOptions=_||Object.create(null),this.typeDefs=v,this.devtoolsConfig=Y_(Y_({},I),{enabled:(null==I?void 0:I.enabled)||u}),void 0===this.devtoolsConfig.enabled&&(this.devtoolsConfig.enabled=!1!==globalThis.__DEV__),d&&setTimeout((function(){return t.disableNetworkFetches=!1}),d),this.watchQuery=this.watchQuery.bind(this),this.query=this.query.bind(this),this.mutate=this.mutate.bind(this),this.watchFragment=this.watchFragment.bind(this),this.resetStore=this.resetStore.bind(this),this.reFetchObservableQueries=this.reFetchObservableQueries.bind(this),this.version=dm,this.localState=new Ub({cache:n,client:this,resolvers:y,fragmentMatcher:O}),this.queryManager=new jb({cache:this.cache,link:this.link,defaultOptions:this.defaultOptions,defaultContext:m,documentTransform:o,queryDeduplication:p,ssrMode:c,clientAwareness:{name:b,version:E},localState:this.localState,assumeImmutableResults:g,onBroadcast:this.devtoolsConfig.enabled?function(){t.devToolsHookCb&&t.devToolsHookCb({action:{},state:{queries:t.queryManager.getQueryStore(),mutations:t.queryManager.mutationStore||{}},dataWithOptimisticResults:t.cache.extract(!0)})}:void 0}),this.devtoolsConfig.enabled&&this.connectToDevTools()}return e.prototype.connectToDevTools=function(){if("undefined"!=typeof window){var e=window,t=Symbol.for("apollo.devtools");(e[t]=e[t]||[]).push(this),e.__APOLLO_CLIENT__=this,Bb||!1===globalThis.__DEV__||(Bb=!0,window.document&&window.top===window.self&&/^(https?|file):$/.test(window.location.protocol)&&setTimeout((function(){if(!window.__APOLLO_DEVTOOLS_GLOBAL_HOOK__){var e=window.navigator,t=e&&e.userAgent,i=void 0;"string"==typeof t&&(t.indexOf("Chrome/")>-1?i="https://chrome.google.com/webstore/detail/apollo-client-developer-t/jdkknkkbebbapilgoeccciglkfbmbnfm":t.indexOf("Firefox/")>-1&&(i="https://addons.mozilla.org/en-US/firefox/addon/apollo-developer-tools/")),i&&!1!==globalThis.__DEV__&&gm.log("Download the Apollo DevTools for a better development experience: %s",i)}}),1e4))}},Object.defineProperty(e.prototype,"documentTransform",{get:function(){return this.queryManager.documentTransform},enumerable:!1,configurable:!0}),e.prototype.stop=function(){this.queryManager.stop()},e.prototype.watchQuery=function(e){return this.defaultOptions.watchQuery&&(e=Mv(this.defaultOptions.watchQuery,e)),!this.disableNetworkFetches||"network-only"!==e.fetchPolicy&&"cache-and-network"!==e.fetchPolicy||(e=Y_(Y_({},e),{fetchPolicy:"cache-first"})),this.queryManager.watchQuery(e)},e.prototype.query=function(e){return this.defaultOptions.query&&(e=Mv(this.defaultOptions.query,e)),gm("cache-and-network"!==e.fetchPolicy,16),this.disableNetworkFetches&&"network-only"===e.fetchPolicy&&(e=Y_(Y_({},e),{fetchPolicy:"cache-first"})),this.queryManager.query(e)},e.prototype.mutate=function(e){return this.defaultOptions.mutate&&(e=Mv(this.defaultOptions.mutate,e)),this.queryManager.mutate(e)},e.prototype.subscribe=function(e){return this.queryManager.startGraphQLSubscription(e)},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!1),this.cache.readQuery(e,t)},e.prototype.watchFragment=function(e){return this.cache.watchFragment(e)},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!1),this.cache.readFragment(e,t)},e.prototype.writeQuery=function(e){var t=this.cache.writeQuery(e);return!1!==e.broadcast&&this.queryManager.broadcastQueries(),t},e.prototype.writeFragment=function(e){var t=this.cache.writeFragment(e);return!1!==e.broadcast&&this.queryManager.broadcastQueries(),t},e.prototype.__actionHookForDevTools=function(e){this.devToolsHookCb=e},e.prototype.__requestRaw=function(e){return Vv(this.link,e)},e.prototype.resetStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore({discardWatches:!1})})).then((function(){return Promise.all(e.resetStoreCallbacks.map((function(e){return e()})))})).then((function(){return e.reFetchObservableQueries()}))},e.prototype.clearStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore({discardWatches:!0})})).then((function(){return Promise.all(e.clearStoreCallbacks.map((function(e){return e()})))}))},e.prototype.onResetStore=function(e){var t=this;return this.resetStoreCallbacks.push(e),function(){t.resetStoreCallbacks=t.resetStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.onClearStore=function(e){var t=this;return this.clearStoreCallbacks.push(e),function(){t.clearStoreCallbacks=t.clearStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.reFetchObservableQueries=function(e){return this.queryManager.reFetchObservableQueries(e)},e.prototype.refetchQueries=function(e){var t=this.queryManager.refetchQueries(e),i=[],s=[];t.forEach((function(e,t){i.push(t),s.push(e)}));var r=Promise.all(s);return r.queries=i,r.results=s,r.catch((function(e){!1!==globalThis.__DEV__&&gm.debug(17,e)})),r},e.prototype.getObservableQueries=function(e){return void 0===e&&(e="active"),this.queryManager.getObservableQueries(e)},e.prototype.extract=function(e){return this.cache.extract(e)},e.prototype.restore=function(e){return this.cache.restore(e)},e.prototype.addResolvers=function(e){this.localState.addResolvers(e)},e.prototype.setResolvers=function(e){this.localState.setResolvers(e)},e.prototype.getResolvers=function(){return this.localState.getResolvers()},e.prototype.setLocalStateFragmentMatcher=function(e){this.localState.setFragmentMatcher(e)},e.prototype.setLink=function(e){this.link=this.queryManager.link=e},Object.defineProperty(e.prototype,"defaultContext",{get:function(){return this.queryManager.defaultContext},enumerable:!1,configurable:!0}),e}();!1!==globalThis.__DEV__&&(Fb.prototype.getMemoryInternals=_g);var Vb=function(){return Vb=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Vb.apply(this,arguments)},Kb=new Map,$b=new Map,Gb=!0,Wb=!1;function zb(e){return e.replace(/[\s,]+/g," ").trim()}function qb(e){var t,i,s,r=zb(e);if(!Kb.has(r)){var n=function(e,t){return new vf(e,t).parseDocument()}(e,{experimentalFragmentVariables:Wb,allowLegacyFragmentVariables:Wb});if(!n||"Document"!==n.kind)throw new Error("Not a valid GraphQL document.");Kb.set(r,function(e){var t=new Set(e.definitions);t.forEach((function(e){e.loc&&delete e.loc,Object.keys(e).forEach((function(i){var s=e[i];s&&"object"==typeof s&&t.add(s)}))}));var i=e.loc;return i&&(delete i.startToken,delete i.endToken),e}((t=n,i=new Set,s=[],t.definitions.forEach((function(e){if("FragmentDefinition"===e.kind){var t=e.name.value,r=zb((o=e.loc).source.body.substring(o.start,o.end)),n=$b.get(t);n&&!n.has(r)?Gb&&console.warn("Warning: fragment with name "+t+" already exists.\ngraphql-tag enforces all fragment names across your application to be unique; read more about\nthis in the docs: http://dev.apollodata.com/core/fragments.html#unique-names"):n||$b.set(t,n=new Set),n.add(r),i.has(r)||(i.add(r),s.push(e))}else s.push(e);var o})),Vb(Vb({},t),{definitions:s}))))}return Kb.get(r)}function Yb(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];"string"==typeof e&&(e=[e]);var s=e[0];return t.forEach((function(t,i){t&&"Document"===t.kind?s+=t.loc.source.body:s+=t,s+=e[i+1]})),qb(s)}var Qb,Jb=Yb;(Qb=Yb||(Yb={})).gql=Jb,Qb.resetCaches=function(){Kb.clear(),$b.clear()},Qb.disableFragmentWarnings=function(){Gb=!1},Qb.enableExperimentalFragmentVariables=function(){Wb=!0},Qb.disableExperimentalFragmentVariables=function(){Wb=!1},Yb.default=Yb;var Xb=function(){function e(e,t,i,s,r){var n=this;this.observer=e,this.operation=t,this.forward=i,this.delayFor=s,this.retryIf=r,this.retryCount=0,this.currentSubscription=null,this.onError=function(e){return J_(n,void 0,void 0,(function(){return X_(this,(function(t){switch(t.label){case 0:return this.retryCount+=1,[4,this.retryIf(this.retryCount,this.operation,e)];case 1:return t.sent()?(this.scheduleRetry(this.delayFor(this.retryCount,this.operation,e)),[2]):(this.observer.error(e),[2])}}))}))},this.try()}return e.prototype.cancel=function(){this.currentSubscription&&this.currentSubscription.unsubscribe(),clearTimeout(this.timerId),this.timerId=void 0,this.currentSubscription=null},e.prototype.try=function(){this.currentSubscription=this.forward(this.operation).subscribe({next:this.observer.next.bind(this.observer),error:this.onError,complete:this.observer.complete.bind(this.observer)})},e.prototype.scheduleRetry=function(e){var t=this;if(this.timerId)throw new Error("RetryLink BUG! Encountered overlapping retries");this.timerId=setTimeout((function(){t.timerId=void 0,t.try()}),e)},e}(),Zb=function(e){function t(t){var i=e.call(this)||this,s=t||{},r=s.attempts,n=s.delay;return i.delayFor="function"==typeof n?n:function(e){var t=e||{},i=t.initial,s=void 0===i?300:i,r=t.jitter,n=void 0===r||r,o=t.max,a=void 0===o?1/0:o,c=n?s:s/2;return function(e){var t=Math.min(a,c*Math.pow(2,e));return n&&(t=Math.random()*t),t}}(n),i.retryIf="function"==typeof r?r:function(e){var t=e||{},i=t.retryIf,s=t.max,r=void 0===s?5:s;return function(e,t,s){return!(e>=r)&&(i?i(s,t):!!s)}}(r),i}return q_(t,e),t.prototype.request=function(e,t){var i=this;return new fv((function(s){var r=new Xb(s,e,t,i.delayFor,i.retryIf);return function(){r.cancel()}}))},t}(Bv);const eE=["repo_size","repo_version",{renditionLink:["href","templated"]},{blockDownloadLink:["href","templated"]},{blockUploadLink:["href","templated"]}],tE=[{appMetadata:['am: valueOf(key: "")']},"dc_format",{labels:["lastAccessDate",{favorite:["isFavorite"]}]},{effectivePermissions:["default","primary","applicationMetadata","aclPolicy","directory","annotations"]},"repo_ancestors","repo_assetClass","primary_etag","repo_assetId","repo_createDate",{repo_createdBy:["id"]},"repo_modifiedBy","repo_modifyDate","repo_name","repo_path","repo_state",{storage_assignee:["id","type"]},"storage_deviceCreateDate","storage_deviceModifyDate","storage_region",{repository:["repo_repositoryId",{repo_owner:["id","type"]},"repo_repositoryType"]},{primaryLink:["href","templated"]},{operation:"Composite",fields:eE,fragment:!0},{operation:"File",fields:eE,fragment:!0},{operation:"Directory",fields:[{pageLink:["href","templated"]},{blockUploadLink:["href","templated"]}],fragment:!0}];var iE;!function(e){e.READ="READ",e.WRITE="WRITE",e.ACK="ACK",e.DELETE="DELETE"}(iE||(iE={}));const sE={name:"NAME",created:"CREATE_DATE",modified:"MODIFY_DATE",shared:"MODIFY_DATE"};var rE,nE={},oE={},aE={},cE={};Object.defineProperty(cE,"__esModule",{value:!0}),function(e){e.Mutation="mutation",e.Query="query",e.Subscription="subscription"}(rE||(rE={})),cE.default=rE;var lE={},dE={};Object.defineProperty(dE,"__esModule",{value:!0}),dE.isNestedField=void 0,dE.isNestedField=function(e){return"object"==typeof e&&e.hasOwnProperty("operation")&&e.hasOwnProperty("variables")&&e.hasOwnProperty("fields")||"object"==typeof e&&e.hasOwnProperty("operation")&&e.hasOwnProperty("fragment")&&e.hasOwnProperty("fields")};var uE=ht&&ht.__assign||function(){return uE=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},uE.apply(this,arguments)};Object.defineProperty(lE,"__esModule",{value:!0});var hE=dE,pE=function(){function e(){}return e.resolveVariables=function(t){for(var i={},s=0,r=t;s<r.length;s++){var n=r[s],o=n.variables,a=n.fields;i=uE(uE(uE({},i),o),a&&e.getNestedVariables(a)||{})}return i},e.queryDataNameAndArgumentMap=function(e){return e&&Object.keys(e).length?"(".concat(Object.entries(e).reduce((function(e,t,i){var s=t[0],r=t[1];return"".concat(e).concat(0!==i?", ":"").concat(r&&r.name?r.name:s,": $").concat(s)}),""),")"):""},e.queryFieldsMap=function(t){var i=this;return t?t.map((function(t){if((0,hE.isNestedField)(t))return e.queryNestedFieldMap(t);if("object"==typeof t){var s="";return Object.entries(t).forEach((function(e,t,r){var n=e[0],o=e[1];s+="".concat(n," ").concat(o.length>0?"{ "+i.queryFieldsMap(o)+" }":""),t<r.length-1&&(s+=", ")})),s}return"".concat(t)})).join(", "):""},e.operationOrAlias=function(e){return"string"==typeof e?e:"".concat(e.alias,": ").concat(e.name)},e.isFragment=function(e){var t;return null!==(t=!0===(null==e?void 0:e.fragment))&&void 0!==t&&t},e.operationOrFragment=function(t){return e.isFragment(t)?t.operation:e.operationOrAlias(t.operation)},e.getFragment=function(t){return e.isFragment(t)?"... on ":""},e.queryNestedFieldMap=function(t){return"".concat(e.getFragment(t)).concat(e.operationOrFragment(t)," ").concat(this.isFragment(t)?"":this.queryDataNameAndArgumentMap(t.variables)," ").concat(t.fields.length>0?"{ "+this.queryFieldsMap(t.fields)+" }":"")},e.queryVariablesMap=function(t,i){var s={},r=function(e){e&&Object.keys(e).map((function(t){s[t]="object"==typeof e[t]?e[t].value:e[t]}))};return r(t),i&&"object"==typeof i&&r(e.getNestedVariables(i)),s},e.getNestedVariables=function(e){var t={};return function e(i){return null==i||i.forEach((function(i){if((0,hE.isNestedField)(i))t=uE(uE(uE({},i.variables),t),i.fields&&e(i.fields));else if("object"==typeof i)for(var s=0,r=Object.entries(i);s<r.length;s++)e(r[s][1])})),t}(e),t},e.queryDataType=function(e){var t="String",i="object"==typeof e?e.value:e;if(null!=(null==e?void 0:e.type))t=e.type;else{var s=Array.isArray(i)?i[0]:i;switch(typeof s){case"object":t="Object";break;case"boolean":t="Boolean";break;case"number":t=s%1==0?"Int":"Float"}}return"object"==typeof e&&(!0===e.list?t="[".concat(t,"]"):Array.isArray(e.list)&&(t="[".concat(t).concat(e.list[0]?"!":"","]")),e.required&&(t+="!")),t},e}();lE.default=pE,Object.defineProperty(aE,"__esModule",{value:!0});var _E=cE,mE=lE,fE=function(){function e(e){Array.isArray(e)?this.variables=mE.default.resolveVariables(e):(this.variables=e.variables,this.fields=e.fields,this.operation=e.operation)}return e.prototype.mutationBuilder=function(){return this.operationWrapperTemplate(this.variables,this.operationTemplate(this.operation))},e.prototype.mutationsBuilder=function(e){var t=this,i=e.map((function(e){return t.operation=e.operation,t.variables=e.variables,t.fields=e.fields,t.operationTemplate(e.operation)}));return this.operationWrapperTemplate(mE.default.resolveVariables(e),i.join("\n  "))},e.prototype.queryDataNameAndArgumentMap=function(){return this.variables&&Object.keys(this.variables).length?"(".concat(Object.keys(this.variables).reduce((function(e,t,i){return"".concat(e).concat(0!==i?", ":"").concat(t,": $").concat(t)}),""),")"):""},e.prototype.queryDataArgumentAndTypeMap=function(e){return Object.keys(e).length?"(".concat(Object.keys(e).reduce((function(t,i,s){return"".concat(t).concat(0!==s?", ":"","$").concat(i,": ").concat(mE.default.queryDataType(e[i]))}),""),")"):""},e.prototype.operationWrapperTemplate=function(e,t){var i="string"==typeof this.operation?this.operation:this.operation.name;return{query:"".concat(_E.default.Mutation," ").concat(i.charAt(0).toUpperCase()+i.slice(1)," ").concat(this.queryDataArgumentAndTypeMap(e)," {\n  ").concat(t,"\n}"),variables:mE.default.queryVariablesMap(e)}},e.prototype.operationTemplate=function(e){var t="string"==typeof e?e:"".concat(e.alias,": ").concat(e.name);return"".concat(t," ").concat(this.queryDataNameAndArgumentMap()," {\n    ").concat(this.queryFieldsMap(this.fields),"\n  }")},e.prototype.queryFieldsMap=function(e){var t=this;return Array.isArray(e)?e.map((function(e){return"object"==typeof e?"".concat(Object.keys(e)[0]," { ").concat(t.queryFieldsMap(Object.values(e)[0])," }"):"".concat(e)})).join(", "):""},e}();aE.default=fE;var gE={};Object.defineProperty(gE,"__esModule",{value:!0});var yE=cE,vE=lE,OE=function(){function e(e){this.queryDataType=function(e){var t="String",i="object"==typeof e?e.value:e;if(void 0!==e.type)t=e.type;else switch(typeof i){case"object":t="Object";break;case"boolean":t="Boolean";break;case"number":t=i%1==0?"Int":"Float"}return"object"==typeof e&&e.required&&(t+="!"),t},Array.isArray(e)?this.variables=vE.default.resolveVariables(e):(this.variables=e.variables,this.fields=e.fields||[],this.operation=e.operation)}return e.prototype.queryBuilder=function(){return this.operationWrapperTemplate(this.operationTemplate())},e.prototype.queriesBuilder=function(e){var t,i=this;return this.operationWrapperTemplate((t=[],e.forEach((function(e){e&&(i.operation=e.operation,i.fields=e.fields,i.variables=e.variables,t.push(i.operationTemplate()))})),t.join(" ")))},e.prototype.queryDataNameAndArgumentMap=function(){return this.variables&&Object.keys(this.variables).length?"(".concat(Object.keys(this.variables).reduce((function(e,t,i){return"".concat(e).concat(0!==i?", ":"").concat(t,": $").concat(t)}),""),")"):""},e.prototype.queryDataArgumentAndTypeMap=function(){var e=this;return this.variables&&Object.keys(this.variables).length?"(".concat(Object.keys(this.variables).reduce((function(t,i,s){return"".concat(t).concat(0!==s?", ":"","$").concat(i,": ").concat(e.queryDataType(e.variables[i]))}),""),")"):""},e.prototype.operationWrapperTemplate=function(e){var t="string"==typeof this.operation?this.operation:this.operation.name;return{query:"".concat(yE.default.Query," ").concat(t.charAt(0).toUpperCase()).concat(t.slice(1)," ").concat(this.queryDataArgumentAndTypeMap()," { ").concat(e," }"),variables:vE.default.queryVariablesMap(this.variables)}},e.prototype.operationTemplate=function(){var e="string"==typeof this.operation?this.operation:"".concat(this.operation.alias,": ").concat(this.operation.name);return"".concat(e," ").concat(this.queryDataNameAndArgumentMap()," { nodes { ").concat(vE.default.queryFieldsMap(this.fields)," } }")},e}();gE.default=OE,Object.defineProperty(oE,"__esModule",{value:!0});var bE=aE,EE=gE;oE.default={DefaultAppSyncQueryAdapter:EE.default,DefaultAppSyncMutationAdapter:bE.default};var IE={},TE=ht&&ht.__assign||function(){return TE=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},TE.apply(this,arguments)};Object.defineProperty(IE,"__esModule",{value:!0});var SE=cE,AE=lE,PE=function(){function e(e,t){var i=this;Array.isArray(e)?this.variables=AE.default.resolveVariables(e):(this.variables=e.variables,this.fields=e.fields,this.operation=e.operation),this.config={operationName:""},t&&Object.entries(t).forEach((function(e){var t=e[0],s=e[1];i.config[t]=s}))}return e.prototype.mutationBuilder=function(){return this.operationWrapperTemplate(SE.default.Mutation,this.variables,this.operationTemplate(this.operation))},e.prototype.mutationsBuilder=function(e){var t=this,i=e.map((function(e){return t.operation=e.operation,t.variables=e.variables,t.fields=e.fields,t.operationTemplate(e.operation)}));return this.operationWrapperTemplate(SE.default.Mutation,AE.default.resolveVariables(e),i.join("\n  "))},e.prototype.queryDataArgumentAndTypeMap=function(e){return this.fields&&"object"==typeof this.fields&&(e=TE(TE({},AE.default.getNestedVariables(this.fields)),e)),e&&Object.keys(e).length>0?"(".concat(Object.keys(e).reduce((function(t,i,s){return"".concat(t).concat(0!==s?", ":"","$").concat(i,": ").concat(AE.default.queryDataType(e[i]))}),""),")"):""},e.prototype.operationWrapperTemplate=function(e,t,i){var s="".concat(e," ").concat(this.queryDataArgumentAndTypeMap(t)," {\n      ").concat(i,"\n    }");return this.config.operationName&&(s=s.replace("mutation","mutation ".concat(this.config.operationName))),{query:s,variables:AE.default.queryVariablesMap(t,this.fields)}},e.prototype.operationTemplate=function(e){var t="string"==typeof e?e:"".concat(e.alias,": ").concat(e.name);return"".concat(t," ").concat(AE.default.queryDataNameAndArgumentMap(this.variables)," ").concat(this.fields&&this.fields.length>0?"{\n    ".concat(AE.default.queryFieldsMap(this.fields),"\n  }"):"")},e}();IE.default=PE;var wE={},CE=ht&&ht.__assign||function(){return CE=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},CE.apply(this,arguments)};Object.defineProperty(wE,"__esModule",{value:!0});var RE=cE,LE=lE,NE=function(){function e(e,t){var i=this;this.config={operationName:""},t&&Object.entries(t).forEach((function(e){var t=e[0],s=e[1];i.config[t]=s})),Array.isArray(e)?this.variables=LE.default.resolveVariables(e):(this.variables=e.variables,this.fields=e.fields||[],this.operation=e.operation)}return e.prototype.queryBuilder=function(){return this.operationWrapperTemplate(this.operationTemplate(this.variables))},e.prototype.queriesBuilder=function(e){var t,i=this;return this.operationWrapperTemplate((t=[],e.forEach((function(e){e&&(i.operation=e.operation,i.fields=e.fields,t.push(i.operationTemplate(e.variables)))})),t.join(" ")))},e.prototype.queryDataArgumentAndTypeMap=function(){var e=this.variables;return this.fields&&"object"==typeof this.fields&&(e=CE(CE({},LE.default.getNestedVariables(this.fields)),e)),e&&Object.keys(e).length>0?"(".concat(Object.keys(e).reduce((function(t,i,s){return"".concat(t).concat(0!==s?", ":"","$").concat(i,": ").concat(LE.default.queryDataType(e[i]))}),""),")"):""},e.prototype.operationWrapperTemplate=function(e){var t="".concat(RE.default.Query," ").concat(this.queryDataArgumentAndTypeMap()," { ").concat(e," }");return{query:t=t.replace("query","query".concat(""!==this.config.operationName?" "+this.config.operationName:"")),variables:LE.default.queryVariablesMap(this.variables,this.fields)}},e.prototype.operationTemplate=function(e){var t="string"==typeof this.operation?this.operation:"".concat(this.operation.alias,": ").concat(this.operation.name);return"".concat(t," ").concat(e?LE.default.queryDataNameAndArgumentMap(e):""," ").concat(this.fields&&this.fields.length>0?"{ "+LE.default.queryFieldsMap(this.fields)+" }":"")},e}();wE.default=NE;var DE={};Object.defineProperty(DE,"__esModule",{value:!0});var ME=cE,xE=lE,kE=function(){function e(e){Array.isArray(e)?this.variables=xE.default.resolveVariables(e):(this.variables=e.variables,this.fields=e.fields,this.operation=e.operation)}return e.prototype.subscriptionBuilder=function(){return this.operationWrapperTemplate(ME.default.Subscription,this.variables,this.operationTemplate(this.operation))},e.prototype.subscriptionsBuilder=function(e){var t=this,i=e.map((function(e){return t.operation=e.operation,t.variables=e.variables,t.fields=e.fields,t.operationTemplate(e.operation)}));return this.operationWrapperTemplate(ME.default.Subscription,xE.default.resolveVariables(e),i.join("\n  "))},e.prototype.queryDataNameAndArgumentMap=function(){return this.variables&&Object.keys(this.variables).length?"(".concat(Object.keys(this.variables).reduce((function(e,t,i){return"".concat(e).concat(0!==i?", ":"").concat(t,": $").concat(t)}),""),")"):""},e.prototype.queryDataArgumentAndTypeMap=function(e){return Object.keys(e).length?"(".concat(Object.keys(e).reduce((function(t,i,s){return"".concat(t).concat(0!==s?", ":"","$").concat(i,": ").concat(xE.default.queryDataType(e[i]))}),""),")"):""},e.prototype.operationWrapperTemplate=function(e,t,i){return{query:"".concat(e," ").concat(this.queryDataArgumentAndTypeMap(t)," {\n  ").concat(i,"\n}"),variables:xE.default.queryVariablesMap(t)}},e.prototype.operationTemplate=function(e){var t="string"==typeof this.operation?this.operation:"".concat(this.operation.alias,": ").concat(this.operation.name);return"".concat(t," ").concat(this.queryDataNameAndArgumentMap()," {\n    ").concat(this.queryFieldsMap(this.fields),"\n  }")},e.prototype.queryFieldsMap=function(e){var t=this;return e?e.map((function(e){return"object"==typeof e?"".concat(Object.keys(e)[0]," { ").concat(t.queryFieldsMap(Object.values(e)[0])," }"):"".concat(e)})).join(", "):""},e}();DE.default=kE,Object.defineProperty(nE,"__esModule",{value:!0}),nE.adapters=FE=nE.query=nE.mutation=nE.subscription=void 0;var HE=oE;nE.adapters=HE.default;var jE=IE,UE=wE,BE=DE,FE=nE.query=function(e,t,i){return Array.isArray(e)?t?new t(e,i).queriesBuilder(e):new UE.default(e,i).queriesBuilder(e):t?new t(e,i).queryBuilder():new UE.default(e,i).queryBuilder()};nE.mutation=function(e,t,i){return Array.isArray(e)?t?new t(e,i).mutationsBuilder(e):new jE.default(e,i).mutationsBuilder(e):t?new t(e,i).mutationBuilder():new jE.default(e,i).mutationBuilder()},nE.subscription=function(e,t){return Array.isArray(e)?t?new t(e).subscriptionsBuilder(e):new BE.default(e).subscriptionsBuilder(e):t?new t(e).subscriptionBuilder():new BE.default(e).subscriptionBuilder()};const VE="\n    fragment repoMetadata on Asset {\n        repo_assetId\n        repo_name\n        repo_path\n        repo_createDate\n        repo_createdBy {\n            id\n        }\n        repo_modifyDate\n        repo_modifiedBy\n        primary_etag\n        repo_state\n        dc_format\n        storage_deviceCreateDate\n        storage_deviceModifyDate\n        storage_region\n        storage_assignee {\n            id\n            type\n        }\n        repository {\n            repo_repositoryId\n            repo_repositoryType\n            repo_owner {\n                id\n            }\n        }\n        repo_ancestors\n        repo_assetClass\n        primaryLink {\n            href\n            templated\n        }\n        blockUploadLink {\n            href\n            templated\n        }\n        ... on CompositeImpl {\n            repo_version\n            repo_size\n            isComposite\n            primaryLink {\n                href\n            }\n            blockDownloadLink {\n                href\n            }\n            renditionLink {\n                href\n            }\n        }\n        ... on FileImpl {\n            repo_version\n            repo_size\n            isFile\n            primaryLink {\n                href\n            }\n            blockDownloadLink {\n                href\n            }\n            renditionLink {\n                href\n            }\n        }\n    }\n",KE='\n    fragment applicationMetadata on Asset {\n        appMetadata {\n            am: valueOf(key: "")\n        }\n    }\n',$E="\n    fragment effectivePermissions on Asset {\n        effectivePermissions {\n            aclPolicy\n            annotations\n            applicationMetadata\n            default\n            directory\n            primary\n        }\n    }\n";function GE(e){var t,i,s,r;if(!(null==e?void 0:e.listingHints))return"";let n="... on DirectoryImpl {";for(let o=0;o<e.listingHints.length;o++){const a=e.listingHints[o].order;n+=`\n        list${o+1}: childrenConnection(\n            first: ${null!==(i=null===(t=e.listingHints[o].loadOptions)||void 0===t?void 0:t.limit)&&void 0!==i?i:10},\n            orderBy: [\n                {\n                    field: ${sE[a.field]},\n                    direction: ${a.direction.toUpperCase()}\n                }\n            ],\n            filter: {\n                dc_format: ${null!==(r=null===(s=e.listingHints[o].filter)||void 0===s?void 0:s.mediaTypes)&&void 0!==r?r:null}\n            }\n        ) {\n            edges {\n                node {\n                    ...repoMetadata\n                    ...applicationMetadata\n                    # TODO: undefined effectivePermissions is equivalent to false for now.\n                    # We will change it to deferred in the future.\n                    ${e.listingHints[o].effectivePermissions?"...effectivePermissions":""}\n                }\n            }\n            pageInfo {\n                endCursor\n                hasNextPage\n            }\n        }\n        `}return n+="}",n}function WE(e){let t="";return(null==e?void 0:e.appMetadata)&&(t+="\n            ...applicationMetadata\n        "),(null==e?void 0:e.effectivePermissions)&&(t+="\n            ...effectivePermissions\n        "),t}function zE(e){var t;return(null==e?void 0:e.effectivePermissions)||(null===(t=null==e?void 0:e.listingHints)||void 0===t?void 0:t.some((e=>e.effectivePermissions)))}function qE(e){var t;return(null==e?void 0:e.appMetadata)||(null===(t=null==e?void 0:e.listingHints)||void 0===t?void 0:t.length)}function YE(e){return VE+(qE(e)?KE:"")+(zE(e)?$E:"")+`\n        query getAssetByPath($assetPath: String!, $repositoryId: ID!) {\n            resolveAssetByPath(assetPath: $assetPath, repositoryId: $repositoryId) {\n                ...repoMetadata\n                ${WE(e)}\n                ${GE(e)}\n            }\n        }\n    `}function QE(e){return VE+(qE(e)?KE:"")+(zE(e)?$E:"")+`\n        query getAssetByPath($assetPath: String!) {\n            resolveUserHome {\n                ...repoMetadata\n                ... on DirectoryImpl {\n                    assetByRelativePath(relativePath: $assetPath) {\n                        ...repoMetadata\n                        ${WE(e)}\n                        ${GE(e)}\n                    }\n                }\n            }\n        }\n    `}const JE=Yb`
    mutation updateLastAccessed($assetId: ID!, $input: UpdateLabelInput!) {
        updateLabel(assetId: $assetId, input: $input) {
            lastAccessDate
        }
    }
`;class XE{constructor(e){this._core=e}async _client(e=!0){var t;const i=this._core._environment.getValue("HIGH_PRIORITY_RAPI_REQUESTS"),s=new iO(Object.assign({uri:i?`https://${this._core._environment.endpoints.ACPC_SUPERGRAPH_EDGE_HOST}`:`https://${this._core._environment.endpoints.ACPC_SUPERGRAPH_HOST}`},(null===(t=this._core._environment._hooks)||void 0===t?void 0:t.fetch)?{fetch:this._core._environment._hooks.fetch}:{}));await this._core._environment._refreshAccessToken();const r=new Bv(((e,t)=>{const i=this._core._environment.getValue("ACCESS_TOKEN");return e.setContext({headers:{authorization:`Bearer ${i}`,"x-api-key":this._core._environment.getValue("CLIENT_ID")}}),t(e)})),n=new Zb({delay:(e,t,i)=>{if(1===e)return 0;const s=this._core._environment.getValue("MIN_RETRY_INTERVAL"),r=this._core._environment.getValue("MAX_RETRY_INTERVAL"),n=rr(1e3*Math.pow(2,e),s,r);return this._core._environment.log(`GQL: Retryable error ${i.statusCode} retrying in ${n}ms, ${e} retries so far`),n},attempts:async(e,t,i)=>{const s=this._core._environment._maxNumberOfRetries,r=e>s,n=function(e){return e&&"statusCode"in e&&"number"==typeof e.statusCode}(i)&&401===i.statusCode;return n&&(this._core._environment._isTokenInvalid=!0),r&&this._core._environment.log(`GQL: Retryable error ${i.statusCode} attempt ${e} exceeded ${s} retries`),!(r||!n||(await this._core._environment._refreshAccessToken(),0))}});return new Fb({link:Fv([n,r,s]),cache:new Eb({addTypename:e}),defaultOptions:{query:{fetchPolicy:"no-cache",errorPolicy:"all"}}})}async initialize(e=!0){await this._client(e)}async getFavorites(e){var t;const i=await this._client();let s;try{s=FE({operation:"favorites",fields:["assetListId",{operation:"assetListConnection",variables:{first:{value:e.first,required:!0},after:e.after,filter:{value:e.filter,type:"AssetListFilter",required:!1},orderBy:{value:e.orderBy,type:"FavoriteOrderByInput",required:!1}},fields:[{pageInfo:["hasNextPage","endCursor"]},{edges:["cursor",{node:[{operation:"Asset",fragment:!0,fields:tE}]}]}]}]},null,{operationName:"favorites"})}catch(e){console.error("error building query string",e)}const r=s&&await i.query({query:Yb(s.query),variables:s.variables}).catch((e=>{throw Ge.createWithApolloError(e)}));if(null===(t=r.errors)||void 0===t?void 0:t[0])throw Ge.createWithGraphQLError(r.errors[0]);return r.data}async setFavorite(e,t){const i=await this._client();try{await i.mutate({mutation:Yb`
                    mutation updateLabel($assetId: ID!, $input: UpdateLabelInput!) {
                        updateLabel(assetId: $assetId, input: $input) {
                            favorite {
                                isFavorite
                            }
                        }
                    }
                `,variables:{assetId:e,input:{favorite:{isFavorite:t}}}})}catch(e){if(e instanceof zv)throw Ge.createWithApolloError(e);throw Ge.create(Ue.UNKNOWN,"No data or error returned from the query getAssetById")}}async getAssetById(e){var t,i,s;const r=await this._client(),n=FE({operation:"resolveAssetById",variables:{assetId:{value:e,name:"assetId",required:!0,type:"ID"}},fields:tE},null,{operationName:"getAssetById"}),o=await r.query({query:Yb(n.query),variables:n.variables}).catch((e=>{throw Ge.createWithApolloError(e)}));if(!(null===(t=o.data)||void 0===t?void 0:t.resolveAssetById)){if(!(null===(i=o.errors)||void 0===i?void 0:i[0]))throw Ge.create(Ue.UNKNOWN,"No data or error returned from the query getAssetById");throw Ge.createWithGraphQLError(null===(s=o.errors)||void 0===s?void 0:s[0])}return o.data}async getAssetByPath(e,t,i){var s,r,n,o,a,c;const l=await this._client();if(t){const o={query:YE(i),variables:{assetPath:e,repositoryId:t}},a=await l.query({query:Yb(o.query),variables:o.variables}).catch((e=>{throw Ge.createWithApolloError(e)}));if(!(null===(s=a.data)||void 0===s?void 0:s.resolveAssetByPath)){if(!(null===(r=a.errors)||void 0===r?void 0:r[0]))throw Ge.create(Ue.UNKNOWN,"No data or error returned from the query getAssetById");throw Ge.createWithGraphQLError(null===(n=a.errors)||void 0===n?void 0:n[0])}return a.data}const d={query:QE(i),variables:{assetPath:e}},u=await l.query({query:Yb(d.query),variables:d.variables}).catch((e=>{throw Ge.createWithApolloError(e)}));if(!(null===(o=u.data)||void 0===o?void 0:o.resolveUserHome)){if(!(null===(a=u.errors)||void 0===a?void 0:a[0]))throw Ge.create(Ue.UNKNOWN,"No data or error returned from the query getAssetById");throw Ge.createWithGraphQLError(null===(c=u.errors)||void 0===c?void 0:c[0])}return u.data}async getSharedWithYou(e,t){const i=await this._client(),{first:s,after:r,filter:n,orderBy:o}=e,a=await Promise.resolve().then((function(){return NA}));return new Promise(((e,c)=>{const l=i.subscribe({query:a.SHARED_WITH_YOU_ASSETS,variables:{first:s,after:r,filter:n,orderBy:o},fetchPolicy:"network-only"});let d=!1;l.subscribe({next:i=>{var s,r;const n=(null!==(r=null===(s=i.errors)||void 0===s?void 0:s.length)&&void 0!==r?r:0)>0,o=!!i.data,a=i,l=!!a.incremental;if(n){const e=i.errors[0];if(!o&&!l)return void c(Ge.createWithGraphQLError(e));console.warn("GQLInterface - Shared With You Query GraphQL Errors: ",e.message)}if(o||l)if(l&&d){const e=a.incremental.map((e=>e.data));null==t||t(e)}else o&&!d&&(d=!0,e(i.data));else c(Ge.create(Ue.UNKNOWN,"No data or error returned from the Shared With You query"))},error:e=>{console.error("GQLInterface: Subscription error",e),c(Ge.createWithApolloError(e))}})}))}async getChildren(e,t){var i,s,r;const n=await this._client(),o={query:VE+KE+$E+"\n        query getChildren($assetId: ID!, $first: Int!, $after: String, $orderBy: [OrderByInput!], $filter: AssetFilter) {\n            resolveAssetById(assetId: $assetId) {\n                ... on DirectoryImpl {\n                    childrenConnection(first: $first, after: $after, orderBy: $orderBy, filter: $filter) {\n                        edges {\n                            node {\n                                ...repoMetadata\n                                ...applicationMetadata\n                                ...effectivePermissions\n                            }\n                        }\n                        pageInfo {\n                            endCursor\n                            hasNextPage\n                        }\n                    }\n                }\n            }\n        }\n    ",variables:{assetId:e,first:t.first,after:t.after,orderBy:t.orderBy,filter:t.filter}},a=await n.query({query:Yb(o.query),variables:o.variables}).catch((e=>{throw Ge.createWithApolloError(e)}));if(!(null===(i=a.data)||void 0===i?void 0:i.resolveAssetById)){if(!(null===(s=a.errors)||void 0===s?void 0:s[0]))throw Ge.create(Ue.UNKNOWN,"No data or error returned from the query getChildren");throw Ge.createWithGraphQLError(null===(r=a.errors)||void 0===r?void 0:r[0])}return a.data.resolveAssetById.childrenConnection}async recents(e,t){const i=await this._client(),{first:s,after:r,filter:n}=e,o=await Promise.resolve().then((function(){return MA}));return new Promise(((e,a)=>{const c=i.subscribe({query:o.recents,variables:{first:s,after:r,filter:n},fetchPolicy:"network-only"});let l=!1;c.subscribe({next:i=>{var s,r;const n=(null!==(r=null===(s=i.errors)||void 0===s?void 0:s.length)&&void 0!==r?r:0)>0,o=!!i.data,c=i,d=!!c.incremental;if(n){const e=i.errors[0];if(!o&&!d)return void a(Ge.createWithGraphQLError(e));console.warn("GQLInterface - Recents Query GraphQL Errors: ",e.message)}if(o||d)if(d&&l){const e=c.incremental.map((e=>e.data));null==t||t(e)}else o&&!l&&(l=!0,e(i.data));else a(Ge.create(Ue.UNKNOWN,"No data or error returned from the Recents query"))},error:e=>{console.error("GQLInterface: Subscription error",e),a(Ge.createWithApolloError(e))}})}))}async updateLastAccessed(e){var t,i,s;const r=await this._client(),n=await r.mutate({mutation:JE,variables:e}).catch((e=>{throw Ge.createWithApolloError(e)}));if(!(null===(t=n.data)||void 0===t?void 0:t.updateLabel)){if(!(null===(i=n.errors)||void 0===i?void 0:i[0]))throw Ge.create(Ue.UNKNOWN,"No data or error returned from the query updateLastAccessed");throw Ge.createWithGraphQLError(null===(s=n.errors)||void 0===s?void 0:s[0])}}}qe([rt],XE.prototype,"_client",null),qe([Pt],XE.prototype,"initialize",null);class ZE{constructor(e){this._core=e,this._gqlInterface=new XE(this._core),this._listData=new Map}async initialize(){await this._gqlInterface.initialize()}async getAssetByPath(e,t,i){const s=await this._gqlInterface.getAssetByPath(e,t,i);let r,n;if(t&&0!==t.length)n=s.resolveAssetByPath,r={assetData:this._convertGQLAssetToAdobeAssetData(n)};else{const e=s.resolveUserHome;n=e.assetByRelativePath,r={homeFolderData:this._convertGQLAssetToAdobeAssetData(e),assetData:this._convertGQLAssetToAdobeAssetData(n)}}if(null==i?void 0:i.listingHints)for(let e=0;e<i.listingHints.length;e++){const t=n[`list${e+1}`].edges.map((e=>this._convertGQLAssetToAdobeAssetData(e.node))),s=this.generateDirectoryLoaderHash({assetId:n.repo_assetId,filter:i.listingHints[e].filter,order:i.listingHints[e].order,loadOptions:i.listingHints[e].loadOptions});this._listData.set(s,{children:t,pageInfo:n[`list${e+1}`].pageInfo})}return r}async getAssetById(e){const t=await this._gqlInterface.getAssetById(e);return this._convertGQLAssetToAdobeAssetData(t.resolveAssetById)}async getFavorites(e){const{favorites:{assetListConnection:{pageInfo:t,edges:i}}}=await this._gqlInterface.getFavorites(e);return{favorites:i.map((e=>this._convertGQLAssetToAdobeAssetData(e.node))),pageInfo:t}}async getSharedWithYou(e,t){const{sharedWithYou:{assetListConnection:{pageInfo:i,edges:s}}}=await this._gqlInterface.getSharedWithYou(e,t);return{items:s.map((e=>this._convertGQLAssetToAdobeAssetData(e.node))),pageInfo:i}}async recents(e,t){const{recents:{assetListConnection:{pageInfo:i,edges:s}}}=await this._gqlInterface.recents(e,t);return{items:s.map((e=>this._convertGQLAssetToAdobeAssetData(e.node))),pageInfo:i}}_parseEffectivePermissions(e){const t=e=>null==e?void 0:e.map((e=>e.toLowerCase())),i={};return i["*"]=t(e.default),i[gt.PRIMARY]=t(e.primary),i[gt.AC_POLICY]=t(e.aclPolicy),i[gt.DIRECTORY]=t(e.directory),i[gt.APP_METADATA]=t(e.applicationMetadata),i[gt.ANNOTATIONS]=t(e.annotations),Gi(i)}_convertGQLAssetToAdobeAssetData(e){var t,i,s,r,n,o,a;const c=Object.fromEntries(Object.entries(null!==(t=e.repo_representations)&&void 0!==t?t:{}).filter((([,e])=>!0===e))),l=e.effectivePermissions&&this._parseEffectivePermissions(e.effectivePermissions);return{"dc:format":e.dc_format,"repo:ancestors":e.repo_ancestors,"repo:assetClass":e.repo_assetClass.toLowerCase(),"repo:representations":c,"repo:assetId":e.repo_assetId,"repo:etag":e.primary_etag,"repo:createDate":e.repo_createDate,"repo:createdBy":e.repo_createdBy.id,"repo:modifyDate":e.repo_modifyDate,"repo:name":e.repo_name,"repo:path":e.repo_path,"repo:modifiedBy":e.repo_modifiedBy,"repo:repositoryId":null===(i=e.repository)||void 0===i?void 0:i.repo_repositoryId,"repo:state":e.repo_state,"repo:size":e.repo_size,"repo:version":e.repo_version,"storage:assignee":e.storage_assignee,"storage:region":e.storage_region,"storage:deviceCreateDate":e.storage_deviceCreateDate,"storage:deviceModifyDate":e.storage_deviceModifyDate,effectivePermission:l,perUserMetadata:{"shell:lastAccessDate":null===(s=e.labels)||void 0===s?void 0:s.lastAccessDate},_embedded:{[gt.APP_METADATA]:(null===(r=e.appMetadata)||void 0===r?void 0:r.am)||{}},_links:{[gt.PRIMARY]:e.primaryLink,[gt.BLOCK_INITIALIZE]:e.blockUploadLink,[gt.DOWNLOAD]:e.blockDownloadLink,[gt.RENDITION]:e.renditionLink,[gt.PAGE]:e.pageLink},isFavorite:null===(o=null===(n=e.labels)||void 0===n?void 0:n.favorite)||void 0===o?void 0:o.isFavorite,sharedViaInvite:!!(null===(a=e.sharingInfo)||void 0===a?void 0:a.sharedWithYou)}}async setFavorite(e,t){await this._gqlInterface.setFavorite(e,t)}generateDirectoryLoaderHash({assetId:e,order:t,filter:i=new Fd,loadOptions:s}){let r=e+":"+t.hash+":"+i.hash;return(null==s?void 0:s.limit)&&(r+="limit:"+s.limit),r}async getChildren(e,t){var i,s,r;const n=this.generateDirectoryLoaderHash({assetId:e,filter:t.filter,order:t.order,loadOptions:t.loadOptions});if(this._listData.has(n)){const e=this._listData.get(n);return this._listData.delete(n),e}const o=await this._gqlInterface.getChildren(e,{first:null!==(s=null===(i=t.loadOptions)||void 0===i?void 0:i.limit)&&void 0!==s?s:20,orderBy:[{field:sE[t.order.field],direction:t.order.direction.toUpperCase()}],filter:(null===(r=t.filter)||void 0===r?void 0:r.mediaTypes)?{dc_format:[...t.filter.mediaTypes]}:void 0,after:t.after});return{children:o.edges.map((e=>this._convertGQLAssetToAdobeAssetData(e.node))),pageInfo:o.pageInfo}}async updateLastAccessed(e,t){await this._gqlInterface.updateLastAccessed({assetId:e,input:{lastAccessDate:t}})}}qe([Pt],ZE.prototype,"getAssetByPath",null),qe([Pt],ZE.prototype,"getAssetById",null),qe([Pt],ZE.prototype,"getFavorites",null);var eI=Object.freeze({__proto__:null,default:ZE});const tI={[gt.WORKSPACES_CONTEXT]:[],[gt.TEAMS_PAGE]:["start","limit"],[gt.WORKSPACES_PRIMARY]:["id","selector"],[gt.WORKSPACES_PAGE]:["orderBy","start","limit","teamId","bookmarkFilter","teamAccess"],[gt.REPOSITORIES_PAGE]:[],[gt.TEAMS_CREATE]:[],[gt.TEAM_PROVISION]:[],[gt.WORKSPACES_BOOKMARKS_BATCH]:[]},iI=[200,201],sI=["FULL"],rI={start:0,limit:0,orderDirection:"ascending",orderBy:"name"},nI={orderDirection:"ascending",orderBy:"name",bookmarked:!1,teamID:void 0,start:0,limit:0};function oI(e,t){return Object.assign({},e,t)}function aI(e){return("ascending"===e.orderDirection?"+":"-")+e.orderBy}function cI(e){const t={};return e.start&&(t.start=e.start),e.limit&&(t.limit=e.limit),t}class lI extends lr{_getHeaders(e){const t={"x-service-features":"CanvasMigration","Cache-Control":"no-cache"};return e&&(t["Content-Type"]=e),t}async _discoverLinks(e){return(await this._getResponse(e,this._getHeaders()))._links}_getEndpointHref(e){return`https://${this._core._environment.endpoints.PROJECTS_HOST}${e}`}async discoverLinks(){return this._discoverLinks(this._getEndpointHref("/api/v2/index"))}async getTeams(e){const t=function(e,t){const i=oI(rI,t),s=cI(i);return s.orderBy=aI(i),s.nameContains=i.nameContains,s.state=i.state,bt(e,gt.TEAMS_PAGE,s)}(await this.discoverLinks(),e);return await this._getResponse(t,this._getHeaders())}async getOrgRepositories(){const e=bt(await this.discoverLinks(),gt.REPOSITORIES_PAGE,{});return await this._getResponse(e,this._getHeaders())}async createTeam(e){const t=bt(await this.discoverLinks(),gt.TEAMS_CREATE,{});return(await this._doPost(t,this._getHeaders(mt),JSON.stringify(e))).json()}async permanentlyDeleteTeam(e){const t=bt(e,gt.TEAMS_PRIMARY);await this._doDelete(t,this._getHeaders(),[204])}async archiveTeam(e){const t=bt(e,gt.TEAMS_DISCARD);await this._doPost(t,this._getHeaders(),void 0,[204])}async restoreTeam(e){const t=bt(e,gt.TEAMS_RESTORE);await this._doPost(t,this._getHeaders(),void 0,[204])}async renameTeam(e,t){const i=bt(e,gt.TEAMS_RENAME);await this._doPost(i,this._getHeaders(mt),JSON.stringify({name:t}),[204])}async patchTeam(e,t){const i=bt(e,gt.TEAMS_PROPERTIES);await this._doPatch(i,Object.assign(Object.assign({},this._getHeaders(ft)),{"If-Match":"*"}),JSON.stringify(t),[204])}async getTeamProperties(e){const t=bt(e,gt.TEAMS_PROPERTIES);return await this._getResponse(t,this._getHeaders())}async provisionTeam(){const e=bt(await this.discoverLinks(),gt.TEAM_PROVISION,{});return(await this._doPost(e,this._getHeaders(),void 0,iI)).json()}async getSpaces(e){const t=function(e,t){const i=oI(nI,t),s=cI(i);s.orderBy=aI(i),i.bookmarked||(s.bookmarkFilter=!1),!1===i.teamAccess&&(s.teamAccess=!1);const{teamID:r}=i;return r&&(s.teamId=r),bt(e,gt.WORKSPACES_PAGE,s)}(await this.discoverLinks(),e);return await this._getResponse(t,this._getHeaders())}async getSpace(e,t=sI){const i=bt(await this.discoverLinks(),gt.WORKSPACES_PRIMARY,{id:e,selector:t});return await this._getResponse(i,this._getHeaders())}async reloadSpace(e,t=sI){const i=bt(e,gt.WORKSPACES_PRIMARY,{selector:t});return await this._getResponse(i,this._getHeaders())}async bookmarkOp(e){const t=bt(await this.discoverLinks(),gt.WORKSPACES_BOOKMARKS_BATCH);return(await this._doPost(t,this._getHeaders(mt),JSON.stringify(e),[200])).json()}async createSpace(e,t){const i=bt(e,gt.WORKSPACES_CREATE);return(await this._doPost(i,this._getHeaders(mt),JSON.stringify(t))).json()}async patchSpace(e,t){const i=bt(e,gt.WORKSPACES_PRIMARY);await this._doPatch(i,this._getHeaders(ft),JSON.stringify(t),[200,204])}async getEnclosingSpaces(e){const t=bt(await this.discoverLinks(),gt.WORKSPACES_CONTEXT);return(await this._doPost(t,this._getHeaders(mt),JSON.stringify(e),[200])).json()}}qe([st((function(e){return yt(e,tI)})),Ye(0,tt)],lI.prototype,"_discoverLinks",null);class dI{constructor(e,t,i){this._spacePool=e,this._workspaceInterface=t,this._teamRoleGetterFactory=i}supportsFilter(e){if(!e)return!1;const{teamRole:t,state:i}=e;return"MEMBER"!==t&&"active"===i}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i;const{order:s,filter:r}=e,{limit:n}=null!==(i=e.loadOptions)&&void 0!==i?i:{},o=null==r?void 0:r.teamRole;if("MEMBER"===o)throw Ge.create(Ue.BAD_REQUEST,"Filtering only for spaces with reamRole MEMBER is not supported.");const a=this._spacePool._core._environment.getValue("PROJECTS_LIST_UPDATE_LATENCY"),c=Date.now()-a,l=this._workspaceInterface.getSpaces({orderBy:Jp[s.field],orderDirection:s.direction,teamID:null==r?void 0:r.teamID,bookmarked:null==r?void 0:r.bookmarked,teamAccess:"NONE"!==o&&void 0,start:t,limit:n}),d=o?()=>o:await this._teamRoleGetterFactory(),u=await l,h=this._spacePool.createLoaderUpdateSession(c),p=Tc.updateRemoteItems(h,u.projects.map((e=>Object.assign(Object.assign({},e),{teamRole:d(e.teamId),state:"active"}))));for(const e of p)e[yc]();let _;h.commit();const m=u.pageSpec.start+u.pageSpec.limit;return m<u.pageSpec.totalLimit&&(_=e=>this._loadPage(e,m)),{items:p,total:u.pageSpec.totalLimit,loadNextPage:_,mostRecentValidMutation:c}}}class uI{constructor(e,t){this._teamPool=e,this._projectInterface=t}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i;const{order:s,filter:r}=e,{limit:n}=null!==(i=e.loadOptions)&&void 0!==i?i:{},o=this._teamPool._core._environment.getValue("PROJECTS_LIST_UPDATE_LATENCY"),a=Date.now()-o,c=await this._projectInterface.getTeams({orderBy:qp[s.field],orderDirection:s.direction,start:t,limit:n,nameContains:null==r?void 0:r.nameContains,state:null==r?void 0:r.state}),l=this._teamPool.createLoaderUpdateSession(a),d=p_.updateRemoteItems(l,c.teams);let u;l.commit();const h=c.pageSpec.start+c.pageSpec.limit;return h<c.pageSpec.totalLimit&&(u=e=>this._loadPage(e,h)),{items:d,total:c.pageSpec.totalLimit,loadNextPage:u,mostRecentValidMutation:a}}}class hI{constructor(e,t){this._orgRepositoryPool=e,this._projectInterface=t}async loadPage(){const e=await this._projectInterface.getOrgRepositories(),t=this._orgRepositoryPool.createLoaderUpdateSession(Date.now()),i=Rp.updateRemoteItems(t,e.repositories);return t.commit(),{items:i}}}function pI(e){const t=new Set(e.items.map((e=>e.id)));return e=>t.has(e)?"MEMBER":"NONE"}function _I(e){const t=e._links;if(!t)throw Ge.create(Ue.BAD_REQUEST,'Object has not been loaded correctly, missing "_links" property.');return t}class mI{constructor(e){this._core=e,this._orgRepositoryPool=new qo(this._core,"orgRepository"),this._teamPool=new qo(this._core,"team"),this._spacePool=new qo(this._core,"space"),this._projectInterface=new lI(this._core),this._rapi=new El(this._core),this._hostAssetContext=this._core.hostAssetContext,this._teamRoleGetterFactory=async()=>pI(await this._fetchTeams()),this._teamPoolDelegate={onItemsUpdated:()=>{const e=this.getTeams()._getExistingList(Qp.default,new vo);if(!e||!e.items.length)return void this._core._environment.debug("[SpaceContext._teamPoolDelegate] skipping update of Space.teamRole -- no teams");const t=this._spacePool,i=pI(e),s=t.createUpdateSession("Updating teamRole across all spaces");this._spacePool.forEach((e=>{const t=i(e.teamID);e.teamRole!==t&&Tc.updateLocalItem(s,e,{teamRole:t})})),s.commit()}},this._teamPool.addDelegate(this._teamPoolDelegate,"context")}get projectInterface(){return this._projectInterface}get orgRepositoryPool(){return this._orgRepositoryPool}get teamPool(){return this._teamPool}get spacePool(){return this._spacePool}async discoverLinks(){return await this._projectInterface.discoverLinks()}getOrgRepositories(){const e=new hI(this._orgRepositoryPool,this._projectInterface);return new xo(this._orgRepositoryPool,[e])}getTeams(){const e=new uI(this._teamPool,this._projectInterface);return new xo(this._teamPool,[e],new u_)}getSpaces(){const e=new dI(this._spacePool,this._projectInterface,this._teamRoleGetterFactory);return new xo(this._spacePool,[e],new l_)}async _fetchTeams(){const e=this.getTeams().getList(Qp.default,void 0,{refreshTimeout:3e5});return await Ro(e),e}async provisionType1Team(){if("type1"!==this._core._environment.getValue("ACCOUNT_TYPE"))return;const e=await this._fetchTeams(),t=this._core._environment.getValue("USER_ID");let i=e.items.find((e=>e.repositoryOwnerID===t&&"user"===e.repositoryOwnerType));if(!i){const e=await this._projectInterface.provisionTeam(),t=this._teamPool.createMutationSession();i=p_.updateRemoteItem(t,e),t.commit()}return i}async createTeam(e,t){const i=await this._projectInterface.createTeam(Object.assign(Object.assign({},t),{repositoryId:e.repositoryID})),s=this._teamPool.createMutationSession(),r=p_.updateRemoteItem(s,i);return s.commit(),r}async _renameAsset(e,t){if(!Or(t))throw Ge.create(Ue.BAD_REQUEST,"Invalid name provided for the rename operation.");const i=await this._hostAssetContext.getAssetWithCloudID(e);return await i.rename(t),i}async _renameTeam(e,t){const i=t.name;if(!i)return;if(!Or(i))throw Ge.create(Ue.BAD_REQUEST,"Invalid name provided for the rename operation.");const s=_I(e);await this._projectInterface.renameTeam(s,i);const r=this._core._getAssetPool(),n=r.getLocalItemById(e.id),o=await this._core.getAssetContext();if(n){const e=wr(i,n),t=r.createUpdateSession();Cr({assetPool:r,asset:n,session:t,operation:{type:"rename",newPath:e},assetContext:o}),this._hostAssetContext._adobeAssetUpdater.updateLocalItem(t,n,{"repo:path":e,"repo:name":i}),t.commit()}const a=this.teamPool.createMutationSession();p_.updateLocalItem(a,e,{name:i}),a.commit()}async renameTeam(e,t){await this.updateTeam(e,{name:t})}async restoreTeam(e){await Fs.runExclusiveTask("restore",[e],(async()=>{try{const t=_I(e),i=this.teamPool.createUpdateSession();await this._projectInterface.restoreTeam(t),p_.updateLocalItem(i,e,{state:"active"}),i.commit()}catch(e){throw Ge.create(Ue.UNKNOWN,"An error occured restoring team",{underlyingError:e})}}))}async archiveTeam(e){await Fs.runExclusiveTask("archive",[e],(async()=>{const t=this.teamPool.createUpdateSession();try{const t=_I(e);await this._projectInterface.archiveTeam(t)}catch(t){const i=t;if(i.code!==Ue.BAD_REQUEST)throw i;{const t=await this._hostAssetContext.getAssetWithCloudID(e.id);await t.discard()}}p_.updateLocalItem(t,e,{state:"discarded"}),t.commit()}))}_validateDescription(e){return e.length<=1e3}_validateColor(e){return/^#[A-Fa-f0-9]{6}$/.test(e)}_getPatchOP(e,t,i,s){if(s&&!s(e))throw Ge.create(Ue.BAD_REQUEST,`Property ${t} has invalid value`);return 0===e.length&&i&&i.length>0?{op:"remove",path:t}:{op:i?"replace":"add",value:e,path:t}}async _patchTeam(e,t){const{description:i}=t,s=[],r={};if(void 0!==i&&(s.push(this._getPatchOP(i,"/description",e.description,this._validateDescription)),r.description=i),!s.length)return;const n=_I(e);await this._projectInterface.patchTeam(n,s);const o=this.teamPool.createMutationSession();p_.updateLocalItem(o,e,r),o.commit()}async updateTeam(e,t){await Fs.runExclusiveTask("update",[e],(async()=>{const i=await Promise.allSettled([this._patchTeam(e,t),this._renameTeam(e,t)]);this._checkForRejection(i,(()=>{const t=this.teamPool.createUpdateSession();t.queueDiscardedItem(e),t.commit()}))}))}async loadTeamProperties(e){const t=_I(e),i=await this._projectInterface.getTeamProperties(t);if(!i||0===Object.keys(i).length)return;const s=this.teamPool.createMutationSession();p_.updateLocalItem(s,e,Object.assign({},i)),s.commit()}async permanentlyDeleteTeam(e){if("active"===e.state)throw Ge.create(Ue.UNSUPPORTED,"Teams that are not 'discarded' cannot be permanently deleted.");const t=t=>{if(t.discardedItems){const i=t.discardedItems.filter((t=>t.id===e.id)).map((e=>e.id));i.length&&this._teamPool.removeLocalItems(i)}};this._teamPool.on(Go,t);try{await Fs.runExclusiveTask("delete",[e],(async()=>{const t=_I(e);await this._projectInterface.permanentlyDeleteTeam(t);const i=this.teamPool.createUpdateSession();i.queueDiscardedItem(e),i.commit()}))}finally{this.teamPool.off(Go,t)}}async[gc](e){const t=this._core._environment.getValue("PROJECTS_ITEM_UPDATE_LATENCY");await e.waitForMutationPropagationIfNeeded(t);const i=_I(e),s=await this._projectInterface.reloadSpace(i,sI),r=this._spacePool.createUpdateSession();Tc.updateLocalItem(r,e,s),r.commit()}async _moveSpaces(e,t,i=new Map,s=!0,r){let n={failedResults:[],newModels:[]};return await Fs.runExclusiveTask("move",e,(async()=>{const s=await this._hostAssetContext.getAssetWithCloudID(t.id);void 0===r&&(r=new Map);const o=new Map,a=e.map((e=>{o.set(e.id,e);let t=`${s.repoPath}/${Rr(e,i)}`;return t=Ir(this._core,e.id,t,!1,r),{op:"move",id:e.id,source:{"repo:assetId":e.id,"repo:repositoryId":e.repositoryID},target:{"repo:path":t,"repo:repositoryId":s.repositoryID}}}));n=await this._runOperations(a,o,{teamId:t.id,teamName:t.name})})),s?await Gl(n,t,i,r,this._moveSpaces.bind(this)):n}async moveSpaces(e,t){return this._moveSpaces(e,t)}async archiveSpaces(e){return await Fs.runExclusiveTask("archive",e,(async()=>{const t=new Map,i=e.map((e=>(t.set(e.id,e),{op:"discard",id:e.id,target:{"repo:assetId":e.id,"repo:repositoryId":e.repositoryID}})));return await this._runOperations(i,t)}))}async restoreSpaces(e,t){return await Fs.runExclusiveTask("restore",e,(async()=>{const i=new Map,s=e.map((e=>(i.set(e.id,e),{op:"restore",id:e.id,target:{"repo:assetId":e.id,"repo:repositoryId":e.repositoryID},name:null==t?void 0:t.get(e)})));return await this._runOperations(s,i)}))}async _runOperations(e,t,i={}){const s=await this._core.getAssetContext();return await this._rapi.runOperationsForContext(e,t,this._spacePool,((e,t,r)=>{if(!r)throw Ge.create(Ue.UNKNOWN,"Missing metadata from asset bulk operation.");const n=r["repo:path"];if(t.pathName!==n){const e=this._core._getAssetPool(),i=e.getLocalItemById(t.id),r=e.createUpdateSession();i&&(Cr({assetPool:e,asset:i,session:r,operation:{type:"rename",newPath:n},assetContext:s}),s._adobeAssetUpdater.updateLocalItem(r,i,{"repo:path":n}),r.commit())}Tc.updateLocalItem(e,t,Object.assign({state:"ACTIVE"===r["repo:state"]?"active":"archived",name:r["repo:name"],pathName:r["repo:path"]},i))}),[{match:e=>e.code===Ue.ACCESS_DENIED||e.code===Ue.NOT_FOUND,action:async e=>await e.load().catch((t=>({model:e,error:t})))}])}async createSpaceBookmarks(e){return this._bookmarkSpaces("ADD",e)}async removeSpaceBookmarks(e){return this._bookmarkSpaces("REMOVE",e)}async _bookmarkSpaces(e,t){await Fs.runExclusiveTask("bookmark",t,(async()=>{var i;const s=this._core._environment.getValue("USER_ID"),r={bookmarked:"ADD"===e},n=this.spacePool.createUpdateSession(),o=new Map,a=t.map((e=>(o.set(e.id,{space:e,wasBookmarked:e.isBookmarked}),Tc.updateLocalItem(n,e,r),{projectUrn:e.id,userId:s})));let c;n.commit();try{c=await this._projectInterface.bookmarkOp({op:e,items:a})}finally{if(c)for(const e of c.responses){const t=o.get(null===(i=e.request)||void 0===i?void 0:i.projectUrn);t&&(t.status=e.status)}const e=this.spacePool.createUpdateSession(),t=this.spacePool.createMutationSession();for(const{space:i,wasBookmarked:s,status:n}of o.values())201===n?Tc.updateLocalItem(t,i,r):(Tc.updateLocalItem(e,i,{bookmarked:s}),404===n&&e.queueDiscardedItem(i));e.commit(),t.commit()}}))}_checkForRejection(e,t){for(const i of e)if("rejected"===i.status){const e=i.reason;throw e instanceof Ge&&e.code===Ue.NOT_FOUND&&t(),e}}async updateSpace(e,t){await Fs.runExclusiveTask("update",[e],(async()=>{const i=await Promise.allSettled([this._renameSpace(e,t),this._patchSpace(e,t)]);this._checkForRejection(i,(()=>{const t=this.spacePool.createUpdateSession();t.queueDiscardedItem(e),t.commit()}))}))}async _renameSpace(e,t){const{name:i}=t;if(void 0===i)return;const s=await this._renameAsset(e.id,i),r=this.spacePool.createMutationSession();Tc.updateLocalItem(r,e,{name:s.name,pathName:s.repoPath}),r.commit()}async _patchSpace(e,t){const{description:i,color:s}=t,r=[],n={};if(void 0!==i&&(r.push(this._getPatchOP(i,"/description",e.description,this._validateDescription)),n.description=i),void 0!==s&&(r.push(this._getPatchOP(s,"/color",e.color,this._validateColor)),n.color=s),!r.length)return;const o=_I(e);await this._projectInterface.patchSpace(o,r);const a=this.spacePool.createMutationSession();Tc.updateLocalItem(a,e,n),a.commit()}async createSpace(e,t){const i=_I(e);this._validateColor(t.color),this._validateDescription(t.description),Or(t.name);const s=await this._projectInterface.createSpace(i,Object.assign(Object.assign({},t),{parentId:e.id})),r=this.spacePool.createMutationSession(),n=Tc.updateRemoteItem(r,Object.assign(Object.assign({},s),{teamId:e.id}));return r.commit(),n}async getEnclosingSpace(e){return(await this.getEnclosingSpaces([e])).get(e)}async getEnclosingSpaces(e){const t=this._core._environment.getValue("PROJECTS_LIST_UPDATE_LATENCY"),i=Date.now()-t,s=await this._projectInterface.getEnclosingSpaces(e.map((e=>({"repo:assetId":e})))),r=new Map,n=this.spacePool.createUpdateSession("get enclosing spaces",i);for(const e of s.responses){if(200!==e.status)continue;const t=e.request["repo:assetId"],i=Tc.updateRemoteItem(n,e.body);r.set(t,i)}return n.commit(),r}async lookupSpaceById(e){let t=this._spacePool.getLocalItemById(e);if(!t){const i=await this._projectInterface.getSpace(e,sI),s=this._spacePool.createUpdateSession();t=Tc.updateRemoteItem(s,i),s.commit()}return t}onUserLeftTeam(e){const t=this._teamPool.getLocalItemById(e);if(t){const e=this._teamPool.createUpdateSession();e.queueDiscardedItem(t),e.commit()}}}qe([rt],mI.prototype,"getOrgRepositories",null),qe([rt],mI.prototype,"getTeams",null),qe([rt],mI.prototype,"getSpaces",null);var fI=Object.freeze({__proto__:null,default:mI});function gI(e,t){return`${e}-${t}`}class yI{constructor(e){const{asset:t,mediaTypes:i,excludeMediaTypes:s}=e,r=ze(e,["asset","mediaTypes","excludeMediaTypes"]);this._implicitDirectoryListingFilter=new Jo(Object.assign({asset:t},r)),(i||s)&&(this._adobeAssetFilter=new Fd({mediaTypes:i,excludeMediaTypes:s}))}matches(e){return!(this._adobeAssetFilter&&!this._adobeAssetFilter.matches(e)||this._implicitDirectoryListingFilter&&!this._implicitDirectoryListingFilter.matches(e))}get mediaTypes(){var e;return null===(e=this._adobeAssetFilter)||void 0===e?void 0:e.mediaTypes}}class vI extends dc{constructor(e,t,i){super(e,t,i),this._core=e,this.isProject=!0,this._description="",this._projectPermissions=$i,this._projectInterface=new xd(this._core),this._repositoryOwner={id:"",type:"user"},this._directorySubtype=es.CC_PROJECTS,this._assetClass="directory",this._allowInLists=!1,this._isRecent=!1,this._projectLinks=null==i?void 0:i.projectLinks,this._needsRepoMetadata=!0,tn.manageLazyLoading(this,[{event:ct,fetchData:this._getGradient}])}get gradientID(){var e;return null!==(e=this._gradientID)&&void 0!==e?e:""}get gradient(){return this._gradient}async _getGradient(){this._gradient=await this._core.projectContext.getGradient(this.gradientID)}get description(){return Jr("Description Not yet Supported","Currently the description field is not supported by the service."),this._description}get directorySubtype(){return this._directorySubtype}get inaccessibleLibraryReferencesCount(){return this._inaccessibleLibraryReferences?this._inaccessibleLibraryReferences.length:void 0}async _load({repoMetadata:e,appMetadata:t,effectivePermission:i,projectMetadata:s,perUserMetadata:r}={}){await super._load({repoMetadata:e,appMetadata:t,effectivePermission:i,perUserMetadata:r}),s||(s=await this._projectInterface.getProject(this.id));const n=this._core.projectContext._assetPool.createMutationSession();this._core.projectContext._projectUpdater.updateRemoteItem(n,s),n.commit()}get projectLinks(){return this._projectLinks}get creator(){return this._creator}get view(){if(!this._repositoryOwner.id)return;const e=this._core._environment.getUserId(),{defaultOrganizationId:t,organizations:i}=this._core.hostAssetContext,s=[e,...(null==i?void 0:i.map((e=>e.id)))||[]];return this._repositoryOwner.id===e||this._repositoryOwner.id===t?Yi.Yours:s.includes(this._repositoryOwner.id)?void 0:Yi.SWY}async move(e){Jr("[MOVE_UNSUPPORTED]",`Move on a project is not supported ${e}`)}async moveCSCProject(e){const t=await this._core.getProjectContext();await t.moveCSCProject(this.id,e)}async rename(e){var t;if(!(null===(t=this._projectLinks)||void 0===t?void 0:t[gt.PROJECTS_RENAME]))throw Ge.create(Ue.BAD_REQUEST,"Rename link is missing for this project.");if(!Or(e))throw Ge.create(Ue.BAD_REQUEST,"Invalid name provided for asset rename operation.");await this._projectInterface.renameProject(e,this._projectLinks);const i=this._core.projectContext._assetPool,s=await this._core.getAssetContext(),r=i.createUpdateSession(),n=wr(e,this);Cr({assetPool:this._core._getAssetPool(),asset:this,session:r,operation:{type:"rename",newPath:n},assetContext:s}),this._core.projectContext._projectUpdater.updateLocalItem(r,this,{"repo:name":e,"repo:path":n}),r.commit()}async discard(){if(this.isDiscarded)throw Ge.create(Ue.INVALID_OPERATION,"Asset is already discarded");await this._ensureLink(gt.DISCARD),await this._projectInterface.discardProject(this.id,this._projectLinks);const e=this._core._getAssetPool(),t=await this._core.getAssetContext(),i=e.createUpdateSession();Cr({assetPool:e,asset:this,session:i,operation:{type:"discard"},assetContext:t}),this._core.projectContext._projectUpdater.updateLocalItem(i,this,{"repo:state":"DISCARDED"}),i.commit()}async restore(){if(!this.isDiscarded)throw Ge.create(Ue.INVALID_OPERATION,"Cannot restore an asset that is not discarded");await this._ensureLink(gt.RESTORE),await this._projectInterface.restoreProject(this.id,this._projectLinks);const e=this._core._getAssetPool(),t=await this._core.getAssetContext(),i=e.createUpdateSession();Cr({assetPool:e,asset:this,session:i,operation:{type:"restore"},assetContext:t}),this._core.projectContext._projectUpdater.updateLocalItem(i,this,{"repo:state":"ACTIVE"}),i.commit()}async _updateProjectLinksFromService(){const e=await this._projectInterface.getProject(this.id),{_links:t}=e,i=this._core.projectContext._assetPool.createUpdateSession();this._core.projectContext._projectUpdater.updateLocalItem(i,this,{_links:t}),i.commit()}_isProjectLinkType(e){return[gt.CREATE,gt.RESTORE,gt.DISCARD,gt.PROJECTS_RENAME,gt.PAGE,gt.PROJECTS_REFERENCE_CREATE,gt.PROJECTS_REFERENCE_PRIMARY].includes(e)}async _ensureLink(e){var t;if(this._isProjectLinkType(e)){(null===(t=this._projectLinks)||void 0===t?void 0:t[e])||await this._updateProjectLinksFromService();const i=Object.assign(Object.assign({},this.__links),{[e]:this._projectLinks[e]}),s=this._core.hostAssetContext._assetPool.createUpdateSession();return this._core.hostAssetContext._adobeAssetUpdater.updateLocalItem(s,this,{_links:i}),void s.commit()}this._core._environment.debug(`ProjectLinkMissing ${e} Link ${e} missing on project, called out fetch it`),await super._ensureLink(e)}async validateProjectNameForRename(e){return e.toLowerCase()===this.name.toLowerCase()||await this._core.projectContext.validateProjectNameForCreate(e,this)}async updateProperties(){}leaveStatus(){const e=this.collaboratorArray;if(!this._isCollaboratorDataLoaded)return Xi.PENDING;if(0===e.length)return Xi.CANNOT_LEAVE_NO_COLLABORATORS;const t=e.find((e=>e.isCurrentUser));return t?"owner"===t.role?Xi.CANNOT_LEAVE_IS_OWNER:!t.isDirect&&t.isAdmin?Xi.CANNOT_LEAVE_IS_ADMIN_OF_PROJECT:1===e.length?Xi.CANNOT_LEAVE_LAST_COLLABORATOR:e.find((e=>e.canShare&&e.isDirect&&e!==t))||"user"===this.storageAssignee.type?t.isDirect?Xi.CAN_LEAVE:Xi.CANNOT_LEAVE_ADDRESS_BOOK_GROUP_MEMBER:Xi.CANNOT_LEAVE_LAST_DIRECT_COLLAB_WITH_SHARE_PERMISSION:Xi.CANNOT_LEAVE_ADDRESS_BOOK_GROUP_MEMBER}userCanLeaveProject(){switch(Jr("userCanLeaveProject Deprecated","Use Project.leaveStatus instead. This will be removed on or after 2024-10-01."),this.leaveStatus()){case Xi.PENDING:return;case Xi.CAN_LEAVE:return!0;case Xi.CANNOT_LEAVE_NO_COLLABORATORS:case Xi.CANNOT_LEAVE_ADDRESS_BOOK_GROUP_MEMBER:case Xi.CANNOT_LEAVE_LAST_COLLABORATOR:case Xi.CANNOT_LEAVE_LAST_DIRECT_COLLAB_WITH_SHARE_PERMISSION:case Xi.CANNOT_LEAVE_IS_ADMIN_OF_PROJECT:case Xi.CANNOT_LEAVE_IS_OWNER:return!1}}hasPermission(...e){return e.every((e=>(this._projectPermissions&e)===e))}async updateProject(e){await this._core.projectContext.updateProject(this.id,e)}_applyRestorePermission(e){const t=this._core.projectContext._getCachedRestoreCapability(this.repositoryID),i=t!==this.hasPermission(Ki.Restore);this._projectPermissions=t?this._projectPermissions|Ki.Restore:this._projectPermissions&~Ki.Restore,i&&e.queueChangedItem(this,[ct])}async _reloadPermissions(){await this._load(),super._reloadPermissions()}get librariesSource(){const e=new Wn(this._core.hostAssetContext._assetPool,this,this._core,!0,!0),t=new yI({asset:this,mediaTypes:[ja],_isSharedWithYou:!0});return new xo(this._core.hostAssetContext._assetPool,[e],t)}get repositoryOwner(){return this._repositoryOwner}async createLibrary(e){const t=await this._core.getLibraryContext(),i={name:e.name,parent_assetId:this.id,roles:e.roles};return i.access=e.restrictEdit?"team_view":"team_edit",t._createLibrary(i)}async updateLastAccessed(e){await super.updateLastAccessed(e);const t=this._core.projectContext._assetPool.createUpdateSession();this._core.projectContext._projectUpdater.updateLocalItem(t,this,{isRecent:Boolean(this.lastAccessed)}),t.commit()}async createLibraryReference(e){await this._ensureLink(gt.PROJECTS_REFERENCE_CREATE);const{"project:referenceId":t}=await this._projectInterface.createLibraryReference(e,this._projectLinks),i=await this._core.getLibraryContext(),s=await i.getLibraryByAssetId(t),r=i._assetPool.createUpdateSession("create reference library");i._libraryUpdater.updateLocalItem(r,s,{referenced_by_project:{projectId:this.id,reference:!0}}),r.commit()}async deleteLibraryReference(e){await this._ensureLink(gt.PROJECTS_REFERENCE_PRIMARY),await this._projectInterface.deleteLibraryReference(e,this._projectLinks);const t=this._core.hostAssetContext._assetPool.getLocalItemById(e);if(t){const e=await this._core.getLibraryContext(),i=e._assetPool.createUpdateSession("delete reference library");e._libraryUpdater.updateLocalItem(i,t,{referenced_by_project:{projectId:this.id,reference:!1}}),i.commit()}}async requestAccessToLibraryReferences(e){if(void 0===this._inaccessibleLibraryReferences)return Jr("[INACCESSIBLE_REFERENCES_NOT_LOADED]","Inaccessible library references not loaded. No access requests will be made."),{successfulRequests:[],failedRequests:[]};if(0===this._inaccessibleLibraryReferences.length)return{successfulRequests:[],failedRequests:[]};const t=await this._core.getCollaborationContext();return await t._requestAccess(this._inaccessibleLibraryReferences,e,{canComment:!0,canShare:!0,role:"viewer"})}}qe([ut],vI.prototype,"gradientID",null),qe([sn(ct,"_gradient")],vI.prototype,"gradient",null),qe([ut],vI.prototype,"description",null),qe([ut],vI.prototype,"inaccessibleLibraryReferencesCount",null),qe([ut],vI.prototype,"view",null),qe([sn(Mi,"_collaboratorsArray")],vI.prototype,"leaveStatus",null),qe([ut],vI.prototype,"hasPermission",null),qe([rt],vI.prototype,"librariesSource",null),qe([ut],vI.prototype,"repositoryOwner",null);const OI=new mn({localItemType:vI,remoteIdProperty:"repo:assetId",propertyUpdater:new Sn({_repositoryID:"repo:repositoryId",_path:"repo:path",_etag:"repo:etag",_created:{name:"repo:createDate",format:"date"},_description:"description",_name:"repo:name",_assetState:{name:"repo:state",choices:dn},_storageAssignee:{name:"storage:assignee",format:hc},_projectLinks:{name:"_links",format:"object"},_creator:{name:`_embedded[${gt.PROJECTS_CREATOR}]`,format:"object"},_createdBy:`_embedded[${gt.PROJECTS_CREATOR}].id`,_gradientID:{name:`_embedded[${gt.APP_METADATA}][project:rendition].gradientId`,set:(e,t)=>{const i=t;if(!e)return void(i._gradientID="");const s=gI(e,i._core._environment.getValue("LOCALE"));i._gradientID!==s&&(i._gradientID=s,tn.setLoadStatus(i,ot,en.NotLoaded))}},_projectPermissions:{get:function(e){var t;return(null===(t=e._embedded)||void 0===t?void 0:t[gt.AC_EFFECTIVE])?function(e){const t=e[gt.PROJECTS_PRIMARY]||e["*"]||[],i=e[gt.PRIMARY]||e["*"]||[],s=e[gt.DIRECTORY]||e["*"]||[],r=e[gt.ANNOTATIONS]||e["*"]||[],n=e[gt.AC_POLICY]||e["*"]||[];let o=Ki.None;return t.forEach((e=>{switch(e){case"ack":o|=Ki.Ack;break;case"read":o|=Ki.Read;break;case"rename":o|=Ki.Rename;break;case"discard":o|=Ki.Discard;break;case"restore":o|=Ki.Restore}})),i.forEach((e=>{switch(e){case"write":o|=Ki.Write;break;case"delete":s.includes("write")&&(o|=Ki.Delete)}})),n.includes("write")&&(o|=Ki.Share),r.includes("write")&&(o|=Ki.WriteComment),o}(e._embedded[gt.AC_EFFECTIVE]):fn},format:"number"},_repositoryOwner:{name:`_embedded[${gt.REPOSITORY}][repo:owner]`,format:hc},_isRecent:{name:"isRecent",format:"boolean"},_allowInLists:{name:"allowInLists",format:"boolean"},_directorySubtype:{name:"project:directorySubtype",choices:["wfPortfolio","wfProgram","wfProject","wfProjectTemplate","ccProject"]},_inaccessibleLibraryReferences:{name:"inaccessibleReferences",isArray:!0,format:"string"}})});class bI{constructor(e,t,i,s){this._projectPool=e,this._projectInterface=t,this._projectUpdater=i,this._core=s}supportsFilter(e){return void 0!==e}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i,s,r;const{order:n,filter:o}=e,{limit:a}=null!==(i=e.loadOptions)&&void 0!==i?i:{},c=this._projectPool._core._environment.getValue("PROJECTS_LIST_UPDATE_LATENCY"),l=Date.now()-c;let d;if(t)d=await this._projectInterface.getProjectsWithLink(t);else if((null==o?void 0:o.view)===Yi.Recent){const t=a?{first:a}:{};d=await this._projectInterface.getRecentProjects(t,e.resource)}else{const t=o.view?{view:Qi[o.view]}:{},i=o.repositoryID?{repositoryId:o.repositoryID}:{},s=o.nameContains?{nameContains:o.nameContains}:{},r=o.isDiscarded?{isDiscarded:!0}:{},c=o.directorySubtypes?{directorySubtypes:o.directorySubtypes}:{},l=[];if(o.view!==Yi.Yours&&o.view!==Yi.SWY||await tn.fetchIfNeeded(this._core.hostAssetContext,kd),o.view===Yi.Yours){const e=this._core.hostAssetContext.defaultOrganizationId||"";l.push(this._core._environment.getUserId()),e&&l.push(e)}else o.view!==Yi.Organization&&o.view!==Yi.Admin||o.organizationID&&l.push(o.organizationID);d=await this._projectInterface.getProjects(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({orderBy:xp[n.field],orderDirection:n.direction,limit:a},t),i),s),r),l.length?{ownerId:l.join(",")}:{}),c),e.resource)}const u=this._projectPool.createLoaderUpdateSession(l),h=d.children.map((e=>o.view===Yi.Recent?Object.assign(Object.assign({},e),{isRecent:!0}):Object.assign(Object.assign({},e),{allowInLists:!0}))),p=this._projectUpdater.updateRemoteItems(u,h);let _;u.commit();const m=null===(s=d._links)||void 0===s?void 0:s.next;return m&&(_=e=>this._loadPage(e,m)),{items:p,total:null===(r=d._page)||void 0===r?void 0:r.total,loadNextPage:_,mostRecentValidMutation:l}}}class EI{constructor(){this.view=q.All}matches(e){return e.isProject&&(e._allowInLists||e._isRecent)}}class II{constructor(e,t){this._core=e,this._assetPool=t,this._projectInterface=new xd(this._core),this._gradientPool=new qo(this._core,"gradient"),this._canRestoreProjectCache=new Map,this._projectUpdater=OI,this._core.on(Ci,((e,t,i)=>{"LOCALE"===i.configurationKeyName&&this._getGradients()}))}get assetPool(){return Jr("ProjectContext._assetPool","This property is deprecated and will be removed on or after 10-01-2024. For internal use by SAM.js only."),this._assetPool}projects(){this._core.hostAssetContext.organizations;const e=new bI(this._assetPool,this._projectInterface,this._projectUpdater,this._core);return new xo(this._assetPool,[e],new EI)}async createProject(e){const{name:t,gradientID:i}=e;if(!Or(t))throw Ge.create(Ue.BAD_REQUEST,"Invalid name provided for the rename operation.");const s=await this.getGradient(i),r=await this._projectInterface.createProject({[gt.APP_METADATA]:{"project:rendition":{gradientId:s.gradientID}},"repo:name":t}),n=this._assetPool.createMutationSession(),o=this._projectUpdater.updateRemoteItem(n,Object.assign(Object.assign({},r),{allowInLists:!0}));return n.commit(),o}async resolveProjectByName(e){const t=await this._projectInterface.resolveProjectByName(e),i=t["repo:assetId"];this._core.collaborationContext.confirmAccess(i);const s=this._assetPool.createMutationSession(),r=this._projectUpdater.updateRemoteItem(s,t);return s.commit(),r}async validateProjectNameForCreate(e,t,i){if(!Or(e))throw Ge.create(Ue.BAD_REQUEST,"Invalid project name.");let s=e;t&&(s=wr(e,t));try{await this._projectInterface.validateProjectName(s,i)}catch(e){const t=e;if(t.code===Ue.NOT_FOUND)return!0;if(t.code===Ue.CONFLICT)return!1;throw e}return!1}async getProjectbyID(e,t=!0){let i=this._assetPool.getLocalItemById(e);if(i)return t&&this._core.collaborationContext.confirmAccess(e),i;t&&await this._core.collaborationContext.confirmAccess(e);const s=await this._projectInterface.getProject(e),r=this._assetPool.createMutationSession();return i=this._projectUpdater.updateRemoteItem(r,s),i.hasPermission(Ki.Write)||"org"!==i.repositoryOwner.type?this._projectUpdater.updateLocalItem(r,i,{allowInLists:!0}):this._checkForInvite(i),r.commit(),i}async _checkForInvite(e){const t=new Ol(this._core);if((await t.getQueryResponse({limit:1,asset_id:e.id,[An.SHARED_VIA_INVITE]:!0})).result_sets[0].items.length){const t=this._assetPool.createUpdateSession();this._projectUpdater.updateLocalItem(t,e,{allowInLists:!0}),t.commit()}}async _getGradients(){const e=this._core._environment.getValue("LOCALE"),t=await this._projectInterface.getGradients(e),i=t.default,s=this._gradientPool.createUpdateSession(),r=function(e,t,i){return e.map((e=>Object.assign(Object.assign({},e),{computedID:gI(e["project:gradientId"],i),"project:gradientData":Object.assign(Object.assign({},e["project:gradientData"]),{isDefault:t===e["project:gradientId"],languageCode:i})})))}(t.children,i,e),n=f_.updateRemoteItems(s,r);return s.commit(),n}async getGradients(){return await this._getGradients()}async getGradient(e){const t=this._gradientPool.getLocalItemById(e),i=this._core._environment.getValue("LOCALE");if(t&&t.languageCode===i)return t;await this._getGradients();const s=this._gradientPool.getLocalItemById(e);if(!s){if(this._defaultGradient&&this._defaultGradient.languageCode===i)return this._defaultGradient;if(this._gradientPool.forEach((e=>{e.isDefault&&(this._defaultGradient=e)})),this._defaultGradient)return this._defaultGradient;throw Ge.create(Ue.UNKNOWN,`Gradient ID does not exist ${e}`)}return s}async updateProject(e,t){let i={};if(t.gradientID){const s=await this.getGradient(t.gradientID),r=await this.getProjectbyID(e),n=r.projectLinks;i=Object.assign(Object.assign({},i),{gradientID:s.gradientID}),await this._projectInterface.patchProject(n,i);const o=this._assetPool.createMutationSession();this._projectUpdater.updateRemoteItem(o,{"repo:assetId":r.id,_embedded:{[gt.APP_METADATA]:{"project:rendition":{gradientId:s.gradientID}}}}),o.commit()}}async canCreateProjects(e){try{return await this._projectInterface.getCapability(Ji.CREATE,e),!0}catch(e){if(!We(e))throw e;return!1}}async _canRestoreProject(e){if(this._canRestoreProjectCache.has(e))return this._canRestoreProjectCache.get(e);const t=await this.canCreateProjects(e);return this._canRestoreProjectCache.set(e,t),t}_getCachedRestoreCapability(e){return this._canRestoreProjectCache.get(e)||!1}async _prefetchIndex(){await this._projectInterface._discoverProjectLinks()}async canCreateProjectReason(e){try{return await this._projectInterface.getCapability(Ji.CREATE,e),Zi.ALLOWED}catch(e){if(!We(e))return Zi.UNKNOWN;switch(e.subCode){case Be.PROJECTS_ADMIN_ONLY:return Zi.ADMIN_DISABLED;case Be.PROJECTS_NO_HOME_REPOSITORY:return Zi.NO_HOME_REPOSITORY;case Be.PROJECTS_INVALID_REPOSITORY:return Zi.INVALID_REPOSITORY;default:return Zi.UNKNOWN}}}getProjectsSearchSource(e){const t=new Ad({_query:e,_projectsOnly:!0}),i=new wd(this._core.hostAssetContext._assetPool,this._core,this._core.hostAssetContext._globalSearchInterfaceV3,t);return new xo(this._assetPool,[i],t)}async _callContextAPI(e,t){const i=(await this._projectInterface._discoverProjectLinks())[gt.PROJECTS_CONTEXT].href;return await this._projectInterface._issueContextAPIRequest(e,t,i)}getProjectOrder(e="ascending",t="name"){return new Hp(e,t)}getProjectFilter(e){return new n_(e)}async createCSCProjectByPath(e,t,i,s,r,n){return this._createCSCProject({name:e,subType:t,path:i,orgId:s,userId:r,appMetadata:n})}async createCSCProjectInParent(e,t,i,s,r,n){return this._createCSCProject({name:e,subType:t,parentAssetId:i,orgId:s,userId:r,appMetadata:n})}async moveCSCProject(e,t){const i=await this.getProjectbyID(e,!1);if(i.directorySubtype===es.CC_PROJECTS)throw Ge.create(Ue.INVALID_OPERATION,"Move is only supported for CSC Projects");const s=i.projectLinks;await this._projectInterface.moveCSCProject(t,s);const r=await this._core.getAssetContext(),n=await this._projectInterface.getProject(e),o=this._assetPool.createMutationSession();Cr({assetPool:this._assetPool,asset:i,session:o,operation:{type:"move",newPath:n["repo:path"]},assetContext:r}),this._projectUpdater.updateRemoteItem(o,n),o.commit()}async _createCSCProject(e){const{name:t,subType:i,parentAssetId:s,path:r,orgId:n,userId:o,appMetadata:a}=e;if(!Or(t))throw Ge.create(Ue.BAD_REQUEST,"Invalid name provided");const c=Object.assign({name:t,projectDirectorySubType:i},a?{appMetadata:Object.assign({},a)}:{});let l;l=s?Object.assign(Object.assign({},c),{parentAssetId:s}):Object.assign(Object.assign({},c),{path:r});const d=await this._projectInterface.createCSCProject(l,n,o),u=this._assetPool.createMutationSession(),h=this._projectUpdater.updateRemoteItem(u,Object.assign(Object.assign({},d),{allowInLists:!0}));u.commit();const p=new Zo(this._core,h);return await p.load(),await h._handleResourceUpdates({repoMetadata:p.data}),h}}qe([rt],II.prototype,"projects",null),qe([Nt],II.prototype,"createProject",null),qe([(e,t,i)=>{const s=Symbol(`@consolidated ${t}`),r=i.value;if(!r)throw Ge.create(Ue.BAD_REQUEST,"@consolidated decorator can only be applied to a method");i.value=async function(...e){var i;const n=null===(i=this[et])||void 0===i?void 0:i.get(t),o=void 0===n?"default":e[n],a=this[s]||(this[s]=new Map),c=a.get(o);if(c)return c;{const t=r.apply(this,e);return a.set(o,t),t.finally((()=>{a.delete(o)})),t}}},Ye(0,tt)],II.prototype,"validateProjectNameForCreate",null),qe([Nt,Pt,Ye(0,tt)],II.prototype,"getProjectbyID",null),qe([Pt],II.prototype,"_prefetchIndex",null);var TI=Object.freeze({__proto__:null,default:II});const SI="/api/v1",AI={"Content-Type":mt};class PI extends lr{async _monitorResponse(e){return e}_getUrl(e){return`https://${this._core._environment.endpoints.CLASSROOMS_HOST}${e}`}async createClassroom(e){var t;const i=await this._doPost(this._getUrl(`${SI}/classrooms`),AI,JSON.stringify({className:e.name,subject:e.subject,grades:e.grades,period:e.period,teachers:(null===(t=e.teachers)||void 0===t?void 0:t.map((e=>encodeURIComponent(e))))||[]}),[201]);return await i.json()}async createClassroomFromVirtual(e){const t=await this._doPost(this._getUrl(`${SI}/classrooms/virtual/${e}/create`),{"Content-Type":mt},void 0,[201]);return await t.json()}async updateClassroomFromVirtual(e,t){var i;const s=await this._doPost(this._getUrl(`${SI}/classrooms/virtual/${e}/update`),{"Content-Type":mt},JSON.stringify({className:t.name,subject:t.subject,grades:t.grades,period:t.period,teachers:(null===(i=t.teachers)||void 0===i?void 0:i.map((e=>encodeURIComponent(e))))||[]}),[201]);return await s.json()}async deleteClassroom(e){await this._doDelete(this._getUrl(`${SI}/classrooms/${e}`),AI,[202])}async deleteVirtualClassroom(e){await this._doPost(this._getUrl(`${SI}/classrooms/virtual/${e}/delete`),AI,void 0,[202])}async getClassroom(e){return this._getResponse(this._getUrl(`${SI}/classrooms/${e}`)).then((e=>{var t;return null!==(t=e.importedFrom)&&void 0!==t||(e.importedFrom={}),e}))}async getClassrooms(){return this._getResponse(this._getUrl(`${SI}/classrooms`)).then((e=>e.map((e=>{var t;return null!==(t=e.importedFrom)&&void 0!==t||(e.importedFrom={}),e}))))}async refreshClassroomCode(e){return this._doPut(this._getUrl(`${SI}/classrooms/${e}/code/refresh`),void 0,void 0,[200]).then((e=>e.json()))}async updateClassroom(e,t){var i;return(await this._doPatch(this._getUrl(`${SI}/classrooms/${e}`),{"Content-Type":mt},JSON.stringify({className:t.name,subject:t.subject,grades:t.grades,period:t.period,teachers:(null===(i=t.teachers)||void 0===i?void 0:i.map((e=>encodeURIComponent(e))))||[]}))).json()}async getClassroomTeachers(e){return this.getClassroomMembers(e,Ch.TEACHER)}async getClassroomStudents(e){return await this.getClassroomMembers(e,Ch.STUDENT)}async getClassroomMembers(e,t){const i=t===Ch.NONE?"":`/${t}s`,s=`${SI}/classrooms/${e}/members${i}`,r=await this._getResponse(this._getUrl(s));return r.members.forEach((t=>{t.classroomId=e,t.computedKey=xa(e,t.userId)})),r.members}async getMembership(e){return this._getResponse(this._getUrl(`${SI}/classrooms/${e}/members/status`))}async blockStudent(e,t){const i=await this._doPost(this._getUrl(`${SI}/classrooms/${e}/members/students/block`),AI,JSON.stringify({studentId:t}),[200]);return await i.json()}async unblockStudent(e,t){const i=await this._doPost(this._getUrl(`${SI}/classrooms/${e}/members/students/unblock`),AI,JSON.stringify({studentId:t}),[200]);return await i.json()}async removeStudent(e,t){const i=await this._doDelete(this._getUrl(`${SI}/classrooms/${e}/members/students?studentId=${t}`),AI,[202]);return await i.json()}async removeTeacher(e,t){const i=await this._doDelete(this._getUrl(`${SI}/classrooms/${e}/members/teachers?userId=${t}`),AI,[202]);return await i.json()}async checkCoTeacherEligibility(e){const t=await this._doPost(this._getUrl(`${SI}/classrooms/users/eligibility`),AI,JSON.stringify({classroomId:e.classroomId,role:"teacher",emails:e.emails}),[200]);return await t.json()}}class wI{constructor(e,t){this._ClassroomMemberPool=e,this._classroomsInterface=t}async loadPage(e){return await this._loadPage(e)}async _loadPage(e){const{filter:t}=e,i=t,s=await this._classroomsInterface.getClassroomMembers(i.classroomId,i.role),r=this._ClassroomMemberPool.createLoaderUpdateSession(Date.now()),n=xh.updateRemoteItems(r,s);return r.commit(),{items:n,total:n.length,loadNextPage:void 0}}}const CI=Object.values(Ih);class RI extends Fs{constructor(e,t){super(e,t),this._core=e,this._code="",this._createdBy="",this._importSource={},this._isDeleted=!1,this._isVirtual=!1,this._grades=[],this._memberRole=Ch.NONE,this._name="",this._period="",this._status=bh.ACTIVE,this._subject=Ih.noSubject,this._classroomsInterface=new PI(this._core),this._assetId="";const i=new wI(this._core.classroomContext._classroomMemberPool,this._classroomsInterface);this._members=new xo(this._core.classroomContext._classroomMemberPool,[i],new jh({classroomId:this.id}))}get code(){return this._code}get created(){if(this._created)return new Date(this._created)}get createdBy(){return this._createdBy}get importSource(){return this._importSource}get isDeleted(){return this._isDeleted}get isVirtual(){return this._isVirtual}get grades(){return this._grades}get members(){return this._members}get memberRole(){return this._memberRole}get name(){return this._name}get period(){return this._period}get status(){return this._status}get subject(){return this._subject}get type(){return this._type}get userCount(){return this._userCount}get assetId(){return this._assetId}async delete(){await this._classroomsInterface.deleteClassroom(this.id)}async refreshCode(){this._classroomsInterface.refreshClassroomCode(this.id)}async update(e){return this._core.classroomContext.updateClassroom(this.id,e)}async checkCoTeacherEligibility(e){return this._classroomsInterface.checkCoTeacherEligibility(Object.assign(Object.assign({},e),{classroomId:this.id}))}}qe([ut],RI.prototype,"code",null),qe([ut],RI.prototype,"created",null),qe([ut],RI.prototype,"createdBy",null),qe([ut],RI.prototype,"importSource",null),qe([ut],RI.prototype,"isDeleted",null),qe([ut],RI.prototype,"isVirtual",null),qe([ut],RI.prototype,"grades",null),qe([ut],RI.prototype,"members",null),qe([ut],RI.prototype,"memberRole",null),qe([ut],RI.prototype,"name",null),qe([ut],RI.prototype,"period",null),qe([ut],RI.prototype,"status",null),qe([ut],RI.prototype,"subject",null),qe([ut],RI.prototype,"type",null),qe([ut],RI.prototype,"userCount",null),qe([ut],RI.prototype,"assetId",null);const LI=new mn({localItemType:RI,remoteIdProperty:"classId",getAlternateId:function(e){return e.virtualId},propertyUpdater:new Sn({_assetId:{name:"assetId",format:"string"},_code:{name:"classCode",format:"string"},_created:{name:"createdOn",format:"string"},_createdBy:{name:"createdBy",format:"string"},_importSource:{name:"importedFrom",format:"object",set:(e,t)=>{t._importSource={id:e.sourceId,type:e.source,synced:e.lastUpdatedAt?new Date(e.lastUpdatedAt):void 0}}},_isDeleted:{name:"deleted",format:"boolean"},_isVirtual:{name:"isVirtualClassroom",format:"boolean"},_grades:{isArray:!0,name:"grades"},_memberRole:{name:"memberRole",format:"string"},_name:{name:"className",format:"string"},_period:{name:"period",format:"string"},_status:{name:"status",format:"string",choices:Object.values(bh)},_subject:{name:"subject",format:"string",choices:CI},_type:{name:"type",format:"string",choices:Object.values(Eh)},_userCount:{name:"userCount",format:"number"},_virtualId:{name:"virtualId",format:"string"}})});class NI{constructor(e,t){this._classroomPool=e,this._classroomsInterface=t}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){const i=await this._classroomsInterface.getClassrooms(),s=this._classroomPool.createLoaderUpdateSession(Date.now()),r=LI.updateRemoteItems(s,i);return s.commit(),{items:r,total:r.length,loadNextPage:void 0}}}const DI=ba(),MI={orderDirection:"ascending",orderBy:"repo:name",start:0,limit:0};class xI extends lr{async _discoverLinks(e){return(await this._getResponse(e,{headers:DI}))._links}_getEndpointHref(e){return`https://${this._core._environment.endpoints.ASSIGNMENTS_HOST}${e}`}async discoverLinks(){return this._discoverLinks(this._getEndpointHref("/api/v1/index"))}async getAssignments(e){if(!e.classroomId&&!e.campaignId)throw Ge.create(Ue.BAD_REQUEST,"classroomId or campaignId is required to fetch assignments");if(e.classroomId&&e.campaignId)throw Ge.create(Ue.BAD_REQUEST,"Cannot fetch assignments by both classroomId and campaignId");const t=function(e,t){const i=Object.assign({},MI,t),s=function(e){const t={};return e.start&&(t.start=e.start.toString()),e.limit&&(t.limit=e.limit.toString()),t}(i);s.orderBy=function(e){return("ascending"===e.orderDirection?"+":"-")+e.orderBy}(i);const{classroomId:r,campaignId:n,submissions:o,view:a}=i;if(a&&(s.view=a),r&&n)throw Ge.create(Ue.BAD_REQUEST,"Cannot fetch assignments by both classroomId and campaignId");if(!r&&!n)throw Ge.create(Ue.BAD_REQUEST,"classroomId or campaignId is required to fetch assignments");return r?s.classroomId=r:n&&(s.campaignId=n),o&&(s.submissions=o),bt(e,gt.ASSIGNMENTS_COLLECTION,s)}(await this.discoverLinks(),e);return this._getResponse(t,{headers:DI})}async getAssignmentBy(e,t,i,s){const r=await this.discoverLinks(),n="id"===e?{assignmentId:t}:{assignmentCode:t},o="id"===e?gt.ASSIGNMENTS_PRIMARY:gt.ASSIGNMENTS_CODE;i&&(n.submissions=i);const a=bt(r,o,n);return this._getResponse(a,{headers:Object.assign(Object.assign({},DI),s)})}async getAssignment(e,t,i){return this.getAssignmentBy("id",e,t,i)}async getAssignmentByCode(e,t,i){return this.getAssignmentBy("code",e,t,i)}async createAssignment(e){var t,i,s,r;const n=(null!==(i=null===(t=e.tasks)||void 0===t?void 0:t.length)&&void 0!==i?i:0)>0,o=e.status||(n?Bh.ASSIGNED:Bh.DRAFT),a=await this.discoverLinks(),c=new URL(bt(a,gt.ASSIGNMENTS_CREATE));Mr(c,{classroomId:e.classroomId,assign:(o===Bh.ASSIGNED).toString()});const l=e.externalTemplateIds||[],d=(null===(s=e.externalTutorials)||void 0===s?void 0:s.map((e=>JSON.stringify(e))))||[],u={"assignment:canClassroomReadSubmissions":e.canClassroomReadSubmissions,"assignment:dueDate":null===(r=e.dueDate)||void 0===r?void 0:r.toISOString(),"assignment:instructions":e.instructions,"repo:name":e.name,"assignment:status":o,"assignment:tasks":e.tasks||[],"assignment:createdBy":e.createdBy,"assignment:externalTemplateIds":[...l,...d],"assignment:campaignId":e.campaignId},h=await this._doPost(c.toString(),Object.assign(Object.assign({},DI),{"Content-Type":mt}),JSON.stringify(u),[201]);return await h.json()}async patchAssignment(e,t){const i=bt(await this.discoverLinks(),gt.ASSIGNMENTS_PRIMARY,{assignmentId:e}),s=await this._doPatch(i,Object.assign(Object.assign({},DI),{"Content-Type":mt}),JSON.stringify(t),[200,204]);return await s.json()}async discardAssignment(e,t){if(!(null==t?void 0:t[gt.DISCARD]))throw Ge.create(Ue.BAD_REQUEST,`Discard link is missing for this assignment ${e}`);const i=bt(t,gt.DISCARD,{assignmentId:e});await this._doPost(i,DI,void 0,[204])}async restoreAssignment(e,t){if(!(null==t?void 0:t[gt.RESTORE]))throw Ge.create(Ue.BAD_REQUEST,`Restore link is missing for this assignment ${e}`);const i=bt(t,gt.RESTORE,{assignmentId:e});await this._doPost(i,DI,void 0,[204])}}qe([st((function(e){return yt(e,Uh)})),Ye(0,tt)],xI.prototype,"_discoverLinks",null);class kI extends an{constructor(e,t){super(e,t),this._core=e,this._parent=t,this._studentAssignmentsInterface=new Jd(this._core)}async _loadData(){const e=await this._core.hostAssetContext._rapi.getAssetLinks(this._parent.id),t=await this._studentAssignmentsInterface.getStudentAssignment(this._parent.id,void 0,{[Oa.PREFER_RAPI]:"true"}),{_links:i}=t,s=ze(t,["_links"]);await this._setData(Object.assign(Object.assign({},s),{_links:Object.assign(Object.assign({},e),i)}));const r=this._core._getAssetPool().createMutationSession();UI.updateLocalItem(r,this._parent,this.data),r.commit()}}class HI{constructor({core:e,studentAssignmentsInterface:t}){this._core=e,this._studentAssignmentsInterface=t}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i;const s=Date.now(),{studentAssignmentId:r}=e.implicitFilter,n=this._core._getAssetPool().getLocalItemById(r);let o=null!==(i=null==n?void 0:n.studentAssignmentFiles)&&void 0!==i?i:[];if(n&&n._hasLoadedChildren)o=this._core._getAssetPool().toArray().filter((e=>e.studentAssignmentId===r));else if(0===o.length){const e=await this._studentAssignmentsInterface.getStudentAssignment(r,{loadDocuments:!0}),t=e["classroom:context"]["classroom:assignmentContext"]["classroom:assignmentAssetId"],i=e["classroom:context"]["classroom:classroomContext"]["classroom:classroomAssetId"],s=this._core._getAssetPool().createMutationSession();o=this._core.classroomContext._updateStudentAssignmentFilesCache({remoteStudentAssignmentFiles:e.children,session:s,assignmentId:t,classroomId:i,studentAssignmentId:r}),n&&(n._hasLoadedChildren=!0)}return{items:o,total:o.length,mostRecentValidMutation:s}}}class jI extends dc{constructor(e,t,i){super(e,t,i),this._core=e,this._assetClass="directory",this._assignmentId="",this._assignmentCode="",this._parentClassroomId="",this._inheritedClassroomId="",this._hasLoadedChildrenProp=!1,this._status=Wd.NOT_STARTED,this._student={id:"",displayName:"",email:""},this._studentAssignmentsInterface=new Jd(this._core),this._studentAssignmentFiles=[],this._studentAssignmentAppMetadata=new kI(e,this),this._needsRepoMetadata=!0}get appMetadata(){return this._studentAssignmentAppMetadata}get _hasLoadedChildren(){return this._hasLoadedChildrenProp}set _hasLoadedChildren(e){this._hasLoadedChildrenProp=e}get studentAssignmentFiles(){return this._studentAssignmentFiles}get assignmentId(){return this._assignmentId}get assignmentCode(){return this._assignmentCode}get parentClassroomId(){return this._parentClassroomId||this._inheritedClassroomId||super.parentClassroomId||""}get parentAssignmentId(){return this.assignmentId}get status(){return this._status}get student(){return this._student}get studentDirectoryId(){return this._studentDirectoryId}get submission(){return this._submission}get submissionDate(){return this._submissionDate}get isStudentAssignment(){return!0}async getFiles(e={}){return this._studentDirectoryId?this._core.classroomContext.getStudentAssignmentFiles({studentDirectoryId:this.studentDirectoryId,order:e.order}):[]}get files(){if(this._studentDirectoryId)return this._studentAssignmentFilesSource||(this._studentAssignmentFilesSource=new xo(this._core._getAssetPool(),[new HI({core:this._core,studentAssignmentsInterface:this._studentAssignmentsInterface})],new np(this._studentDirectoryId))),this._studentAssignmentFilesSource}get studentAssignmentLinks(){return this.links}get links(){return Object.assign({},this.__links)}get _canLoadNewChildrenFromONSNotification(){return this.hasPermission(Ki.Write)}canStart(){return this._status===Wd.NOT_STARTED}canReturn(){return this._status===Wd.SUBMITTED}async _load({repoMetadata:e,appMetadata:t,effectivePermission:i,perUserMetadata:s,doFetchStudentAssignmentMetadata:r=!0}={}){if(await super._load({repoMetadata:e,appMetadata:t,effectivePermission:i,perUserMetadata:s}),r){const e=await this._studentAssignmentsInterface.getStudentAssignment(this.id,void 0,{[Oa.PREFER_RAPI]:"true"}),t=this._core._getAssetPool().createMutationSession();UI.updateRemoteItem(t,e),t.commit()}}async return(){var e;return this._core.classroomContext._returnAssignment({links:this.links,studentAssignmentId:this.studentDirectoryId,submissionId:null===(e=this.submission)||void 0===e?void 0:e["repo:assetId"]})}async start(){return this._core.classroomContext._startAssignment({assignmentId:this.assignmentId,links:this.links})}async submit(e){return await this._core.classroomContext.submitAssignment({assignmentId:this.assignmentId,links:this.links,status:this.status,studentAssignmentId:this.studentDirectoryId,submissionId:e}),this}get isChildOfClassroom(){return!0}get isChildOfAssignment(){return!0}get isChildOfAssignmentMaterials(){return!1}get isChildOfStudentAssignment(){return!1}}qe([ut],jI.prototype,"appMetadata",null),qe([ut],jI.prototype,"assignmentId",null),qe([ut],jI.prototype,"assignmentCode",null),qe([ut],jI.prototype,"parentClassroomId",null),qe([ut],jI.prototype,"parentAssignmentId",null),qe([ut],jI.prototype,"status",null),qe([ut],jI.prototype,"student",null),qe([ut],jI.prototype,"studentDirectoryId",null),qe([ut],jI.prototype,"submission",null),qe([ut],jI.prototype,"submissionDate",null),qe([ut],jI.prototype,"getFiles",null),qe([ut],jI.prototype,"studentAssignmentLinks",null),qe([ut],jI.prototype,"links",null),qe([ut],jI.prototype,"isChildOfClassroom",null),qe([ut],jI.prototype,"isChildOfAssignment",null),qe([ut],jI.prototype,"isChildOfAssignmentMaterials",null),qe([ut],jI.prototype,"isChildOfStudentAssignment",null);const UI=new mn({remoteIdProperty:"repo:assetId",getAlternateId:function(e){var t;let i;if(void 0!==e["classroom:context"])i=e["classroom:context"]["classroom:assignmentContext"]["classroom:assignmentAssetId"];else{if(void 0===e["cc:inherited"]||void 0===e["cc:inherited"]["cc:assignment"])throw Ge.create(Ue.INTERNAL_ERROR,"Remote item does not have classroom:context or cc:inherited defined");i=e["cc:inherited"]["cc:assignment"]["repo:assetId"]}return`${null===(t=e["assignment:assignee"])||void 0===t?void 0:t.id}-${i}`},localItemType:jI,propertyUpdater:new Sn({_assignmentId:{name:"classroom:context[classroom:assignmentContext][classroom:assignmentAssetId]",format:"string"},_assignmentCode:{name:"computedAssignmentCode",format:"string"},_parentClassroomId:{name:"classroom:context[classroom:classroomContext][classroom:classroomAssetId]",format:"string"},_inheritedClassroomId:{name:"cc:inherited[cc:classroom][repo:assetId]",format:"string"},_studentAssignmentFiles:{isArray:!0,name:"children",format:"object",set:(e,t)=>{const i=t;i.studentAssignmentFiles.length=0;const s=i._core._getAssetPool().createMutationSession(),r=i._core.classroomContext._updateStudentAssignmentFilesCache({remoteStudentAssignmentFiles:e,session:s,assignmentId:i.assignmentId,classroomId:i.parentClassroomId,studentAssignmentId:i.id});i.studentAssignmentFiles.push(...r)}},__links:{name:"_links",format:"object"},_status:{name:"assignment:submissionStatus",format:"string"},_student:{name:"assignment:assignee",format:"object_subset",set:(e,t)=>{const i=t;i._student=Object.assign(Object.assign({},i._student),e)}},_studentDirectoryId:{name:"repo:assetId",format:"string"},_submission:{name:"assignment:submission",format:"object"},_submissionDate:{name:"assignment:submissionDate",format:"date"}})});class BI extends an{constructor(e,t){super(e,t),this._core=e,this._parent=t}async _loadData(){await super._loadData();const e=this._core._getAssetPool().createMutationSession();$I.updateLocalItem(e,this._parent,this.data),e.commit()}}class FI{constructor(e){const{assignmentCode:t,assignmentId:i}=e||{};this.assignmentCode=t||"",this.assignmentId=i||""}matches(e){if(!this.assignmentId&&!this.assignmentCode)throw new Error("Getting StudentAssignments across Assignments is not supported at this time");if(!e.isStudentAssignment)return!1;const t=e;return!(this.assignmentId&&this.assignmentId!==t.assignmentId||this.assignmentCode&&this.assignmentCode!==t.assignmentCode)}}const VI=Object.values(Bh);class KI extends dc{constructor(e,t,i){super(e,t,i),this._core=e,this._assetClass="directory",this._assignmentInterface=new xI(this._core),this._canClassroomReadSubmissions=!1,this._classroomId="",this._code="",this._externalTemplateIds=[],this._externalTemplateIdsRemote=[],this._instructions="",this._isAutoCreated=!1,this._studentAssignments=[],this._externalTutorials=[],this._isExternalTutorialsDirty=!1,this._parentClassroomId="",this._materialsAssetId="",this._studentsAssetId="",this._parentAssignmentsFolderAssetId="",this._assignmentAppMetadata=new BI(e,this),this._needsRepoMetadata=!0}get appMetadata(){return this._assignmentAppMetadata}get canClassroomReadSubmissions(){return this._canClassroomReadSubmissions}get campaignId(){return this._campaignId}get classroomId(){return this._classroomId}get isChildOfAssignment(){return!1}get isChildOfAssignmentMaterials(){return!1}get isChildOfClassroom(){return!0}get isChildOfStudentAssignment(){return!1}get studentAssignments(){return this._studentAssignments}_getStudentAssignmentsFilter(){return new FI({assignmentId:this.id})}getStudentAssignments(){return this._core.classroomContext._getStudentAssignmentsSource(this._getStudentAssignmentsFilter())}getStudentAssignmentsByStatus(e){return Array.isArray(e)?this._studentAssignments.filter((t=>e.includes(t.status))):this._studentAssignments.filter((t=>t.status===e))}get existingStudentAssignments(){const e=[Wd.IN_PROGRESS,Wd.SUBMITTED,Wd.RETURNED];return this.getStudentAssignmentsByStatus(e)}get code(){return this._code}get isAssignment(){return!0}get instructions(){return this._instructions}get isAutoCreated(){return this._isAutoCreated}get dueDate(){return this._dueDate}get status(){return this._status}get tasks(){var e;return null!==(e=this._tasks)&&void 0!==e?e:[]}get templateIds(){var e;return null!==(e=this._templateIds)&&void 0!==e?e:[]}get parentClassroomId(){return this._parentClassroomId}get materialsAssetId(){return this._materialsAssetId}get studentsAssetId(){return this._studentsAssetId}get _parentAssignmentsAssetId(){return this._parentAssignmentsFolderAssetId}get externalTemplateIds(){return this._isExternalTutorialsDirty&&(this._externalTemplateIds=this._externalTemplateIdsRemote.filter((e=>{try{return JSON.parse(e),!1}catch(e){return!0}}))),this._externalTemplateIds}get externalTutorials(){return this._isExternalTutorialsDirty&&(this._externalTutorials=this._externalTemplateIdsRemote.reduce(((e,t)=>{try{e.push(JSON.parse(t))}catch(e){}return e}),[])),this._externalTutorials}get referenceIds(){var e;return null!==(e=this._referenceIds)&&void 0!==e?e:[]}get templates(){return Jr("Assignment.templates","Assignment.templates is deprecated and will be removed on or after 2024-10-01. Please use Assignment.templateIds instead."),[]}_loadWithRetry(){return this._load()}async _load({repoMetadata:e,appMetadata:t,effectivePermission:i}={}){await super._load({repoMetadata:e,appMetadata:t,effectivePermission:i});const s=void 0!==this.links[gt.ASSIGNMENTS_PRIMARY],r=0===this.studentAssignments.length;if(!e||!t||r||!s){const e=await this._assignmentInterface.getAssignment(this.id,void 0,{[Oa.PREFER_RAPI]:"true"}),t=this._core._getAssetPool().createMutationSession();$I.updateRemoteItem(t,e),t.commit()}}async updateAssignment(e){return this._core.classroomContext.updateAssignment(this.id,e)}async setTemplates(e){return this._core.classroomContext.updateAssignment(this.id,{templateIds:e})}async assignAssignment(){return this._core.classroomContext.updateAssignment(this.id,{status:Bh.ASSIGNED})}async discard(){if(this.isDiscarded)return;await this._assignmentInterface.discardAssignment(this.id,this.links);const e=this._core._getAssetPool().createUpdateSession();$I.updateLocalItem(e,this,{"repo:state":dn[1]}),e.commit()}async restore(){if(!this.isDiscarded)return;await this._assignmentInterface.restoreAssignment(this.id,this.links);const e=this._core._getAssetPool().createUpdateSession();$I.updateLocalItem(e,this,{"repo:state":dn[0]}),e.commit()}get links(){return Object.assign({},this.__links)}}qe([ut],KI.prototype,"appMetadata",null),qe([ut],KI.prototype,"canClassroomReadSubmissions",null),qe([ut],KI.prototype,"campaignId",null),qe([ut],KI.prototype,"classroomId",null),qe([ut],KI.prototype,"isChildOfAssignment",null),qe([ut],KI.prototype,"isChildOfAssignmentMaterials",null),qe([ut],KI.prototype,"isChildOfClassroom",null),qe([ut],KI.prototype,"isChildOfStudentAssignment",null),qe([ut],KI.prototype,"studentAssignments",null),qe([rt],KI.prototype,"getStudentAssignments",null),qe([ut],KI.prototype,"code",null),qe([ut],KI.prototype,"isAssignment",null),qe([ut],KI.prototype,"instructions",null),qe([ut],KI.prototype,"isAutoCreated",null),qe([ut],KI.prototype,"dueDate",null),qe([ut],KI.prototype,"status",null),qe([ut],KI.prototype,"tasks",null),qe([ut],KI.prototype,"templateIds",null),qe([ut],KI.prototype,"parentClassroomId",null),qe([ut],KI.prototype,"materialsAssetId",null),qe([ut],KI.prototype,"studentsAssetId",null),qe([ut],KI.prototype,"externalTemplateIds",null),qe([ut],KI.prototype,"externalTutorials",null),qe([ut],KI.prototype,"referenceIds",null),qe([At],KI.prototype,"_loadWithRetry",null),qe([ut],KI.prototype,"links",null);const $I=new mn({localItemType:KI,remoteIdProperty:"repo:assetId",propertyUpdater:new Sn({_campaignId:{name:"assignment:campaignId",format:"string"},_canClassroomReadSubmissions:{name:"assignment:canClassroomReadSubmissions",format:"boolean"},_name:{name:"repo:name",format:"string"},_created:{name:"repo:createDate",format:"date"},_parentClassroomAssetId:{name:"classroom:context[classroom:classroomContext][classroom:classroomAssetId]",format:"string"},_parentAssignmentsFolderAssetId:{name:"classroom:context[classroom:assignmentsContext][classroom:assignmentsAssetId]",format:"string"},_materialsAssetId:{name:"classroom:context[assignment:materialsContext][assignment:materialsAssetId]",format:"string"},_studentsAssetId:{name:"classroom:context[assignment:studentsContext][assignment:studentsAssetId]",format:"string"},_repositoryID:{name:"repo:repositoryId",format:"string"},__links:{name:"_links",format:"object"},_studentAssignments:{isArray:!0,name:"children",format:"object",set:(e,t)=>{const i=t;i.studentAssignments.length=0;const s=i._core._getAssetPool().createMutationSession(),r=e.map((e=>Object.assign(Object.assign({},e),{computedAssignmentCode:i.code,"classroom:context":{"classroom:assignmentContext":{"classroom:assignmentAssetId":i.id},"classroom:classroomContext":{"classroom:classroomAssetId":i.parentClassroomId},"classroom:assignmentsContext":{"classroom:assignmentsAssetId":i._parentAssignmentsAssetId},"assignment:materialsContext":{"assignment:materialsAssetId":i.materialsAssetId},"assignment:studentsContext":{"assignment:studentsAssetId":i.studentsAssetId}}}))),n=UI.updateRemoteItems(s,r);s.commit(),i.studentAssignments.push(...n),Xh.default.sortItems(i.studentAssignments)}},_tasks:{isArray:!0,name:"assignment:tasks"},_code:{name:"assignment:code",format:"string"},_classroomId:{name:"assignment:classroomId",format:"string"},_createdBy:{name:"repo:createdBy",format:"string"},_status:{name:"assignment:status",format:"string",choices:VI},_dueDate:{name:"assignment:dueDate",format:"date"},_instructions:{name:"assignment:instructions",format:"string"},_templateIds:{name:"assignment:templateIds",isArray:!0},_externalTemplateIdsRemote:{name:"assignment:externalTemplateIds",isArray:!0,set:(e,t)=>{const i=t;i._externalTemplateIdsRemote=e,i._isExternalTutorialsDirty=!0}},_referenceIds:{name:"assignment:referenceIds",isArray:!0},_path:{name:"repo:path",format:"string"},_modifiedBy:{name:"repo:modifiedBy",format:"string"},_assetState:{name:"repo:state",choices:dn},_isAutoCreated:{get:e=>"adobe"===e["assignment:createdBy"],format:"boolean"}})});class GI{constructor(e,t){this._assignmentInterface=e,this._core=t}async loadPage(e){return await this._loadPage(e)}async observeAssignmentsFolder(e){const t=e["classroom:context"]["classroom:assignmentsContext"]["classroom:assignmentsAssetId"];return this._core.hostAssetContext.getAssetWithCloudID(t)}async _loadPage(e,t){const i=e.filter,{classroomId:s,campaignId:r,submissions:n}=i,o=await this._assignmentInterface.getAssignments(Object.assign(Object.assign({},e),{classroomId:s,campaignId:r,submissions:await this._core.classroomContext.validateStudentAssignmentsFilter(n,s)})),a=Date.now(),c=this._core._getAssetPool().createLoaderUpdateSession(a),l=$I.updateRemoteItems(c,o.children);return c.commit(),o.children.length>0&&this.observeAssignmentsFolder(o.children[0]).then((e=>{i._monitoredFolder=e})),{items:l,total:o.children.length,mostRecentValidMutation:a}}}class WI{constructor(e,t){this._StudentAssignmentsInterface=e,this._core=t}async loadPage(e){return await this._loadPage(e)}async observeStudentsFolder({remoteStudentAssignments:e}){const t=e[0]["classroom:context"]["assignment:studentsContext"]["assignment:studentsAssetId"];return this._core.hostAssetContext.getAssetWithCloudID(t)}async _loadPage(e,t){const{filter:i,implicitFilter:s}=e,{assignmentId:r,assignmentCode:n}=s,{assignmentId:o,assignmentCode:a,loadDocuments:c}=i;r||n||(s.assignmentId=o,s.assignmentCode=a);const{assignmentId:l,assignmentCode:d}=s;let u=[];const h=(await this._StudentAssignmentsInterface.getStudentAssignments({assignmentCode:d,assignmentId:l,loadDocuments:c})).children,p=this._core._getAssetPool().createUpdateSession(),_=d?h.map((e=>Object.assign(Object.assign({},e),{computedAssignmentCode:d}))):h;if(u=UI.updateRemoteItems(p,_),p.commit(),c)for(const e of u)e._hasLoadedChildren=!0;return h.length>0&&this.observeStudentsFolder({remoteStudentAssignments:h}).then((e=>{s._monitoredFolder=e})),{items:u,total:u.length,loadNextPage:void 0}}}var zI="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:{},qI="1.7.0",YI=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/,QI=function(e){var t=new Set([e]),i=new Set,s=e.match(YI);if(!s)return function(){return!1};var r=+s[1],n=+s[2],o=+s[3];if(null!=s[4])return function(t){return t===e};function a(e){return i.add(e),!1}function c(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(i.has(e))return!1;var s=e.match(YI);if(!s)return a(e);var l=+s[1],d=+s[2],u=+s[3];return null!=s[4]||r!==l?a(e):0===r?n===d&&o<=u?c(e):a(e):n<=d?c(e):a(e)}}(qI),JI=qI.split(".")[0],XI=Symbol.for("opentelemetry.js.api."+JI),ZI=zI;function eT(e,t,i,s){var r;void 0===s&&(s=!1);var n=ZI[XI]=null!==(r=ZI[XI])&&void 0!==r?r:{version:qI};if(!s&&n[e]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return i.error(o.stack||o.message),!1}return n.version!==qI?(o=new Error("@opentelemetry/api: Registration of version v"+n.version+" for "+e+" does not match previously registered API v"+qI),i.error(o.stack||o.message),!1):(n[e]=t,i.debug("@opentelemetry/api: Registered a global for "+e+" v"+qI+"."),!0)}function tT(e){var t,i,s=null===(t=ZI[XI])||void 0===t?void 0:t.version;if(s&&QI(s))return null===(i=ZI[XI])||void 0===i?void 0:i[e]}function iT(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+qI+".");var i=ZI[XI];i&&delete i[e]}var sT,rT=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nT("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nT("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nT("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nT("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nT("verbose",this._namespace,e)},e}();function nT(e,t,i){var s=tT("diag");if(s)return i.unshift(t),s[e].apply(s,function(e,t,i){if(i||2===arguments.length)for(var s,r=0,n=t.length;r<n;r++)!s&&r in t||(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}([],function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var s,r,n=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return o}(i),!1))}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(sT||(sT={}));var oT=function(){function e(){function e(e){return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s=tT("diag");if(s)return s[e].apply(s,function(e,t,i){if(i||2===arguments.length)for(var s,r=0,n=t.length;r<n;r++)!s&&r in t||(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}([],function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var s,r,n=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return o}(t),!1))}}var t=this;t.setLogger=function(e,i){var s,r,n;if(void 0===i&&(i={logLevel:sT.INFO}),e===t){var o=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(s=o.stack)&&void 0!==s?s:o.message),!1}"number"==typeof i&&(i={logLevel:i});var a=tT("diag"),c=function(e,t){function i(i,s){var r=t[i];return"function"==typeof r&&e>=s?r.bind(t):function(){}}return e<sT.NONE?e=sT.NONE:e>sT.ALL&&(e=sT.ALL),t=t||{},{error:i("error",sT.ERROR),warn:i("warn",sT.WARN),info:i("info",sT.INFO),debug:i("debug",sT.DEBUG),verbose:i("verbose",sT.VERBOSE)}}(null!==(r=i.logLevel)&&void 0!==r?r:sT.INFO,e);if(a&&!i.suppressOverrideMessage){var l=null!==(n=(new Error).stack)&&void 0!==n?n:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+l),c.warn("Current logger will overwrite one already registered from "+l)}return eT("diag",c,t,!0)},t.disable=function(){iT("diag",t)},t.createComponentLogger=function(e){return new rT(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),aT=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){var t=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var s,r,n=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return o}(e,2);return[t[0],t[1]]}))},e.prototype.setEntry=function(t,i){var s=new e(this._entries);return s._entries.set(t,i),s},e.prototype.removeEntry=function(t){var i=new e(this._entries);return i._entries.delete(t),i},e.prototype.removeEntries=function(){for(var t,i,s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];var n=new e(this._entries);try{for(var o=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],s=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),a=o.next();!a.done;a=o.next()){var c=a.value;n._entries.delete(c)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}return n},e.prototype.clear=function(){return new e},e}();function cT(e){return void 0===e&&(e={}),new aT(new Map(Object.entries(e)))}function lT(e){return Symbol.for(e)}oT.instance();var dT,uT=new function e(t){var i=this;i._currentContext=t?new Map(t):new Map,i.getValue=function(e){return i._currentContext.get(e)},i.setValue=function(t,s){var r=new e(i._currentContext);return r._currentContext.set(t,s),r},i.deleteValue=function(t){var s=new e(i._currentContext);return s._currentContext.delete(t),s}},hT=function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},e(t,i)};return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),pT=function(){function e(){}return e.prototype.createHistogram=function(e,t){return TT},e.prototype.createCounter=function(e,t){return IT},e.prototype.createUpDownCounter=function(e,t){return ST},e.prototype.createObservableGauge=function(e,t){return PT},e.prototype.createObservableCounter=function(e,t){return AT},e.prototype.createObservableUpDownCounter=function(e,t){return wT},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),_T=function(){},mT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hT(t,e),t.prototype.add=function(e,t){},t}(_T),fT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hT(t,e),t.prototype.add=function(e,t){},t}(_T),gT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hT(t,e),t.prototype.record=function(e,t){},t}(_T),yT=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),vT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hT(t,e),t}(yT),OT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hT(t,e),t}(yT),bT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hT(t,e),t}(yT),ET=new pT,IT=new mT,TT=new gT,ST=new fT,AT=new vT,PT=new OT,wT=new bT,CT={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},RT={set:function(e,t,i){null!=e&&(e[t]=i)}},LT=function(){function e(){}return e.prototype.active=function(){return uT},e.prototype.with=function(e,t,i){for(var s=[],r=3;r<arguments.length;r++)s[r-3]=arguments[r];return t.call.apply(t,function(e,t,i){if(i||2===arguments.length)for(var s,r=0,n=t.length;r<n;r++)!s&&r in t||(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}([i],function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var s,r,n=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return o}(s),!1))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),NT="context",DT=new LT,MT=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return eT(NT,e,oT.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,i){for(var s,r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];return(s=this._getContextManager()).with.apply(s,function(e,t,i){if(i||2===arguments.length)for(var s,r=0,n=t.length;r<n;r++)!s&&r in t||(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}([e,t,i],function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var s,r,n=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return o}(r),!1))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return tT(NT)||DT},e.prototype.disable=function(){this._getContextManager().disable(),iT(NT,oT.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(dT||(dT={}));var xT="0000000000000000",kT="00000000000000000000000000000000",HT={traceId:kT,spanId:xT,traceFlags:dT.NONE},jT=function(){function e(e){void 0===e&&(e=HT),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),UT=lT("OpenTelemetry Context Key SPAN");function BT(e){return e.getValue(UT)||void 0}function FT(){return BT(MT.getInstance().active())}function VT(e,t){return e.setValue(UT,t)}function KT(e){return e.deleteValue(UT)}function $T(e,t){return VT(e,new jT(t))}function GT(e){var t;return null===(t=BT(e))||void 0===t?void 0:t.spanContext()}var WT=/^([0-9a-f]{32})$/i,zT=/^[0-9a-f]{16}$/i;function qT(e){return i=e.traceId,WT.test(i)&&i!==kT&&(t=e.spanId,zT.test(t)&&t!==xT);var t,i}function YT(e){return new jT(e)}var QT=MT.getInstance(),JT=function(){function e(){}return e.prototype.startSpan=function(e,t,i){if(void 0===i&&(i=QT.active()),Boolean(null==t?void 0:t.root))return new jT;var s,r=i&&GT(i);return"object"==typeof(s=r)&&"string"==typeof s.spanId&&"string"==typeof s.traceId&&"number"==typeof s.traceFlags&&qT(r)?new jT(r):new jT},e.prototype.startActiveSpan=function(e,t,i,s){var r,n,o;if(!(arguments.length<2)){2===arguments.length?o=t:3===arguments.length?(r=t,o=i):(r=t,n=i,o=s);var a=null!=n?n:QT.active(),c=this.startSpan(e,r,a),l=VT(a,c);return QT.with(l,o,void 0,c)}},e}(),XT=new JT,ZT=function(){function e(e,t,i,s){this._provider=e,this.name=t,this.version=i,this.options=s}return e.prototype.startSpan=function(e,t,i){return this._getTracer().startSpan(e,t,i)},e.prototype.startActiveSpan=function(e,t,i,s){var r=this._getTracer();return Reflect.apply(r.startActiveSpan,r,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):XT},e}(),eS=new(function(){function e(){}return e.prototype.getTracer=function(e,t,i){return new JT},e}()),tS=function(){function e(){}return e.prototype.getTracer=function(e,t,i){var s;return null!==(s=this.getDelegateTracer(e,t,i))&&void 0!==s?s:new ZT(this,e,t,i)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:eS},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,i){var s;return null===(s=this._delegate)||void 0===s?void 0:s.getTracer(e,t,i)},e}(),iS=MT.getInstance(),sS=oT.instance(),rS=new(function(){function e(){}return e.prototype.getMeter=function(e,t,i){return ET},e}()),nS="metrics",oS=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return eT(nS,e,oT.instance())},e.prototype.getMeterProvider=function(){return tT(nS)||rS},e.prototype.getMeter=function(e,t,i){return this.getMeterProvider().getMeter(e,t,i)},e.prototype.disable=function(){iT(nS,oT.instance())},e}(),aS=oS.getInstance(),cS=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),lS=lT("OpenTelemetry Baggage Key");function dS(e){return e.getValue(lS)||void 0}function uS(){return dS(MT.getInstance().active())}function hS(e,t){return e.setValue(lS,t)}function pS(e){return e.deleteValue(lS)}var _S="propagation",mS=new cS,fS=function(){function e(){this.createBaggage=cT,this.getBaggage=dS,this.getActiveBaggage=uS,this.setBaggage=hS,this.deleteBaggage=pS}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return eT(_S,e,oT.instance())},e.prototype.inject=function(e,t,i){return void 0===i&&(i=RT),this._getGlobalPropagator().inject(e,t,i)},e.prototype.extract=function(e,t,i){return void 0===i&&(i=CT),this._getGlobalPropagator().extract(e,t,i)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){iT(_S,oT.instance())},e.prototype._getGlobalPropagator=function(){return tT(_S)||mS},e}(),gS=fS.getInstance(),yS="trace",vS=function(){function e(){this._proxyTracerProvider=new tS,this.wrapSpanContext=YT,this.isSpanContextValid=qT,this.deleteSpan=KT,this.getSpan=BT,this.getActiveSpan=FT,this.getSpanContext=GT,this.setSpan=VT,this.setSpanContext=$T}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=eT(yS,this._proxyTracerProvider,oT.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return tT(yS)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){iT(yS,oT.instance()),this._proxyTracerProvider=new tS},e}(),OS={context:iS,diag:sS,metrics:aS,propagation:gS,trace:vS.getInstance()};function bS(e){return function(t){t.traceableAs=()=>e}}function ES(e,t,i){var s;let r;"function"==typeof e&&(null===(s=e.prototype)||void 0===s?void 0:s.constructor)?r=e.prototype.constructor:"object"==typeof e&&e.constructor&&(r=e.constructor);const n=i.value;return i.value=function(...e){let i=t;if(r){let e;"function"==typeof r.traceableAs?e=r.traceableAs():(Jr("Class name not provided",`Use the traceableAs decorator on the class of ${i} to ensure the class name does not get minified`),e=r.name),i=e+"."+i}const s=OS.trace.getTracer("sam-js").startSpan(i),o=OS.trace.setSpan(OS.context.active(),s);try{const t=OS.context.with(o,n,this,...e);return t&&"function"==typeof t.then?t.catch((e=>{throw e instanceof Error&&s.recordException(e),e})).finally((()=>{s.end()})):(s.end(),t)}catch(e){throw e instanceof Error&&s.recordException(e),s.end(),e}},i}let IS=class{constructor(e,t){this._core=e,this._assetPool=t,this._assignmentInterface=new xI(this._core),this._classroomsInterface=new PI(this._core),this._studentAssignmentsInterface=new Jd(this._core),this._studentAssignmentFileUpdater=tp,this._studentAssignmentUpdater=UI,this._assignmentUpdater=$I,this._classroomPool=new qo(this._core,"classroom"),this._classroomMemberPool=new qo(this._core,"classroomMember"),this._core.getBoardContext().then((e=>{this._boardContext=e}))}_ensureBoardContext(){if(!this._boardContext)throw new Error("Board context not initialized");return this._boardContext}get assignmentPool(){return this._assetPool}async getClassroomById(e){Na(e,"id");const t=this._classroomsInterface,i=this._classroomPool;let s=i.getLocalItemById(e);if(!s){const r=await t.getClassroom(e),n=i.createUpdateSession();s=LI.updateRemoteItem(n,this._processRemoteClassroomItem(e,r)),n.commit()}return s}async getClassroomByCode(e){Na(e,"classCode");return this._classroomPool.toArray().find((t=>t.code===e))||this.getClassroomById(e)}getClassrooms(){return new xo(this._classroomPool,[new NI(this._classroomPool,this._classroomsInterface)])}async getClassroomByAssetId(e){const t=this.getClassrooms().getList(Dh.default,void 0,{loadAllPages:!0});return await Ro(t),t.items.find((t=>t.assetId===e))}async getClassroomByBoardId(e){const t=await this._ensureBoardContext()._getBoard(e);return this.getClassroomByAssetId(t._idOfBaseAsset)}getClassroomMembers(){return new xo(this._classroomMemberPool,[new wI(this._classroomMemberPool,this._classroomsInterface)])}getAssignments(){const e=new GI(this._assignmentInterface,this._core);return new xo(this._assetPool,[e])}_getStudentAssignmentsSource(e){const t=new WI(this._studentAssignmentsInterface,this._core);return new xo(this._assetPool,[t],e)}getStudentAssignments(e){return this._getStudentAssignmentsSource(new FI(e))}cleanAssignmentName(e){return e.trimEnd()}async createClassroom(e){var t;const i=function(e){const t=[],i=[{key:"subject",type:"enum",isRequired:!1,ref:Ih},{key:"grades",type:"string[]",isRequired:!1},{key:"period",type:"string",isRequired:!1},{key:"teachers",type:"string[]",isRequired:!1}];t.push(...Ma(i,e));const s="string"==typeof e.name&&null!==e.name,r="string"==typeof e.id&&null!==e.id;return s||r||t.push("name or id is missing"),t}(e);if(i.length>0)throw Ge.create(Ue.BAD_REQUEST,JSON.stringify(i));let s;if(e.id)s=await this._classroomsInterface.createClassroomFromVirtual(e.id),s.virtualId=e.id;else{const i=(null===(t=e.name)||void 0===t?void 0:t.trim())||"";if(!Or(i))throw Ge.create(Ue.BAD_REQUEST,"Invalid class name provided for the creation operation.");s=await this._classroomsInterface.createClassroom(Object.assign(Object.assign({},e),{name:i}))}const r=this._classroomPool.createMutationSession(),n=LI.updateRemoteItem(r,s);return r.commit(),n}async createAssignment(e){const t=function(e){var t,i,s,r,n,o,a,c,l;const d=[],u=[{key:"classroomId",type:"string",isRequired:!0},{key:"createdBy",type:"string",isRequired:!1},{key:"dueDate",type:"date",isRequired:!1},{key:"externalTemplateIds",type:"string[]",isRequired:!1},{key:"instructions",type:"string",isRequired:!1},{key:"name",type:"string",isRequired:!0},{key:"status",type:"enum",isRequired:!1,ref:Bh},{key:"tasks",type:"string[]",isRequired:!1},{key:"templateIds",type:"string[]",isRequired:!1}];d.push(...Ma(u,e)),null===(t=e.references)||void 0===t||t.forEach(((e,t)=>{"object"==typeof e?(Da(e.content,"string",!0)||Da(e.content,"blob",!0)||d.push(`references[${t}].content is not a string, Blob, or is missing`),Da(e.name,"string",!0)||d.push(`references[${t}].name is not a string or is missing`)):"string"!=typeof e&&d.push(`references[${t}] is not an string or ExternalAsset`)})),e.externalTutorials&&(Array.isArray(e.externalTutorials)?e.externalTutorials.forEach(((e,t)=>{(function(e){return Ma([{key:"surfaces",type:"object",isRequired:!0},{key:"aem_id",type:"string",isRequired:!0},{key:"metadata",type:"object",isRequired:!1}],e)})(e).forEach((e=>{d.push(`externalTutorials[${t}]: ${e}`)}))})):d.push("externalTutorials is not an array"));const h=(null!==(s=null===(i=e.tasks)||void 0===i?void 0:i.length)&&void 0!==s?s:0)>0,p=(null!==(n=null===(r=e.templateIds)||void 0===r?void 0:r.length)&&void 0!==n?n:0)>0,_=(null!==(a=null===(o=e.externalTutorials)||void 0===o?void 0:o.length)&&void 0!==a?a:0)>0,m=(null!==(l=null===(c=e.externalTemplateIds)||void 0===c?void 0:c.length)&&void 0!==l?l:0)>0;return e.status===Bh.DRAFT||h||p||_||m||d.push("Assigned Assignment must have tasks, templates, externalTemplateIds, or tutorials"),d}(e);if(t.length>0)throw Ge.create(Ue.BAD_REQUEST,JSON.stringify(t));const i=this.cleanAssignmentName(e.name);if(!Or(i))throw Ge.create(Ue.BAD_REQUEST,"Invalid name provided for the creation operation.");let s=e.classroomId;const r=this._classroomPool.toArray().find((t=>t._virtualId===e.classroomId));if(r)s=r.id;else{const t=await this.getClassroomById(e.classroomId);if(t.isVirtual&&(s=(await this.createClassroom({id:t.id})).id,s===e.classroomId))throw Ge.create(Ue.BAD_REQUEST,"Cannot create an assignment with a virtual classroom.")}const{templateIds:n,references:o}=e,a=ze(e,["templateIds","references"]);a.name=i;const c=null!=n?n:[],l=null!=o?o:[],d=c.length+l.length>0,u=a.status||Bh.DRAFT;let h=this._findAssignment(s,i);const p=!!h;if(!h){yl(a,"status")&&!d||(a.status=Bh.DRAFT);const e=await this._assignmentInterface.createAssignment(Object.assign(Object.assign({},a),{classroomId:s})),t=this._assetPool.createMutationSession();h=$I.updateRemoteItem(t,e),t.commit()}const _={};if(c.length>0&&(_.templateIds=c),l.length>0&&(_.references=l),d||p)try{await this.updateAssignment(h.id,Object.assign(Object.assign(Object.assign({},_),p?Object.assign(Object.assign({},a),{name:void 0}):{}),{status:u}))}catch(e){throw Ge.wrapErrorIfNeeded(Ue.INTERNAL_ERROR,"Error updating assignment materials",e)}return h}_findAssignment(e,t){return this._assetPool.toArray().find((i=>i instanceof KI&&i.classroomId===e&&i.name===t))}async _assignAssignment(e){if(!this._assetPool.getLocalItemById(e))throw Ge.create(Ue.NOT_FOUND,`Could not find assignment to assign with ID of "${e}"`);return this.updateAssignment(e,{status:Bh.ASSIGNED})}async getAssignmentByID(e,t,i){Na(e,"id"),i&&Na(i,"classroomId");let s=this._assetPool.getLocalItemById(e);if(s)return s;const r=await this.validateStudentAssignmentsFilter(t,i),n=await this._assignmentInterface.getAssignment(e,r),o=this._assetPool.createMutationSession();return s=$I.updateRemoteItem(o,n),o.commit(),s}async getAssignmentByCode(e,t,i){Na(e,"code"),i&&Na(i,"classroomId");let s=this._assetPool.toArray().find((t=>t.code===e));if(s)return s;const r=await this.validateStudentAssignmentsFilter(t,i),n=await this._assignmentInterface.getAssignmentByCode(e,r),o=this._assetPool.createMutationSession();return s=$I.updateRemoteItem(o,n),o.commit(),s}async getStudentAssignmentById(e,t){var i;const s=this._assetPool.getLocalItemById(e);if(s)return s;const r=await this._studentAssignmentsInterface.getStudentAssignment(e,t),n=this._assetPool.createMutationSession(),o=UI.updateRemoteItem(n,r);return o._hasLoadedChildren=null!==(i=null==t?void 0:t.loadDocuments)&&void 0!==i&&i,n.commit(),o}async _discardAssignment(e){await e.discard()}async _restoreAssignment(e){await e.restore()}_computeRemoteStudentAssignmentFiles({assignmentId:e,classroomId:t,remoteStudentAssignmentFiles:i,studentAssignmentId:s}){return[...i].map((i=>{if(i.computedStudentAssignmentId=s,i.computedAssignmentId=e,t){if(!t.startsWith("urn"))throw Ge.create(Ue.BAD_REQUEST,`The classroomId provided, ${t}, is NOT an asset ID`);i.computedClassroomAssetId=t}return i}))}_updateStudentAssignmentFilesCache({assignmentId:e,classroomId:t,remoteStudentAssignmentFiles:i,session:s,studentAssignmentId:r}){const n=this._computeRemoteStudentAssignmentFiles({remoteStudentAssignmentFiles:i,assignmentId:e,classroomId:t,studentAssignmentId:r}),o=tp.updateRemoteItems(s,n);return s.commit(),o}async _returnAssignment(e){const t=await this._studentAssignmentsInterface.return(e),i=this._assetPool.createMutationSession(),s=UI.updateRemoteItem(i,t);return i.commit(),s}async _startAssignment(e){const t=await this._studentAssignmentsInterface.start(e),i=this._assetPool.createMutationSession(),s=UI.updateRemoteItem(i,t);return i.commit(),s}async submitAssignment(e){const{assignmentId:t,status:i,studentAssignmentId:s,submissionId:r}=e,n=Na(t,"assignmentId",!1),o=n&&void 0===s||Na(s,"studentAssignmentId",!1);if(!n&&!o)throw Ge.create(Ue.BAD_REQUEST,"Either studentAssignmentId or assignmentId is required to submit an assignment");if(!n&&i===Wd.NOT_STARTED)throw Ge.create(Ue.BAD_REQUEST,"assignmentId is required when the assignment has not been started");if(!s&&i&&i!==Wd.NOT_STARTED)throw Ge.create(Ue.BAD_REQUEST,"studentAssignmentId is required once the assignment has been started");let a;if(i&&i===Wd.NOT_STARTED)a=await this._startAssignment({assignmentId:t,links:e.links});else if(s)a=await this.getStudentAssignmentById(s);else if(a=(await this.getAssignmentByID(t,Vh.SELF)).studentAssignments[0],a.status===Wd.NOT_STARTED)throw Ge.create(Ue.BAD_REQUEST,"studentAssignmentId is required once the assignment has been started");const c=await this._core.hostAssetContext.getAssetWithCloudID(r);if(await this._isFloating(a,c)){if(!c.hasPermission(Ki.Move)||!c.hasPermission(Ki.Write))throw Ge.create(Ue.BAD_REQUEST,`Current user does not have permission to move and / or submit this asset: ${c.id}`);let e,i;try{i=c.repoPath.substring(0,c.repoPath.lastIndexOf("/")),e=await this._core.hostAssetContext.getAssetWithRepoPath(i,c.repositoryID)}catch(e){throw Ge.create(Ue.BAD_REQUEST,`Unable to fetch the parent asset of the file being submitted using the path ${i}: ${e}`)}if(!e.hasPermission(Ki.Write))throw Ge.create(Ue.BAD_REQUEST,`Current user is trying to submit an assignment from a folder that they do not have write permission on -- directory ID: ${e.id}`);const s=this._getFormattedCreatedDateHelper({includeFormattedDate:!1,date:new Date}),r=await this.getAssignmentByID(t),n=`${a.student.displayName} ${r.name} ${s}.${c.extension}`;await c.move(a,n)}const{studentDirectoryId:l}=a,d=await this._studentAssignmentsInterface.submit({links:a.links,studentAssignmentId:l,submissionId:r}),u=this._assetPool.createMutationSession();return UI.updateRemoteItem(u,d),u.commit(),d}async _isFloating(e,t){var i;if(t.isChildOfStudentAssignment){if(t.parentStudentAssignmentId!==e.id)throw Ge.create(Ue.BAD_REQUEST,`Submitted asset is already in a different assignment directory and has been submitted to another assignment -- directory ID: ${t.parentStudentAssignmentId}, attempted to turn in to: ${e.id}`);return!1}try{const s=null===(i=e.children)||void 0===i?void 0:i.getList(Bn.default);if(s)return await Ro(s),!s.items.some((e=>e.id===t.id))}catch(e){throw Ge.create(Ue.BAD_REQUEST,`Error waiting for list load in floating file check: ${e}`)}return!0}async updateStudentAssignmentFile(e,t){var i,s,r,n,o,a;const c=t.sourceAsset||t.sourceTasks||t.sourceTutorials,l=t.sourceAssets||t["assignment:sourceAssets"]||t["assignment:sourceTasks"]||t["assignment:sourceTutorials"];if(c&&l)throw Ge.create(Ue.INTERNAL_ERROR,"Do not use the deprecated interface.");const d=[{op:"add",path:"/assignment:sourceAssets",value:null!==(s=null!==(i=t.sourceAssets)&&void 0!==i?i:t["assignment:sourceAssets"])&&void 0!==s?s:[]},{op:"add",path:"/assignment:sourceTasks",value:null!==(n=null!==(r=t.sourceTasks)&&void 0!==r?r:t["assignment:sourceTasks"])&&void 0!==n?n:[]},{op:"add",path:"/assignment:sourceTutorials",value:null!==(a=null!==(o=t.sourceTutorials)&&void 0!==o?o:t["assignment:sourceTutorials"])&&void 0!==a?a:[]}];t.sourceAsset&&d.push({op:"add",path:"/assignment:sourceAsset",value:t.sourceAsset});const u="string"==typeof e?await this._core.hostAssetContext.getAssetWithCloudID(e):e;return await u.patchAppMetadata(d),u}async validateAssignmentNameForCreate(e,t){await this._validateAssignmentName(e,t)}async validateStudentAssignmentsFilter(e,t){if(e&&e===Vh.ANY){if(!t)throw Ge.create(Ue.BAD_REQUEST,"Cannot fetch specified assignment submission type without classroomId");if((await this.getClassroomMembership(t)).role===Ch.STUDENT)throw Ge.create(Ue.BAD_REQUEST,'Student role cannot request assignment submission type "ANY"')}return e}async validateAssignmentNameForUpdate(e,t,i){await this._validateAssignmentName(e,t,i)}async _validateAssignmentName(e,t,i){const s=e.trim();if(0===s.length)throw Ge.create(Ue.BAD_REQUEST,"The assignment name cannot be blank.");if(!Or(s))throw Ge.create(Ue.BAD_REQUEST,"The assignment name is an invalid platform repo name.");if(s.endsWith("."))throw Ge.create(Ue.BAD_REQUEST,"The assignment name cannot end with a period.");if(!t)return;if((await this.getClassroomById(t)).isVirtual)return;const r=this.getAssignments().getList(await this.getAssignmentOrder(),await this.getAssignmentFilter({classroomId:t}),{});await Ro(r);const n=this._core._environment.getValue("LOCALE"),o=r.items.find((e=>e.name.toLocaleLowerCase(n)===s.toLocaleLowerCase(n)));if(o&&(!i||o.id!==i))throw Ge.create(Ue.CONFLICT,"The assignment name must be unique within the classroom.")}async _renameAssignment(e,t){const i=await this.getAssignmentByID(e);try{return i.repositoryID||await i._load(),i.rename(t)}catch(t){if(t instanceof Ge)throw t;throw Ge.create(Ue.INTERNAL_ERROR,`Could not rename asset "${e}"`)}}async updateAssignment(e,t){Na(e,"assignmentId");const{references:i,status:s,templateIds:r}=t,n=ze(t,["references","status","templateIds"]),o=await this._getUpdatedAssignmentMaterials(e,t),a=n;o.shouldUpdateTemplates&&(a.templateIds=o.updatedTemplateIds),o.shouldUpdateReferences&&(a.referenceIds=o.updatedReferenceIds);const c=[];Boolean(t.name)&&(a.name=this.cleanAssignmentName(t.name),c.push(this._renameAssignment(e,a.name))),s===Bh.ASSIGNED&&(a.status=s),c.push(this._updateAssignmentMetadata(e,a)),await Promise.all(c),this._discardAssets(o.assetsToDiscard)}async _updateAssignmentMetadata(e,t){if(0===Object.keys(t).length)return;const i=Object.entries(Fh).reduce(((e,[i,s])=>{if(yl(t,i)){const r=t[i];r instanceof Date?e[s]=r.toISOString():e[s]="dueDate"!==i||r?r:""}return e}),{"repo:assetId":e}),s=this._getUpdateAssignmentOps(i);if(0!==s.length){const t=await this._assignmentInterface.patchAssignment(e,s),i=this._assetPool.createMutationSession();$I.updateRemoteItem(i,t),i.commit()}}async _getAssignmentMaterialsFolderAsset(e){const t=await this.getAssignmentByID(e),i=`${t.repoPath}/materials`,s=await this._core.hostAssetContext.getAssetWithRepoPath(i,t.repositoryID);if(!s)throw Ge.create(Ue.BAD_REQUEST,`Could not find materials folder with path of "${i}"`);return s}async _getAssets(e){return(await Promise.allSettled(e.map((e=>this._core.hostAssetContext.getAssetWithCloudID(e))))).map(((t,i)=>{if("fulfilled"===t.status)return t.value;throw Ge.wrapErrorIfNeeded(Ue.INTERNAL_ERROR,`Failed to get asset with ID of "${e[i]}"`,t.reason)}))}async _discardAssets(e){if(0===e.length)return;const t=await this._getAssets(e);await Promise.allSettled(t.map((e=>e.discard())))}_getUpdateAssignmentOps(e){const t=Object.entries(e).filter((([e])=>e.startsWith("assignment:"))).map((([e,t])=>({op:"replace",path:`/${e}`,value:t})));return t}async _copyAssetsToMaterialsFolder(e,t){if(0===t.length)return[];const i=await this.getAssignmentByID(e),s=(await this._getAssets(t)).map(((e,t)=>{const s=e.extension?`.${e.extension}`:"";return e._copyWithDestMetadata(i.repositoryID,`${i.repoPath}/materials`,`${i.name} ${this._getFormattedCreatedDateHelper({includeFormattedDate:!0,date:new Date})} ${t}${s}`)})),r=(await Promise.allSettled(s)).map(((e,i)=>{if("fulfilled"===e.status)return e.value;throw Ge.wrapErrorIfNeeded(Ue.INTERNAL_ERROR,`Failed to copy asset with ID of "${t[i]}"`,e.reason)}));return r.map((e=>e.id))}_getFormattedCreatedDateHelper({includeFormattedDate:e,date:t}){const i=this._core._environment.getValue("LOCALE"),s=e?{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3,hourCycle:"h24"}:{hour:"numeric",minute:"numeric",second:"numeric"};return new Intl.DateTimeFormat(i,s).format(t).replace(/[/:]/g,".")}async _determineAssetDifferences(e,t,i){const s=await this.getAssignmentByID(e);if(!i)return{assetsToCopy:[],assetsToKeep:[],assetsToDiscard:s[t]};const r=s[t].filter((e=>!i.includes(e)));return{assetsToCopy:i.filter((e=>!s[t].includes(e))),assetsToKeep:s[t].filter((e=>i.includes(e))),assetsToDiscard:r}}async _getUpdatedAssignmentMaterials(e,t){var i,s;const r=yl(t,"templateIds"),n=yl(t,"references"),o={assetsToDiscard:[],shouldUpdateReferences:n,shouldUpdateTemplates:r,updatedReferenceIds:[],updatedTemplateIds:[]},a=[];let c=0;const l=[];if(r){const i=await this._determineAssetDifferences(e,"templateIds",t.templateIds);o.assetsToDiscard.push(...i.assetsToDiscard),a.push(...i.assetsToCopy),o.updatedTemplateIds.push(...i.assetsToKeep),c=a.length}if(n){const{referenceIds:r,referencesToImport:n}=null!==(s=null===(i=t.references)||void 0===i?void 0:i.reduce(((e,t)=>("string"==typeof t?e.referenceIds.push(t):e.referencesToImport.push(t),e)),{referenceIds:[],referencesToImport:[]}))&&void 0!==s?s:{referenceIds:[],referencesToImport:[]},c=await this._determineAssetDifferences(e,"referenceIds",r);o.assetsToDiscard.push(...c.assetsToDiscard),a.push(...c.assetsToCopy),o.updatedReferenceIds.push(...c.assetsToKeep),n.length>0&&l.push((async()=>{const t=[];(await this.importNewReferencesForAssignment(e,n)).forEach((e=>{if("fulfilled"!==e.status)throw Ge.create(Ue.BAD_REQUEST,"Error importing reference asset",{underlyingError:e.reason});t.push(e.value.id)})),o.updatedReferenceIds.push(...t)}))}let d=[];l.push((async()=>{d=await this._copyAssetsToMaterialsFolder(e,a)})),await Promise.all(l.map((e=>e())));const[u,h]=[d.slice(0,c),d.slice(c)];return o.updatedTemplateIds.push(...u),o.updatedReferenceIds.push(...h),o}async importNewReferencesForAssignment(e,t){const i=await this._getAssignmentMaterialsFolderAsset(e);return Promise.allSettled(t.map((async e=>i.importFile(e.content,e.name,e.mediaType,!0,0,!1))))}async getStudentAssignmentFiles({studentDirectoryId:e,order:t}){Na(e,"studentDirectoryId");const i=(await this._core.hostAssetContext.getAssetWithCloudID(e)).children.getList(t||Bn.default,new rp,{loadAllPages:!0});return await Ro(i),i.items}async refreshClassroomCodes(e){Na(e,"classIds");const t=(await Promise.allSettled(e.map((e=>this._classroomsInterface.refreshClassroomCode(e))))).filter((e=>"fulfilled"===e.status)).map((e=>e.value)),i=(await Promise.allSettled(t.map((async({classroomId:e,classcode:t})=>{const i=await this._classroomsInterface.getClassroom(e);return i.classCode=t,i})))).filter((e=>"fulfilled"===e.status)).map((e=>e.value)),s=this._classroomPool.createMutationSession();LI.updateRemoteItems(s,i),s.commit()}async deleteClassrooms(e){if(Na(e,"ids"),Array.isArray(e))await Promise.all(e.map((e=>this.deleteClassrooms(e))));else{const t=await this.getClassroomById(e);t.isVirtual?await this._classroomsInterface.deleteVirtualClassroom(e):await this._classroomsInterface.deleteClassroom(e);const i=this._classroomPool.createUpdateSession();i.queueDiscardedItem(t),i.commit(),this._classroomPool.removeLocalItems([t.id])}}async updateClassroom(e,t){var i;let s;Na(e,"classroomId");const r=await this.getClassroomById(e);null!==(i=t.name)&&void 0!==i||(t.name=r.name),r.isVirtual?(s=await this._classroomsInterface.updateClassroomFromVirtual(r.id,t),s.virtualId=r.id):s=await this._classroomsInterface.updateClassroom(e,t);const n=this._classroomPool.createMutationSession();LI.updateRemoteItem(n,this._processRemoteClassroomItem(e,s)),n.commit()}_processRemoteClassroomItem(e,t){const i=this._classroomPool.getLocalItemById(e);return(null==i?void 0:i._virtualId)&&(t.virtualId=i._virtualId),t}async getClassroomMembership(e){return Na(e,"classroomId"),this._classroomsInterface.getMembership(e)}async blockStudentFromClassroom(e,t){return Na(e,"classroomId"),Na(t,"studentId"),this._classroomsInterface.blockStudent(e,t)}async unblockStudentFromClassroom(e,t){return Na(e,"classroomId"),Na(t,"studentId"),this._classroomsInterface.unblockStudent(e,t)}async removeStudentFromClassroom(e,t){Na(e,"classroomId"),Na(t,"studentId");const i=await this._classroomsInterface.removeStudent(e,t);return this.removeUserFromPool(e,t),i}async removeTeacherFromClassroom(e,t){Na(e,"classroomId"),Na(t,"teacherId");const i=await this._classroomsInterface.removeTeacher(e,t);return this.removeUserFromPool(e,t),i}removeUserFromPool(e,t){const i=this._classroomMemberPool.getLocalItemById(xa(e,t));if(i){const s=this._classroomMemberPool.createUpdateSession();s.queueDiscardedItem(i),s.commit(),this._classroomMemberPool.removeLocalItems([xa(e,t)])}}getClassroomOrder(e="ascending",t="name"){return new Dh(e,t)}getAssignmentOrder(e="ascending",t="name"){return new Wh(e,t)}getAssignmentFilter(e={}){return new zh(e)}getStudentAssignmentOrder(e="ascending",t="studentDisplayName"){return new Xh(e,t)}getStudentAssignmentFilter(e){return new qh(e)}getStudentAssignmentFileOrder(e="ascending",t="name"){return new sp(e,t)}getStudentAssignmentFileFilter(e,t){return new np(e,t)}getClassroomMemberOrder(e="ascending",t="name"){return new Hh(e,t)}getClassroomMemberFilter(e){return new jh(e)}async checkCoTeacherEligibility(e){return this._classroomsInterface.checkCoTeacherEligibility(e)}async _getClassroomByIdOrCode(e){const{classroomCode:t,classroomId:i}=e;if(i)return this.getClassroomById(i);if(t)return this.getClassroomByCode(t);throw Ge.create(Ue.BAD_REQUEST,"Either classroomCode or classroomId must be provided")}async _getAssignmentId(e){const{assignmentCode:t,assignmentId:i}=e;if(i)return i;if(t)return(await this.getAssignmentByCode(t)).id;throw Ge.create(Ue.BAD_REQUEST,"Either assignmentCode or assignmentId must be provided")}async getClassroomBoards(e){const t=await this._getClassroomByIdOrCode(e);return this._ensureBoardContext().getBoards({baseAssetId:t.assetId})}async getAssignmentBoards(e){const t=await this._getAssignmentId(e);return this._ensureBoardContext().getBoards({baseAssetId:t})}async getAssignmentBoard(e){const t=(await this.getAssignmentBoards(e)).getList(Pp.default,void 0,{loadAllPages:!0});if(await Ro(t),t.items.length>1)throw Ge.create(Ue.BAD_REQUEST,`Expected 1 board, got ${t.items.length}`);return t.items[0]}async _getRealClassroomGivenClassroomIdOrCode({classroomId:e,classroomCode:t}){const i=e||"",s=this._classroomPool.toArray().find((e=>e._virtualId===i));if(s)return{classroom:s};{const s=e?{classroomId:e}:{classroomCode:t},r=await this._getClassroomByIdOrCode(s);if(r.isVirtual){const e=await this.createClassroom({id:r.id});if(i===e.id)throw Ge.create(Ue.BAD_REQUEST,"Cannot create an asset with a virtual classroom.");return{classroom:e,isVirtualClassroomJustMigrated:!0}}return{classroom:r}}}async createClassroomBoard(e){const{classroomId:t,classroomCode:i}=e,s=ze(e,["classroomId","classroomCode"]),{classroom:r,isVirtualClassroomJustMigrated:n}=await this._getRealClassroomGivenClassroomIdOrCode({classroomId:t,classroomCode:i}),{id:o,assetId:a}=r;return this._ensureBoardContext().createBoard(Object.assign(Object.assign({},s),{baseAssetId:a,type:lp.CLASSROOM,additionalData:{classroomId:o},shouldCheckForDuplicateName:!n}))}async validateClassroomBoardNameForCreate(e){let t,i;const{classroomCode:s,classroomId:r}=e;if(s||r){const e=r?{classroomId:r}:{classroomCode:s};i=await this._getClassroomByIdOrCode(e),t=i.assetId}return this._ensureBoardContext().validateBoardNameForCreate({name:e.name,baseAssetId:t})}async validateClassroomBoardNameForUpdate(e){const{name:t,boardId:i}=e,s=await this._getClassroomByIdOrCode(e);return this._ensureBoardContext().validateBoardNameForUpdate({name:t,baseAssetId:s.assetId,boardId:i})}};qe([Nt,Pt,Ye(0,tt)],IS.prototype,"getClassroomById",null),qe([Nt,Pt,Ye(0,tt)],IS.prototype,"getClassroomByCode",null),qe([rt],IS.prototype,"getClassrooms",null),qe([Nt,Pt,Ye(0,tt)],IS.prototype,"getClassroomByAssetId",null),qe([Nt,Pt,Ye(0,tt)],IS.prototype,"getClassroomByBoardId",null),qe([rt],IS.prototype,"getClassroomMembers",null),qe([rt],IS.prototype,"getAssignments",null),qe([Nt,Ct,Ye(0,tt)],IS.prototype,"getStudentAssignments",null),qe([ES,Nt,Pt],IS.prototype,"createClassroom",null),qe([ES,Nt,Pt],IS.prototype,"createAssignment",null),qe([Nt,Pt,Ye(0,tt)],IS.prototype,"getAssignmentByID",null),qe([Nt,Pt,Ye(0,tt)],IS.prototype,"getAssignmentByCode",null),qe([Nt,Pt,Ye(0,tt)],IS.prototype,"getStudentAssignmentById",null),qe([Pt],IS.prototype,"_discardAssignment",null),qe([Pt],IS.prototype,"_restoreAssignment",null),qe([Pt],IS.prototype,"_returnAssignment",null),qe([Pt],IS.prototype,"_startAssignment",null),qe([ES,Pt],IS.prototype,"submitAssignment",null),qe([Pt],IS.prototype,"_validateAssignmentName",null),qe([Pt],IS.prototype,"_renameAssignment",null),qe([Pt],IS.prototype,"updateAssignment",null),qe([Pt],IS.prototype,"_updateAssignmentMetadata",null),qe([Pt],IS.prototype,"refreshClassroomCodes",null),qe([Nt,Ct,Ye(0,tt)],IS.prototype,"getClassroomBoards",null),qe([Nt,Ct,Ye(0,tt)],IS.prototype,"getAssignmentBoards",null),qe([Nt,Pt,Ye(0,tt)],IS.prototype,"getAssignmentBoard",null),IS=qe([bS("ClassroomContext")],IS);var TS=IS,SS=Object.freeze({__proto__:null,default:TS});const AS={"repo:name":"Sample board name","dc:description":"Board description","board#type":"classroom","board:context":{baseAssetId:"urn:aaid:sc:VA6C2:af99f449-ea01-3e3e-aba5-fe57fd38364b",boardsAssetId:"urn:aaid:sc:VA6C2:af99f449-ea01-3e3e-aba5-fe57fd38364c"},"repo:assetId":"urn:aaid:sc:VA6C2:61b71cdc-4d42-5ac2-8d19-dede02efdxyz","repo:createDate":"2024-10-01T21:59:01.415Z","repo:modifyDate":"2024-10-01T21:59:06.565Z","repo:createdBy":"1916195E667CADAB0A12345D@AdobeID","repo:modifiedBy":"1916195E667CADAB0A12345D@AdobeID",posts:[{id:"af46a980-9cc5-4baf-935c-123fcb6ee615",description:"Text 1",type:"application/vnd.adobe.post.text+dcx",postedBy:{userId:"BF44198F668D1EAE0A494021@af361967668d0331494131.e",email:"assignmentstudent1@itaw16.onmicrosoft.com",firstName:"John",lastName:"Doe",displayName:"John. Doe",images:{50:"https://example_50_pixel.com",100:"https://example_100_pixel.com"}},created:"2020-03-17T21:23:25.693Z",modified:"2020-03-17T22:23:25.693Z","board#createdData":{userId:"0D522D2B5D7687E40A494215@AdobeID"},"board#modifiedData":{userId:"0D522D2B5D7687E40A494215@AdobeID"}},{id:"af46a980-9cc5-4baf-935c-501fcb6ee616",name:"My poster",description:"My poster description",type:"application/vnd.adobe.post.assetlink+dcx",link:{"repo:assetId":"urn:aaid:sc:VA6C2:61b71cdc-4d42-5ac2-8d19-dede02efdbbb","repo:etag":'"167dd86b8f8d4ac88f40722210655c51"'},postedBy:{userId:"BF44198F668D1EAE0A494021@af361967668d0331494131.e",email:"assignmentstudent1@itaw16.onmicrosoft.com",firstName:"John",lastName:"Doe",displayName:"John. Doe",images:{50:"https://example_50_pixel.com",100:"https://example_100_pixel.com"}},created:"2020-03-17T21:23:25.693Z",modified:"2020-03-17T22:23:25.693Z","board#createdData":{userId:"0D522D2B5D7687E40A494215@AdobeID"},"board#modifiedData":{userId:"0D522D2B5D7687E40A494215@AdobeID"}}]},PS=ba();class wS extends lr{async _discoverLinks(e){return(await this._getResponse(e,{headers:PS}))._links}_getEndpointHref(e){return`https://${this._core._environment.endpoints.ASSIGNMENTS_HOST}${e}`}async discoverLinks(){return this._discoverLinks(this._getEndpointHref("/api/v1/boards/index"))}async createBoard(e){const t=await this.discoverLinks(),{name:i,description:s,type:r,additionalData:n,posts:o}=e,a={"repo:name":i,"dc:description":s,"board#type":r,additionalMetadata:n};o&&(a.posts=await Promise.all(o.map((e=>this.mapPostCreationData(e)))));const c=bt(t,gt.BOARDS_CREATE,{baseAssetId:e.baseAssetId,useBaseAssetDirectory:e.shouldCreateDirectlyInBaseAsset||!1});return(await this._doPost(c,Object.assign(Object.assign({},PS),{"Content-Type":"application/json"}),JSON.stringify(a),[201])).json()}async getBoard(e){const t=bt(await this.discoverLinks(),gt.BOARDS_PRIMARY,{boardId:e});return(await this._doGet(t,{headers:PS})).json()}async getBoards(e){const{baseAssetId:t}=e,i=bt(await this.discoverLinks(),gt.BOARDS_COLLECTION,{baseAssetId:t,useBaseAssetDirectory:e.shouldGetDirectlyInBaseAsset||!1}),s=await this._doGet(i,{headers:PS});return(await s.json()).children}async mapPostCreationData(e){const{name:t,description:i,type:s,userId:r}=e,n={name:t,"board#postDescription":i,type:hp.toB(s)};if(r&&(n.userId=r),s===cp.Text&&(n["board#postText"]=e.text),s===cp.AssetLink){const t=await this._core.hostAssetContext.getAssetWithCloudID(e.assetId);n.link={"repo:assetId":e.assetId,"dc:format":t.mediaType}}return n}async updateBoard(e){const t=await this.discoverLinks(),{description:i,postsToAdd:s=[],postsToRemove:r,postsToUpdate:n,boardId:o}=e,a=[];void 0!==i&&a.push({op:"replace",path:"/dc:description",value:i});for(const e of s)a.push({op:"add",path:"/board#post",value:await this.mapPostCreationData(e)});null==r||r.forEach((e=>{a.push({op:"remove",path:`/board#post/${e}`})})),null==n||n.forEach((e=>{a.push({op:"replace",path:`/board#post/${e.id}/board#postDescription`,value:e.description})}));const c=bt(t,gt.BOARDS_PRIMARY,{boardId:o});if(a.length>0)return(await this._doPatch(c,Object.assign(Object.assign({},PS),{"Content-Type":"application/json"}),JSON.stringify(a))).json()}async updateUsers(e){return await this.discoverLinks(),Promise.resolve(AS)}async discardBoard(e,t){if(!(null==t?void 0:t[gt.BOARDS_DISCARD]))throw Ge.create(Ue.BAD_REQUEST,`Discard link is missing for this board ${e}`);const i=bt(t,gt.BOARDS_DISCARD,{boardId:e});await this._doPost(i,PS,void 0,[204])}async publishBoard(e){const{boardId:t,links:i,boardTitle:s,boardSubTitle:r,showPosterName:n}=e;if(!(null==i?void 0:i[gt.BOARDS_PUBLISH]))throw Ge.create(Ue.BAD_REQUEST,`Publish link is missing for this board ${t}`);const o=bt(i,gt.BOARDS_PUBLISH,{boardId:t}),a={boardTitle:s,boardSubTitle:r,showPosterName:n};return(await this._doPost(o,PS,JSON.stringify(a),[201])).json()}async unpublishBoard({boardId:e,links:t}){if(!(null==t?void 0:t[gt.BOARDS_UNPUBLISH]))throw Ge.create(Ue.BAD_REQUEST,`Unpublish link is missing for this board ${e}`);const i=bt(t,gt.BOARDS_UNPUBLISH,{boardId:e});await this._doPost(i,PS,void 0,[204])}}qe([st((function(e){return yt(e,dp)})),Ye(0,tt)],wS.prototype,"_discoverLinks",null);class CS{constructor(e){this._core=e,this._boardsInterface=new wS(e)}async observeBoardsFolder(e){const t=e[0]["board:context"].boardsAssetId;return this._core.hostAssetContext.getAssetWithCloudID(t)}async loadPage(e){return this._loadPage(e)}async _loadPage(e){const{filter:t,implicitFilter:i}=e,s=i.baseAssetId||t.baseAssetId,r=i.shouldGetDirectlyInBaseAsset||t.shouldGetDirectlyInBaseAsset||!1,n=await this._boardsInterface.getBoards({baseAssetId:s,shouldGetDirectlyInBaseAsset:r}),o=this._core._getAssetPool().createLoaderUpdateSession(Date.now()),a=bp.updateRemoteItems(o,n);return o.commit(),n.length>0&&this.observeBoardsFolder(n).then((e=>{i._monitoredFolder=e})),{items:a,total:a.length,mostRecentValidMutation:Date.now()}}}class RS{constructor(e,t){this._core=e,this._assetPool=t,this._boardsInterface=new wS(this._core),this._boardUpdater=bp}async updateBoardInPool(e){const t=this._core._getAssetPool().createMutationSession(),i=bp.updateRemoteItem(t,e);return t.commit(),i}async getBoardById(e){const t=this._core._getAssetPool().getLocalItemById(e),i=(null==t?void 0:t._hasLoadedPosts)?t:await this._fetchBoardById(e);if(null==i?void 0:i.isDiscarded)throw Ge.create(Ue.NOT_FOUND,`Board ${e} is discarded`);return i}async _getBoard(e){return this._core._getAssetPool().getLocalItemById(e)||this._fetchBoardById(e)}async _fetchBoardById(e,t){if(!Na([e],"Board ID",!1))throw Ge.create(Ue.BAD_REQUEST,"Board ID is required");const i=await this._boardsInterface.getBoard(e);await t;const s=await this.updateBoardInPool(i);return s._hasLoadedPosts=!0,s}async validateBoardNameForCreate({name:e,baseAssetId:t,shouldValidateDirectlyInBaseAsset:i=!1}){await this._validateBoardName({name:e,baseAssetId:t,shouldValidateDirectlyInBaseAsset:i})}async validateBoardNameForUpdate({name:e,baseAssetId:t,boardId:i,shouldValidateDirectlyInBaseAsset:s=!1}){try{Na([t,i],"BaseAssetId and boardId")}catch(e){throw Ge.create(Ue.BAD_REQUEST,"Base asset ID and board ID are required for name validation")}await this._validateBoardName({name:e,baseAssetId:t,boardId:i,shouldValidateDirectlyInBaseAsset:s})}async _validateBoardName({name:e,baseAssetId:t,boardId:i,shouldValidateDirectlyInBaseAsset:s=!1}){let r=[];if(t){const e=this.getBoardFilter({baseAssetId:t}),i=this.getBoardOrder(),n=this.getBoards({baseAssetId:t,shouldGetDirectlyInBaseAsset:s}).getList(i,e,{loadAllPages:!0});if(await Ro(n),n.status===ro.HadLoaderErrors)throw Ge.create(Ue.NETWORK_ERROR,"Failed to load boards");r=n.items}return Nr({name:e,assetId:i,assetList:r,locale:this._core._environment.getValue("LOCALE"),getOtherAssetName:e=>e instanceof Op?e.displayName:e.name})}async createBoard(e){const{name:t,baseAssetId:i,shouldCheckForDuplicateName:s=!0,type:r,additionalData:n,posts:o=[]}=e;if(!i||!r)throw Ge.create(Ue.BAD_REQUEST,"Base asset ID and type are required for board creation");if(r===lp.CLASSROOM&&!(null==n?void 0:n.classroomId))throw Ge.create(Ue.BAD_REQUEST,"Classroom ID is required for classroom boards");await this._validateBoardName({name:t,baseAssetId:s?i:void 0}),o.length>0&&(e.posts=await Promise.all(o.map((e=>this.processNewPost(e)))));const a=await this._boardsInterface.createBoard(e);return this.updateBoardInPool(a)}async _getUserHomeUploadsFolder(){const e=`${Wi}/Uploads`;try{return await this._core.hostAssetContext.getAssetWithRepoPath(e)}catch(t){if(We(t)&&t.code===Ue.NOT_FOUND)return(await this._core.hostAssetContext.getRootFolder()).createFolder(e.split("/").pop());throw Ge.wrapErrorIfNeeded(Ue.INTERNAL_ERROR,"Failed to get uploads folder",t)}}async _uploadFileForAssetLinkPost(e){let t;return t=e.parentAssetId?await this._core.hostAssetContext.getAssetWithCloudID(e.parentAssetId):await this._getUserHomeUploadsFolder(),t.importFile(e.blob,e.fileName,e.mediaType,!0,0,!1)}async _updateBoardAfterPatchingBoard(e){const t=await this._boardsInterface.updateBoard(e);t&&await this.updateBoardInPool(t)}async processNewPost(e){if(e.type===cp.AssetLink){if(e.assetId&&e.blob)throw Ge.create(Ue.BAD_REQUEST,"Asset ID and blob cannot be provided together for asset link posts");if(!e.assetId&&e.blob){if(!e.fileName)throw Ge.create(Ue.BAD_REQUEST,"File name is required for asset link posts with a blob");const t=(({name:e,maxLength:t=gr,shouldValidate:i=!1})=>{const s=e.replaceAll(new RegExp(vr,"g"),"").substring(0,t).replace(/[\u{0000}-\u{001F}|\u{007F}]+/gu,"").replace(/[\s|.]+$/g,"");return i&&Nr({name:s}),s})({name:e.fileName,maxLength:240,shouldValidate:!0}),i={blob:e.blob,fileName:t,mediaType:e.mediaType,parentAssetId:e.parentAssetId},s=await this._uploadFileForAssetLinkPost(i);e.assetId=s.id,e.fileName=s.name}else if(!e.assetId)throw Ge.create(Ue.BAD_REQUEST,"Asset ID or blob is required for asset link posts")}else if(e.type===cp.Text&&!e.text)throw Ge.create(Ue.BAD_REQUEST,"Text is required for text posts");return e}async addPost(e){var{boardId:t}=e,i=ze(e,["boardId"]);const s={boardId:t,postsToAdd:[await this.processNewPost(i)]};await this._updateBoardAfterPatchingBoard(s)}async removePost({boardId:e,postId:t}){const i={boardId:e,postsToRemove:[t]};await this._updateBoardAfterPatchingBoard(i)}async updatePost(e){var{boardId:t}=e;const i={boardId:t,postsToUpdate:[ze(e,["boardId"])]};await this._updateBoardAfterPatchingBoard(i)}getBoards({baseAssetId:e,shouldGetDirectlyInBaseAsset:t}){if(!e)throw Ge.create(Ue.BAD_REQUEST,"Base asset ID is required for fetching boards");const i=new CS(this._core),s=new wp({baseAssetId:e,shouldGetDirectlyInBaseAsset:t||!1});return new xo(this._assetPool,[i],s)}_cleanBoardName(e){return e.trimEnd()}async _renameBoard({boardId:e,newName:t,baseAssetId:i}){await this._validateBoardName({name:t,baseAssetId:i,boardId:e});const s=await this._getBoard(e);try{s.repositoryID||await s._load();const e=`${this._cleanBoardName(t)}${Op.boardNameSuffix}`;return s.rename(e)}catch(t){throw Ge.wrapErrorIfNeeded(Ue.INTERNAL_ERROR,`Could not rename asset "${e}"`,t)}}async _updateBoardManifest({boardId:e,description:t}){const i={boardId:e,description:t};await this._updateBoardAfterPatchingBoard(i)}async updateBoard({boardId:e,description:t,displayName:i}){let s;const r=void 0!==i,n=void 0!==t;(n||r)&&(s=await this._getBoard(e)),n&&t!==(null==s?void 0:s.description)&&await this._updateBoardManifest({boardId:e,description:t}),r&&await this._renameBoard({boardId:e,newName:i,baseAssetId:null==s?void 0:s._idOfBaseAsset})}async _discardBoardFromPool(e){const t=this._core._getAssetPool().createUpdateSession();t.queueDiscardedItem(e),t.commit(),this._core._getAssetPool().removeLocalItems([e.id])}async discardBoard(e){const t=await this._getBoard(e);return await this._boardsInterface.discardBoard(e,t.links),this._discardBoardFromPool(t)}async publishBoard(e){const{boardId:t,boardSubTitle:i,boardTitle:s,showPosterName:r}=e,n=await this._getBoard(t),o=await this._boardsInterface.publishBoard({boardId:t,links:n.links,boardTitle:s,boardSubTitle:i,showPosterName:r});return this.updateBoardInPool(o)}async unpublishBoard(e){var t;const i=await this._getBoard(e);await this._boardsInterface.unpublishBoard({boardId:e,links:i.links});const s=null===(t=i.publishedBoardInfo)||void 0===t?void 0:t.boardId,r=this._assetPool.getLocalItemById(s);if(r)return this._discardBoardFromPool(r)}getBoardOrder(e){const t=Object.assign({},{direction:"ascending",field:"name"},e);return new Pp(t.direction,t.field)}getBoardFilter(e){return new wp(e)}getPostOrder(e={}){const t={direction:Ip.default.direction,field:Ip.default.field},i=Object.assign({},t,e);return new Ip(i.direction,i.field)}async getPostByBoardAndPostId({boardId:e,postId:t}){const i=(await this.getBoardById(e))._postPool.getLocalItemById(t);if(!i)throw Ge.create(Ue.NOT_FOUND,`Post with ID ${t} not found`);return i}}qe([Nt,Pt,Ye(0,tt)],RS.prototype,"getBoardById",null),qe([Nt,Pt,Ye(0,tt)],RS.prototype,"_getBoard",null),qe([Nt,Pt,Ye(0,tt)],RS.prototype,"_fetchBoardById",null),qe([Nt,Ct,Ye(0,tt)],RS.prototype,"getBoards",null),qe([Pt],RS.prototype,"_renameBoard",null);var LS=Object.freeze({__proto__:null,default:RS});class NS extends Nn{constructor(e){super({_isSharedWithYou:!0}),this.filterOptions=e,(null==e?void 0:e.owner)&&e.owner.length>0&&(this._owner=new Set([...e.owner])),(null==e?void 0:e.roles)&&e.roles.length>0&&(this._roles=new Set([...e.roles]))}matches(e){return!!e.isLibrary&&!(this._owner&&!dh(e,this._owner))&&!(this._roles&&!uh(e,this._roles))&&super.matches(e)}}NS.TrainingSets=new NS({owner:[th.All],roles:[rh.TrainingSet]});class DS{constructor(e,t,i,s){this._libraryPool=e,this._libraryInterface=t,this._libraryUpdater=i,this._core=s}supportsFilter(e){return void 0!==e}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i,s,r;let n;const o=e.filter;if(t)(null===(i=e.loadOptions)||void 0===i?void 0:i.limit)&&(t.href=t.href.replace(/limit=[0-9]*/,`limit=${e.loadOptions.limit}`)),n=await this._libraryInterface.getLibrariesWithLink(t);else{const{limit:t}=null!==(s=e.loadOptions)&&void 0!==s?s:{},i=e.implicitFilter,r=e.order,a=i._owner||o._owner||ph.DEFAULT._owner,c=i._roles||o._roles,l={};a&&!o._reference&&(l.owner=[...a].sort().join(",")),o._reference&&(l.references=o._reference),c&&(l.roles=[...c].sort().join(",")),o._project&&(l.team=o._project),o._publishMetadata&&(l.itemFilter=o._publishMetadata),l.orderBy="ascending"===r.direction?ah[r.field]:`-${ah[r.field]}`,t&&(l.limit=t,l.start||(l.start=0)),l.selector="rendition_grid,collaboration",n=await this._libraryInterface.getLibraries(l)}o._project&&this._decorateLibraryDataWithReferencedByProject(n.libraries,o._project);const a=this._libraryPool._core._environment.getValue("USS_LIST_UPDATE_LATENCY"),c=Date.now()-a,l=this._libraryPool.createLoaderUpdateSession(c),d=this._libraryUpdater.updateRemoteItems(l,n.libraries);let u;d.forEach((e=>e._setLibraryLoadState("LOADED"))),d.forEach((e=>tn.updatedByItemUpdater(e,Fn))),l.commit(),o._project&&this._updateProjectInaccessibleReferences(o._project,n.inaccessibleReferences);const h=null===(r=n._links)||void 0===r?void 0:r.next;return h&&(u=e=>this._loadPage(e,h)),{items:d,total:n.total_count,loadNextPage:u,mostRecentValidMutation:c}}_decorateLibraryDataWithReferencedByProject(e,t){t!==ih.All&&t!==ih.None&&e.forEach((e=>{const{reference:i}=e;i&&t&&(e.referenced_by_project={projectId:t,reference:i})}))}_updateProjectInaccessibleReferences(e,t){if(!t)return;const i=this._core._getProjectContext();if(!i)return;const s=i._assetPool.getLocalItemById(e);if(!s)return;const r=i._assetPool.createUpdateSession("update project inaccessible references");i._projectUpdater.updateLocalItem(r,s,{inaccessibleReferences:t}),r.commit()}}class MS{constructor(e,t,i){this._libraryPool=e,this._libraryInterface=t,this._libraryUpdater=i}supportsFilter(e){return void 0!==e}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i,s,r;const{implicitFilter:n}=e,{_query:o}=n,a=this._libraryPool._core._environment.getValue("PROJECTS_LIST_UPDATE_LATENCY"),c=Date.now()-a;let l;t?((null===(i=e.loadOptions)||void 0===i?void 0:i.limit)&&(t.href=t.href.replace(/limit=[0-9]*/,`limit=${e.loadOptions.limit}`)),l=await this._libraryInterface.searchLibrariesWithLink(o,t)):l=await this._libraryInterface.searchLibraries(o);const d=this._libraryPool.createLoaderUpdateSession(c),u=this._libraryUpdater.updateRemoteItems(d,null!==(s=l.libraries)&&void 0!==s?s:[]);for(const e of u)tn.updatedByItemUpdater(e,Fn);let h;d.commit();const p=null===(r=l._links)||void 0===r?void 0:r.next;return p&&(h=e=>this._loadPage(e,p)),n._matchingIDsFromSearch=new Set([...n._matchingIDsFromSearch||[],...u.map((e=>e.id))]),{items:u,total:l.total_count,loadNextPage:h,mostRecentValidMutation:c}}}class xS extends Nn{constructor(e){var t,i;super(),this._query="",this._query=null!==(i=null===(t=e.query)||void 0===t?void 0:t.trim())&&void 0!==i?i:""}get query(){return this._query}matches(e){return!!e.isLibrary&&!(this._matchingIDsFromSearch&&!this._matchingIDsFromSearch.has(e.id))&&!(this._query&&!this._matchingIDsFromSearch)&&super.matches(e)}}class kS extends Os{constructor(e,t){super(),this._asset=void 0,this._callback=()=>{this.emit("change")},this._cacheKey=e,this._path=t}get cacheKey(){return this._cacheKey}get path(){return this._path}get asset(){return this._asset}async ensureExistence(e,t){const i=e._core._environment,s=i.cache,r=this._cacheKey,n=await s.getItem(r);try{const t=n!==Ii?await e.getAssetWithCloudID(n):await e.getAssetWithRepoPath(this._path);return s.setItem(r,t.cloudID),this._setAsset(t,s)}catch(r){if(r.code===Ue.NOT_FOUND){i.debug(`${this._path} not found, creating it now`);const r=await this._create(e,t);return this._setAsset(r,s)}throw r}}async _setAsset(e,t){return this._asset=e,await t.setItem(this._cacheKey,e.cloudID),this._setUpWatcher(),e}}class HS extends kS{constructor(){super("SYNC_GROUP_ID","/assets/adobe-libraries")}async _create(e,t){return await(await e.getHomeFolder()).createFolder(this.path)}_setUpWatcher(){var e;null===(e=this._asset)||void 0===e||e.on("change",this._callback)}}class jS extends kS{constructor(e,t){super(e,t)}async _create(e,t){return await t.getBookmarks(),e.getAssetWithRepoPath(this.path)}_setUpWatcher(){var e,t;null===(e=this._asset)||void 0===e||e.on("change",this._callback),null===(t=this._asset)||void 0===t||t.appMetadata.on("change",this._callback)}}class US extends jS{constructor(){super("COLLAB_BOOKMARKS_ID","/sync/adobe-libraries/collab-bookmarks.json")}}class BS extends jS{constructor(){super("PUBLIC_BOOKMARKS_ID","/sync/adobe-libraries/bookmarks.json")}}class FS{constructor(e,t){this._core=e,this.__assetPool=t,this._libraryUpdater=ud,this._libraryInterface=new fa(this._core),this._syncGroupLocation=new HS,this._publicBookmarkLocation=new BS,this._collabBookmarkLocation=new US}get _assetPool(){return this.__assetPool}get librariesSource(){const e=new DS(this._assetPool,this._libraryInterface,this._libraryUpdater,this._core);return this._ensureSubscriptionLocationExistence().then((()=>{this._publicBookmarkLocation.on("change",this._onPublicBookmarksChanged.bind(this)),this._collabBookmarkLocation.on("change",this._onCollabBookmarksChanged.bind(this))})).catch((e=>{this._core._environment.error(`Error ensuring subscription location existence: ${e}`)})),new xo(this._assetPool,[e],new NS)}_onPublicBookmarksChanged(){var e;for(const t of this.librariesSource._getLists())(null===(e=t.filter._owner)||void 0===e?void 0:e.has(th.Public))&&t.refresh()}_onCollabBookmarksChanged(){var e;for(const t of this.librariesSource._getLists())(null===(e=t.filter._owner)||void 0===e?void 0:e.has(th.Incoming))&&t.refresh()}async _createLibrary(e){if(!Or(e.name))throw Ge.create(Ue.BAD_REQUEST,"Invalid name provided for the createLibrary operation.");const t=await this._libraryInterface.createLibrary(e),i=this._assetPool.createMutationSession(),s=this._libraryUpdater.updateRemoteItem(i,t);return s._setLibraryLoadState("LOADED"),i.commit(),s}getLibrarySearchSource(e){const t=new xS({query:e}),i=new MS(this._assetPool,this._libraryInterface,this._libraryUpdater);return new xo(this._assetPool,[i],t)}async createPersonalLibrary(e){const t={syncCreate:!0,name:e.name,roles:e.roles};return this._createLibrary(t)}async _getLibraryLocally(e){const t=this._assetPool.getLocalItemById(e);if(t)return await t._waitForLibraryLoad(),t}async _getLibraryRemotely(e,t){const i=await this._libraryInterface.getLibraryData(e,t);if(!i)return;const s=this._assetPool.createMutationSession(),r=this._libraryUpdater.updateRemoteItem(s,i);return s.commit(),r}_isValidURN(e){return/^urn:[a-zA-Z0-9][a-zA-Z0-9-]{0,31}:[a-zA-Z0-9()+,\-.:=@;$_!*'%/?#]+$/.test(e)}async getLibraryByAssetId(e){const t=this._isValidURN(e)?await(async e=>{let t=await this._getLibraryLocally(e);return t||(t=await this._getLibraryRemotely(e)),t})(e):await(async e=>await this._getLibraryRemotely(e))(e);if(!t)throw Ge.create(Ue.NOT_FOUND,`Library not found for the given ID: ${e}`);return t}async _ensureSubscriptionLocationExistence(){const e=await this._core.getAssetContext();return Promise.allSettled([this._syncGroupLocation.ensureExistence(e,this._libraryInterface),this._publicBookmarkLocation.ensureExistence(e,this._libraryInterface),this._collabBookmarkLocation.ensureExistence(e,this._libraryInterface)]).then((e=>{e.forEach((e=>{if("rejected"===e.status)throw e.reason}))}))}getLibraryOrder(e="descending",t="modified"){return new lh(e,t)}getLibraryFilter(e){return new ph(e)}async _getLibrariesModule(){if(!this._ccLibraries)try{const{default:e,CloudDriver:t}=await Promise.resolve().then((function(){return wD})),i=this._core._environment.getValue("ACCESS_TOKEN"),s=this._core._environment.getValue("ENVIRONMENT")===os.Production?"production":"staging",r=new t(this._core,(async()=>({env:s,token:i,options:{}})));await r.init();const n={disableLocalFallthrough:!0,skipConnectingOnInit:!1,disablePreemptiveLibraryLoad:!0};this._ccLibraries=new e(this._core,this._assetPool,r,n)}catch(e){throw this._core._environment.error(`Error loading CCLibraries module: ${e}`),e}return this._ccLibraries}_getLibrariesModule_NoLoad(){return this._ccLibraries}}qe([rt],FS.prototype,"librariesSource",null),qe([Nt],FS.prototype,"createPersonalLibrary",null),qe([Nt],FS.prototype,"getLibraryByAssetId",null);var VS=Object.freeze({__proto__:null,default:FS});class KS{constructor(e,t,i){this._assetPool=e,this._core=t,this._customModelInterface=i}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i;let s;const{order:r,limit:n,filter:o}=e,a={},c=r||Bp.default,l=c.field;a.orderBy="ascending"===c.direction?jp[l]:`-${jp[l]}`,n&&(a.limit=n,a.start||(a.start=0));const d=null==o?void 0:o.listingOptions,u=d?Object.assign({},d):{};u.createDateMin&&(u.createdDateMin=u.createDateMin.getTime(),delete u.createDateMin),u.createDateMax&&(u.createdDateMax=u.createDateMax.getTime(),delete u.createDateMax),u.modifyDateMin&&(u.modifiedDateMin=u.modifyDateMin.getTime(),delete u.modifyDateMin),u.modifyDateMax&&(u.modifiedDateMax=u.modifyDateMax.getTime(),delete u.modifyDateMax),s=t?await this._customModelInterface.searchCustomModelsUsingPageLink(u,t):await this._customModelInterface.searchCustomModels(a,u);const h=this._core._environment.getValue("USS_LIST_UPDATE_LATENCY"),p=Date.now()-h,_=this._assetPool.createLoaderUpdateSession(p),m=sd.updateRemoteItems(_,s.custom_models);let f;_.commit();const g=null===(i=s._links)||void 0===i?void 0:i.next;return g&&(f=e=>this._loadPage(e,g)),{items:m,total:s.total_count,loadNextPage:f,mostRecentValidMutation:p}}}const $S=(e,t)=>e||t?{min:GS(t),max:GS(e)}:void 0,GS=e=>e?e.toISOString():e;class WS{constructor(e,t){this._core=e,this._customModelContext=t,this._ussInterface=this._core.hostAssetContext._ussInterface,this._ussLoaderHelper=new Oc(this._core.hostAssetContext._assetPool,e,this)}supportsFilter(e){return void 0!==e}loadPage(e){return this._ussLoaderHelper.loadPage(e)}async _getUSSResults(e){var t,i,s;const{implicitFilter:{query:r},filter:{listingOptions:n},order:o}=e,a=$S(null==n?void 0:n.createDateMax,null==n?void 0:n.createDateMin),c=$S(null==n?void 0:n.modifyDateMax,null==n?void 0:n.modifyDateMin),l=Object.assign(Object.assign({hints:[{acp_platform_v2:!0,creative_cloud_rendition_v2:!0}],asset_name:r,limit:null!==(i=null===(t=e.loadOptions)||void 0===t?void 0:t.limit)&&void 0!==i?i:100,start_index:null!==(s=null==e?void 0:e.start)&&void 0!==s?s:0,[An.TYPE]:[ts],creative_cloud_asset_type:"dcx"},{sort_order:"ascending"===(d=o).direction?"asc":"desc",sort_orderby:{name:"asset_name",created:"create_date",modified:"modify_date"}[d.field]}),{fetch_fields:{includes:["_embedded","stock_content","link_additional_metadata","app_metadata","firefly#cme$$baseModelName","firefly#cme$$baseModelVersion","firefly#cme$$conceptId","firefly#cme$$trainingMode","firefly#cme$$superclass","firefly#cme$$version","firefly#ffmodel"]},"app_metadata$$cme:publishedState":null==n?void 0:n.publishedState,sync_created_date:a?{range:a}:void 0,sync_updated_date:c?{range:c}:void 0});var d;return this._ussInterface.getQueryResponse(l)}_postProcessPage({implicitFilter:e},t){const{items:i}=t;e._matchingIDsFromSearch=new Set([...e._matchingIDsFromSearch||[],...i.map((e=>e.id))])}}class zS extends rd{constructor(e){const{query:t}=e;super(ze(e,["query"])),this._query=t.trim()}get query(){return this._query}matches(e){return!(this._matchingIDsFromSearch&&!this._matchingIDsFromSearch.has(e.id))&&!(this._query&&!this._matchingIDsFromSearch)&&super.matches(e)}}class qS extends dc{constructor(){super(...arguments),this.isCustomModel=!0,this._inferenceReady=!1,this._publishedState=rs.UNPUBLISHED,this._samplePrompt="",this._displayName="",this._baseModelName="",this._baseModelVersion="",this._conceptId="",this._trainingMode=""}get inferenceReady(){return this._inferenceReady}get publishedState(){return this._publishedState}get samplePrompt(){return this._samplePrompt}get renditionUrl(){return this._renditionUrl}get displayName(){return this._displayName}get baseModelName(){return this._baseModelName}get baseModelVersion(){return this._baseModelVersion}get conceptId(){return this._conceptId}get trainingMode(){return this._trainingMode}}qe([ut],qS.prototype,"inferenceReady",null),qe([ut],qS.prototype,"publishedState",null),qe([ut],qS.prototype,"samplePrompt",null),qe([ut],qS.prototype,"renditionUrl",null),qe([ut],qS.prototype,"displayName",null),qe([ut],qS.prototype,"baseModelName",null),qe([ut],qS.prototype,"baseModelVersion",null),qe([ut],qS.prototype,"conceptId",null),qe([ut],qS.prototype,"trainingMode",null);const YS=new mn({localItemType:qS,remoteIdProperty:"assetId",propertyUpdater:new Sn({_inferenceReady:{name:"inferenceReady",format:"boolean"},_publishedState:"publishedState",_samplePrompt:"samplePrompt",_renditionUrl:"renditionUrl",_displayName:"displayName",_baseModelName:"baseModelName",_baseModelVersion:"baseModelVersion",_conceptId:"conceptId",_trainingMode:"trainingMode",_links:{name:"_links",format:"object"},_name:"assetName",_path:"path",_created:{name:"createDate",format:"date"},_modified:{name:"modifyDate",format:"date"},_createdBy:"createdBy",_version:"version",_etag:"etag",_storageRegion:"region",_size:{name:"size",format:"number"}})});class QS{constructor(e,t,i){this._assetPool=e,this._core=t,this._customModelInterface=i}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i,s;const{order:r,filter:n}=e,{limit:o}=null!==(i=e.loadOptions)&&void 0!==i?i:{},a=n.listingOptions,c=Object.assign({orderBy:Kp[r.field],limit:o},a),l=await this._customModelInterface.getCustomModels(t?Object.assign(Object.assign({},c),{startIndex:t}):c),d=this._assetPool.createLoaderUpdateSession(Date.now()-this._core._environment.getValue("USS_LIST_UPDATE_LATENCY")),u=YS.updateRemoteItems(d,l.items);let h;d.commit();const p=null===(s=l.nextPage)||void 0===s?void 0:s.startIndex;return p&&(h=e=>this._loadPage(e,p)),{items:u,loadNextPage:h,total:l.total}}}const JS={VA6C2:"va6",VA6:"va6",VA7:"va6",JPN3:"jpn3",IRL1:"irl1"};class XS extends lr{_getMelvilleUrl(e){return`https://${this._core._environment.endpoints.MELVILLE_HOST}${e}`}async _getFetchOptionOverrides(e,t){const{href:i,options:s}=await super._getFetchOptionOverrides(e,t);return{href:i,options:Object.assign(Object.assign({},s),{headers:Object.assign(Object.assign({},s.headers),{"X-Product-Location":`SAM.js/${Cs.version}`})})}}async _getUrl(e){const t=await this._core.hostAssetContext.getHomeFolder(),i=JS[t.storageRegion],s=this._core._environment.endpoints.ACP_CS_HOST,r=s.split(".")[0],n=`${r}-${i}`;return`https://${s.replace(r,n)}/fps/${e}`}async getCustomModels(e){const t=e?JSON.parse(JSON.stringify(e)):{},i=It(await this._getUrl("customModels"),t);return this._getResponse(i)}async createTrainingSet(e){if(!e.name)throw Ge.create(Ue.BAD_REQUEST,"Invalid argument: missing required name");if(!e.projectId)throw Ge.create(Ue.BAD_REQUEST,"Invalid argument: missing required projectId. The parent must be a project");if(!e["firefly#ffmodel"].schemaVersion)throw Ge.create(Ue.BAD_REQUEST,"Invalid argument: missing required schemaVersion.");const t={name:e.name,parent_assetId:e.projectId,roles:[{type:"cm_training_set"}],"firefly#ffmodel":e["firefly#ffmodel"],"firefly#cme":Object.assign(Object.assign({},e["firefly#ffmodel"]),{version:e["firefly#ffmodel"].schemaVersion})};return(await this._core.getLibraryContext())._createLibrary(t)}async getTrainingSetById(e){return(await this._core.getLibraryContext())._getLibraryRemotely(e)}async createCustomModel(e){const t=(await this._doPost(this._getMelvilleUrl("/api/v1/custom-models"),{"Content-Type":"application/json"},JSON.stringify(e),[201,200])).headers.get("asset-id");if(!t)throw Ge.create(Ue.NOT_FOUND,"Asset id for newly created custom model not returned by melville");return{id:t}}}class ZS{constructor(e,t,i){this._assetPool=e,this._core=t,this._customModelInterface=i}supportsFilter(e){return void 0!==e}async loadPage(e){return this._loadPage(e)}async _loadPage(e,t){var i,s;const{order:r,implicitFilter:n,filter:o}=e,{limit:a}=null!==(i=e.loadOptions)&&void 0!==i?i:{},c=n,l="listingOptions"in o&&o.listingOptions||[],d=Object.assign(Object.assign({orderBy:Kp[r.field],limit:a},l),{name:c.query}),u=await this._customModelInterface.getCustomModels(t?Object.assign(Object.assign({},d),{startIndex:t}):d),h=this._assetPool.createLoaderUpdateSession(Date.now()-this._core._environment.getValue("USS_LIST_UPDATE_LATENCY")),p=YS.updateRemoteItems(h,u.items);let _;h.commit();const m=null===(s=u.nextPage)||void 0===s?void 0:s.startIndex;return m&&(_=e=>this._loadPage(e,m)),n._matchingIDsFromSearch=new Set([...n._matchingIDsFromSearch||[],...p.map((e=>e.id))]),{items:p,loadNextPage:_,total:u.total}}}class eA extends Nn{constructor(e){super(e)}matches(e){return!!e.isCustomModel&&super.matches(e)}}class tA extends eA{constructor(e){const{query:t}=e;super(ze(e,["query"])),this._query=t.trim()}get query(){return this._query}matches(e){return!(this._matchingIDsFromSearch&&!this._matchingIDsFromSearch.has(e.id))&&!(this._query&&!this._matchingIDsFromSearch)&&super.matches(e)}}class iA{constructor(e,t){this._core=e,this._assetPool=t,this._customModelInterface=new XS(this._core),this._customModelUpdater=YS,this._libraryInterface=new fa(this._core)}getCustomModelOrder(e="descending",t="modified"){return new Gp(e,t)}getCustomModelFilter(e){return new c_(e)}customModelSearchSource(e){const t=new tA({query:e});return new xo(this._assetPool,[new ZS(this._assetPool,this._core,this._customModelInterface)],t)}get customModelSource(){return new xo(this._assetPool,[new QS(this._assetPool,this._core,this._customModelInterface)],new eA)}async createTrainingSet(e){return this._customModelInterface.createTrainingSet(e)}async trainingSetsSource(){const e=await this._core.getLibraryContext(),t=new DS(e._assetPool,this._libraryInterface,ud,this._core);return new xo(e._assetPool,[t],NS.TrainingSets)}async getTrainingSetById(e){return this._customModelInterface.getTrainingSetById(e)}async createCustomModel(e){return this._customModelInterface.createCustomModel(e)}}qe([rt],iA.prototype,"customModelSource",null),qe([rt],iA.prototype,"trainingSetsSource",null);class sA extends ph{constructor(e){super(Object.assign(Object.assign({},e),{owner:[th.All],roles:[rh.TrainingSet]}))}}sA.DEFAULT=new sA;class rA{constructor(e={}){this._customModelFilter=e.customModelFilter||new o_,this._trainingSetFilter=e.trainingSetFilter||new sA}get _owner(){return this._trainingSetFilter?this._trainingSetFilter._owner:void 0}get _roles(){return this._trainingSetFilter?this._trainingSetFilter._roles:void 0}matches(e){return td(e)?!!this._customModelFilter&&this._customModelFilter.matches(e):!!od(e)&&!!this._trainingSetFilter&&this._trainingSetFilter.matches(e)}}class nA{constructor(e,t){this._core=e,this._assetPool=t,this._customModelInterface=new Zl(this._core),this._customModelUpdaterMelville=sd,this._libraryInterface=new fa(this._core)}get legacyCustomModelContext(){return this._LegacyCustomModelContext||(this._LegacyCustomModelContext=new iA(this._core,this._assetPool)),this._LegacyCustomModelContext}customModelSearchSource(e){const t=new zS({query:e});return new xo(this._assetPool,[new WS(this._core,this)],t)}customModelDashboardSource(){const e=new rA({customModelFilter:new rd({generatorOnly:!0}),trainingSetFilter:NS.TrainingSets});return new xo(this._assetPool,[new KS(this._assetPool,this._core,this._customModelInterface),new DS(this._assetPool,this._libraryInterface,ud,this._core)],e)}get customModelSource(){return new xo(this._assetPool,[new KS(this._assetPool,this._core,this._customModelInterface)],new rd)}async createTrainingSet(e){return this._customModelInterface.createTrainingSet(e)}async trainingSetsSource(){const e=await this._core.getLibraryContext(),t=new DS(e._assetPool,this._libraryInterface,ud,this._core);return new xo(e._assetPool,[t],NS.TrainingSets)}async getTrainingSetById(e){return this._customModelInterface.getTrainingSetById(e)}async updateTrainingSet(e,t,i=!1){if(i&&(!t.schemaVersion||!t.trainingMode))throw Ge.create(Ue.BAD_REQUEST,"Schema version and training mode are required fields on the training set metadata. To overwrite all metadata, these must be included in the payload.");const s=await this.getTrainingSetById(e);if(!s)throw Ge.create(Ue.NOT_FOUND,"Training set not found");let r;r=i?{"firefly#cme":Object.assign({},t)}:{"firefly#cme":Object.assign(Object.assign({},s.customModelInfo),t)},await this._libraryInterface.updateMetadata(s.id,r),await this.getTrainingSetById(s.id)}async createCustomModel(e){const t=await this._customModelInterface.createCustomModel(e),i=this._assetPool.createMutationSession(),s=this._customModelUpdaterMelville.updateRemoteItem(i,t);return i.commit(),s}async _fetchAndUpdateCustomModelById(e){const t=await this._customModelInterface.getCustomModelById(e),i=this._assetPool.createMutationSession(),s=this._customModelUpdaterMelville.updateRemoteItem(i,t);return i.commit(),s}async getCustomModelById(e){const t=this._assetPool.getLocalItemById(e);if(t){if(!t.isCustomModel)throw Ge.create(Ue.INVALID_OPERATION,"Attempting to fetch asset type that is not a custom model");return t}return this._fetchAndUpdateCustomModelById(e)}async updateCustomModel(e,t){await this._customModelInterface.updateCustomModel(e,t),await this._fetchAndUpdateCustomModelById(e)}getCustomModelOrder(e="descending",t="modified"){return new Bp(e,t)}getCustomModelFilter(e){return new o_(e)}getTrainingSetOrder(e="descending",t="modified"){return new lh(e,t)}getTrainingSetFilter(e){return new sA(e)}}qe([rt],nA.prototype,"customModelSource",null),qe([Nt],nA.prototype,"createTrainingSet",null),qe([rt],nA.prototype,"trainingSetsSource",null),qe([Nt],nA.prototype,"getTrainingSetById",null),qe([Nt],nA.prototype,"createCustomModel",null),qe([Nt],nA.prototype,"getCustomModelById",null);var oA=Object.freeze({__proto__:null,default:nA});const aA=new mn({localItemType:dc,remoteIdProperty:"asset_id",propertyUpdater:new Sn({"_appMetadata._data":{name:"applicationMetadata",format:"object_subset",set:(e,t)=>{t.appMetadata._setData(e)}},_isFavorite:{name:"isFavorite",format:"boolean"},_assetClass:{get:()=>"composite"},_generationModelDisplayName:"generationModelDisplayName",_name:"repo:name",_size:{name:"repo:size",format:"number"},_type:{name:"type",format:"string",choices:[ra,na]},__links:{name:"_links",format:"object"},_created:{name:"createdDate",format:"date"},_modified:{name:"modifiedDate",format:"date"},_etag:"composite_manifest_etag",_path:"asset_name_path",_repositoryID:"repo:repositoryId",_createdBy:"repo:createdBy",_modifiedBy:"repo:modifiedBy"})});class cA extends Nn{matches(e){return aa(e)}}const lA=Symbol("GenerationHistoryDirectoryRef"),dA=Symbol("GenerationHistoryFavoritesListRef");class uA{constructor(e,t){this._core=e,this._generationHistoryInterface=t}async loadPage(e){return await this._loadPage(e)}async _loadPage(e,t){var i,s,r;let n;if(t)n=await this._generationHistoryInterface.getGenerationHistoryAssetsUsingPageLink(t);else{const{order:t}=e,{limit:r}=null!==(i=e.loadOptions)&&void 0!==i?i:{},{generationGroupId:o,historyAssetType:a}=null!==(s=e.filter)&&void 0!==s?s:{},c={};c.orderBy="ascending"===t.direction?"created_date":"-created_date",o&&(c.generationGroupId=o),a&&(c.generationType=a),r&&(c.limit=r,c.start||(c.start=0));const l=this._generationHistoryInterface.getGenerationHistoryAssets(c,e.resource);e.filter[dA]=this._core.hostAssetContext.favoriteAssetsSource.getList(Np.default,new Fd({mediaTypes:[ra,na]}),{loadAllPages:!0});const[d]=await Promise.all([l,Ro(e.filter[dA]),this.getDefaultGHAFolder().then((t=>e.filter[lA]=t))]);n=d}const o=this._core._environment.getValue("USS_LIST_UPDATE_LATENCY"),a=Date.now()-o,c=this._core._getAssetPool().createLoaderUpdateSession(a),l=aA.updateRemoteItems(c,n.listings);let d;c.commit();const u=null===(r=n._links)||void 0===r?void 0:r.next;return u&&(d=e=>this._loadPage(e,u)),{items:l,total:n.total_count,loadNextPage:d,mostRecentValidMutation:a}}async getDefaultGHAFolder(){const e=await this._core.getGenerationHistoryContext(),{_fireflyGenerationsDirectoryID:t}=e,i=t?await this._core.hostAssetContext.getAssetWithCloudID(t):await this._core.hostAssetContext.getAssetWithRepoPath(`/${sa}`).then((e=>e)).catch((async e=>{if(e.code===Ue.NOT_FOUND){const e=await this._core.hostAssetContext.getHomeFolder(),t=await e._getAssetInterface(),i=await t.createFolder(sa);return this._core.hostAssetContext._createAssetFromMetadata(i)}throw Ge.create(Ue.UNKNOWN,"SAM was unable to resolve or create the firefly-generations directory")}));return e._fireflyGenerationsDirectoryID=i.cloudID,i}}class hA{constructor(e){this._core=e}async loadPage(e){return await this._loadPage(e)}async _loadPage(e){var t;const{generationGroupId:i}=null!==(t=e.filter)&&void 0!==t?t:{};return i?{items:this._core._getAssetPool().toArray().filter((e=>la(e)===i))}:{items:[]}}}class pA{constructor(e,t){this._core=e,this._assetPool=t,this._generationHistoryInterface=new ga(this._core),this._generationHistoryAssetUpdater=aA}get generationHistorySource(){return new xo(this._assetPool,[new uA(this._core,this._generationHistoryInterface),new hA(this._core)],new cA)}async getGenerationHistoryAssetById(e){const t=this._assetPool.getLocalItemById(e);if(t){if(!aa(t))throw Ge.create(Ue.INVALID_OPERATION,"Attempting to fetch asset type that is not a generation history asset");return t}const{isFavorite:i}=await(await this._core._getGQLManager()).getAssetById(e),s=await this._generationHistoryInterface.getGenerationHistoryAssetById(e),r=this._assetPool.createMutationSession(),n=this._generationHistoryAssetUpdater.updateRemoteItem(r,Object.assign(Object.assign({},s),{isFavorite:i}));return r.commit(),n}get generationHistoryUtils(){return ha}getGenerationHistoryAssetFilter(e){return new a_(e)}getGenerationHistoryAssetOrder(e="descending",t="created"){return new Vp(e,t)}}qe([rt],pA.prototype,"generationHistorySource",null),qe([Nt],pA.prototype,"getGenerationHistoryAssetById",null);var _A=Object.freeze({__proto__:null,default:pA});class mA extends lr{_getWorkfrontLinkURL(){return`https://${this._core._environment.endpoints.WORKFRONT_HOST}/esm-connector/api/v1/search`}async getWorkfrontLink(e,t){const i=new URL(`${this._getWorkfrontLinkURL()}?`);return Mr(i,{UID:e}),(await this._doGet(i.toString(),{headers:{"x-gw-ims-org-id":t}})).json()}}var fA=Object.freeze({__proto__:null,default:class{constructor(e){this._core=e,this._workfrontInterface=new mA(this._core)}async getAssetWithRepoPath(e,t){const i=await this._core.getAssetContext(),{data:s}=await i._getRepoDataByPath(e,t),r=i._assetPool.createMutationSession(),n=await this._core._adobeAssetFactory.getRepoMetadataUpdaters([s]),o=this._core._adobeAssetFactory.assetFromRepoMetadata({session:r,repoMetadata:s,updaters:n});return r.commit(),o}async getRepository(e){const t=(await this._core.getAssetContext())._rapi,i=(await t.getWorkfrontIndex(e)).newWorkfrontParentDir._embedded[gt.REPO_METADATA];return{id:i["repo:repositoryId"],path:i["repo:path"],name:i["repo:name"],links:i._links}}async getAssetWithCloudID(e){const t=await this._core.getAssetContext(),i=(await t._getAssetRepoDataWithCloudID(e)).data,s=this._core._getAssetPool().createUpdateSession("getAssetWithCloudID"),r=await this._core._adobeAssetFactory.getRepoMetadataUpdaters([i]),n=this._core._adobeAssetFactory.assetFromRepoMetadata({session:s,repoMetadata:i,updaters:r});return s.commit(),n}async getWorkfrontLink(e,t){var i;let s;if(t)s=t;else{const e=new ar(this._core),t=new xd(this._core);await t.getOrganizations(e),s=null===(i=e.data)||void 0===i?void 0:i.default}return(await this._workfrontInterface.getWorkfrontLink(e,s)).workfrontURL}async setDenyWithDeepOverride(e){return Promise.reject(`Method is unimplemented, assetId: ${e}`)}_getPrivileges(){return[V_.ACK,V_.READ,V_.WRITE,V_.DELETE]}async setDeny(e,t,i){const s=await this._core.getAccessControlContext(),r=await s.getACL(e);await r.addACES([{inheritance:t,principal:i,privileges:this._getPrivileges(),modifier:K_.DENY,relations:[]}])}async removeDeny(e,t,i){const s=await this._core.getAccessControlContext(),r=await s.getACL(e),n=r.aces.find((e=>e.inheritance===t&&ls(e.principal,i)&&e.isDeny&&e.privileges.every((e=>this._getPrivileges().includes(e)))&&0===e.relations.length));if(!n)throw Ge.create(Ue.NOT_FOUND,"ACE matching the requested inheritance and principal was not found");await r.removeACES([n])}async removeDenyWithDeepOverride(e){return Promise.reject(`Method is unimplemented, assetId: ${e}`)}async _getResourceGenerationNumber(e,t){const i=await this._core.getAssetContext();let s=i._assetPool.getLocalItemById(e);s||(s=await i.getAssetWithCloudID(e,!1)),await s._ensureLink(t);const r=await s._getAssetInterface(),n=await r.getResourceGenerationNumber(t);if(!n)throw Ge.create(Ue.BAD_REQUEST,"Resource Generation Number not found, only available in Node environments");const o=Number(n);if(isNaN(o))throw Ge.create(Ue.BAD_REQUEST,"Resource Generation Number is not a number");return o}async getPrimaryRGN(e){return this._getResourceGenerationNumber(e,gt.PRIMARY)}async getRepoMetadataRGN(e){return this._getResourceGenerationNumber(e,gt.REPO_METADATA)}async getAppMetadataRGN(e){return this._getResourceGenerationNumber(e,gt.APP_METADATA)}}});const gA={isCuratedCollectionAsset:!1};class yA{constructor(e){this._core=e,this._minimalAssets=new WeakMap}_isCuratedCollectionAsset(e){const t=this._minimalAssets.get(e);return!!t&&t.isCuratedCollectionAsset}_isMinimalAsset(e){return this._minimalAssets.has(e)}async getMinimalAssetWithAssetId(e,t,i){return this._getMinimalAssetById(e,t,i)}async _getMinimalAssetById(e,t,i,s){const r=await this._core.getAssetContext(),n=r._rapi,o=r._assetPool.getLocalItemById(e);if(o){const i=this._core._environment.getValue("DISABLE_ONS");if(!s&&i&&(s=new Zo(this._core),await n.getRepoMetadataById(e,s,t)),s){const e=r._assetPool.createMutationSession();r._adobeAssetUpdater.updateRemoteItem(e,s.data),e.commit()}return o}s||(s=new Zo(this._core),await n.getRepoMetadataById(e,s,t));const a=s.data;a._links=Object.assign(Object.assign({},a._links),t);const c=r._assetPool.createMutationSession(),l=await this._core._adobeAssetFactory.getRepoMetadataUpdaters([a]),d=this._core._adobeAssetFactory.assetFromRepoMetadata({session:c,repoMetadata:a,updaters:l}),u=Object.assign(Object.assign({},gA),i);return this._minimalAssets.set(d,{isCuratedCollectionAsset:u.isCuratedCollectionAsset}),a&&a["storage:assignee"]&&d._storageAssignee_NoLazyLoad.id===a["storage:assignee"].id&&tn.updatedByItemUpdater(d,Fn),c.commit(),d._setResources({repoMetadataResource:s,effectivePermissionsResource:void 0,appMetadataResource:void 0,perUserMetadataResource:void 0}),d}async getMinimalAssetWithRepoPath(e,t,i,s){return this._getMinimalAssetWithRepoPathImpl(e,t,i,s)}async _getMinimalAssetWithRepoPathImpl(e,t,i,s){const r=(await this._core.getAssetContext())._rapi;let n;const o=new Zo(this._core),a=await r.getRepoMetadataByPath(t,e,o,i);return n=await this._getMinimalAssetById(a["repo:assetId"],i,s,o),n}}qe([Nt,Pt,Ye(0,tt)],yA.prototype,"getMinimalAssetWithAssetId",null),qe([Pt,Ye(0,tt)],yA.prototype,"_getMinimalAssetById",null),qe([Nt,Pt],yA.prototype,"getMinimalAssetWithRepoPath",null),qe([Pt],yA.prototype,"_getMinimalAssetWithRepoPathImpl",null);var vA=Object.freeze({__proto__:null,DefaultMinimalAssetLoadOptions:gA,default:yA});class OA{constructor(e,t,i,s=[],r){this._core=e,this._assetId=t,this._etag=i,this._aces=s,this._assetInterface=r}get aces(){return[...this._aces]}set aces(e){this._aces=[...e]}get assetId(){return this._assetId}get etag(){return this._etag}set etag(e){this._etag=e}get isEmpty(){return 0===this._aces.length}async _forceRefreshACL(){const e=await this._core.getAccessControlContext();await e.getACL(this.assetId,!0)}async _handleConflict(e){throw We(e)&&e.code===Ue.CONFLICT&&await this._forceRefreshACL(),e}hasDirtyACES(){return this._aces.some((e=>e._isDirty))}async removeACES(e){if(this.hasDirtyACES())throw Ge.create(Ue.BAD_REQUEST,"Cant delete ACEs with pending changes, these will be overwritten");[...e].sort(((e,t)=>e.id<t.id?0:-1));try{await this._assetInterface.deleteAccessControlEntries(e,this._etag)}catch(e){await this._handleConflict(e)}return await this._forceRefreshACL(),this._aces}async addACES(e){if(this.hasDirtyACES())throw Ge.create(Ue.BAD_REQUEST,"Cant add ACES with pending changes, these will be overwritten");return await this._assetInterface.addAccessControlEntries(e,this._etag),await this._forceRefreshACL(),this._aces}async updateACES(){if(!this.hasDirtyACES())throw Ge.create(Ue.BAD_REQUEST,"No changes to commit");const e=this._aces.filter((e=>e._isDirty));try{await this._assetInterface.updateAccessControlList(e,this._etag)}catch(e){await this._handleConflict(e)}await this._forceRefreshACL()}}class bA{constructor(e,t,i,s,r,n,o){this._core=e,this.id=t,this._privileges=i,this._modifier=s,this._inheritance=r,this._relations=n,this._principal=o,this.__isDirty=!1,this.__isDeleted=!1}_checkIfDeleted(){if(this.__isDeleted)throw Ge.create(Ue.BAD_REQUEST,"Cannot update a deleted ACE")}get _isDirty(){return this.__isDirty}set _isDirty(e){this.__isDirty=e}set _isDeleted(e){this.__isDeleted=e}get _isDeleted(){return this.__isDeleted}get principal(){return this._principal}set principal(e){this._checkIfDeleted(),this._principal=e,this._isDirty=!0}get privileges(){return this._privileges}set privileges(e){this._checkIfDeleted(),this._privileges=e,this._isDirty=!0}get modifier(){return this._modifier}set modifier(e){this._checkIfDeleted(),this._modifier=e,this._isDirty=!0}get inheritance(){return this._inheritance}set inheritance(e){this._checkIfDeleted(),this._inheritance=e,this._isDirty=!0}get relations(){return this._relations}set relations(e){this._checkIfDeleted(),this._relations=e,this._isDirty=!0}get isDeny(){return this._modifier===K_.DENY}get isGrant(){return this._modifier===K_.GRANT}get isDeepInheritance(){return this._inheritance===$_.DEEP}get isSelfInheritance(){return this._inheritance===$_.SELF}get isDeepOverrideInheritance(){return this._inheritance===$_.DEEP_OVERRIDE}get isUserPrincipal(){return"string"!=typeof this._principal&&this._principal["@type"]===G_.PRINCIPAL_TYPE_IMS_USER}get isGroupPrincipal(){return"string"!=typeof this._principal&&this._principal["@type"]===G_.PRINCIPAL_TYPE_IMS_GROUP}}class EA{constructor(e){this._core=e,this._aclCache=new Map}_getCachedACL(e){const t=this._aclCache.get(e);if(t){const e=t.deref();if(e)return e}}async _getAssetInterface(e){const t=this._core._getAssetPool().getLocalItemById(e);let i;if(t)i=await t._getAssetInterface();else{const t=await this._core.getAssetContext(),s=await t._getAssetRepoDataWithCloudID(e);i=new Yr(t._rapi,e,s.data._links,s.data["repo:etag"])}return i}async getACL(e,t=!1){const i=this._getCachedACL(e);if(i&&!t)return i;const s=await this._getAssetInterface(e),r=await s.getAccessControlList(),n=(e,t)=>new bA(this._core,t,e["repo:privileges"],e["repo:modifier"],e["repo:inheritance"],e["repo:relations"],e["repo:principal"]);if(i&&t&&(i.aces.forEach((e=>{e._isDeleted=!0})),i.aces=[]),i)return i.aces=r["repo:acl"].map(n),i.etag=r.etag,i;const o=new OA(this._core,e,r.etag,r["repo:acl"].map(n),s);return this._aclCache.set(e,new WeakRef(o)),o}}qe([st,Ye(0,tt)],EA.prototype,"_getAssetInterface",null);var IA=Object.freeze({__proto__:null,default:EA});const TA=["repo:repositoryId","repo:name","repo:etag","stRef:relativePath","stRef:documentID"];function SA(e){const t=e._permissions;return t===Ki.Ack||t===Ki.None}const AA=["application/illustrator"];class PA extends nr{constructor(e,t){super(e._core),this._assetLinkList=e,this._data=t,this._resolutionErrors=[],this._onChange=()=>{var e,t;const i=null===(e=this._resolvedAssets)||void 0===e?void 0:e.filter(SA);(null==i?void 0:i.length)&&(this._resolutionErrors=i.map((e=>Ge.create(e._permissions===Ki.Ack?Ue.ACCESS_DENIED:Ue.NOT_FOUND,"lost access"))),this._resolvedAssets=null===(t=this._resolvedAssets)||void 0===t?void 0:t.filter((e=>!i.includes(e)))),this.emit("change"),this._assetLinkList._onChange()}}async _setLinkData(e,t){return this._data=e,t&&(this._resolvedAssets=[t]),this._onChange(),this.adobeAsset&&this.assetID===this.adobeAsset.cloudID||await this._resolveWithRetry(),this}async _setLinkedAsset(e){const t=this._getLinkDataForAsset(e);return this._setLinkData(t,e)}_getLinkDataForAsset(e){var t,i;const s={"repo:assetId":e.cloudID,"repo:repositoryId":e.repositoryID,"repo:etag":e.etag,"dc:format":e.mediaType,"repo:name":e.name,"stRef:documentID":null===(t=e.embeddedMetadata.data)||void 0===t?void 0:t["xmpMM:DocumentID"],"stRef:instanceID":null===(i=e.embeddedMetadata.data)||void 0===i?void 0:i["xmpMM:InstanceID"],"stRef:manager":"Adobe Cloud"},r=this._assetLinkList.containerAsset;return r&&r.repositoryID===e.repositoryID&&(s["stRef:relativePath"]=Us.relative(Us.dirname(r.repoPath),e.repoPath)),s}_serializeLinkData(e){return JSON.stringify(e,Object.keys(e).sort())}_resolveWithRetry(){return this._resolve()}async _resolve(){var e;const t=[],i=[],s=e=>{if(![Ue.NOT_FOUND,Ue.ACCESS_DENIED].includes(e.code))throw e;i.push(e)};try{const e=await this._context.getAssetWithCloudID(this.assetID);e.embeddedMetadata.isLoaded||await e.embeddedMetadata.load(),t.push(e)}catch(e){this._core._environment.error(`Failed to resolve link by id (${this.assetID}): ${e}`),s(e)}const r=this._assetLinkList.containerAsset;if(this.relativePath&&r&&r.repositoryID===this.repositoryID){const i=Us.join(Us.dirname(r.repoPath),this.relativePath);try{const s=await this._context.getAssetWithRepoPath(i,this.repositoryID);s.embeddedMetadata.isLoaded||await s.embeddedMetadata.load(),t[0]&&t[0].cloudID===s.cloudID||((null===(e=t[0])||void 0===e?void 0:e.isDiscarded)?t.unshift(s):t.push(s))}catch(e){this._core._environment.error(`Failed to resolve link by path: ${this.repositoryID}, ${i}`),s(e)}}this._resolvedAssets&&this._resolvedAssets.forEach((e=>e.off("change",this._onChange))),t.forEach((e=>e.on("change",this._onChange))),this._resolvedAssets=t,this._resolutionErrors=i,this._onChange()}get _context(){return this._assetLinkList._manager._context}get adobeAsset(){var e;return null===(e=this._resolvedAssets)||void 0===e?void 0:e[0]}get alternativeAdobeAsset(){var e;return null===(e=this._resolvedAssets)||void 0===e?void 0:e[1]}get linkStatus(){if(!this._resolvedAssets)return"UpToDate";if(!this.adobeAsset)return this._resolutionErrors.some((e=>e.code===Ue.ACCESS_DENIED))?"Restricted":"Broken";if(this.adobeAsset.isDiscarded)return"Discarded";const e=this.adobeAsset.embeddedMetadata.data["xmpMM:InstanceID"]||"",t=!e&&!this.instanceID||AA.includes(this.type),i=e!==this.instanceID||t&&this.etag!==this.adobeAsset.etag;if(this.alternativeAdobeAsset||i)return"OutOfDate";const s=this._getLinkDataForAsset(this.adobeAsset),r=TA.some((e=>s[e]!==this._data[e]));return r?"MetadataOutOfDate":"UpToDate"}get fragmentIdentifier(){return this._data["stRef:fromPart"]||""}get version(){return this._data["repo:version"]||""}get assetID(){return this._data["repo:assetId"]}get repositoryID(){return this._data["repo:repositoryId"]||""}get name(){return this._data["repo:name"]||""}get type(){return this._data["dc:format"]||""}get etag(){return this._data["repo:etag"]||""}get relativePath(){return this._data["stRef:relativePath"]||""}get documentID(){return this._data["stRef:documentID"]||""}get instanceID(){return this._data["stRef:instanceID"]||""}getAssetLinkRef(){return Object.assign({},this._data)}getAssetLinkRefString(){return this._serializeLinkData(this._data)}getNewAssetLinkRef(e){return this._getLinkDataForAsset(e)}getNewAssetLinkRefString(e){return this._serializeLinkData(this.getNewAssetLinkRef(e))}async updateWithAsset(e){return await this._setLinkedAsset(e),this.getAssetLinkRefString()}async updateWithLinkRef(e){return await this._setLinkData(e),e}async updateWithLinkRefString(e){return await this._setLinkData(JSON.parse(e)),e}acceptMetadataChanges(){if(this.adobeAsset&&"MetadataOutOfDate"===this.linkStatus){const e=this._getLinkDataForAsset(this.adobeAsset);this._data=Object.assign(Object.assign({},this._data),e),this._onChange()}return this.getAssetLinkRefString()}}qe([Pt],PA.prototype,"_setLinkData",null),qe([At],PA.prototype,"_resolveWithRetry",null),qe([ut],PA.prototype,"adobeAsset",null),qe([ut],PA.prototype,"alternativeAdobeAsset",null),qe([ut],PA.prototype,"linkStatus",null),qe([ut],PA.prototype,"fragmentIdentifier",null),qe([ut],PA.prototype,"version",null),qe([ut],PA.prototype,"assetID",null),qe([ut],PA.prototype,"repositoryID",null),qe([ut],PA.prototype,"name",null),qe([ut],PA.prototype,"type",null),qe([ut],PA.prototype,"etag",null),qe([ut],PA.prototype,"relativePath",null),qe([ut],PA.prototype,"documentID",null),qe([ut],PA.prototype,"instanceID",null),qe([ut],PA.prototype,"getAssetLinkRef",null),qe([ut],PA.prototype,"getAssetLinkRefString",null),qe([ut],PA.prototype,"getNewAssetLinkRef",null),qe([ut],PA.prototype,"getNewAssetLinkRefString",null);class wA extends or{constructor(e,t){super(e._core),this._manager=e,this._containerAsset=t,this._links=new Set,this._directlyMonitoredAssetIDs=new Map,this._onChange=()=>{this.emit("change")},this._refreshLinks=(e=new Set(this.monitoredAssetIDs))=>{this.forEach((t=>{!t.adobeAsset&&e.has(t.assetID)&&t._resolveWithRetry()}))},this._refreshLinksForChangedAssets=e=>{this._refreshLinks(e);const t=this._monitoredAssetIDs,i=new Set;e.forEach((e=>{t.has(e)&&i.add(e);const s=this._directlyMonitoredAssetIDs.get(e.toLowerCase());s&&i.add(s)})),this.emit("notified",[...i])}}addAssetID(e){this._directlyMonitoredAssetIDs.set(e.toLowerCase(),e),this._onChange()}removeAssetID(e){this._directlyMonitoredAssetIDs.delete(e.toLowerCase()),this._onChange()}add(e){return Promise.all(e.map((async e=>{const t="string"==typeof e?JSON.parse(e):e,i=new PA(this,t);return this._links.add(i),this._onChange(),await i._resolveWithRetry(),i})))}async create(e,t,i){const s="string"==typeof e?e:e.cloudID,r=new PA(this,{"repo:assetId":s,"stRef:fromPart":t,"repo:version":i,"stRef:manager":"Adobe Cloud"});return this._links.add(r),this._onChange(),await r._resolve(),r.adobeAsset&&r._setLinkedAsset(r.adobeAsset),r}remove(e){this._links.delete(e),this._onChange()}clear(){this._links.clear(),this._onChange()}get count(){return this._links.size}get links(){return[...this._links]}get _monitoredAssetIDs(){const e=new Set(this._directlyMonitoredAssetIDs.values());return this.forEach((t=>{e.add(t.assetID),t.alternativeAdobeAsset&&e.add(t.alternativeAdobeAsset.cloudID)})),e}get monitoredAssetIDs(){return[...this._monitoredAssetIDs]}forEach(e){this._links.forEach(e)}get containerAsset(){return this._containerAsset}activate(e=0){Jr("AssetLinkList.activate",`AssetLinkList.activate(${e}) is deprecated - lists are always monitored for notifications.This method will be removed on or after 2024-10-01.`)}deactivate(){Jr("AssetLinkList.deactivate","AssetLinkList.deactivate() is deprecated - lists are always monitored for notifications. This method will be removed on or after 2024-10-01.")}get isActive(){return Jr("AssetLinkList.isActive","AssetLinkList.isActive is deprecated - lists are always monitored for notifications. This method will be removed on or after 2024-10-01."),!0}async updateContainerAsset(e){this._containerAsset=e,this._onChange(),await Promise.all(Array.from(this._links).map((e=>e._resolveWithRetry())))}clone(e){e.links.forEach((e=>this._links.add(e)))}}qe([ut],wA.prototype,"count",null),qe([ut],wA.prototype,"links",null),qe([ut],wA.prototype,"monitoredAssetIDs",null),qe([ut],wA.prototype,"forEach",null),qe([ut],wA.prototype,"containerAsset",null),qe([ut],wA.prototype,"isActive",null);class CA extends nr{constructor(e){super(e._core),this._context=e,this._lists=new Set,this._onListChange=()=>{this._context._updateONSSubscriptions()}}createList(e){const t=new wA(this,e);return t.on("change",this._onListChange),this._lists.add(t),this.emit("change"),t}removeList(e){this._lists.delete(e),e.off("change",this._onListChange),this.emit("change")}get lists(){return[...this._lists]}}qe([ut],CA.prototype,"lists",null);var RA=Object.freeze({__proto__:null,default:CA});const LA=Yb`query SharedWithYou(
  $first: Int!
  $after: String
  $filter: AssetListFilter
  $orderBy: SharedWithYouOrderByInput) {
  sharedWithYou {
    assetListId
    assetListConnection(
      first: $first
      after: $after
      filter: $filter
      orderBy: $orderBy) {
      edges {
        cursor
        node {
          ... on Asset {
            sharingInfo {
              sharedWithYou {
                shareDate
                sharedBy {
                  id
                }
              }
            }
            repo_assetClass
            labels {
              lastAccessDate
            }
            #defer
            repository {
              repo_repositoryId
            }
            dc_format
            storage_deviceCreateDate
            storage_deviceModifyDate
            primary_etag
            effectivePermissions {
              aclPolicy
              annotations
              applicationMetadata
              default
              directory
              primary
            }
            primaryLink {
              href
            }
            blockUploadLink {
              href
            }
            repo_ancestors
            repo_createDate
            repo_createdBy {
              id
            }
            repo_path
            repo_representations {
              composite
              directory
              file
            }
            repo_modifyDate
            repo_name
            repo_state
            repo_assetId
            storage_region
            storage_assignee {
              id
              type
            }
            ... @defer {
              deferredRepoAssetId: repo_assetId
              appMetadata {
                valueOf(key: "")
              }
            }
          }
          ... on CompositeImpl {
            repo_version
            repo_size
            blockDownloadLink {
              href
            }
            renditionLink {
              href
            }
          }
          ... on FileImpl {
            repo_version
            repo_size
            blockDownloadLink {
              href
            }
            renditionLink {
              href
            }
          }
        }
      }
      pageInfo {
        endCursor
        hasNextPage
      }
    }
  }
}
`;var NA=Object.freeze({__proto__:null,SHARED_WITH_YOU_ASSETS:LA});const DA=Yb` query PLSRecents($first: Int!, $after: String, $filter: AssetListFilter) {
  recents {
    assetListId
    assetListConnection(first: $first, after: $after, filter: $filter) {
      pageInfo {
        endCursor
        hasNextPage
      }
      edges {
        cursor
        node {
          ... on Asset {
            dc_format
            repo_assetId
            repo_name
            repo_path
            primary_etag
            repo_representations {
              composite
              directory
              file
            }
            repo_state
            repo_ancestors
            repo_createDate
            repo_modifyDate
            repo_modifiedBy
            repo_createdBy {
              id
            }
            storage_region
            storage_deviceCreateDate
            storage_deviceModifyDate
            storage_assignee {
              id
              type
            }
            repo_assetClass
            repository {
              repo_repositoryId
            }
            sharingInfo {
              sharedWithYou {
                shareDate
                sharedBy {
                  id
                }
              }
            }
            effectivePermissions {
              aclPolicy
              annotations
              applicationMetadata
              default
              directory
              primary
            }
            primaryLink {
              href
            }
            blockUploadLink {
              href
            }
            labels {
              lastAccessDate
            }
            ... @defer {
              deferredRepoAssetId: repo_assetId
              appMetadata {
              valueOf(key: "")
              }
            }
            ... on CompositeImpl {
              repo_version
              repo_size
              isComposite
              blockDownloadLink {
                href
              }
              renditionLink {
                href
              }
            }
            ... on FileImpl {
              repo_version
              repo_size
              isFile
              blockDownloadLink {
                href
              }
              renditionLink {
                href
              }
            }
          }
        }
      }
    }
  }
}
`;var MA=Object.freeze({__proto__:null,recents:DA});const xA={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomsvc+xml":["atomsvc"],"application/ccxml+xml":["ccxml"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/font-tdpfr":["pfr"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/hyperstudio":["stk"],"application/illustrator":["ai"],"application/illustrator-text":["ai"],"application/illustrator.template":["ait"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/java-archive":["jar"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js"],"application/json":["json"],"application/jsonml+json":["jsonml"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/photoshop":["psd"],"application/photoshop.large":["psb"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/prs.cww":["cww"],"application/pskc+xml":["pskcxml"],"application/rdf+xml":["rdf"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.ae.graphic+zip":["aegraphic","mogrt"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.animate-xfl+zip":["fla","xfl"],"application/vnd.adobe.animate-oam+zip":["oam"],"application/vnd.adobe.animate-sym+zip":["sym"],"application/vnd.adobe.animate-swf+zip":["swa"],"application/vnd.adobe.characterstyle+json":["style"],"application/vnd.adobe.characterstyle+snippet":["idms"],"application/vnd.adobe.charts+zip":["zip"],"application/vnd.adobe.ch.puppet+zip":["puppet"],"application/vnd.adobe.color+json":["ase"],"application/vnd.adobe.colortheme+json":["ase"],"application/vnd.adobe.cube+txt":["cube"],"application/vnd.adobe.element.agc+json":["agc"],"application/vnd.adobe.exr.light+zip":["exr"],"application/vnd.adobe.fbx.3d+zip":["fbx"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.hz.express+dcxucf":["dcxucf"],"application/vnd.adobe.ibl.light+zip":["ibl","zip"],"application/vnd.adobe.illustrator.template":["ait"],"application/vnd.adobe.indesign-idms":["idms"],"application/vnd.adobe.indesign-idms-text":["idms"],"application/vnd.adobe.indesign.template":["indt"],"application/vnd.adobe.layerstyle":["asl"],"application/vnd.adobe.look+xml":["look"],"application/vnd.adobe.graphic+json":["json"],"application/vnd.adobe.mdl.material+zip":["mdl","zip"],"application/vnd.adobe.muse-collection":["muse"],"application/vnd.adobe.obj.3d+zip":["obj","zip"],"application/vnd.adobe.paragraphstyle+json":["style"],"application/vnd.adobe.paragraphstyle+snippet":["idms"],"application/vnd.adobe.photoshop.template":["psdt"],"application/vnd.adobe.ppro.graphic+zip":["prgraphic","mogrt"],"application/vnd.adobe.ribbon.brush+zip":["brush"],"application/vnd.adobe.sbsar+zip":["sbsar"],"application/vnd.adobe.scatter.brush+zip":["brush"],"application/vnd.adobe.vector.brush+zip":["brush"],"application/vnd.adobe.text+json":["text-json"],"application/vnd.adobe.theo.document+dcxucf":["dcxucf"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["xfdf"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["mpp","mpt"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/voicexml+xml":["vxml"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["dmg"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bittorrent":["torrent"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-otf":["otf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-ttf":["ttf","ttc"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/font-woff":["woff"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-install-instructions":["install"],"application/x-iso9660-image":["iso"],"application/x-java-jnlp-file":["jnlp"],"application/x-latex":["latex"],"application/x-lzh-compressed":["lzh","lha"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdownload":["exe","dll","com","bat","msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["wmf","wmz","emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-nzb":["nzb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["rar"],"application/x-research-info-systems":["ris"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["obj"],"application/x-ustar":["ustar"],"application/x-wais-source":["src"],"application/x-x509-ca-cert":["der","crt"],"application/x-xfig":["fig"],"application/x-xliff+xml":["xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"application/xaml+xml":["xaml"],"application/xcap-diff+xml":["xdf"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xml":["xml","xsl"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/adpcm":["adp"],"audio/aif":["aif"],"audio/basic":["au","snd"],"audio/m4a":["m4a"],"audio/midi":["mid","midi","kar","rmi"],"audio/mp4":["mp4a"],"audio/mpeg":["mpga","mp2","mp2a","m2a"],"audio/mpeg3":["mp3","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/wav":["wav"],"audio/webm":["weba"],"audio/x-aac":["aac"],"audio/x-aiff":["aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-wav":["wav"],"audio/xm":["xm"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dng":["dng"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heif":["heif"],"image/ief":["ief"],"image/jpeg":["jpeg","jpg","jpe"],"image/jpg":["jpeg","jpg"],"image/ktx":["ktx"],"image/png":["png"],"image/prs.btif":["btif"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/tiff":["tiff","tif"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.adobe.photoshop.template":["psdt"],"image/vnd.adobe.pattern+png":["png"],"image/vnd.adobe.shape+svg":["shape"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.dvb.subtitle":["sub"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/webp":["webp"],"image/x-3ds":["3ds"],"image/x-adobe-dng":["dng"],"image/x-adobe-photoshop-brush":["abr"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["ico"],"image/x-mrsid-image":["sid"],"image/x-pcx":["pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/rfc822":["eml","mime"],"model/gltf-binary":["glb"],"model/gltf+json":["gltf"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/vnd.usdz+zip":["usdz"],"model/vnd.adobe.dn+dcx":["dn"],"model/vnd.adobe.dn+dcxucf":["dn"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["mts"],"model/vnd.vtu":["vtu"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["x3db","x3dbz"],"model/x3d+vrml":["x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"text/cache-manifest":["appcache"],"text/calendar":["ics","ifb"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in"],"text/prs.lines.tag":["dsc"],"text/richtext":["rtx"],"text/sgml":["sgml","sgm"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-fortran":["f","for","f77","f90"],"text/x-java-source":["java"],"text/x-opml":["opml"],"text/x-pascal":["p","pas"],"text/x-nfo":["nfo"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"video/3gpp":["3gp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/jpeg":["jpgv"],"video/jpm":["jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["mov","qt"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx","wmv"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-quicktime":["mov"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"],"3d/vnd.adobe.dn+dcxucf":["dn"]},kA=new Set(["application/x-indesign","application/postscript","application/illustrator","application/pdf","application/vnd.adobe.psremix","application/vnd.adobe.pstouch","application/vnd.adobe.ideas","application/vnd.adobe.ase","image/jpeg","image/jpg","image/pjpeg","image/tiff","image/gif","image/bmp","image/x-ms-bmp","image/svg+xml","image/png","image/x-png","image/jp2","image/psd","image/vnd.adobe.photoshop","image/heic","application/photoshop","application/x-photoshop","image/raw","image/dng","image/x-adobe-dng","video/mp4","video/mpeg","video/x-ms-wmv","video/3gpp","video/3gpp2","video/quicktime","video/x-msvideo","video/x-flv","video/x-ms-asf","video/x-m4v","video/mp2t","application/mxf","application/x-shockwave-flash","application/vnd.adobe.brushes.brush+ucf","application/vnd.adobe.collage","application/vnd.adobe.proto","application/msword","application/msexcel","application/mspowerpoint","application/vnd.ms-publisher","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","text/rtf","application/illustrator.template","application/vnd.adobe.indesign.template","application/vnd.adobe.photoshop.template","image/vnd.adobe.photoshop.template"]),HA={};function jA(e){return e?xA[e.toLowerCase()]||function(e){const t=e.match(/application\/x-adobe-libraries-(.+)/);return t?[t[1]]:[]}(e.toLowerCase()):[]}function UA(e){return e?HA[e.toLowerCase()]||function(e){return[`application/x-adobe-libraries-${e}`]}(e.toLowerCase()):[]}function BA(e){return kA.has(e)}Object.keys(xA).forEach((e=>{xA[e].forEach((t=>{HA[t]=HA[t]||[],HA[t].push(e)}))}));const FA="@PLACEHOLDER",VA=[1,1,2,3,5,8,13,21,34,55],KA=10485760,$A=[45623,45625],GA=5242880,WA={photoshop:"TOOLKIT_NAME_PHOTOSHOP",photoshop_swatches:"TOOLKIT_NAME_PHOTOSHOP_SWATCHES",photoshop_brushes:"TOOLKIT_NAME_PHOTOSHOP_BRUSHES",photoshop_gradients:"TOOLKIT_NAME_PHOTOSHOP_GRADIENTS",photoshop_patterns:"TOOLKIT_NAME_PHOTOSHOP_PATTERNS",photoshop_styles:"TOOLKIT_NAME_PHOTOSHOP_STYLES",photoshop_shapes:"TOOLKIT_NAME_PHOTOSHOP_SHAPES",photoshop_swatches_prerelease:"TOOLKIT_NAME_PHOTOSHOP_SWATCHES_PR",photoshop_brushes_prerelease:"TOOLKIT_NAME_PHOTOSHOP_BRUSHES_PR",photoshop_gradients_prerelease:"TOOLKIT_NAME_PHOTOSHOP_GRADIENTS_PR",photoshop_patterns_prerelease:"TOOLKIT_NAME_PHOTOSHOP_PATTERNS_PR",photoshop_styles_prerelease:"TOOLKIT_NAME_PHOTOSHOP_STYLES_PR",photoshop_shapes_prerelease:"TOOLKIT_NAME_PHOTOSHOP_SHAPES_PR"},zA={IMAGE_ELEMENT_TYPE:"application/vnd.adobe.element.image+dcx",COLOR_ELEMENT_TYPE:"application/vnd.adobe.element.color+dcx",COLOR_THEME_ELEMENT_TYPE:"application/vnd.adobe.element.colortheme+dcx",BRUSH_ELEMENT_TYPE:"application/vnd.adobe.element.brush+dcx",CHARACTER_STYLE_ELEMENT_TYPE:"application/vnd.adobe.element.characterstyle+dcx",PARAGRAPH_STYLE_ELEMENT_TYPE:"application/vnd.adobe.element.paragraphstyle+dcx",FONT_ELEMENT_TYPE:"application/vnd.adobe.element.font+dcx",LAYER_STYLE_ELEMENT_TYPE:"application/vnd.adobe.element.layerstyle+dcx",LOOK_ELEMENT_TYPE:"application/vnd.adobe.element.look+dcx",CAPSULE_ELEMENT_TYPE:"application/vnd.adobe.element.graphic+dcx",VIDEO_ELEMENT_TYPE:"application/vnd.adobe.element.video+dcx",THREE_D_ELEMENT_TYPE:"application/vnd.adobe.element.3d+dcx",LIGHT_ELEMENT_TYPE:"application/vnd.adobe.element.light+dcx",MATERIAL_ELEMENT_TYPE:"application/vnd.adobe.element.material+dcx",PATTERN_ELEMENT_TYPE:"application/vnd.adobe.element.pattern+dcx",TEMPLATE_ELEMENT_TYPE:"application/vnd.adobe.element.template+dcx",TEXT_ELEMENT_TYPE:"application/vnd.adobe.element.text+dcx",ANIMATION_ELEMENT_TYPE:"application/vnd.adobe.element.animation+dcx",LIBRARY_TYPE:"application/vnd.adobe.library+dcx",GRADIENT_ELEMENT_TYPE:"application/vnd.adobe.element.gradient+dcx",COMPONENT_ELEMENT_TYPE:"application/vnd.adobe.element.component+dcx",AUDIO_ELEMENT_TYPE:"application/vnd.adobe.element.audio+dcx"},qA={MAX_ELEMENTS:1e4,MAX_REMOVED_ELEMENTS:2e3,MAX_COMPONENT_SIZE:1073741824,DL_NAMESPACE:"library",VALID_RELATIONS:["primary","rendition","alternate"],DEFAULT_GROUP_CLASSIFIER:"$default",ELEMENT_ACTIONS:["edit","openStock","editInSource"],LIBRARY_ACTIONS:["editInSource"],DOCUMENT_LIBRARY_ACTION_PRODUCT_MAP:{types:{"application/vnd.adobe.xd.cloudproject+dcx":["SPKR"]},products:{}},ELEMENT_ACTION_PRODUCT_MAP:{types:{"application/vnd.adobe.element.image+dcx":{"application/illustrator":["ILST_EDIT","ILST_PLACE","IDSN_PLACE"],"image/svg+xml":["ILST_EDIT","ILST_PLACE"],"application/vnd.adobe.indesign-idms":["IDSN_EDIT","IDSN_PLACE"],"image/vnd.adobe.photoshop":["PHXS_EDIT","PHXS_PLACE","IDSN_PLACE"],"application/photoshop":["PHXS_EDIT","PHXS_PLACE","IDSN_PLACE"],"application/photoshop.large":["PHXS_EDIT","PHXS_PLACE","IDSN_PLACE"],"image/png":["PHXS_EDIT","PHXS_PLACE","ILST_PLACE","IDSN_PLACE","PPRO_PLACE","AEFT_PLACE"],"image/jpeg":["PHXS_EDIT","PHXS_PLACE","ILST_PLACE","IDSN_PLACE","PPRO_PLACE","AEFT_PLACE"],"image/jpg":["PHXS_EDIT","PHXS_PLACE","IDSN_PLACE","ILST_PLACE","PPRO_PLACE","AEFT_PLACE"],"image/gif":["PHXS_EDIT","PHXS_PLACE","ILST_PLACE","IDSN_PLACE","PPRO_PLACE","AEFT_PLACE"],"image/bmp":["PHXS_EDIT","PHXS_PLACE","ILST_PLACE","IDSN_PLACE","PPRO_PLACE","AEFT_PLACE"],"image/x-portable-bitmap":["PHXS_EDIT","PHXS_PLACE"],"image/x-pict":["PHXS_EDIT","PHXS_PLACE"],"image/x-pcx":["PHXS_EDIT","PHXS_PLACE"],"image/x-portable-graymap":["PHXS_EDIT","PHXS_PLACE"],"image/x-portable-anymap":["PHXS_EDIT","PHXS_PLACE"],"image/x-portable-pixmap":["PHXS_EDIT","PHXS_PLACE"],"image/x-tga":["PHXS_EDIT","PHXS_PLACE"],"image/tiff":["PHXS_EDIT","PHXS_PLACE"],"image/vnd.wap.wbmp":["PHXS_EDIT","PHXS_PLACE"]},"application/vnd.adobe.element.text+dcx":{"application/illustrator-text":["ILST_EDIT_TEXT"],"application/vnd.adobe.indesign-idms-text":["IDSN_EDIT_TEXT"]},"application/vnd.adobe.element.template+dcx":{"image/vnd.adobe.photoshop.template":["PHXS_PLACE"],"application/illustrator.template":["ILST_PLACE"],"application/vnd.adobe.indesign.template":["IDSN_PLACE"]},"application/vnd.adobe.element.3d+dcx":{"application/vnd.adobe.obj.3d+zip":["ESHR_PLACE"]},"application/vnd.adobe.element.material+dcx":{"application/vnd.adobe.mdl.material+zip":["ESHR_PLACE"]},"application/vnd.adobe.element.light+dcx":{"application/vnd.adobe.ibl.light+zip":["ESHR_PLACE"]},"application/vnd.adobe.element.animation+dcx":{"application/vnd.adobe.animate-xfl+zip":["FLPR_EDIT"],"application/vnd.adobe.animate-sym+zip":["FLPR_EDIT"]}},products:{}},VECTOR_RENDITION_ELEMENT_TYPES:["application/illustrator"],ANALYTICS_ENABLED:!1},YA="cclibraries",QA="LIBS",JA=JSON.stringify({apiVersion:12}),XA=["start","limit","selector","type","orderBy","group","owner"],ZA={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,CONFLICT:409,PRECONDITION_FAILED:412,UNSUPPOERTED_MEDIA_TYPE:415,IM_A_TEAPOT:418,INTERNAL_SERVER_ERROR:500,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503},eP="AbortError",tP=`${FA}-[a-f0-9]{8}-(?:[a-f0-9]{4}-){3}[a-f0-9]{12}`,iP=new RegExp(`^${tP}$`),sP=new RegExp(`(${tP})`),rP=()=>`${FA}-${Oi.v4()}`;function nP(e){return iP.test(e)}const oP=e=>{const[t]=sP.exec(e)||[];return t},aP=e=>Object.assign({ownership:"private",groups:[],elements:[],documentationElements:[],deletable:!0,removedElements:[],areElementsLoaded:!0,isLibraryLoaded:!0,isWritable:!0,isParentWritable:!0,details:{elementCount:0,documentationElementCount:0,removedElementCount:0},removeType:"delete"},e);function cP(e){try{if(e&&"object"==typeof e&&!Array.isArray(e))return e;const t=JSON.parse(e);if(t&&"object"==typeof t&&!Array.isArray(t))return t}catch(e){return}}function lP(e){const t=uP(e);return t?JSON.stringify(t,Object.keys(t).sort()):""}const dP=new RegExp("([^/]+);node=(.*)");function uP(e){return cP(e)||function(e){const t=e.match(dP);if(!t)return;const[,i,s]=t;return{"dc:format":"application/vnd.adobe.library+dcx","stRef:documentID":i,"stRef:fromPart":`id=${s}`}}(e)}function hP(e){var t;const i=uP(e);if(i)return{libraryAssetId:i["repo:assetId"],libraryId:i["stRef:documentID"],elementId:null===(t=i["stRef:fromPart"])||void 0===t?void 0:t.substring(3)}}function pP(e){e.sort(((e,t)=>t.size-e.size));const t=Math.ceil(e.length/6);return e.splice(0,t).reduce(((e,t)=>e+Math.round(t.size/1024*2.5)),0)}class _P extends Ge{constructor(e,t,i,s){var r;(function(e){const t=e;return!!t.code&&!!t.message})(e)&&(t=e.message,i=e.libraryId,s=null===(r=e._additionalInfo)||void 0===r?void 0:r.underlyingError,e=e.code),super(function(e){switch(e){case"EXCEEDS_QUOTA":return Ue.FULL_CLOUD_STORAGE;case"LOGGED_OUT":case"NOT_ALLOWED":return Ue.AUTHORIZATION_ERROR;case"NETWORK_ERROR":return Ue.NETWORK_ERROR;case"NOT_SUPPORTED":case"NOT_IMPLEMENTED":return Ue.UNSUPPORTED;default:return Ue.UNKNOWN}}(e),t||"",{underlyingError:s}),this.libraryErrorCode=e,this.libraryId=i}get underlyingError(){var e;return null===(e=this._additionalInfo)||void 0===e?void 0:e.underlyingError}}class mP{constructor(){this._emitter=new Os}get DANGEROUS(){return{removeAllListeners:e=>(e?this._emitter.removeAllListeners(e):this._emitter.removeAllListeners(),this)}}addListener(e,t){return this._emitter.addListener(e,t),this}on(e,t){return this.addListener(e,t)}once(e,t){return this._emitter.once(e,t),this}removeListener(e,t){return this._emitter.removeListener(e,t),this}off(e,t){return this.removeListener(e,t)}setMaxListeners(e){return this._emitter.setMaxListeners(e),this}getMaxListeners(){return this._emitter.getMaxListeners()}listeners(e){return this._emitter.listeners(e)}rawListeners(e){return this._emitter.rawListeners(e)}emit(e,...t){return this._emitter.emit(e,...t)}listenerCount(e){return this._emitter.listenerCount(e)}prependListener(e,t){return this._emitter.prependListener(e,t),this}prependOnceListener(e,t){return this._emitter.prependOnceListener(e,t),this}eventNames(){return this._emitter.eventNames()}}class fP{static get instance(){return fP._loggerInstance||(fP._loggerInstance=new fP),fP._loggerInstance}setEventEmitter(e){this._eventEmitter=e}_loggerEvent(e,t){var i;null===(i=this._eventEmitter)||void 0===i||i.emit("messageLogged",new Li(`[SAMJS LibraryContents] ${e}`,t))}log(e){this._loggerEvent(e,ml.Info)}warn(e){this._loggerEvent(e,ml.Warn)}error(e){this._loggerEvent(e,ml.Err)}info(e){this._loggerEvent(e,ml.Info)}debug(e){this._loggerEvent(e,ml.Debug)}}var gP,yP=fP.instance;class vP{constructor(e){this.data=e}get config(){return this.data.config}get user(){return this.data.user}get ignoreRenditionGrids(){return this.data.ignoreRenditionGrids}get installedApps(){return this.data.installedApps||[]}get processInfo(){return this.data.processInfo}get environment(){return this.data.environment}get renditionSize(){return this.data.config.RENDITION_SIZES}get fullRenditionConfig(){return this.data.config.FULL_RENDITION_CONFIG}}class OP extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function bP(e,t){return new Promise(((i,s)=>{const r=()=>{clearTimeout(n),null==t||t.removeEventListener("abort",r),s(new DOMException("Request aborted","AbortError"))},n=setTimeout((()=>{null==t||t.removeEventListener("abort",r),i()}),e);t&&(t.addEventListener("abort",r),t.aborted&&r())}))}!function(e){e[e.RESOLVE=0]="RESOLVE",e[e.REJECT=1]="REJECT"}(gP||(gP={}));const EP=(...e)=>{const t=new AbortController,i=()=>{t.abort(),e.forEach((e=>e.removeEventListener("abort",i)))};return e.some((e=>e.aborted))?i():e.forEach((e=>e.addEventListener("abort",i))),t.signal},IP=new class{constructor(){this.signalToReasonMap=new WeakMap}getSignal(e){var t;return null!==(t=e.signal)&&void 0!==t?t:e}reason(e){return this.signalToReasonMap.get(this.getSignal(e))}give(e,t){this.signalToReasonMap.set(this.getSignal(e),t)}};var TP;async function SP(e){var t,i,s,r;const n=[];try{for(var o,a=!0,c=Ze(e);!(t=(o=await c.next()).done);){r=o.value,a=!1;try{const e=r;n.push(...e)}finally{a=!0}}}catch(e){i={error:e}}finally{try{a||t||!(s=c.return)||await s.call(c)}finally{if(i)throw i.error}}return n}!function(e){e.CONNECTED="connected",e.CONNECTING="connecting",e.LOADING="loading",e.ERROR="error"}(TP||(TP={}));class AP extends mP{constructor(e,t){super(),this._connector=t,this._isConnected=!1,this._failedConnectionAttempt=!1,this._options={},this._config=new vP({config:{},environment:"production"}),this._cachedFetch=function(e){const t=new Map;return(...i)=>{const s=JSON.stringify(i),r=t.get(s);if(r)return r;const n=e.apply(void 0,i);return t.set(s,n),setTimeout((()=>n.finally((()=>t.delete(s))))),n}}(fetch),this._loadElementsAbortController=new AbortController,this._core=e}get config(){return this._config}get environment(){return this._config.environment}get token(){return this._token}get isConnected(){return this._isConnected}get connectionState(){return this._failedConnectionAttempt?TP.ERROR:this.isConnected?TP.CONNECTED:this._connectionPromise?TP.CONNECTING:TP.LOADING}resetAbortController(){this._abortController=new AbortController}get abortController(){return this._abortController}init(e={},t=(()=>{}),i=(()=>{})){return this._options=Object.assign(Object.assign({},this._options),e),this.on("connect",t),this.on("disconnect",i),this._options.skipConnectingOnInit?Promise.resolve():this.connect()}get _isConnectingOrConnected(){return Boolean(this._abortController&&!this._abortController.signal.aborted)}connect(){return this._isConnectingOrConnected||(this.resetAbortController(),this._connectionPromise=this._connect(),this.emit("connecting")),this._connectionPromise}async _attemptToConnect(e){const t=async t=>{try{const{future:i,cancel:s}=function(e,t){let i;return{future:new Promise(((...t)=>{i=setTimeout(t[e],1e4)})),cancel:()=>clearTimeout(i)}}(gP.REJECT),r=new AbortController,n=await Promise.race([this._connector(r.signal),i]).finally((()=>{r.abort(),s()}));return(null==e?void 0:e.aborted)?t(!1):(await this._handleConnected(n),this._isConnected=!0,t(!0))}catch(e){return t(!1)}};return new Promise((e=>t(e))).then((e=>(this._failedConnectionAttempt=!e,this._failedConnectionAttempt&&this.emit("failedConnection"),e)))}async _connect(){var e;const t=null===(e=this._abortController)||void 0===e?void 0:e.signal;for(let e=0;!await this._attemptToConnect(t);e+=1){if(void 0!==this._options.retryCount&&this._options.retryCount<=e)return void yP.log(`[DRIVER] Failed to connect to server (Attempt: ${e}). Exceeded max retries.`);const i=1e3*VA[Math.min(e,VA.length-1)];yP.log(`[DRIVER] Failed to connect to server (Attempt: ${e}). Will retry in ${i}ms.`);try{await bP(i,t)}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}}this.emit("connect",this)}disconnect(){var e,t;null===(e=this._abortController)||void 0===e||e.abort(),this._isConnected=!1,this._failedConnectionAttempt=!1,null===(t=this._handleDisconnected)||void 0===t||t.call(this),this.emit("disconnect",this)}async reconnect(){yP.warn("Process restart. Attempting to reconnect"),this.disconnect(),await this.connect()}sleep(e,t){var i,s;return bP(e,t&&(null===(i=this._abortController)||void 0===i?void 0:i.signal)?EP(t,this._abortController.signal):null===(s=this._abortController)||void 0===s?void 0:s.signal)}getAllLibraries(e,t){return SP(this.getLibraries(e,t))}getAllElements(e,t,i){return SP(this.getElements(e,t,i))}getAllDocumentationElements(e,t,i){return SP(this.getDocumentationElements(e,t,i))}getAllRemovedElements(e,t,i){return SP(this.getRemovedElements(e,t,i))}getAllGroups(e){return SP(this.getGroups(e))}publishBrand(e){throw new _P("NOT_IMPLEMENTED","Driver.publishBrand is not implemented.")}unpublishBrand(e){throw new _P("NOT_IMPLEMENTED","Driver.unpublishBrand is not implemented.")}setRenditionCacheChangeListener(e){}addWatchedLibrary(e){}removeWatchedLibrary(e){}addLibrariesSyncGroupListener(e){}removeLibrariesSyncGroupListener(){}operationFactory(e,t,i){return new e(t,i)}getOperationTypes(e){return this._operationTypes}constructOperation(e){var t;if(0===e.actions.length)return;if(this._options.readOnly)throw new _P("NOT_ALLOWED","Cannot perform write action -- in read-only mode.");const i=null===(t=this.getOperationTypes(e))||void 0===t?void 0:t.find((t=>t.supportsAction(e.actions[0])));if(!i)throw new Error;const s=this.operationFactory(i,this,e);for(const t of e.actions)if(!s.addAction(t))break;return s}getLocalSettings(){var e;const t=null!==(e=this._localStorage)&&void 0!==e?e:new Map;return{config:Object.fromEntries(t.entries())}}}class PP extends mP{constructor(){super(...arguments),this._abortController=new AbortController,this._isComplete=!1,this._progress=0}abort(){this.DANGEROUS.removeAllListeners(),this._abortController.abort()}get isComplete(){return 100===this.progress}get progress(){return this._progress}set progress(e){this._progress=Math.min(e,100)}}class wP extends Ge{static isRequestError(e){return!!e.code}constructor(e,t,i,s){super(function(e){switch(e){case"UNAUTHORIZED":case"INVALID_CREDENTIALS":return j.AUTHORIZATION_ERROR;case"REQUEST_TIMEOUT":return j.REQUEST_TIMED_OUT;case"OUT_OF_SPACE":return j.FULL_LOCAL_DISK_SPACE;case"NOT_FOUND":case"ENOENT":return j.NOT_FOUND;default:return j.UNKNOWN}}(e),t,{underlyingError:s}),this._requestErrorCode=e,this._response=i}get requestErrorCode(){return this._requestErrorCode}get response(){return this._response}get underlyingError(){return this._additionalInfo.underlyingError}set underlyingError(e){this._additionalInfo.underlyingError=e}setResponse(e){return this.response?yP.warn("Request Error response reference is already set."):this._response=e,this}}function CP(e,t){return RP(null==e?void 0:e.status,t).setResponse(e)}function RP(e,t){switch(e){case 304:return new wP("NOT_MODIFIED","Response has not changed.");case 401:return new wP("UNAUTHORIZED","Token expired or invalid");case 403:return new wP("INVALID_CREDENTIALS","You do not have access to this resource.");case 404:return new wP("ENOENT"===t?t:"NOT_FOUND","Resource not found");case 408:return new wP("REQUEST_TIMEOUT","Server could not respond in a timely manner");case 412:return new wP("PRECONDITION_FAILED","This resource does not match the requisite conditions.");case 422:return new wP("INVALID_DATA","Library is corrupt, unzipping failed.");case 507:return new wP("OUT_OF_SPACE","Hard disk ran out of space.");default:return new wP("GENERIC_ERROR",`Something went wrong: ${e}`)}}function LP(e){const t=CP(e._additionalInfo.response);return t.underlyingError=e,t}class NP{constructor(e,t,i,s,r){this.url=e,this.headers=t,this.status=i,this.statusText=s,this._text=r}get ok(){const{status:e}=this;return e>=ZA.OK&&e<ZA.MULTIPLE_CHOICES}get redirected(){return!1}get type(){return"basic"}async json(){try{return JSON.parse(this._text)}catch(e){throw new _P("INVALID_DATA",`Failed to parse JSON response from '${this.url}' async request.`,void 0,e)}}async text(){return this._text}get trailer(){throw new _P("NOT_IMPLEMENTED","AsyncResponse.trailer not implemented.")}clone(){const e=new Headers;return this.headers.forEach(((t,i)=>e.set(i,t))),new NP(this.url,e,this.status,this.statusText,this._text)}get bodyUsed(){throw new _P("NOT_IMPLEMENTED","AsyncResponse.bodyUsed not implemented.")}get body(){throw new _P("NOT_IMPLEMENTED","AsyncResponse.body not implemented.")}async arrayBuffer(){throw new _P("NOT_IMPLEMENTED","AsyncResponse.arrayBuffer not implemented.")}async blob(){throw new _P("NOT_IMPLEMENTED","AsyncResponse.blob not implemented.")}async formData(){throw new _P("NOT_IMPLEMENTED","AsyncResponse.formData not implemented.")}}const DP=function(){let e=33;const t=["^(["];for(let i=34;i<=127;++i)127!==i&&-1==='()<@,;:"/[]={}'.indexOf(String.fromCharCode(i))||(t.push("\\"+e.toString(8)),e<i-1&&t.push("-\\"+(i-1).toString(8)),e=i+1);return t.push("]+):(.*)$"),new RegExp(t.join(""))}(),MP=/^[^\s]+\s+(\d+)\s*(.*)$/;class xP{constructor(e){this._text=e,this._index=0}readLine(){const{_index:e,_text:t}=this,i=t.indexOf("\n",e);if(-1===i)return;this._index=i+1;let s=t.slice(e,i);return s.endsWith("\r")&&(s=s.slice(0,-1)),s}get remainderText(){return this._text.slice(this._index)}}class kP extends PP{constructor(e,t){super(),this._driver=e,this._handleResponse(t)}cancel(){this.abort(),this._location&&(this._driver.abortOperation(this._location),this._location=void 0)}get error(){return this._error}async _handleResponse(e){var t;try{const i=await e;if([ZA.NO_CONTENT,ZA.OK].includes(i.status)){let e,t,s;if(this.progress=100,i.status===ZA.OK&&(t=await i.text().then((t=>(e=t,function(e,t){if(!t)throw new _P("INVALID_DATA","Invalid async response body.");const i=new xP(t);let s,r;const n=i.readLine();if(n){const e=n.match(MP);if(!e)throw new _P("INVALID_DATA","Invalid status line for async response.");if(s=parseInt(e[1],10),!s)throw new _P("INVALID_DATA","Could not find status code for async response.");r=e[2]}else s=ZA.OK,r="";const o=[];let a,c=i.readLine();for(;c;){const e=c.match(DP);e?(a=e[1],o.push([a,e[2]])):a&&o.push([a,c]),c=i.readLine()}return new NP("",new Headers(o),s,r,i.remainderText)}(0,t)))).then((e=>(s=e.headers,e.json().catch((()=>{}))))).catch((()=>JSON.parse(e))).catch((()=>{yP.error(`Error parsing async response: ${i}`)}))),null==t?void 0:t.exception_code)throw new wP(t.status,t.message,i,t);return this.emit("change",!0,t,s),void this.DANGEROUS.removeAllListeners()}if(i.status===ZA.ACCEPTED){let e={};try{e=await i.json()}catch(e){}e.progress&&(this.progress=e.progress,this.emit("change"));const s=null!==(t=i.headers.get("location"))&&void 0!==t?t:e.href;s&&(this._location=s);const r=i.headers.get("retry-after")?parseInt(i.headers.get("retry-after"),10):1;if(!this._location)throw new wP("MALFORMED_RESPONSE","Location header is missing from ops monitor response");return await this._driver.sleep(1e3*r,this._abortController.signal),this._handleResponse(this._driver.fetch(this._location,{signal:this._abortController.signal}))}throw new wP("UNEXPECTED_RESPONSE",`Unexpected response from ops monitor: ${i.status}`)}catch(e){this._error=e,this.progress=100,this.emit("change",!0),this.DANGEROUS.removeAllListeners()}}}const HP={staging:{hostname:ms[os.Stage].MELVILLE_EDGE_HOST,invitation_hostname:"invitations-stage.adobe.io",teams_hostname:"ccprojects-stage.adobe.io",platform_hostname:"platform-cs-stage.adobe.io"},production:{hostname:ms[os.Production].MELVILLE_EDGE_HOST,invitation_hostname:"invitations.adobe.io",teams_hostname:"ccprojects.adobe.io",platform_hostname:"platform-cs.adobe.io"}};function jP(e,t,i){const s=i.value;i.value=async function(...e){if(0===this._actions.length)throw new _P("NOT_SUPPORTED","Operation must have at least one action to be executed.",this._library.id);return yP.log(`[OPERATION] Performing ${this._actions.length} actions.`),s.apply(this,e)}}class UP{static supportsAction(e){return this.prototype.supportsAction(e)}constructor(e,t){this._actions=[],this._driver=e,this._library=t}addAction(e){return!!this.supportsAction(e)&&(this._actions.push(e),!0)}get actions(){return this._actions}}class BP extends UP{constructor(){super(...arguments),this._actionMappers={}}get action(){return this._actions[0]}async execute(){return{actions:[await this._actionMappers[this.action.name||""](this.action)]}}addAction(e){return 1!==this._actions.length&&super.addAction(e)}}qe([jP],BP.prototype,"execute",null);const FP="platform-cs",VP=`${FP}-edge`,KP=[`https://${FP}.adobe.io/index`,`https://${FP}-stage.adobe.io/index`],$P={Priority:"u=1"};function GP(e){const t=e.split(".");if(3===t.length)try{return JSON.parse(atob(t[1]))}catch(e){return}}function WP(e){const t=GP(e);if(t)return{user:{id:t.user_id,clientId:t.client_id}}}function zP(e){const t=GP(e);if(t){const e=Date.now()-parseInt(t.created_at,10);return Math.max(parseInt(t.expires_in,10)-e,0)}}function qP(e){let t;try{t=new URL(e)}catch(t){return{url:e,headers:{}}}return t.hostname.includes(FP)?(KP.includes(e)&&(t.hostname=t.hostname.replace(FP,VP)),{url:t.href,headers:Object.assign({},$P)}):{url:e,headers:{}}}function YP(e,t=200){const{renditionUrl:i={}}=e.data,{template:s,substitutions:r={}}="string"==typeof i?{template:i}:i;if(s){const e=_t(s).fill(Object.assign(Object.assign({},r),{size:`${t}`,type:"image/png"})),{url:i}=qP(e);return i}}var QP;function JP(e,t=e.manifest.data){var i,s,r,n,o,a,c;const l=null===(i=e.manifest)||void 0===i?void 0:i.etag,d=XP(e,null===(s=t.children)||void 0===s?void 0:s.find((e=>"elements"===e.name))),u=XP(e,null===(r=t.children)||void 0===r?void 0:r.find((e=>"removed_elements"===e.name))),h=XP(e,null===(n=t.children)||void 0===n?void 0:n.find((e=>"documentation_elements"===e.name))),p=null===(o=t.children)||void 0===o?void 0:o.find((e=>"groups"===e.name)),_=(null===(a=null==p?void 0:p.children)||void 0===a?void 0:a.map((e=>({id:e.id,name:e.name,classifier:e["library#classifier"],order:e["library#order"],parentId:e["library#parentId"],sourceRef:e["library#sourceRef"],customData:tw(e)}))))||[],m={id:t.id,name:t.name,etag:l,localizedNames:t["library#localizedName"],toolkitId:t["toolkit#id"],documentId:t["library#documentId"],documentType:t["library#documentType"],createdBy:e.createdBy,modifiedBy:e.modifiedBy,createdDate:e.created.valueOf(),modifiedDate:e.modified.valueOf(),version:t.components&&t.components[0].version,roles:t["library#roles"],description:t["library#description"],details:{elementCount:d.length,documentationElementCount:h.length,removedElementCount:u.length},groups:_,elements:d,documentationElements:h,removedElements:u,customData:tw(t),isLibraryLoaded:!0,areElementsLoaded:!0,appMetadata:null===(c=e.appMetadata)||void 0===c?void 0:c.data};return t.components&&t.components[0].version&&(m.version=t.components[0].version),m}function XP(e,t){var i;return t&&(null===(i=t.children)||void 0===i?void 0:i.map((t=>{const i={id:t.id,name:t.name,isAutoNamed:t["library#autoName"],type:t.type,tags:t.tags||[],dependencyIds:t["library#dependencies"]||[],localizedNames:t["library#localizedName"],createdDate:t["library#created"],createdLocally:!1,createdContext:t["library#createdData"]||{},modifiedDate:t["library#modified"],modifiedLocally:!1,description:t["library#description"],descriptionModifiedLocally:!1,removedLocally:!1,representations:ew(e,t),groups:t["library#groups"]?Object.entries(t["library#groups"]).map((([e,{order:t}])=>{const[i,s]=e.split("#");return{id:s,classifier:i,order:t}})):[],sourceRef:t["library#sourceRef"],roles:t["library#roles"],customData:tw(t)};return function(e,t){var i;const s=e.links[QP.RENDITION],r=null===(i=null==s?void 0:s[0])||void 0===i?void 0:i.href,n=function(e=[]){let t,i=0;for(const s of e){const e=s.isFullSize?Number.POSITIVE_INFINITY:Math.max(s.height||0,s.width||0);(!t||s.isPreferredThumbnail&&!t.isPreferredThumbnail||"primary"===s.relationship&&"primary"!==t.relationship||"rendition"===s.relationship&&!["primary","rendition"].includes(null==t?void 0:t.relationship)||"rendition"===s.relationship&&"rendition"===t.relationship&&e>i)&&BA(s.type)&&(t=s,i=e)}return t}(t.representations);n&&(t.renditionUrl={template:r,substitutions:{fragment:`id=${n.id}`,size:200}})}(e,i),i})))||[]}function ZP(e,t){var i;const s=e.links[QP.COMPONENT],r=null===(i=null==s?void 0:s[0])||void 0===i?void 0:i.href,n=r&&_t(r);return null==n?void 0:n.fill({revision:t.version,component_id:t.id})}function ew(e,t){var i,s;return[...(null===(i=t.components)||void 0===i?void 0:i.map((t=>({id:t.id,type:t.type,relationship:t.rel,url:ZP(e,t),isFullSize:t["library#isFullSize"]||t["library#isfullSize"],isExternalLink:!1,width:t.width,height:t.height,contentLength:t.length,isPreferredThumbnail:t["library#isPreferredThumbnail"],customData:tw(t)}))))||[],...(null===(s=t.children)||void 0===s?void 0:s.map((e=>({id:e.id,type:e.type,linktype:e["library#linktype"],relationship:e["library#rel"],isFullSize:!1,isExternalLink:!1,customData:tw(e)}))))||[]]}function tw(e){const t={};for(const[i,s]of Object.entries(e)){const[e,r]=i.split("#");"library"!==e&&r&&(t[i]=s)}return t}!function(e){e.DOWNLOAD="http://ns.adobe.com/adobecloud/rel/download",e.MANIFEST="http://ns.adobe.com/adobecloud/rel/manifest",e.APPLICATION="http://ns.adobe.com/adobecloud/rel/metadata/application",e.EMBEDDED="http://ns.adobe.com/adobecloud/rel/metadata/embedded",e.REPOSITORY="http://ns.adobe.com/adobecloud/rel/metadata/repository",e.PRIMARY="http://ns.adobe.com/adobecloud/rel/primary",e.RENDITION="http://ns.adobe.com/adobecloud/rel/rendition",e.COMPONENT="http://ns.adobe.com/adobecloud/rel/component",e.RESOLVE="http://ns.adobe.com/adobecloud/rel/resolve/id",e.BLOCK_INIT="http://ns.adobe.com/adobecloud/rel/block/init",e.BLOCK_TRANSFER="http://ns.adobe.com/adobecloud/rel/block/transfer",e.BLOCK_FINALIZE="http://ns.adobe.com/adobecloud/rel/block/finalize"}(QP||(QP={}));const iw=/^[A-Z0-9]{30}$/,sw=["color#data","colortheme#data","channel#data","imageguideline#data","gradient#data","audio#data","font#data","characterstyle#data","paragraphstyle#data","text#data","3d#data","video#data","pattern#data","candy#data","graphic#data","clio#data","firefly#cme"];function rw(e){var t,i;const s={id:null!==(t=e.elementId)&&void 0!==t?t:Oi.v4(),name:"temp rendition element",type:e.type,createdDate:Date.now(),modifiedDate:Date.now(),representations:[{id:Oi.v4(),type:e.rendition_mimetype,relationship:"primary",isFullSize:!1,isExternalLink:!1,isPreferredThumbnail:!0}],groups:[]};switch(e.type){case"application/vnd.adobe.gradient.noise+json":case"href":s.type="application/vnd.adobe.element.image+dcx",s.renditionUrl=e.rendition,s.representations[0].type="image/png",s.representations[0].url=e.rendition;break;case"application/vnd.adobe.color+json":case"application/vnd.adobe.element.color+dcx":s.representations[0].customData={"color#data":null===(i=e.rendition.swatches[0])||void 0===i?void 0:i.find((e=>"RGB"===e.mode))};break;case"application/vnd.adobe.colortheme+json":case"application/vnd.adobe.element.colortheme+dcx":s.representations[0].type="application/vnd.adobe.colortheme+json",s.representations[0].customData={"colortheme#data":e.rendition};break;case"application/vnd.adobe.gradient+json":case"application/vnd.adobe.element.gradient+dcx":s.representations[0].customData={"gradient#data":e.rendition};break;default:return}return s}function nw(e){return"public"===e.ownership&&iw.test(e.id)}function ow(e,t=!1,i=!1){var s,r,n,o;const a=e.manifest_etag||'""',c=!t&&(e=>{const t=e.asset_acl;if(!t)return;const i=t["http://ns.adobe.com/adobecloud/rel/primary"];if(i)return i.includes("write");const s=t["*"];return!!s&&s.includes("write")})(e),l=Object.assign({id:"public"===e.ownership&&(null===(s=e.bookmark)||void 0===s?void 0:s.id)||e.id,name:e.name,ownership:"team"===e.ownership?"incoming":e.ownership,etag:a,version:e.version,default:e.default,localizedNames:e.localized_names,toolkitId:e.toolkit_id,documentId:e.document_id,documentType:e.document_type,createdDate:e.created_date,modifiedDate:e.modified_date,createdBy:e.created_by,modifiedBy:e.modified_by,groups:null===(r=e.groups)||void 0===r?void 0:r.map(cw),details:{elementCount:e.elements_count,documentationElementCount:0,removedElementCount:e.removed_elements_count},appMetadata:e.application_metadata,collaboration:e.collaboration,assetId:e.library_urn,isWritable:c,isParentWritable:!0,removeType:c?"discard":"none",deletable:c,roles:e.roles,description:e.description,owner:null===(n=e.storage_assignee)||void 0===n?void 0:n.id,ownerType:e.ownership?"team"===e.ownership?"org":"user":void 0,customData:tw(e),isLibraryLoaded:!0,publicLinkId:nw(e)?e.id:void 0,bookmark:e.bookmark},i?function(e,t){var i;if(!e||!e.main)return{};const s=rw(e.main),r=(null===(i=e.tiles)||void 0===i?void 0:i.filter(Boolean).map(rw))||[];return{renditionGrid:{main:s?{id:s.id}:void 0,tiles:r.map((e=>e?{id:e.id}:void 0)).filter(Boolean),gridGenerationEtag:t},elements:[s,...r].filter(Boolean)}}(e.rendition_grid,a):{});return(e.workspace_urn||e.parent_assetId)&&(l.team={id:null!==(o=e.workspace_urn)&&void 0!==o?o:e.parent_assetId}),l}function aw(e){var t,i,s,r,n;return{id:e.id,name:e.name,isAutoNamed:e.is_auto_named,type:e.type,tags:e.tags||[],dependencyIds:e.dependency_ids||[],localizedNames:e.localized_names||{},createdDate:e.created_date,createdLocally:!1,createdContext:(null===(t=e.details)||void 0===t?void 0:t.created)||{},modifiedDate:e.modified_date,modifiedLocally:!1,description:null===(i=e.details)||void 0===i?void 0:i.description,descriptionModifiedLocally:!1,removedLocally:!1,representations:(null===(s=e.representations)||void 0===s?void 0:s.map(dw))||[],renditionUrl:"href"===(null===(r=e.thumbnail)||void 0===r?void 0:r.type)&&e.thumbnail.rendition,groups:(null===(n=e.groups)||void 0===n?void 0:n.map(lw))||[],sourceRef:e.sourceRef,roles:e.roles,customData:tw(e),libraryAssetId:e.parent_id}}function cw(e){return{id:e.id,classifier:e.classifier,name:e.name,order:e.order,parentId:e.parent_id,createdDate:e.created_date,modifiedDate:e.modified_date,sourceRef:e.sourceRef}}function lw(e){return{id:e.id,classifier:e.classifier,order:e.order}}function dw(e){var t,i,s,r;return{id:e.id,type:e.type,linktype:e.linktype,relationship:e.relationship,isFullSize:e.is_full_size,isExternalLink:e.is_external_link,height:e.height,width:e.width,contentLength:e.content_length,url:null===(i=null===(t=e._links)||void 0===t?void 0:t["http://ns.adobe.com/melville/rel/primary"])||void 0===i?void 0:i.href,blockDownloadUrl:null===(r=null===(s=e._links)||void 0===s?void 0:s["http://ns.adobe.com/melville/rel/download"])||void 0===r?void 0:r.href,customData:{"channel#data":e["channel#data"],"imageguideline#data":e["imageguideline#data"],"color#data":e["color#data"],"characterstyle#data":e["characterstyle#data"],"paragraphstyle#data":e["paragraphstyle#data"],"gradient#data":e["gradient#data"],"colortheme#data":e["colortheme#data"],"font#data":e["font#data"],"adobestock#trackingdata":e["adobestock#trackingdata"],"firefly#cme":e["firefly#cme"]}}}function uw(e){return{name:e.name,id:e.id,isWritable:"editor"===e.collaboratorRole,owner:e.repositoryOwner,ownerName:e.repositoryName}}function hw(e){var t;return Object.assign({id:e.id,name:e.name,roles:e.roles,description:e.description,tags:e.tags,sourceRef:e.sourceRef,group:null===(t=e.groups)||void 0===t?void 0:t[0]},mw(e.customData))}function pw(e){return{id:e.id,libraryAssetId:e.parent_id,name:e.name,type:e.type,createdDate:e.created_date,modifiedDate:e.modified_date,renditionUrl:e.thumbnail.rendition,tags:e.tags,roles:e.roles,representations:e.representations.map(dw),groups:(e.groups||[]).map(lw)}}function _w(e){var t,i,s,r,n;const o=(null==(a=e.source)?void 0:a.id)&&(null==a?void 0:a.storage_href)&&(null==a?void 0:a.asset_id)&&(null==a?void 0:a.type)&&(null==a?void 0:a.content_length)&&(null==a?void 0:a.etag)&&(null==a?void 0:a.version)?e.source:void 0;var a;return Object.assign({id:null!==(t=null==o?void 0:o.id)&&void 0!==t?t:e.id,type:null!==(i=null==o?void 0:o.type)&&void 0!==i?i:e.type,relationship:e.relationship,path:e.path,is_full_size:e.isFullSize,is_external_link:e.isExternalLink,width:null!==(s=null==o?void 0:o.width)&&void 0!==s?s:e.width,height:null!==(r=null==o?void 0:o.height)&&void 0!==r?r:e.height,content_length:null!==(n=null==o?void 0:o.content_length)&&void 0!==n?n:e.contentLength,is_preferred_thumbnail:e.isPreferredThumbnail,name:null==o?void 0:o.name,storage_href:null==o?void 0:o.storage_href,asset_id:null==o?void 0:o.asset_id,etag:null==o?void 0:o.etag,md5:null==o?void 0:o.md5,version:null==o?void 0:o.version},mw(e.customData,sw))}function mw(e={},t){const i={};for(const[s,r]of Object.entries(e)){const e=s;!(null==t?void 0:t.includes(e))&&t||(i[e]=r)}return i}function fw(e,t){var i;return Object.assign(Object.assign({},hw(e)),{client:t,type:e.type,representations:null===(i=e.representations)||void 0===i?void 0:i.map(_w)})}const gw=e=>e.map((e=>{const{id:t,version:i}=e,s=ze(e,["id","version"]);return Object.assign(Object.assign({},s),{"repo:assetId":t,"repo:version":i})})),yw={read:"team_view",all:"team_edit"},vw=["createLibrary","removeLibrary","unfollowLibrary","leaveLibrary","permanentlyDeleteLibrary","copyLibrary","moveLibrary"];let Ow=class extends BP{constructor(){super(...arguments),this._actionMappers={createLibrary:e=>this._createLibraryActionMap(e),copyLibrary:e=>this._createLibraryActionMap(e),removeLibrary:async e=>(await this._removeLibrary(),e),permanentlyDeleteLibrary:async e=>(await this._permanentlyDeleteLibrary(),e),unfollowLibrary:async e=>(await this._unfollowLibrary(),e),leaveLibrary:async e=>(await this._leaveLibrary(),e),moveLibrary:async e=>{const t=await this._moveLibrary();return Object.assign(Object.assign({},e),{data:t,originalAction:e})}},this._createLibraryActionMap=async e=>{const t=await this._createLibrary(e);return Object.assign(Object.assign({},e),{type:"update",data:t,originalAction:e})}}supportsAction(e){return vw.includes(e.name)}_createLibrary(e){return new Promise(((t,i)=>{var s,r;const{name:n,team:o,roles:a,documentExtractionData:c}=null!==(s=e.data)&&void 0!==s?s:{},{permissionInheritance:l,source:d,includeAppMetadata:u}=null!==(r=e.flags)&&void 0!==r?r:{},h={name:n,roles:a,documentExtractionData:(null==c?void 0:c.length)>0?gw(c):void 0,source:null==d?void 0:d.assetId,parent_assetId:null==o?void 0:o.id,access:yw[l]||void 0,includeResources:u?[{relType:"http://ns.adobe.com/adobecloud/rel/metadata/application"},{relType:"http://ns.adobe.com/adobecloud/rel/primary"}]:void 0},p=this._driver.fetch("/api/v1/libraries?invocation_mode=async",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),_=new kP(this._driver,p);_.on("change",((e,s)=>{if(e)if(_.error)i(_.error);else if(s){const e=ow(s);(null==c?void 0:c.length)>0&&e.assetId&&this._patchBrandAppMetadata(e.assetId,"/brand:extractedFrom",gw(c)),e.isWritable=!0,e.isParentWritable=!0,t(e)}else t(void 0)}))}))}_removeLibrary(){return this._driver.fetch(`/api/v1/libraries/${this._library.assetId}`,{method:"DELETE"})}_permanentlyDeleteLibrary(){return this._driver.fetch(`/api/v1/libraries/${this._library.assetId}?permanent=true`,{method:"DELETE"})}_unfollowLibrary(){var e;return this._driver.fetch(`/api/v1/libraries/bookmarks/${null===(e=this._library.bookmark)||void 0===e?void 0:e.id}`,{method:"DELETE"})}async _leaveLibrary(){var e,t;const i=null===(e=this._driver.config.user)||void 0===e?void 0:e.id,s=await this._driver.fetch(`https://${this._driver.driverConfig.invitation_hostname}/api/v4/share/${this._library.assetId}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({collaborators:[{action:"remove",id:i}]})});if(null===(t=(await s.json()).collaborators)||void 0===t?void 0:t.find((e=>e.statusCode>300)))throw CP(s);return this._unfollowLibrary()}_moveLibrary(){return this._driver.moveLibrary(this._library.assetId,this.action.data.team.id,this.action.data.owner)}async _patchBrandAppMetadata(e,t,i){var s;const r=await(null===(s=this._driver._core)||void 0===s?void 0:s.hostAssetContext.getAssetWithCloudID(e));null==r||r.patchAppMetadata([{op:"add",path:t,value:i}])}};qe([ES],Ow.prototype,"_createLibrary",null),Ow=qe([bS("CloudSingleOperation")],Ow);var bw=Ow;const Ew=e=>e.replace(/ |\t|\n/g,""),Iw=/^(\$\.(?:elements|removedElements|documentationElements))\[\?\(@\.id=="([^"]+)"\)\]$/,Tw=/^\$\.groups\[\?\(@\.id=="([^"]+)"\)\]$/;function Sw(e){e=Ew(e);const[,,t]=Iw.exec(e)||[];return t}function Aw(e){e=Ew(e);const[,t]=Iw.exec(e)||[];return t}function Pw(e){e=Ew(e);const[,t]=Tw.exec(e)||[];return t}class ww extends UP{supportsAction(e){return["moveElement","copyElement","dependent"].includes(e.name)}addAction(e){var t,i,s,r,n,o;if(!this.supportsAction(e))return!1;const a=this._actions[this._actions.length-1];return a||"dependent"===e.name?e.library===(null===(t=e.link)||void 0===t?void 0:t.library)?"dependent"===e.name?a.link===e&&(this._actions.push(e),!0):(null===(i=e.library)||void 0===i?void 0:i.actions.indexOf(e))+1===(null===(r=null===(s=e.link)||void 0===s?void 0:s.library)||void 0===r?void 0:r.actions.indexOf(e.link))&&super.addAction(e):(null===(n=a.link)||void 0===n?void 0:n.library)===(null===(o=e.link)||void 0===o?void 0:o.library)&&a.type===e.type&&super.addAction(e):super.addAction(e)}async execute(){var e;const t="moveElement"===this._actions[0].name,i=null===(e=this._actions[0].link)||void 0===e?void 0:e.library,s=this._actions.filter((e=>"dependent"!==e.name)),r=s.map((e=>Sw(e.path))),{elements:n,etag:o,sourceEtag:a}=await this._doMoveCopyRequest(t,this._library,i,r);if(n.length!==s.length)throw new Error;let c,l;return i===this._library?(c=[],l=this._actions.map((e=>{if("dependent"!==e.name)return e;const t=s.findIndex((t=>t===e.link||t.originalAction===e.link));return Object.assign(Object.assign({},e),{data:n[t],originalAction:e})}))):(l=this._actions,c=this._actions.map(((e,t)=>Object.assign(Object.assign({},e.link),{data:n[t],originalAction:e.link})))),{actions:l,etag:a,linkedActions:c,linkedEtag:o}}}qe([jP],ww.prototype,"execute",null);class Cw extends ww{async _doMoveCopyRequest(e,t,i,s){const r=this._library.assetId,n=i.assetId,o=await this._driver.fetch(`/api/v1/libraries/${n}/elements`,{method:"POST",headers:{"Content-Type":"application/json","If-Match":i.etag},body:JSON.stringify({[e?"self":"source"]:{id:r,elements:s,"if-match":this._library.etag}})});return{elements:(await o.json()).elements.map(aw),etag:o.headers.get("etag"),sourceEtag:o.headers.get("x-source-etag")}}}function Rw(e){return"undefined"!=typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}function Lw(e,t,i){var s;const r=i.reduce(((e,i)=>i(e,t)),e);return r!==e&&(r.originalAction=e),"aggregate"===r.type&&(r.actions=null===(s=r.actions)||void 0===s?void 0:s.map((e=>Lw(e,t,i)))),r}function Nw(e,t){var i,s,r;t||(t=e);const n={};for(const t of e)nP(null===(s=null===(i=t.originalAction)||void 0===i?void 0:i.data)||void 0===s?void 0:s.id)&&(n[null===(r=t.originalAction)||void 0===r?void 0:r.data.id]=t.data);const o=[Dw,Mw,xw];return t.map((e=>Lw(e,n,o)))}function Dw(e,t){var i;const s=e.path&&function(e){const t=Sw(e)||Pw(e);return nP(t)&&t}(e.path);if(s){const a=null===(i=t[s])||void 0===i?void 0:i.id;if(a)return Object.assign(Object.assign({},e),{path:(r=e.path,n=s,o=a,r.replace(n,o))})}var r,n,o;return e}function Mw(e,t){var i,s,r,n,o,a,c,l,d,u;let h=!1;const p=[];if(null===(s=null===(i=e.data)||void 0===i?void 0:i.groups)||void 0===s||s.forEach((e=>{var i;if(e.id&&nP(e.id)){const s=null===(i=t[e.id])||void 0===i?void 0:i.id;if(s)return h=!0,void p.push(Object.assign(Object.assign({},e),{id:s}))}p.push(e)})),h)return Object.assign(Object.assign({},e),{data:Object.assign(Object.assign({},e.data),{groups:p})});if((null===(r=e.data)||void 0===r?void 0:r.id)&&nP(null===(n=e.data)||void 0===n?void 0:n.id)){const i=null===(a=t[null===(o=e.data)||void 0===o?void 0:o.id])||void 0===a?void 0:a.id;i&&(e.data.id=i)}if((null===(c=e.data)||void 0===c?void 0:c.parentId)&&nP(null===(l=e.data)||void 0===l?void 0:l.parentId)){const i=null===(u=t[null===(d=e.data)||void 0===d?void 0:d.parentId])||void 0===u?void 0:u.id;i&&(e.data.parentId=i)}return e}function xw(e,t){var i,s;const r=[];let n=!1;const o=e=>{let i=Object.assign({},e);if(e.id&&nP(e.id)){const s=t[e.id];s&&(i=s,n=!0)}return i};return null===(s=null===(i=e.data)||void 0===i?void 0:i.representations)||void 0===s||s.forEach((e=>{e.source&&(e.source=o(e.source)),r.push(o(e))})),n?Object.assign(Object.assign({},e),{data:Object.assign(Object.assign({},e.data),{representations:r})}):e}function kw(e){var t;const i={};for(let s=0;s<e.length;s+=1){const r=e[s],n=null===(t=r.body)||void 0===t?void 0:t.id;if("POST"===r.method&&nP(n)&&(i[n]=`$${s}.id`,delete r.body.id),["PUT","DELETE"].includes(r.method)){const e=oP(r.path);if(e){if(!i[e])throw new Error(`Unmapped placeholder ID: ${e}`);r.path=r.path.replace(e,i[e])}}if(["PUT","POST"].includes(r.method)){if(r.path.startsWith("elements")&&r.body.representations&&jw(r.body.representations),r.path.startsWith("elements")&&r.body.groups)for(const e of r.body.groups)if(nP(e.id)){if(!i[e.id])throw new Error(`Unmapped placeholder ID: ${e.id}`);e.id=i[e.id]}if(r.path.startsWith("groups")&&r.body.parent_id&&nP(r.body.parent_id)){if(!i[r.body.parent_id])throw new Error(`Unmapped placeholder ID: ${r.body.parent_id}`);r.body.parent_id=i[r.body.parent_id]}}}return e}function Hw(e,t){const i={};for(const[s,r]of Object.entries(e))(void 0!==r||(null==t?void 0:t.includes(s)))&&(i[s]=r);return i}function jw(e){for(const t of e)nP(t.id)&&(t.id=void 0);return e}const Uw=["updateLibrary","createElement","updateElement","removeElement","restoreElement","deleteElement","createGroup","removeGroup"];function Bw(e,t){return Object.assign(Object.assign({},e),{data:t,originalAction:e})}const Fw={updateLibrary:(e,t)=>Bw(e,Hw(ow(t,!1,!1),["documentId","documentType","roles"])),createElement:(e,t)=>Bw(e,aw(t.elements[0])),updateElement:(e,t)=>Bw(e,aw(t.elements[0])),restoreElement:e=>e,removeElement:e=>e,deleteElement:e=>e,createGroup:(e,t)=>Bw(e,cw(t)),removeGroup:e=>e};let Vw=class extends UP{constructor(){super(...arguments),this._baseLibraryOperationPath=`/api/v1/libraries/${this._library.assetId}`,this._actionMappers={updateLibrary:e=>{return{method:"PUT",path:"metadata",body:(t=e.data,Object.assign({name:t.name,document_id:t.documentId,roles:t.roles,description:t.description},mw(t.customData)))};var t},createElement:e=>({method:"POST",path:"elements",body:fw(e.data,this._driver.getClientInfo())}),updateElement:e=>({method:"PUT",path:"elements/metadata",body:{elements:[hw(Object.assign({id:Sw(e.path)},e.data))]}}),removeElement:e=>({method:"DELETE",path:`elements/${Sw(e.path)}`}),restoreElement:e=>({method:"POST",path:"archive",body:{elementIds:[`${e.data.id}`]}}),deleteElement:e=>({method:"DELETE",path:`elements/${Sw(e.path)}`,query_params:{permanent:"true"}}),createGroup:e=>{return{method:"POST",path:"groups",body:(t=e.data,i=this._driver.getClientInfo(),{group:{name:t.name,classifier:t.classifier,order:t.order,parent_id:t.parentId},client:i})};var t,i},removeGroup:e=>{var t;return{method:"DELETE",path:`groups/${Pw(e.path)}`,query_params:(null===(t=e.flags)||void 0===t?void 0:t.includeElements)?{include_contents:"true"}:void 0}}},this._actions=[]}async execute(){const e=kw(this._actions.map((e=>this._actionMappers[e.name](e)))),t=await this._driver.fetch(this._baseLibraryOperationPath,{method:"PATCH",headers:{"Content-Type":"application/json","If-Match":this._library.etag},body:JSON.stringify({requests:e.map((e=>Object.assign(Object.assign({},e),{path:`${this._baseLibraryOperationPath}/${e.path}`})))})}),{responses:i}=await t.json();if(!Array.isArray(i)||i.length!==this._actions.length)throw new _P("INVALID_RESPONSE","Malformed batch response.",this._library.id);let s=this._actions.map(((e,t)=>Fw[e.name](e,i[t])));return s=Nw(s),{actions:s,etag:t.headers.get("ETag")}}supportsAction(e){return function(e){return Uw.includes(e.name)}(e)}};qe([jP,ES],Vw.prototype,"execute",null),Vw=qe([bS("BatchOperation")],Vw);var Kw=Vw;let $w=class extends UP{supportsAction(e){return"updateElementContent"===e.name}addAction(e){return(!this._actions[0]||this._actions[0].path===e.path)&&super.addAction(e)}async execute(){const e=this._actions[this._actions.length-1],t=await this._updateElementContent(Sw(e.path),e.data),i=aw((await t.json()).elements[0]),s=this._actions.map(((e,t)=>t!==this._actions.length-1?Object.assign(Object.assign({},e),{type:"no-op",originalAction:e}):Object.assign(Object.assign({},e),{data:i,originalAction:e})));return{actions:s,etag:t.headers.get("ETag")}}_updateElementContent(e,t){return jw(t.representations),this._driver.fetch(`/api/v1/libraries/${this._library.assetId}/elements/${e}/representations`,{method:"PUT",headers:{"If-Match":this._library.etag,"Content-Type":"application/json"},body:JSON.stringify(fw(t,this._driver.getClientInfo()))})}};qe([jP,ES],$w.prototype,"execute",null),$w=qe([bS("ContentOperation")],$w);var Gw=$w;class Ww extends UP{constructor(){super(...arguments),this._actionMappers={}}async execute(){const e=this.actions.map((e=>this._actionMappers[e.name](e)));return{actions:await Promise.all(e)}}}qe([jP],Ww.prototype,"execute",null);class zw extends Ww{constructor(){super(...arguments),this._actionMappers={uploadComponent:async e=>{const t=JSON.parse(await this._driver.stageRepresentationForCommit(e.library,e.data.file,e.data.type));return Object.assign(Object.assign({},e),{data:t,originalAction:e})}}}supportsAction(e){return"uploadComponent"===e.name}}function qw(e){const t=e.match(/^<(.*)>;/);if(!t)return;const i={href:t[1]},s=e.matchAll(/\s([\w:]*)="([^"]*)"[;,]?/g);for(const e of s){const t=e[1],s=e[2];i[t]=Yw(s)}return i}function Yw(e){if("true"===e||"false"===e)return"true"===e;const t=+e;return isNaN(t)?e:t}var Qw={},Jw=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)),Xw="%[a-f0-9]{2}",Zw=new RegExp(Xw,"gi"),eC=new RegExp("("+Xw+")+","gi");function tC(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var i=e.slice(0,t),s=e.slice(t);return Array.prototype.concat.call([],tC(i),tC(s))}function iC(e){try{return decodeURIComponent(e)}catch(s){for(var t=e.match(Zw),i=1;i<t.length;i++)t=(e=tC(t,i).join("")).match(Zw);return e}}var sC=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"","%FF%FE":""},i=eC.exec(e);i;){try{t[i[0]]=decodeURIComponent(i[0])}catch(e){var s=iC(i[0]);s!==i[0]&&(t[i[0]]=s)}i=eC.exec(e)}t["%C2"]="";for(var r=Object.keys(t),n=0;n<r.length;n++){var o=r[n];e=e.replace(new RegExp(o,"g"),t[o])}return e}(e)}},rC=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const i=e.indexOf(t);return-1===i?[e]:[e.slice(0,i),e.slice(i+t.length)]},nC=function(e,t){for(var i={},s=Object.keys(e),r=Array.isArray(t),n=0;n<s.length;n++){var o=s[n],a=e[o];(r?-1!==t.indexOf(o):t(o,a,e))&&(i[o]=a)}return i};!function(e){const t=Jw,i=sC,s=rC,r=nC;function n(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function o(e,i){return i.encode?i.strict?t(e):encodeURIComponent(e):e}function a(e,t){return t.decode?i(e):e}function c(e){return Array.isArray(e)?e.sort():"object"==typeof e?c(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function l(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function d(e){const t=(e=l(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function u(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function h(e,t){n((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const i=function(e){let t;switch(e.arrayFormat){case"index":return(e,i,s)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===s[e]&&(s[e]={}),s[e][t[1]]=i):s[e]=i};case"bracket":return(e,i,s)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==s[e]?s[e]=[].concat(s[e],i):s[e]=[i]:s[e]=i};case"comma":case"separator":return(t,i,s)=>{const r="string"==typeof i&&i.includes(e.arrayFormatSeparator),n="string"==typeof i&&!r&&a(i,e).includes(e.arrayFormatSeparator);i=n?a(i,e):i;const o=r||n?i.split(e.arrayFormatSeparator).map((t=>a(t,e))):null===i?i:a(i,e);s[t]=o};case"bracket-separator":return(t,i,s)=>{const r=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!r)return void(s[t]=i?a(i,e):i);const n=null===i?[]:i.split(e.arrayFormatSeparator).map((t=>a(t,e)));void 0!==s[t]?s[t]=[].concat(s[t],n):s[t]=n};default:return(e,t,i)=>{void 0!==i[e]?i[e]=[].concat(i[e],t):i[e]=t}}}(t),r=Object.create(null);if("string"!=typeof e)return r;if(!(e=e.trim().replace(/^[?#&]/,"")))return r;for(const n of e.split("&")){if(""===n)continue;let[e,o]=s(t.decode?n.replace(/\+/g," "):n,"=");o=void 0===o?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?o:a(o,t),i(a(e,t),o,r)}for(const e of Object.keys(r)){const i=r[e];if("object"==typeof i&&null!==i)for(const e of Object.keys(i))i[e]=u(i[e],t);else r[e]=u(i,t)}return!1===t.sort?r:(!0===t.sort?Object.keys(r).sort():Object.keys(r).sort(t.sort)).reduce(((e,t)=>{const i=r[t];return Boolean(i)&&"object"==typeof i&&!Array.isArray(i)?e[t]=c(i):e[t]=i,e}),Object.create(null))}e.extract=d,e.parse=h,e.stringify=(e,t)=>{if(!e)return"";n((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const i=i=>t.skipNull&&null==e[i]||t.skipEmptyString&&""===e[i],s=function(e){switch(e.arrayFormat){case"index":return t=>(i,s)=>{const r=i.length;return void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?i:null===s?[...i,[o(t,e),"[",r,"]"].join("")]:[...i,[o(t,e),"[",o(r,e),"]=",o(s,e)].join("")]};case"bracket":return t=>(i,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?i:null===s?[...i,[o(t,e),"[]"].join("")]:[...i,[o(t,e),"[]=",o(s,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return i=>(s,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?s:(r=null===r?"":r,0===s.length?[[o(i,e),t,o(r,e)].join("")]:[[s,o(r,e)].join(e.arrayFormatSeparator)])}default:return t=>(i,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?i:null===s?[...i,o(t,e)]:[...i,[o(t,e),"=",o(s,e)].join("")]}}(t),r={};for(const t of Object.keys(e))i(t)||(r[t]=e[t]);const a=Object.keys(r);return!1!==t.sort&&a.sort(t.sort),a.map((i=>{const r=e[i];return void 0===r?"":null===r?o(i,t):Array.isArray(r)?0===r.length&&"bracket-separator"===t.arrayFormat?o(i,t)+"[]":r.reduce(s(i),[]).join("&"):o(i,t)+"="+o(r,t)})).filter((e=>e.length>0)).join("&")},e.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[i,r]=s(e,"#");return Object.assign({url:i.split("?")[0]||"",query:h(d(e),t)},t&&t.parseFragmentIdentifier&&r?{fragmentIdentifier:a(r,t)}:{})},e.stringifyUrl=(t,i)=>{i=Object.assign({encode:!0,strict:!0},i);const s=l(t.url).split("?")[0]||"",r=e.extract(t.url),n=e.parse(r,{sort:!1}),a=Object.assign(n,t.query);let c=e.stringify(a,i);c&&(c=`?${c}`);let d=function(e){let t="";const i=e.indexOf("#");return-1!==i&&(t=e.slice(i)),t}(t.url);return t.fragmentIdentifier&&(d=`#${o(t.fragmentIdentifier,i)}`),`${s}${c}${d}`},e.pick=(t,i,s)=>{s=Object.assign({parseFragmentIdentifier:!0},s);const{url:n,query:o,fragmentIdentifier:a}=e.parseUrl(t,s);return e.stringifyUrl({url:n,query:r(o,i),fragmentIdentifier:a},s)},e.exclude=(t,i,s)=>{const r=Array.isArray(i)?e=>!i.includes(e):(e,t)=>!i(e,t);return e.pick(t,r,s)}}(Qw);var oC,aC,cC={exports:{}},lC={exports:{}};oC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",aC={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&aC.rotl(e,8)|4278255360&aC.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=aC.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],i=0,s=0;i<e.length;i++,s+=8)t[s>>>5]|=e[i]<<24-s%32;return t},wordsToBytes:function(e){for(var t=[],i=0;i<32*e.length;i+=8)t.push(e[i>>>5]>>>24-i%32&255);return t},bytesToHex:function(e){for(var t=[],i=0;i<e.length;i++)t.push((e[i]>>>4).toString(16)),t.push((15&e[i]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],i=0;i<e.length;i+=2)t.push(parseInt(e.substr(i,2),16));return t},bytesToBase64:function(e){for(var t=[],i=0;i<e.length;i+=3)for(var s=e[i]<<16|e[i+1]<<8|e[i+2],r=0;r<4;r++)8*i+6*r<=8*e.length?t.push(oC.charAt(s>>>6*(3-r)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],i=0,s=0;i<e.length;s=++i%4)0!=s&&t.push((oC.indexOf(e.charAt(i-1))&Math.pow(2,-2*s+8)-1)<<2*s|oC.indexOf(e.charAt(i))>>>6-2*s);return t}},lC.exports=aC;var dC={utf8:{stringToBytes:function(e){return dC.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(dC.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],i=0;i<e.length;i++)t.push(255&e.charCodeAt(i));return t},bytesToString:function(e){for(var t=[],i=0;i<e.length;i++)t.push(String.fromCharCode(e[i]));return t.join("")}}},uC=dC,hC=function(e){return null!=e&&(pC(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&pC(e.slice(0,0))}(e)||!!e._isBuffer)};function pC(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}!function(){var e=lC.exports,t=uC.utf8,i=hC,s=uC.bin,r=function(n,o){n.constructor==String?n=o&&"binary"===o.encoding?s.stringToBytes(n):t.stringToBytes(n):i(n)?n=Array.prototype.slice.call(n,0):Array.isArray(n)||n.constructor===Uint8Array||(n=n.toString());for(var a=e.bytesToWords(n),c=8*n.length,l=1732584193,d=-271733879,u=-1732584194,h=271733878,p=0;p<a.length;p++)a[p]=16711935&(a[p]<<8|a[p]>>>24)|4278255360&(a[p]<<24|a[p]>>>8);a[c>>>5]|=128<<c%32,a[14+(c+64>>>9<<4)]=c;var _=r._ff,m=r._gg,f=r._hh,g=r._ii;for(p=0;p<a.length;p+=16){var y=l,v=d,O=u,b=h;l=_(l,d,u,h,a[p+0],7,-680876936),h=_(h,l,d,u,a[p+1],12,-389564586),u=_(u,h,l,d,a[p+2],17,606105819),d=_(d,u,h,l,a[p+3],22,-1044525330),l=_(l,d,u,h,a[p+4],7,-176418897),h=_(h,l,d,u,a[p+5],12,1200080426),u=_(u,h,l,d,a[p+6],17,-1473231341),d=_(d,u,h,l,a[p+7],22,-45705983),l=_(l,d,u,h,a[p+8],7,1770035416),h=_(h,l,d,u,a[p+9],12,-1958414417),u=_(u,h,l,d,a[p+10],17,-42063),d=_(d,u,h,l,a[p+11],22,-1990404162),l=_(l,d,u,h,a[p+12],7,1804603682),h=_(h,l,d,u,a[p+13],12,-40341101),u=_(u,h,l,d,a[p+14],17,-1502002290),l=m(l,d=_(d,u,h,l,a[p+15],22,1236535329),u,h,a[p+1],5,-165796510),h=m(h,l,d,u,a[p+6],9,-1069501632),u=m(u,h,l,d,a[p+11],14,643717713),d=m(d,u,h,l,a[p+0],20,-373897302),l=m(l,d,u,h,a[p+5],5,-701558691),h=m(h,l,d,u,a[p+10],9,38016083),u=m(u,h,l,d,a[p+15],14,-660478335),d=m(d,u,h,l,a[p+4],20,-405537848),l=m(l,d,u,h,a[p+9],5,568446438),h=m(h,l,d,u,a[p+14],9,-1019803690),u=m(u,h,l,d,a[p+3],14,-187363961),d=m(d,u,h,l,a[p+8],20,1163531501),l=m(l,d,u,h,a[p+13],5,-1444681467),h=m(h,l,d,u,a[p+2],9,-51403784),u=m(u,h,l,d,a[p+7],14,1735328473),l=f(l,d=m(d,u,h,l,a[p+12],20,-1926607734),u,h,a[p+5],4,-378558),h=f(h,l,d,u,a[p+8],11,-2022574463),u=f(u,h,l,d,a[p+11],16,1839030562),d=f(d,u,h,l,a[p+14],23,-35309556),l=f(l,d,u,h,a[p+1],4,-1530992060),h=f(h,l,d,u,a[p+4],11,1272893353),u=f(u,h,l,d,a[p+7],16,-155497632),d=f(d,u,h,l,a[p+10],23,-1094730640),l=f(l,d,u,h,a[p+13],4,681279174),h=f(h,l,d,u,a[p+0],11,-358537222),u=f(u,h,l,d,a[p+3],16,-722521979),d=f(d,u,h,l,a[p+6],23,76029189),l=f(l,d,u,h,a[p+9],4,-640364487),h=f(h,l,d,u,a[p+12],11,-421815835),u=f(u,h,l,d,a[p+15],16,530742520),l=g(l,d=f(d,u,h,l,a[p+2],23,-995338651),u,h,a[p+0],6,-198630844),h=g(h,l,d,u,a[p+7],10,1126891415),u=g(u,h,l,d,a[p+14],15,-1416354905),d=g(d,u,h,l,a[p+5],21,-57434055),l=g(l,d,u,h,a[p+12],6,1700485571),h=g(h,l,d,u,a[p+3],10,-1894986606),u=g(u,h,l,d,a[p+10],15,-1051523),d=g(d,u,h,l,a[p+1],21,-2054922799),l=g(l,d,u,h,a[p+8],6,1873313359),h=g(h,l,d,u,a[p+15],10,-30611744),u=g(u,h,l,d,a[p+6],15,-1560198380),d=g(d,u,h,l,a[p+13],21,1309151649),l=g(l,d,u,h,a[p+4],6,-145523070),h=g(h,l,d,u,a[p+11],10,-1120210379),u=g(u,h,l,d,a[p+2],15,718787259),d=g(d,u,h,l,a[p+9],21,-343485551),l=l+y>>>0,d=d+v>>>0,u=u+O>>>0,h=h+b>>>0}return e.endian([l,d,u,h])};r._ff=function(e,t,i,s,r,n,o){var a=e+(t&i|~t&s)+(r>>>0)+o;return(a<<n|a>>>32-n)+t},r._gg=function(e,t,i,s,r,n,o){var a=e+(t&s|i&~s)+(r>>>0)+o;return(a<<n|a>>>32-n)+t},r._hh=function(e,t,i,s,r,n,o){var a=e+(t^i^s)+(r>>>0)+o;return(a<<n|a>>>32-n)+t},r._ii=function(e,t,i,s,r,n,o){var a=e+(i^(t|~s))+(r>>>0)+o;return(a<<n|a>>>32-n)+t},r._blocksize=16,r._digestsize=16,cC.exports=function(t,i){if(null==t)throw new Error("Illegal argument "+t);var n=e.wordsToBytes(r(t,i));return i&&i.asBytes?n:i&&i.asString?s.bytesToString(n):e.bytesToHex(n)}}();var _C=cC.exports;const mC={field:"modifiedDate",direction:"descending"},fC={modifiedDate:"modified_date",name:"name"};class gC{constructor(e){this._driver=e}routePublicLibraryRequestIfNeeded(e,t,i,...s){return i(e.id,...s)}getLibraryParams(e){return{modifiedDate:e.modified,areElementsLoaded:e.areElementsLoaded,elements:e.data.elements}}getLibraryByPublicLinkId(e,t,i={}){var s,r;return Je(this,arguments,(function*(){try{const s=yield Qe(this._getLibrary(e));if((null==t?void 0:t.areElementsLoaded)&&(s.elements=t.elements),yield yield Qe(s),(null==t?void 0:t.areElementsLoaded)&&t.modifiedDate===s.modifiedDate)return yield Qe(void 0);yield Qe(yield*Xe(Ze(this._getAllElements(e,Object.assign({},i.elementParams)))))}catch(e){if(!(null===(r=null===(s=i.elementParams)||void 0===s?void 0:s.abortController)||void 0===r?void 0:r.signal.aborted))throw e}}))}getElementsByPublicLinkId(e,t,i=mC,s=100,r){return Je(this,arguments,(function*(){const t=`${"descending"===i.direction?"-":""}${fC[i.field]}`,n={limit:s,orderBy:t,selector:["default","representations","details"]};yield Qe(yield*Xe(Ze(this.fetchAllPages(`/api/v1/public/libraries/${e}/elements?${Qw.stringify(n,{arrayFormat:"comma"})}`,(e=>e.elements.map(aw)),r))))}))}getRemovedElementsByPublicLinkId(e,t,i=mC,s=100,r){return Je(this,arguments,(function*(){return yield Qe(void 0)}))}getDocumentationElementsByPublicLinkId(e,t,i=mC,s=100,r){return Je(this,arguments,(function*(){return yield Qe(void 0)}))}getElement(e,t,i){return this.fetch(`/api/v1/public/libraries/${e}/elements/${i}?selector=default,representations,details,tags`).then((e=>e.json())).then((e=>aw(e)))}_getLibrary(e){return this.fetch(`/api/v1/public/libraries/${e}?selector=default,rendition_grid,details`).then((e=>e.json())).then((e=>ow(e,!0)))}_getAllElements(e,t){var i,s,r;return Je(this,arguments,(function*(){var n,o,a,c;const l=[["elements","getElementsByPublicLinkId"],["documentationElements","getDocumentationElementsByPublicLinkId"],["removedElements","getRemovedElementsByPublicLinkId"]],d={};for(const[_,m]of l)if(null===(i=null==t?void 0:t.types)||void 0===i?void 0:i.includes(_))try{for(var u,h=!0,p=(o=void 0,Ze(this[m](e,void 0,null==t?void 0:t.sort,void 0,null===(s=null==t?void 0:t.abortController)||void 0===s?void 0:s.signal)));!(n=(u=yield Qe(p.next())).done);){c=u.value,h=!1;try{const e=c;d[_]=d[_]||[],null===(r=d[_])||void 0===r||r.push(...e),(null==t?void 0:t.loadProgressively)&&(yield yield Qe({[_]:d[_]}))}finally{h=!0}}}catch(e){o={error:e}}finally{try{h||n||!(a=p.return)||(yield Qe(a.call(p)))}finally{if(o)throw o.error}}yield yield Qe(Object.assign({areElementsLoaded:!0},t.loadProgressively?{}:d))}))}fetchAllPages(e,t,i){var s,r;return Je(this,arguments,(function*(){let n,o=e;for(;o;){const e=yield Qe(this.fetch(o,{signal:i}).then((e=>e.json())));yield yield Qe(t(e)),null!=n||(n=e.total_count);const a=null===(r=null===(s=e._links)||void 0===s?void 0:s.page)||void 0===r?void 0:r.href,c=e._page,l=a&&_t(a),d=parseInt(c.start)+c.count;if(!l||!c||d>n)return yield Qe(void 0);o=l.fill({orderBy:c.orderBy,start:`${d}`,limit:`${c.count}`,selector:"default,representations,details"})}}))}fetch(e,t){var i,s;return(null===(i=this._driver.config.user)||void 0===i?void 0:i.id)&&((t=t||{}).headers=t.headers||{},t.headers["x-gw-ims-user-id"]=null===(s=this._driver.config.user)||void 0===s?void 0:s.id),this._driver.fetch(e,t)}}class yC extends mP{constructor(e){super(),this._driver=e,this._onChangeCallback=(e,t,i)=>{var s;const r=i;null===(s=this._changeCallback)||void 0===s||s.call(this,r)}}connect(){var e,t;this._librariesToMonitor=null===(e=this._driver._core)||void 0===e?void 0:e.assetLinkManager.createList(),null===(t=this._librariesToMonitor)||void 0===t||t.on("notified",this._onChangeCallback)}disconnect(){var e,t;this._changeCallback=void 0,null===(e=this._librariesToMonitor)||void 0===e||e.clear(),null===(t=this._librariesToMonitor)||void 0===t